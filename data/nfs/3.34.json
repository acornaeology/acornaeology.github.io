{"meta": {"load_addr": 32768, "end_addr": 40960}, "constants": [{"name": "adlc_cr1", "value": 65184}, {"name": "adlc_cr2", "value": 65185}, {"name": "adlc_tx", "value": 65186}, {"name": "adlc_tx2", "value": 65187}, {"name": "econet_station_id", "value": 65048}, {"name": "econet_nmi_enable", "value": 65056}, {"name": "romsel", "value": 65072}, {"name": "port_command", "value": 153}, {"name": "port_reply", "value": 144}, {"name": "port_save_ack", "value": 145}, {"name": "port_load_data", "value": 146}, {"name": "port_remote", "value": 147}, {"name": "port_printer", "value": 209}, {"name": "err_line_jammed", "value": 160}, {"name": "err_net_error", "value": 161}, {"name": "err_not_listening", "value": 162}, {"name": "err_no_clock", "value": 163}, {"name": "err_tx_cb_error", "value": 164}, {"name": "err_no_reply", "value": 165}, {"name": "err_fs_cutoff", "value": 168}, {"name": "tx_flag", "value": 128}, {"name": "rx_ready", "value": 127}, {"name": "handle_base", "value": 32}, {"name": "cb_stop", "value": 254}, {"name": "cb_skip", "value": 253}, {"name": "cb_fill", "value": 252}, {"name": "osbyte_explode_chars", "value": 20}, {"name": "osbyte_write_keys_pressed", "value": 120}, {"name": "osbyte_issue_service_request", "value": 143}, {"name": "osbyte_read_rom_ptr_table_low", "value": 168}, {"name": "osbyte_read_write_econet_keyboard_disable", "value": 201}, {"name": "osbyte_scan_keyboard_from_16", "value": 122}, {"name": "osbyte_read_write_last_break_type", "value": 253}, {"name": "osbyte_printer_driver_going_dormant", "value": 123}, {"name": "osbyte_close_spool_exec", "value": 119}, {"name": "osbyte_read_write_spool_file_handle", "value": 199}, {"name": "osbyte_acknowledge_escape", "value": 126}, {"name": "osbyte_insert_input_buffer", "value": 153}, {"name": "osbyte_read_buffer", "value": 145}, {"name": "buffer_printer", "value": 3}, {"name": "osword_read_palette", "value": 11}, {"name": "osfind_close", "value": 0}, {"name": "osbyte_read_tube_presence", "value": 234}], "subroutines": [{"addr": 65465, "name": "osrdsc"}, {"addr": 65468, "name": "vduchr"}, {"addr": 65471, "name": "oseven"}, {"addr": 65486, "name": "osfind"}, {"addr": 65480, "name": "nvrdch"}, {"addr": 65483, "name": "nvwrch"}, {"addr": 65489, "name": "osgbpb"}, {"addr": 65492, "name": "osbput"}, {"addr": 65495, "name": "osbget"}, {"addr": 65498, "name": "osargs"}, {"addr": 65504, "name": "osrdch"}, {"addr": 65507, "name": "osasci"}, {"addr": 65511, "name": "osnewl"}, {"addr": 65516, "name": "oswrcr"}, {"addr": 65518, "name": "oswrch"}, {"addr": 65524, "name": "osbyte"}, {"addr": 65521, "name": "osword"}, {"addr": 65501, "name": "osfile"}, {"addr": 65527, "name": "oscli"}, {"addr": 34056, "name": "save_fscv_args", "title": "Save FSCV/vector arguments", "description": "Stores A, X, Y into the filing system workspace. Called at the\nstart of every FS vector handler (FILEV, ARGSV, BGETV, BPUTV,\nGBPBV, FINDV, FSCV). NFS repurposes CFS/RFS workspace locations:\n  &BD (fs_last_byte_flag) = A (function code / command)\n  &BB (fs_options)        = X (control block ptr low)\n  &BC (fs_block_offset)   = Y (control block ptr high)\n  &BE/&BF (fs_crc_lo/hi)  = X/Y (duplicate for indexed access)"}, {"addr": 34067, "name": "decode_attribs_6bit", "title": "Decode file attributes: FS \u2192 BBC format (FSBBC, 6-bit variant)", "description": "Reads attribute byte at offset &0E from the parameter block,\nmasks to 6 bits, then falls through to the shared bitmask\nbuilder. Converts fileserver protection format (5-6 bits) to\nBBC OSFILE attribute format (8 bits) via the lookup table at\n&8530. The two formats use different bit layouts for file\nprotection attributes."}, {"addr": 34077, "name": "decode_attribs_5bit", "title": "Decode file attributes: BBC \u2192 FS format (BBCFS, 5-bit variant)", "description": "Masks A to 5 bits and builds an access bitmask via the\nlookup table at &8530. Each input bit position maps to a\ndifferent output bit via the table. The conversion is done\nby iterating through the source bits and OR-ing in the\ncorresponding destination bits from the table, translating\nbetween BBC (8-bit) and fileserver (5-bit) protection formats."}, {"addr": 34133, "name": "skip_spaces", "title": "Skip leading spaces in parameter block", "description": "Advances Y past space characters in (fs_options),Y.\nReturns with the first non-space character in A.\nSets carry if the character is >= 'A' (alphabetic)."}, {"addr": 34144, "name": "parse_decimal", "title": "Parse decimal number from (fs_options),Y (DECIN)", "description": "Reads ASCII digits and accumulates in &B2 (fs_load_addr_2).\nMultiplication by 10 uses the identity: n*10 = n*8 + n*2,\ncomputed as ASL &B2 (x2), then A = &B2*4 via two ASLs,\nthen ADC &B2 gives x10.\nTerminates on \".\" (pathname separator), control chars, or space.\nThe delimiter handling was revised to support dot-separated path\ncomponents (e.g. \"1.$.PROG\") -- originally stopped on any char\n>= &40 (any letter), but the revision allows numbers followed\nby dots.", "on_entry": {"y": "offset into (fs_options) buffer"}, "on_exit": {"a": "parsed value (accumulated in &B2)", "x": "corrupted", "y": "offset past last digit parsed"}}, {"addr": 34186, "name": "handle_to_mask", "title": "Convert file handle to bitmask (Y2FS)", "description": "Converts fileserver handles to single-bit masks segregated inside\nthe BBC. NFS handles occupy the &20-&27 range (base HAND=&20),\nwhich cannot collide with local filing system or cassette handles\n-- the MOS routes OSFIND/OSBGET/OSBPUT to the correct filing\nsystem based on the handle value alone. The power-of-two encoding\nallows the EOF hint byte to track up to 8 files simultaneously\nwith one bit per file, and enables fast set operations (ORA to\nadd, EOR to toggle, AND to test) without loops. Handle 0 passes\nthrough unchanged (means \"no file\"). The bit-shift conversion loop\nhas a built-in validity check: if the handle is out of range, the\nrepeated ASL shifts all bits out, leaving A=0, which is converted\nto Y=&FF as a sentinel -- bad handles fail gracefully rather than\nindexing into garbage.\nThree entry points: &858A (direct), &8589 (CLC first), &8588 (TAY first).", "on_entry": {"y": "handle number", "c": "0: convert, 1 with Y=0: skip, 1 with Y!=0: convert"}, "on_exit": {"a": "preserved", "x": "preserved", "y": "bitmask (single bit set) or &FF if handle invalid"}}, {"addr": 34213, "name": "mask_to_handle", "title": "Convert bitmask to handle number (FS2A)", "description": "Inverse of Y2FS. Converts from the power-of-two FS format\nback to a sequential handle number by counting right shifts\nuntil A=0. Adds &1E to convert the 1-based bit position to\na handle number (handles start at &1F+1 = &20). Used when\nreceiving handle values from the fileserver in reply packets.", "on_entry": {"a": "single-bit bitmask"}, "on_exit": {"a": "handle number (&20-&27)", "x": "corrupted", "y": "preserved"}}, {"addr": 34223, "name": "print_decimal", "title": "Print byte as 3-digit decimal number", "description": "Prints A as a decimal number using repeated subtraction\nfor each digit position (100, 10, 1). Leading zeros are\nprinted (no suppression). Used to display station numbers."}, {"addr": 34236, "name": "print_decimal_digit", "title": "Print one decimal digit by repeated subtraction", "description": "Divides Y by A using repeated subtraction. Prints the\nquotient as an ASCII digit ('0'-'9'). Returns with the\nremainder in Y. X starts at &2F ('0'-1) and increments\nonce per subtraction, giving the ASCII digit directly."}, {"addr": 34254, "name": "compare_addresses", "title": "Compare two 4-byte addresses", "description": "Compares bytes at &B0-&B3 against &B4-&B7 using EOR.\nUsed by the OSFILE save handler to compare the current\ntransfer address (&C8-&CB, copied to &B0) against the end\naddress (&B4-&B7) during multi-block file data transfers.", "on_exit": {"a": "corrupted (EOR result)", "x": "corrupted", "y": "preserved"}}, {"addr": 34271, "name": "clear_fs_flag", "title": "Clear bit(s) in FS flags (&0E07)", "description": "Inverts A (EOR #&FF), then ANDs into fs_work_0e07 to clear\nthe specified bits. Falls through to set_fs_flag to store."}, {"addr": 34276, "name": "set_fs_flag", "title": "Set bit(s) in FS flags (&0E07)", "description": "ORs A into fs_work_0e07 (EOF hint byte). Each bit represents\none of up to 8 open file handles. When clear, the file is\ndefinitely NOT at EOF. When set, the fileserver must be queried\nto confirm EOF status. This negative-cache optimisation avoids\nexpensive network round-trips for the common case. The hint is\ncleared when the file pointer is updated (since seeking away\nfrom EOF invalidates the hint) and set after BGET/OPEN/EOF\noperations that might have reached the end."}, {"addr": 34304, "name": "print_file_info", "title": "Print file catalogue line", "description": "Displays a formatted catalogue entry: filename (padded to 12\nchars with spaces), load address (4 hex bytes at offset 5-2),\nexec address (4 hex bytes at offset 9-6), and file length\n(3 hex bytes at offset &0C-&0A), followed by a newline.\nData is read from (fs_crc_lo) for the filename and from\n(fs_options) for the numeric fields. Returns immediately\nif fs_work_0e06 is zero (no info available)."}, {"addr": 34283, "name": "print_hex", "title": "Print byte as two hex digits", "description": "Prints the high nibble first (via 4\u00d7 LSR), then the low\nnibble. Each nibble is converted to ASCII '0'-'9' or 'A'-'F'\nand output via OSASCI."}, {"addr": 34372, "name": "setup_tx_ptr_c0", "title": "Set up TX pointer to control block at &00C0", "description": "Points net_tx_ptr to &00C0 where the TX control block has\nbeen built by init_tx_ctrl_block. Falls through to tx_poll_ff\nto initiate transmission with full retry."}, {"addr": 34380, "name": "tx_poll_ff", "title": "Transmit and poll for result (full retry)", "description": "Sets A=&FF (retry count) and Y=&60 (timeout parameter).\nFalls through to tx_poll_core."}, {"addr": 34384, "name": "tx_poll_core", "title": "Core transmit and poll routine (XMIT)", "description": "Claims the TX semaphore (tx_ctrl_status) via ASL -- a busy-wait\nspinlock where carry=0 means the semaphore is held by another\noperation. Only after claiming the semaphore is the TX pointer\ncopied to nmi_tx_block, ensuring the low-level transmit code\nsees a consistent pointer. Then calls the ADLC TX setup routine\nand polls the control byte for completion:\n  bit 7 set = still busy (loop)\n  bit 6 set = error (check escape or report)\n  bit 6 clear = success (clean return)\nOn error, checks for escape condition and handles retries.\nTwo entry points: setup_tx_ptr_c0 (&8644) always uses the\nstandard TXCB; tx_poll_core (&8650) is general-purpose.", "on_entry": {"a": "retry count (&FF = full retry)", "y": "timeout parameter (&60 = standard)"}, "on_exit": {"a": "entry A (retry count, restored from stack)", "x": "0", "y": "0"}}, {"addr": 34107, "title": "Print inline string, high-bit terminated (VSTRNG)", "description": "Pops the return address from the stack, prints each byte via OSASCI\nuntil a byte with bit 7 set is found, then jumps to that address.\nThe high-bit byte serves as both the string terminator and the opcode\nof the first instruction after the string. N.B. Cannot be used for\nBRK error messages -- the stack manipulation means a BRK in the\ninline data would corrupt the stack rather than invoke the error\nhandler.", "on_exit": {"a": "terminator byte (bit 7 set, also next opcode)", "x": "corrupted (by OSASCI)", "y": "0"}}, {"addr": 32873, "name": "dispatch_net_cmd", "title": "*NET command dispatcher", "description": "Parses the character after *NET as '1'-'4', maps to table\nindices 33-36 via base offset Y=&20, and dispatches via &809F.\nCharacters outside '1'-'4' fall through to return_1 (RTS)."}, {"addr": 32927, "name": "dispatch", "title": "PHA/PHA/RTS computed dispatch", "description": "X = command index within caller's group (e.g. service number)\nY = base offset into dispatch table (0, &0D, &20, etc.)\nThe loop adds Y+1 to X, so final X = command index + base + 1.\nThen high and low bytes of (handler-1) are pushed onto the stack,\nand RTS pops them and jumps to handler_address.\n\nThis is a standard 6502 trick: RTS increments the popped address\nby 1 before jumping, so the table stores (address - 1) to\ncompensate. Multiple callers share one table via different Y\nbase offsets."}, {"addr": 32921, "title": "Language entry dispatcher", "description": "Called when the NFS ROM is entered as a language. X = reason code\n(0-4). Dispatches via table indices 14-18 (base offset Y=&0D)."}, {"addr": 33063, "name": "dispatch_service", "title": "Service call dispatcher", "description": "Dispatches MOS service calls 0-12 via the shared dispatch table.\nUses base offset Y=0, so table index = service number + 1.\nService numbers >= 13 are ignored (branch to return_2).\nCalled via JSR &809F rather than fall-through, so it returns\nto &813C to restore saved registers."}, {"addr": 32943, "title": "Service handler entry", "description": "Intercepts three special service calls before normal dispatch:\n  &FE: Tube init \u2014 explode character definitions (OSBYTE &14, X=6)\n  &FF: Full init \u2014 set up WRCHV/RDCHV/BRKV/EVNTV, copy NMI handler\n       code from ROM to RAM pages &04-&06, copy workspace init to\n       &0016-&0076, then fall through to select NFS.\n  &12 with Y=5: Select NFS as active filing system.\nAll other service calls dispatch via dispatch_service (&8127)."}, {"addr": 32968, "name": "init_vectors_and_copy", "title": "NFS initialisation (service &FF: full reset)", "description": "Sets up OS vectors for Tube co-processor support:\n  WRCHV = &051C (page 5 \u2014 WRCH handler)\n  RDCHV = &04E7 (page 4 \u2014 RDCH handler)\n  BRKV  = &0016 (workspace \u2014 BRK/error handler)\n  EVNTV = &06E8 (page 6 \u2014 event handler)\nWrites &8E to Tube control register (&FEE0).\nThen copies 3 pages of Tube host code from ROM (&934C/&944C/&954C)\nto RAM (&0400/&0500/&0600), calls tube_post_init (&0414), and copies\n97 bytes of workspace init from ROM (&9307) to &0016-&0076."}, {"addr": 33156, "name": "select_nfs", "title": "Select NFS as active filing system (INIT)", "description": "Reached from service &12 (select FS) with Y=5, or when *NET command\nselects NFS. Notifies the current FS of shutdown via FSCV A=6 \u2014\nthis triggers the outgoing FS to save its context back to its\nworkspace page, allowing restoration if re-selected later (the\nFSDIE handoff mechanism). Then sets up the standard OS vector\nindirections (FILEV through FSCV) to NFS entry points, claims the\nextended vector table entries, and issues service &0F (vectors\nclaimed) to notify other ROMs. If fs_temp_cd is zero (auto-boot\nnot inhibited), injects the synthetic command \"I .BOOT\" through\nthe command decoder to trigger auto-boot login."}, {"addr": 33303, "name": "setup_fs_vectors", "title": "Set up filing system vectors", "description": "Copies 14 bytes from fs_vector_addrs (&824D) into FILEV-FSCV (&0212).\nThese set all 7 filing system vectors to the standard extended vector\ndispatch addresses (&FF1B, &FF1E, &FF21, &FF24, &FF27, &FF2A, &FF2D).\nThen calls setup_rom_ptrs_netv to install the extended vector table\nentries with the actual NFS handler addresses, and issues service\nrequests to notify other ROMs."}, {"addr": 33391, "name": "svc_abs_workspace", "title": "Service 1: claim absolute workspace", "description": "Claims pages up to &10 for NMI workspace (&0D), FS state (&0E),\nand FS command buffer (&0F). If Y >= &10, workspace already\nallocated \u2014 returns unchanged."}, {"addr": 33400, "name": "svc_private_workspace", "title": "Service 2: claim private workspace and initialise NFS", "description": "Y = next available workspace page on entry.\nSets up net_rx_ptr (Y) and nfs_workspace (Y+1) page pointers.\nOn soft break (OSBYTE &FD returns 0): skips FS state init,\npreserving existing login state, file server selection, and\ncontrol block configuration \u2014 this is why pressing BREAK\nkeeps the user logged in.\nOn power-up/CTRL-BREAK (result non-zero):\n  - Sets FS server station to &FE (FS, the default; no server)\n  - Sets printer server to &EB (PS, the default)\n  - Clears FS handles, OPT byte, message flag, SEQNOS\n  - Initialises all RXCBs with &3F flag (available)\nIn both cases: reads station ID from &FE18 (only valid during\nreset), calls adlc_init, enables user-level RX (LFLAG=&40)."}, {"addr": 33233, "name": "svc_autoboot", "title": "Service 3: auto-boot", "description": "Notifies current FS of shutdown via FSCV A=6. Scans keyboard\n(OSBYTE &7A): if no key is pressed, auto-boot proceeds; if the\n'N' key is pressed (matrix address &55), the boot is declined\nand the key is forgotten via OSBYTE &78. Any other key also\ndeclines. Prints \"Econet Station <n>\" and checks the ADLC SR2\nfor the network clock signal \u2014 prints \"No Clock\" if absent (no\nnetwork communication possible without it). Then falls through\nto set up NFS vectors (selecting NFS as the filing system)."}, {"addr": 33138, "name": "svc_star_command", "title": "Service 4: unrecognised * command", "description": "Matches the command text against ROM string table entries:\n  X=8: matches \"ROFF\" at &8010 (within copyright string) \u2192 *ROFF\n       (log off from fileserver) \u2014 jumps to resume_after_remote\n  X=1: matches \"NET\" at &8009 (ROM title) \u2192 *NET (select NFS)\n       \u2014 falls through to select_nfs\nIf neither matches, returns with the service call unclaimed."}, {"addr": 33212, "name": "svc_help", "title": "Service 9: *HELP", "description": "Prints the ROM identification string using print_inline."}, {"addr": 33179, "name": "match_rom_string", "title": "Match command text against ROM string table", "description": "Compares characters from (os_text_ptr)+Y against bytes starting\nat binary_version+X (&8008+X). Input is uppercased via AND &DF.\nReturns with Z=1 if the ROM string's NUL terminator was reached\n(match), or Z=0 if a mismatch was found. On match, Y points\npast the matched text; on return, skips trailing spaces."}, {"addr": 33228, "name": "call_fscv_shutdown", "title": "Notify filing system of shutdown", "description": "Loads A=6 (FS shutdown notification) and JMP (FSCV).\nThe FSCV handler's RTS returns to the caller of this routine\n(JSR/JMP trick saves one level of stack)."}, {"addr": 33326, "name": "issue_vectors_claimed", "title": "Issue 'vectors claimed' service and optionally auto-boot", "description": "Issues service &0F (vectors claimed) via OSBYTE &8F, then\nservice &0A. If fs_temp_cd is zero (auto-boot not inhibited),\nsets up the command string \"I .BOOT\" at &8245 and jumps to\nthe FSCV 3 unrecognised-command handler (which matches against\nthe command table at &8BD6). The \"I.\" prefix triggers the\ncatch-all entry which forwards the command to the fileserver."}, {"addr": 33489, "name": "setup_rom_ptrs_netv", "title": "Set up ROM pointer table and NETV", "description": "Reads the ROM pointer table base address via OSBYTE &A8, stores\nit in osrdsc_ptr (&F6). Sets NETV low byte to &36. Then copies\none 3-byte extended vector entry (addr=&9007, rom=current) into\nthe ROM pointer table at offset &36, installing osword_dispatch\nas the NETV handler."}, {"addr": 33533, "name": "fscv_shutdown", "title": "FSCV 6: Filing system shutdown / save state (FSDIE)", "description": "Called when another filing system (e.g. DFS) is selected. Saves\nthe current NFS context (FSLOCN station number, URD/CSD/LIB\nhandles, OPT byte, etc.) from page &0E into the dynamic workspace\nbackup area. This allows the state to be restored when *NET is\nre-issued later, without losing the login session. Finally calls\nOSBYTE &77 (FXSPEX: close SPOOL and EXEC files) to avoid leaving\ndangling file handles across the FS switch."}, {"addr": 33564, "name": "init_tx_ctrl_block", "title": "Initialise TX control block at &00C0 from template", "description": "Copies 12 bytes from tx_ctrl_template (&8334) to &00C0.\nFor the first 2 bytes (Y=0,1), also copies the fileserver\nstation/network from &0E00/&0E01 to &00C2/&00C3.\nThe template sets up: control=&80, port=&99 (FS command port),\ncommand data length=&0F, plus padding bytes."}, {"addr": 33588, "name": "tx_ctrl_template", "title": "TX control block template (TXTAB, 12 bytes)", "description": "&00C0: &80 (control flag)    &00C1: &99 (port \u2014 FS command port)\n&00C2: server station        &00C3: server network\n&00C4: &00 (data low)        &00C5: &0F (data high \u2014 buffer page)\n&00C6-&00CB: &FF (FILLER)\nThe &FF padding in the address fields is a recurring pattern:\nEconet control blocks use 4-byte addresses but NFS only needs\n2-byte addresses, so the upper two bytes are filled with &FF."}, {"addr": 33616, "name": "prepare_fs_cmd", "title": "Prepare FS command buffer (12 references)", "description": "Builds the 5-byte FS protocol header at &0F00:\n  &0F00 HDRREP = reply port (set downstream, typically &90/PREPLY)\n  &0F01 HDRFN  = Y parameter (function code)\n  &0F02 HDRURD = URD handle (from &0E02)\n  &0F03 HDRCSD = CSD handle (from &0E03)\n  &0F04 HDRLIB = LIB handle (from &0E04)\nCommand-specific data follows at &0F05 (TXBUF). Also clears V flag.\nCalled before building specific FS commands for transmission.", "on_entry": {"y": "function code for HDRFN", "x": "preserved through header build"}, "on_exit": {"a": "0 on success (from build_send_fs_cmd)", "x": "0 on success, &D6 on not-found", "y": "1 (offset past command code in reply)"}}, {"addr": 33642, "name": "build_send_fs_cmd", "title": "Build and send FS command (DOFSOP)", "description": "Sets reply port to &90 (PREPLY) at &0F00, initialises the TX\ncontrol block, then adjusts TXCB's high pointer (HPTR) to X+5\n-- the 5-byte FS header (reply port, function code, URD, CSD,\nLIB) plus the command data -- so only meaningful bytes are\ntransmitted, conserving Econet bandwidth. If carry is set on\nentry (DOFSBX byte-stream path), takes the alternate path\nthrough econet_tx_retry for direct BSXMIT transmission.\nOtherwise sets up the TX pointer via setup_tx_ptr_c0 and falls\nthrough to send_fs_reply_cmd for reply handling. The carry flag\nis the sole discriminator between byte-stream and standard FS\nprotocol paths -- set by SEC at the BPUTV/BGETV entry points.\nOn return from WAITFS/BSXMIT, Y=0; INY advances past the\ncommand code to read the return code. Error &D6 (\"not found\")\nis detected via ADC #(&100-&D6) with C=0 -- if the return code\nwas exactly &D6, the result wraps to zero (Z=1). This is a\nbranchless comparison returning C=1, A=0 as a soft error that\ncallers can handle, vs hard errors which go through FSERR.", "on_entry": {"x": "buffer extent (command-specific data bytes)", "y": "function code", "a": "timeout period for FS reply", "c": "0 for standard FS path, 1 for byte-stream (BSXMIT)"}, "on_exit": {"a": "0 on success", "x": "0 on success, &D6 on not-found", "y": "1 (offset past command code in reply)"}}, {"addr": 33794, "name": "store_fs_error", "title": "Handle fileserver error replies (FSERR)", "description": "The fileserver returns errors as: zero command code + error number +\nCR-terminated message string. This routine converts the reply buffer\nin-place to a standard MOS BRK error packet by:\n  1. Storing the error code at fs_last_error (&0E09)\n  2. Normalizing error codes below &A8 to &A8 (the standard FS error\n     number), since the MOS error space below &A8 has other meanings\n  3. Scanning for the CR terminator and replacing it with &00\n  4. JMPing indirect through (l00c4) to execute the buffer as a BRK\n     instruction \u2014 the zero command code serves as the BRK opcode\nN.B. This relies on the fileserver always returning a zero command\ncode in position 0 of the reply buffer."}, {"addr": 33699, "name": "handle_bput_bget", "title": "Handle BPUT/BGET file byte I/O", "description": "BPUTV enters at &83A2 (CLC; fall through) and BGETV enters\nat &8485 (SEC; JSR here). The carry flag is preserved via\nPHP/PLP through the call chain and tested later (BCS) to\nselect byte-stream transmission (BSXMIT) vs normal FS\ntransmission (FSXMIT) -- a control-flow encoding using\nprocessor flags to avoid an extra flag variable.\n\nBSXMIT uses handle=0 for print stream transactions (which\nsidestep the SEQNOS sequence number manipulation) and non-zero\nhandles for file operations. After transmission, the high\npointer bytes of the CB are reset to &FF -- \"The BGET/PUT byte\nfix\" which prevents stale buffer pointers corrupting subsequent\nbyte-level operations.", "on_entry": {"c": "0 for BPUT (write byte), 1 for BGET (read byte)", "a": "byte to write (BPUT only)", "y": "file handle"}, "on_exit": {"a": "preserved", "x": "preserved", "y": "preserved"}}, {"addr": 33866, "name": "send_to_fs", "title": "Send command to fileserver and handle reply (WAITFS)", "description": "Performs a complete FS transaction: transmit then wait for reply.\nSets bit 7 of rx_status_flags (mark FS transaction in progress),\nbuilds a TX frame from the data at (net_tx_ptr), and transmits\nit. The system RX flag (LFLAG bit 7) is only set when receiving\ninto the page-zero control block \u2014 if RXCBP's high byte is\nnon-zero, setting the system flag would interfere with other RX\noperations. The timeout counter uses the stack (indexed via TSX)\nrather than memory to avoid bus conflicts with Econet hardware\nduring the tight polling loop. Handles multi-block replies and\nchecks for escape conditions between blocks."}, {"addr": 33914, "name": "check_escape", "title": "Check and handle escape condition (ESC)", "description": "Two-level escape gating: the MOS escape flag (&FF bit 7) is ANDed\nwith the software enable flag ESCAP. Both must have bit 7 set for\nescape to fire. ESCAP is set non-zero during data port operations\n(LOADOP stores the data port &90, serving double duty as both the\nport number and the escape-enable flag). ESCAP is disabled via LSR\nin the ENTER routine, which clears bit 7 \u2014 PHP/PLP around the LSR\npreserves the carry flag since ENTER is called from contexts where\ncarry has semantic meaning (e.g., PUTBYT vs BGET distinction).\nThis architecture allows escape between retransmission attempts\nbut prevents interruption during critical FS transactions. If\nescape fires: acknowledges via OSBYTE &7E, then checks whether\nthe failing handle is the current SPOOL or EXEC handle (OSBYTE\n&C6/&C7); if so, issues \"*SP.\" or \"*E.\" via OSCLI to gracefully\nclose the channel before raising the error \u2014 preventing the system\nfrom continuing to spool output to a broken file handle."}, {"addr": 33967, "name": "error_msg_table", "title": "Econet error message table (ERRTAB, 8 entries)", "description": "Each entry: error number byte followed by NUL-terminated string.\n  &A0: \"Line Jammed\"     &A1: \"Net Error\"\n  &A2: \"Not listening\"   &A3: \"No Clock\"\n  &A4: \"Bad Txcb\"        &11: \"Escape\"\n  &CB: \"Bad Option\"      &A5: \"No reply\"\nIndexed by the low 3 bits of the TXCB flag byte (AND #&07),\nwhich encode the specific Econet failure reason. The NREPLY\nand NLISTN routines build a MOS BRK error block at &100 on the\nstack page: NREPLY fires when the fileserver does not respond\nwithin the timeout period; NLISTN fires when the destination\nstation actively refused the connection.\nIndexed via the error dispatch at c8424/c842c."}, {"addr": 33094, "name": "resume_after_remote", "title": "Resume after remote operation / *ROFF handler (NROFF)", "description": "Checks byte 4 of (net_rx_ptr): if non-zero, the keyboard was\ndisabled during a remote operation (peek/poke/boot). Clears\nthe flag, re-enables the keyboard via OSBYTE &C9, and sends\nfunction &0A to notify completion. Also handles *ROFF and the\ntriple-plus escape sequence (+++), which resets system masks\nvia OSBYTE &CE and returns control to the MOS, providing an\nescape route when a remote session becomes unresponsive."}, {"addr": 32908, "name": "fscv_handler", "title": "FSCV dispatch entry", "description": "Entered via the extended vector table when the MOS calls FSCV.\nStores A/X/Y via save_fscv_args, compares A (function code) against 8,\nand dispatches codes 0-7 via the shared dispatch table at &8020\nwith base offset Y=&12 (table indices 19-26).\nFunction codes: 0=*OPT, 1=EOF, 2=*/, 3=unrecognised *,\n4=*RUN, 5=*CAT, 6=shutdown, 7=read handles.", "on_entry": {"a": "function code (0-7)", "x": "depends on function", "y": "depends on function"}, "on_exit": {"a": "depends on handler (preserved if A >= 8)", "x": "depends on handler (preserved if A >= 8)", "y": "depends on handler (preserved if A >= 8)"}}, {"addr": 34452, "name": "filev_handler", "title": "FILEV handler (OSFILE entry point)", "description": "Saves A/X/Y, copies the filename pointer from the parameter block\nto os_text_ptr, then uses GSINIT/GSREAD to parse the filename into\n&0FC5+. Sets fs_crc_lo/hi to point at the parsed filename buffer.\nDispatches by function code A:\n  A=&FF: load file (send_fs_examine at &86D0)\n  A=&00: save file (filev_save at &8746)\n  A=&01-&06: attribute operations (filev_attrib_dispatch at &8844)\n  Other: restore_args_return (unsupported, no-op)", "on_entry": {"a": "function code (&FF=load, &00=save, &01-&06=attrs)", "x": "parameter block address low byte", "y": "parameter block address high byte"}, "on_exit": {"a": "restored", "x": "restored", "y": "restored"}}, {"addr": 34512, "name": "send_fs_examine", "title": "Send FS examine command", "description": "Sends FS command &03 (FCEXAM: examine file) to the fileserver.\nSets &0F02=&03 and error pointer to '*'. Called for OSFILE &FF\n(load file) with the filename already in the command buffer.\nThe FS reply contains load/exec addresses and file length which\nare used to set up the data transfer. The header URD field\nis repurposed to carry the Econet data port number (PLDATA=&92)\nfor the subsequent block data transfer."}, {"addr": 34582, "name": "send_data_blocks", "title": "Send file data in multi-block chunks", "description": "Repeatedly sends &80-byte (128-byte) blocks of file data to the\nfileserver using command &7F. Compares current address (&C8-&CB)\nagainst end address (&B4-&B7) via compare_addresses, and loops\nuntil the entire file has been transferred. Each block is sent\nvia send_to_fs_star."}, {"addr": 34630, "name": "filev_save", "title": "OSFILE save handler (A=&00)", "description": "Copies 4-byte load/exec/length addresses from the parameter block\nto the FS command buffer, along with the filename. Sends FS\ncommand &91 with function &14 to initiate the save, then\ncalls print_file_info to display the filename being saved.\nHandles both host and Tube-based data sources.\nWhen receiving the save acknowledgement, the RX low pointer is\nincremented by 1 to skip the command code (CC) byte, which\nindicates the FS type and must be preserved. N.B. this assumes\nthe RX buffer does not cross a page boundary."}, {"addr": 34733, "name": "copy_load_addr_from_params", "title": "Copy load address from parameter block", "description": "Copies 4 bytes from (fs_options)+2..5 (the load address in the\nOSFILE parameter block) to &AE-&B3 (local workspace)."}, {"addr": 34746, "name": "copy_reply_to_params", "title": "Copy FS reply data to parameter block", "description": "Copies bytes from the FS command reply buffer (&0F02+) into the\nparameter block at (fs_options)+2..13. Used to fill in the OSFILE\nparameter block with information returned by the fileserver."}, {"addr": 34760, "name": "transfer_file_blocks", "title": "Multi-block file data transfer", "description": "Manages the transfer of file data in chunks between the local\nmachine and the fileserver. Entry conditions: WORK (&B0-&B3) and\nWORK+4 (&B4-&B7) hold the low and high addresses of the data\nbeing sent/received. Sets up source (&C4-&C7) and destination\n(&C8-&CB) from the FS reply, sends &80-byte (128-byte) blocks\nwith command &91, and continues until all data has been\ntransferred. Handles address overflow and Tube co-processor\ntransfers. For SAVE, WORK+8 holds the port on which to receive\nbyte-level ACKs for each data block (flow control)."}, {"addr": 34847, "name": "eof_handler", "title": "FSCV 1: EOF handler", "description": "Checks whether a file handle has reached end-of-file. Converts\nthe handle via handle_to_mask_clc, tests the result against the\nEOF hint byte (&0E07). If the hint bit is clear, returns X=0\nimmediately (definitely not at EOF \u2014 no network call needed).\nIf the hint bit is set, sends FS command &11 (FCEOF) to query\nthe fileserver for definitive EOF status. Returns X=&FF if at\nEOF, X=&00 if not. This two-level check avoids an expensive\nnetwork round-trip when the file is known to not be at EOF."}, {"addr": 34884, "name": "filev_attrib_dispatch", "title": "FILEV attribute dispatch (A=1-6)", "description": "Dispatches OSFILE operations by function code:\n  A=1: write catalogue info (load/exec/length/attrs) \u2014 FS &14\n  A=2: write load address only\n  A=3: write exec address only\n  A=4: write file attributes\n  A=5: read catalogue info, returns type in A \u2014 FS &12\n  A=6: delete named object \u2014 FS &14 (FCDEL)\n  A>=7: falls through to restore_args_return (no-op)\nEach handler builds the appropriate FS command, sends it to\nthe fileserver, and copies the reply into the parameter block.\nThe control block layout uses dual-purpose fields: the 'data\nstart' field doubles as 'length' and 'data end' doubles as\n'protection' depending on whether reading or writing attrs."}, {"addr": 35116, "name": "restore_args_return", "title": "Restore arguments and return", "description": "Common exit point for FS vector handlers. Reloads A from\nfs_last_byte_flag (&BD), X from fs_options (&BB), and Y from\nfs_block_offset (&BC) \u2014 the values saved at entry by\nsave_fscv_args \u2014 and returns to the caller."}, {"addr": 35233, "name": "opt_handler", "title": "FSCV 0: *OPT handler (OPTION)", "description": "Handles *OPT X,Y to set filing system options:\n  *OPT 1,Y (Y=0/1): set local user option in &0E06 (OPT)\n  *OPT 4,Y (Y=0-3): set boot option via FS command &16 (FCOPT)\nOther combinations generate error &CB (OPTER: \"bad option\")."}, {"addr": 35282, "name": "adjust_addrs", "title": "Bidirectional 4-byte address adjustment", "description": "Adjusts a 4-byte value in the parameter block at (fs_options)+Y:\n  If fs_load_addr_2 (&B2) is positive: adds fs_lib_handle+X values\n  If fs_load_addr_2 (&B2) is negative: subtracts fs_lib_handle+X\nStarting offset X=&FC means it reads from &0E06-&0E09 area.\nUsed to convert between absolute and relative file positions."}, {"addr": 35041, "name": "argsv_handler", "title": "ARGSV handler (OSARGS entry point)", "description": "  A=0, Y=0: return filing system number (10 = network FS)\n  A=0, Y>0: read file pointer via FS command &0A (FCRDSE)\n  A=1, Y>0: write file pointer via FS command &14 (FCWRSE)\n  A>=3 (ensure): silently returns -- NFS has no local write buffer\n     to flush, since all data is sent to the fileserver immediately\nThe handle in Y is converted via handle_to_mask_clc. For writes\n(A=1), the carry flag from the mask conversion is used to branch\nto save_args_handle, which records the handle for later use.", "on_entry": {"a": "function code (0=query, 1=write ptr, >=3=ensure)", "y": "file handle (0=FS-level query, >0=per-file)"}, "on_exit": {"a": "filing system number if A=0/Y=0 query, else restored", "x": "restored", "y": "restored"}}, {"addr": 35145, "name": "findv_handler", "title": "FINDV handler (OSFIND entry point)", "description": "  A=0: close file -- delegates to close_handle (&8985)\n  A>0: open file -- modes &40=read, &80=write/update, &C0=read/write\nFor open: the mode byte is converted to the fileserver's two-flag\nformat by flipping bit 7 (EOR #&80) and shifting. This produces\nFlag 1 (read/write direction) and Flag 2 (create/existing),\nmatching the fileserver protocol. After a successful open, the\nnew handle's bit is OR'd into the EOF hint byte (marks it as\n\"might be at EOF, query the server\"), and into the sequence\nnumber tracking byte for the byte-stream protocol.", "on_entry": {"a": "operation (0=close, &40=read, &80=write, &C0=R/W)", "x": "filename pointer low (open)", "y": "file handle (close) or filename pointer high (open)"}, "on_exit": {"a": "handle on open, 0 on close-all, restored on close-one", "x": "restored", "y": "restored"}}, {"addr": 35205, "name": "close_handle", "title": "Close file handle(s) (CLOSE)", "description": "  Y=0: close all files \u2014 first calls OSBYTE &77 (close SPOOL and\n       EXEC files) to coordinate with the MOS before sending the\n       close-all command to the fileserver. This ensures locally-\n       managed file handles are released before the server-side\n       handles are invalidated, preventing the MOS from writing to\n       a closed spool file.\n  Y>0: close single handle \u2014 sends FS close command and clears\n       the handle's bit in both the EOF hint byte and the sequence\n       number tracking byte."}, {"addr": 35306, "name": "gbpbv_handler", "title": "GBPBV handler (OSGBPB entry point)", "description": "  A=1-4: file read/write operations (handle-based)\n  A=5-8: info queries (disc title, current dir, lib, filenames)\nCalls 1-4 are standard file data transfers via the fileserver.\nCalls 5-8 were a late addition to the MOS spec and are the only\nNFS operations requiring Tube data transfer -- described in the\noriginal source as \"untidy but useful in theory.\" The data format\nuses length-prefixed strings (<name length><object name>) rather\nthan the CR-terminated strings used elsewhere in the FS.", "on_entry": {"a": "call number (1-8)", "x": "parameter block address low byte", "y": "parameter block address high byte"}, "on_exit": {"a": "0 after FS operation, else restored", "x": "restored", "y": "restored"}}, {"addr": 35501, "name": "osgbpb_info", "title": "OSGBPB 5-8 info handler (OSINFO)", "description": "Handles the \"messy interface tacked onto OSGBPB\" (original source).\nChecks whether the destination address is in Tube space by comparing\nthe high bytes against TBFLAG. If in Tube space, data must be\ncopied via the Tube FIFO registers (with delays to accommodate the\nslow 16032 co-processor) instead of direct memory access."}, {"addr": 32889, "name": "forward_star_cmd", "title": "Forward unrecognised * command to fileserver (COMERR)", "description": "Copies command text from (fs_crc_lo) to &0F05+ via copy_filename,\nprepares an FS command with function code 0, and sends it to the\nfileserver to request decoding. The server returns a command code\nindicating what action to take (e.g. code 4=INFO, 7=DIR, 9=LIB,\n5=load-as-command). This mechanism allows the fileserver to extend\nthe client's command set without ROM updates. Called from the \"I.\"\nand catch-all entries in the command match table at &8BD6, and\nfrom FSCV 2/3/4 indirectly. If CSD handle is zero (not logged\nin), returns without sending."}, {"addr": 33609, "name": "bye_handler", "title": "*BYE handler (logoff)", "description": "Closes any open *SPOOL and *EXEC files via OSBYTE &77 (FXSPEX),\nthen falls into prepare_fs_cmd with Y=&17 (FCBYE: logoff code).\nDispatched from the command match table at &8BD6 for \"BYE\"."}, {"addr": 35730, "name": "fscv_star_handler", "title": "FSCV 2/3/4: unrecognised * command handler (DECODE)", "description": "CLI parser originally by Roger Wilson (later Sophie Wilson,\nco-designer of ARM). Matches command text against the table\nat &8BD6 using case-insensitive comparison with abbreviation\nsupport \u2014 commands can be shortened with '.' (e.g. \"I.\" for\n\"INFO\"). The \"I.\" entry is a special fudge placed first in the\ntable: since \"I.\" could match multiple commands, it jumps to\nforward_star_cmd to let the fileserver resolve the ambiguity.\n\nThe matching loop compares input characters against table\nentries. On mismatch, it skips to the next entry. On match\nof all table characters, or when '.' abbreviation is found,\nit dispatches via PHA/PHA/RTS to the entry's handler address.\n\nAfter matching, adjusts fs_crc_lo/fs_crc_hi to point past\nthe matched command text."}, {"addr": 35798, "name": "fs_cmd_match_table", "title": "FS command match table (COMTAB)", "description": "Format: command letters (bit 7 clear), then dispatch address\nas two bytes: high|(bit 7 set), low. The PHA/PHA/RTS trick\nadds 1 to the stored (address-1). Matching is case-insensitive\n(AND &DF) and supports '.' abbreviation (standard Acorn pattern).\n\nEntries:\n  \"I.\"     \u2192 &8079 (forward_star_cmd) \u2014 placed first as a fudge\n             to catch *I. abbreviation before matching *I AM\n  \"I AM\"   \u2192 &8D06 (i_am_handler: parse station.net, logon)\n  \"EX \"    \u2192 &8BF2 (ex_handler: extended catalogue)\n  \"EX\"\\r   \u2192 &8BF2 (same, exact match at end of line)\n  \"BYE\"\\r  \u2192 &8349 (bye_handler: logoff)\n  <catch-all> \u2192 &8079 (forward anything else to FS)"}, {"addr": 35826, "name": "ex_handler", "title": "*EX handler (extended catalogue)", "description": "Sets column width &B6=&50 (80 columns, one file per line with\nfull details) and &B7=&01, then branches into cat_handler at\n&8C07, bypassing cat_handler's default 20-column setup."}, {"addr": 35837, "name": "cat_handler", "title": "*CAT handler (directory catalogue)", "description": "Sets column width &B6=&14 (20 columns, four files per 80-column\nline) and &B7=&03. The catalogue protocol is multi-step: first\nsends FCUSER (&15: read user environment) to get CSD, disc, and\nlibrary names, then sends FCREAD (&12: examine) repeatedly to\nfetch entries in batches until zero are returned (end of dir).\nThe receive buffer abuts the examine request buffer and ends at\nRXBUFE, allowing seamless data handling across request cycles.\n\nThe command code byte in the fileserver reply indicates FS type:\nzero means an old-format FS (client must format data locally),\nnon-zero means new-format (server returns pre-formatted strings).\nThis enables backward compatibility with older Acorn fileservers.\n\nDisplay format:\n  - Station number in parentheses\n  - \"Owner\" or \"Public\" access level\n  - Boot option with name (Off/Load/Run/Exec)\n  - Current directory and library paths\n  - Directory entries: CRFLAG (&CF) cycles 0-3 for multi-column\n    layout; at count 0 a newline is printed, others get spaces.\n    *EX sets CRFLAG=&FF to force one entry per line."}, {"addr": 36074, "name": "boot_cmd_strings", "title": "Boot command strings for auto-boot", "description": "The four boot options use OSCLI strings at offsets within page &8C:\n  Option 0 (Off):  offset &F6 \u2192 &8CF6 = bare CR (empty command)\n  Option 1 (Load): offset &E7 \u2192 &8CE7 = \"L.!BOOT\" (dual-purpose:\n      the JMP &212E instruction at &8CE7 has opcode &4C='L' and\n      operand bytes &2E='.' &21='!', forming the string \"L.!\")\n  Option 2 (Run):  offset &E9 \u2192 &8CE9 = \"!BOOT\" (bare filename = *RUN)\n  Option 3 (Exec): offset &EF \u2192 &8CEF = \"E.!BOOT\"\n\nThis is a classic BBC ROM space optimisation: the JMP instruction's\nbytes serve double duty as both executable code and ASCII text."}, {"addr": 36087, "name": "set_lib_handle", "title": "Set library handle", "description": "Stores Y into &0E04 (library directory handle in FS workspace).\nFalls through to c8cff (JMP c892c) if Y is non-zero."}, {"addr": 36092, "name": "set_csd_handle", "title": "Set CSD handle", "description": "Stores Y into &0E03 (current selected directory handle).\nFalls through to c8cff (JMP c892c)."}, {"addr": 36098, "name": "boot_option_offsets", "title": "Boot option \u2192 OSCLI string offset table", "description": "Four bytes indexed by the boot option value (0-3). Each byte\nis the low byte of a pointer into page &8C, where the OSCLI\ncommand string for that boot option lives. See boot_cmd_strings."}, {"addr": 36102, "name": "i_am_handler", "title": "\"I AM\" command handler", "description": "Dispatched from the command match table when the user types\n\"*I AM <station>\" or \"*I AM <station>.<network>\".\nParses the station number (and optional network number after '.')\nusing skip_spaces and parse_decimal. Stores the results in:\n  &0E00 = station number (or fileserver station)\n  &0E01 = network number\nThen forwards the command to the fileserver via forward_star_cmd."}, {"addr": 36127, "name": "copy_handles_and_boot", "title": "Copy FS reply handles to workspace and execute boot command", "description": "SEC entry (LOGIN): copies 4 bytes from &0F05-&0F08 (FS reply) to\n&0E02-&0E05 (URD, CSD, LIB handles and boot option), then\nlooks up the boot option in boot_option_offsets to get the\nOSCLI command string and executes it via JMP oscli.\nThe carry flag distinguishes LOGIN (SEC) from SDISC (CLC) \u2014 both\nshare the handle-copying code, but only LOGIN executes the boot\ncommand. This use of the carry flag to select behaviour between\ntwo callers avoids duplicating the handle-copy loop."}, {"addr": 36128, "name": "copy_handles", "title": "Copy FS reply handles to workspace (no boot)", "description": "CLC entry (SDISC): copies handles only, then jumps to c8cff.\nCalled when the FS reply contains updated handle values\nbut no boot action is needed."}, {"addr": 36154, "name": "option_name_strings", "title": "Option name strings", "description": "Null-terminated strings for the four boot option names:\n  \"Off\", \"Load\", \"Run\", \"Exec\"\nUsed by cat_handler to display the current boot option setting."}, {"addr": 36171, "name": "option_name_offsets", "title": "Option name offsets", "description": "Four-byte table of offsets into option_name_strings:\n  0, 4, 9, &0D \u2014 one per boot option value (0-3)."}, {"addr": 36175, "name": "print_reply_bytes", "title": "Print reply buffer bytes", "description": "Prints Y characters from the FS reply buffer (&0F05+X) to\nthe screen via OSASCI. X = starting offset, Y = count.\nUsed by cat_handler to display directory and library names."}, {"addr": 36188, "name": "print_spaces", "title": "Print spaces", "description": "Prints X space characters via print_space. Used by cat_handler\nto align columns in the directory listing."}, {"addr": 36195, "name": "copy_filename", "title": "Copy filename to FS command buffer", "description": "Entry with X=0: copies from (fs_crc_lo),Y to &0F05+X until CR.\nUsed to place a filename into the FS command buffer before\nsending to the fileserver. Falls through to copy_string_to_cmd."}, {"addr": 36197, "name": "copy_string_to_cmd", "title": "Copy string to FS command buffer", "description": "Entry with X and Y specified: copies bytes from (fs_crc_lo),Y\nto &0F05+X, stopping when a CR (&0D) is encountered. The CR\nitself is also copied. Returns with X pointing past the last\nbyte written."}, {"addr": 36211, "name": "print_dir_name", "title": "Print directory name from reply buffer", "description": "Prints characters from the FS reply buffer (&0F05+X onwards).\nNull bytes (&00) are replaced with CR (&0D) for display.\nStops when a byte with bit 7 set is encountered (high-bit\nterminator). Used by cat_handler to display Dir. and Lib. paths."}, {"addr": 36228, "name": "notify_and_exec", "title": "Send FS load-as-command and execute response", "description": "Sets up an FS command with function code &05 (FCCMND: load as\ncommand) using send_fs_examine. If a Tube co-processor is\npresent (tx_in_progress != 0), transfers the response data\nto the Tube via tube_addr_claim. Otherwise jumps via the\nindirect pointer at (&0F09) to execute at the load address."}, {"addr": 36271, "name": "net1_read_handle", "title": "*NET1: read file handle from received packet", "description": "Reads a file handle byte from offset &6F in the RX buffer\n(net_rx_ptr), stores it in &F0, then falls through to the\ncommon handle workspace cleanup at c8dda (clear fs_temp_ce)."}, {"addr": 36279, "name": "calc_handle_offset", "title": "Calculate handle workspace offset", "description": "Converts a file handle number (in A) to a byte offset (in Y)\ninto the NFS handle workspace. The calculation is A*12:\n  ASL A (A*2), ASL A (A*4), PHA, ASL A (A*8),\n  ADC stack (A*8 + A*4 = A*12).\nValidates that the offset is < &48 (max 6 handles \u00d7 12 bytes\nper handle entry = 72 bytes). If invalid (>= &48), returns\nwith C set and Y=0, A=0 as an error indicator."}, {"addr": 36297, "name": "net2_read_handle_entry", "title": "*NET2: read handle entry from workspace", "description": "Looks up the handle in &F0 via calc_handle_offset. If the\nworkspace slot contains &3F ('?', meaning unused/closed),\nreturns 0. Otherwise returns the stored handle value.\nClears fs_temp_ce on exit."}, {"addr": 36319, "name": "net3_close_handle", "title": "*NET3: close handle (mark as unused)", "description": "Looks up the handle in &F0 via calc_handle_offset. Writes\n&3F ('?') to mark the handle slot as closed in the NFS\nworkspace. Preserves the carry flag state across the write\nusing ROL/ROR on rx_status_flags. Clears fs_temp_ce on exit."}, {"addr": 36338, "name": "net4_resume_remote", "title": "*NET4: resume after remote operation", "description": "Calls resume_after_remote (&8146) to re-enable the keyboard\nand send a completion notification. The BVC always branches\nto c8dda (clear fs_temp_ce) since resume_after_remote\nreturns with V clear (from CLV in prepare_cmd_clv)."}, {"addr": 36343, "name": "osword_fs_entry", "title": "Filing system OSWORD entry", "description": "Subtracts &0F from the command code in &EF, giving a 0-4 index\nfor OSWORD calls &0F-&13 (15-19). Falls through to the\nPHA/PHA/RTS dispatch at &8E01."}, {"addr": 36353, "name": "fs_osword_dispatch", "title": "PHA/PHA/RTS dispatch for filing system OSWORDs", "description": "X = OSWORD number - &0F (0-4). Dispatches via the 5-entry table\nat &8E18 (low) / &8E1D (high)."}, {"addr": 36722, "name": "econet_tx_rx", "title": "Econet transmit/receive handler", "description": "A=0: Initialise TX control block from ROM template at &8310\n     (zero entries substituted from NMI workspace &0DDA), transmit\n     it, set up RX control block, and receive reply.\nA>=1: Handle transmit result (branch to cleanup at &8F48)."}, {"addr": 36871, "name": "osword_dispatch", "title": "NETVEC dispatch handler (ENTRY)", "description": "Indirected from NETVEC at &0224. Saves all registers and flags,\nretrieves the reason code from the stacked A, and dispatches to\none of 9 handlers (codes 0-8) via the PHA/PHA/RTS trampoline at\n&9020. Reason codes >= 9 are ignored.\n\nDispatch targets (from NFS09):\n  0:   no-op (RTS)\n  1-3: PRINT -- chars in printer buffer / Ctrl-B / Ctrl-C\n  4:   NWRCH -- write character to screen (net write char)\n  5:   SELECT -- printer selection changed\n  6:   no-op (net read char -- not implemented)\n  7:   NBYTE -- remote OSBYTE call\n  8:   NWORD -- remote OSWORD call", "on_entry": {"a": "reason code (0-8)"}, "on_exit": {"a": "preserved", "x": "preserved", "y": "preserved"}}, {"addr": 36925, "name": "net_write_char", "title": "Fn 4: net write character (NWRCH)", "description": "Writes a character (passed in Y) to the screen via OSWRITCH.\nBefore the write, uses TSX to reach into the stack and zero the\ncarry flag in the caller's saved processor status byte -- ROR\nfollowed by ASL on the stacked P byte (&0106,X) shifts carry\nout and back in as zero. This ensures the calling code's PLP\nrestores carry=0, signalling \"character accepted\" without needing\na separate CLC/PHP sequence. A classic 6502 trick for modifying\nreturn flags without touching the actual processor status.", "on_entry": {"y": "character to write"}, "on_exit": {"a": "&3F", "x": "0", "y": "0"}}, {"addr": 36939, "name": "setup_tx_and_send", "title": "Set up TX control block and send", "description": "Builds a TX control block at (nfs_workspace)+&0C from the current\nworkspace state, then initiates transmission via the ADLC TX path.\nThis is the common send routine used after command data has been\nprepared. The exact control block layout and field mapping need\nfurther analysis."}, {"addr": 37209, "name": "ctrl_block_setup_alt", "title": "Alternate entry into control block setup", "description": "Sets X=&0D, Y=&7C. Tests bit 6 of &833A to choose target:\n  V=0 (bit 6 clear): stores to (nfs_workspace)\n  V=1 (bit 6 set):   stores to (net_rx_ptr)"}, {"addr": 37218, "name": "ctrl_block_setup", "title": "Control block setup \u2014 main entry", "description": "Sets X=&1A, Y=&17, clears V (stores to nfs_workspace).\nReads the template table at &918E indexed by X, storing each\nvalue into the target workspace at offset Y. Both X and Y\nare decremented on each iteration.\n\nTemplate sentinel values:\n  &FE = stop (end of template for this entry path)\n  &FD = skip (leave existing value unchanged)\n  &FC = use page high byte of target pointer"}, {"addr": 37262, "name": "ctrl_block_template", "title": "Control block initialisation template", "description": "Read by the loop at &9167, indexed by X from a starting value\ndown to 0. Values are stored into either (nfs_workspace) or\n(net_rx_ptr) at offset Y, depending on the V flag.\n\nTwo entry paths read different slices of this table:\n  ctrl_block_setup:   X=&1A (26) down, Y=&17 (23) down, V=0\n  ctrl_block_setup_alt: X=&0D (13) down, Y=&7C (124) down, V from BIT &833A\n\nSentinel values:\n  &FE = stop processing\n  &FD = skip this offset (decrement Y but don't store)\n  &FC = substitute the page byte (net_rx_ptr_hi or nfs_workspace_hi)"}, {"addr": 36386, "name": "copy_param_block", "title": "Bidirectional block copy between OSWORD param block and workspace.", "description": "C=1: copy X+1 bytes from (&F0),Y to (fs_crc_lo),Y (param to workspace)\nC=0: copy X+1 bytes from (fs_crc_lo),Y to (&F0),Y (workspace to param)"}, {"addr": 36403, "name": "osword_0f_handler", "title": "OSWORD &0F handler: initiate transmit (CALLTX)", "description": "Checks the TX semaphore (TXCLR at &0D62) via ASL -- if carry is\nclear, a TX is already in progress and the call returns an error,\npreventing user code from corrupting a system transmit. Otherwise\ncopies 16 bytes from the caller's OSWORD parameter block into the\nuser TX control block (UTXCB) in static workspace. The TXCB\npointer is copied to LTXCBP only after the semaphore is claimed,\nensuring the low-level transmit code (BRIANX) sees a consistent\npointer -- if copied before claiming, another transmitter could\nmodify TXCBP between the copy and the claim.", "on_entry": {"x": "parameter block address low byte", "y": "parameter block address high byte"}, "on_exit": {"a": "corrupted", "x": "corrupted", "y": "&FF"}}, {"addr": 36435, "name": "osword_11_handler", "title": "OSWORD &11 handler: read JSR arguments (READRA)", "description": "Copies the JSR (remote procedure call) argument buffer from the\nstatic workspace page back to the caller's OSWORD parameter block.\nReads the buffer size from workspace offset JSRSIZ, then copies\nthat many bytes. After the copy, clears the old LSTAT byte via\nCLRJSR to reset the protection status. Also provides READRB as\na sub-entry (&8E6A) to return just the buffer size and args size\nwithout copying the data."}, {"addr": 36475, "name": "osword_12_handler", "title": "OSWORD &12 handler: read/set state information (RS)", "description": "Dispatches on the sub-function code (0-9):\n  0: read FS station (FSLOCN at &0E00)\n  1: set FS station\n  2: read printer server station (PSLOCN)\n  3: set printer server station\n  4: read protection masks (LSTAT at &D63)\n  5: set protection masks\n  6: read context handles (URD/CSD/LIB, converted from\n     internal single-bit form back to handle numbers)\n  7: set context handles (converted to internal form)\n  8: read local station number\n  9: read JSR arguments buffer size\nEven-numbered sub-functions read; odd-numbered ones write.\nUses the bidirectional copy at &8E22 for station read/set."}, {"addr": 36592, "name": "osword_10_handler", "title": "OSWORD &10 handler: open/read RX control block (OPENRX)", "description": "If the first byte of the caller's parameter block is zero, scans\nfor a free RXCB (flag byte = &3F = deleted) starting from RXCB #3\n(RXCBs 0-2 are dedicated: printer, remote, FS). Returns the RXCB\nnumber in the first byte, or zero if none free. If the first byte\nis non-zero, reads the specified RXCB's data back into the caller's\nparameter block (12 bytes) and then deletes the RXCB by setting\nits flag byte to &3F -- a consume-once semantic so user code reads\nreceived data and frees the CB in a single atomic operation,\npreventing double-reads. The low-level user RX flag (LFLAG) is\ntemporarily disabled via ROR/ROL during the operation to prevent\nthe interrupt-driven receive code from modifying a CB that is\nbeing read or opened.", "on_entry": {"x": "parameter block address low byte", "y": "parameter block address high byte"}, "on_exit": {"a": "corrupted", "x": "corrupted", "y": "&FF"}}, {"addr": 37116, "name": "remote_boot_handler", "title": "Remote boot/execute handler", "description": "Validates byte 4 of the RX control block (must be zero), copies the\n2-byte execution address from RX offsets &80/&81 into NFS workspace,\nsets up a control block, disables keyboard (OSBYTE &C9), then falls\nthrough to execute_at_0100."}, {"addr": 37162, "name": "execute_at_0100", "title": "Execute downloaded code at &0100", "description": "Zeroes &0100-&0102 (safe BRK default), restores the protection mask,\nand JMP &0100 to execute code received over the network."}, {"addr": 37178, "name": "remote_validated", "title": "Remote operation with source validation (REMOT)", "description": "Validates that the source station/network in the received packet\nmatches the controlling station stored in the remote RXCB. This\nensures that only the station that initiated the remote session\ncan send commands \u2014 characters from other stations are rejected.\nFull init sequence: 1) disable keyboard, 2) set workspace ptr,\n3) set status busy, 4) set R/W/byte/word masks, 5) set up CB,\n6) set MODE 7 (the only mode guaranteed for terminal emulation),\n7) set auto repeat rates, 8) enter current language. This is\nessentially a \"thin terminal\" setup \u2014 the local machine becomes\na remote display/keyboard for the controlling station.\nBit 0 of the status byte disallows further remote takeover\nattempts (preventing re-entrant remote control), while bit 3\nmarks the machine as currently remoted."}, {"addr": 37194, "name": "insert_remote_key", "title": "Insert remote keypress", "description": "Reads a character from RX block offset &82 and inserts it into\nkeyboard input buffer 0 via OSBYTE &99."}, {"addr": 36695, "name": "setup_rx_buffer_ptrs", "title": "Set up RX buffer pointers in NFS workspace", "description": "Calculates the start address of the RX data area (&F0+1) and stores\nit at workspace offset &28. Also reads the data length from (&F0)+1\nand adds it to &F0 to compute the end address at offset &2C."}, {"addr": 36963, "name": "remote_cmd_dispatch", "title": "Fn 7: remote OSBYTE handler (NBYTE)", "description": "Full RPC mechanism for OSBYTE calls across the network. When a\nmachine is remoted, OSBYTE/OSWORD calls that affect terminal-side\nhardware (keyboard scanning, flash rates, etc.) must be indirected\nacross the net. OSBYTE calls are classified into three categories:\n  Y>0 (NCTBPL table): executed on BOTH machines (flash rates etc.)\n  Y<0 (NCTBMI table): executed on terminal only, result sent back\n  Y=0: not recognised, passed through unhandled\nResults returned via stack manipulation: the saved processor status\nbyte at &0106 has V-flag (bit 6) forced on to tell the MOS the\ncall was claimed (preventing dispatch to other ROMs), and the I-bit\n(bit 2) forced on to disable interrupts during register restoration,\npreventing race conditions. The carry flag in the saved P is also\nmanipulated via ROR/ASL to zero it, signaling success to the caller.\nOSBYTE &81 (INKEY) gets special handling as it must read the\nterminal's keyboard."}, {"addr": 37069, "name": "remote_cmd_data", "title": "Fn 8: remote OSWORD handler (NWORD)", "description": "Only intercepts OSWORD 7 (make a sound) and OSWORD 8 (define an\nenvelope). Unlike NBYTE which returns results, NWORD is entirely\nfire-and-forget \u2014 no return path is implemented. The developer\nexplicitly noted this was acceptable since sound/envelope commands\ndon't return meaningful results. Copies up to 14 parameter bytes\nfrom the RX buffer to workspace, tags the message as RWORD, and\ntransmits."}, {"addr": 37301, "name": "remote_display_setup", "title": "Fn 5: printer selection changed (SELECT)", "description": "Called when the printer selection changes. Compares the new\nselection (in PARMX) against the network printer (buffer 4).\nIf it matches, initialises the printer buffer pointer (PBUFFP)\nand sets the initial flag byte (&41). Otherwise just updates\nthe printer status flags (PFLAGS)."}, {"addr": 37319, "name": "remote_print_handler", "title": "Fn 1/2/3: network printer handler (PRINT)", "description": "Handles network printer output. Reason 1 = chars in buffer (extract\nfrom MOS buffer 3 and accumulate), reason 2 = Ctrl-B (start print),\nreason 3 = Ctrl-C (end print). The printer status byte PFLAGS uses:\n  bit 7 = sequence number (toggles per packet for dup detection)\n  bit 6 = always 1 (validity marker)\n  bit 0 = 0 when print active\nPrint streams reuse the BSXMIT (byte-stream transmit) code with\nhandle=0, which causes the AND SEQNOS to produce zero and sidestep\nper-file sequence tracking. After transmission, TXCB pointer bytes\nare filled with &FF to prevent stale values corrupting subsequent\nBGET/BPUT operations (a historically significant bug fix).\nN.B. The printer and REMOTE facility share the same dynamically\nallocated static workspace page via WORKP1 (&9E,&9F) \u2014 care must\nbe taken to never leave the pointer corrupted, as corruption would\ncause one subsystem to overwrite the other's data.\nOnly handles buffer 4 (network printer); others are ignored."}, {"addr": 37356, "name": "store_output_byte", "title": "Store output byte to network buffer", "description": "Stores byte A at the current output offset in the RX buffer\npointed to by (net_rx_ptr). Advances the offset counter and\ntriggers a flush if the buffer is full."}, {"addr": 37399, "name": "flush_output_block", "title": "Flush output block", "description": "Sends the accumulated output block over the network, resets the\nbuffer pointer, and prepares for the next block of output data."}, {"addr": 37597, "name": "save_vdu_state", "title": "Save VDU workspace state", "description": "Stores the cursor position value from &0355 into NFS workspace,\nthen reads cursor position (OSBYTE &85), shadow RAM (OSBYTE &C2),\nand screen start (OSBYTE &C3) via read_vdu_osbyte, storing\neach result into consecutive workspace bytes."}, {"addr": 38511, "name": "adlc_init", "title": "ADLC initialisation", "description": "Reads station ID (INTOFF side effect), performs full ADLC reset,\nchecks for Tube presence (OSBYTE &EA), then falls through to\nadlc_init_workspace."}, {"addr": 38529, "name": "adlc_init_workspace", "title": "Initialise NMI workspace", "description": "Copies NMI shim from ROM to &0D00, stores current ROM bank number\ninto shim self-modifying code, sets TX status to &80 (idle/complete),\nsaves station ID from &FE18 into TX scout buffer, re-enables NMIs\nby reading &FE20."}, {"addr": 38557, "name": "save_econet_state", "title": "Save Econet state to RX control block", "description": "Stores rx_status_flags, protection_mask, and tx_in_progress\nto (net_rx_ptr) at offsets 8-10. INTOFF side effect on entry."}, {"addr": 38580, "name": "restore_econet_state", "title": "Restore Econet state from RX control block", "description": "Loads rx_status_flags, protection_mask, and tx_in_progress\nfrom (net_rx_ptr) at offsets 8-10, then reinitialises via\nadlc_init_workspace."}, {"addr": 38605, "name": "install_nmi_shim", "title": "Copy NMI shim from ROM (&9FCA) to RAM (&0D00)", "description": "Copies 32 bytes. Interrupts are enabled during the copy."}, {"addr": 22, "name": "tube_brk_handler", "title": "Tube BRK handler (BRKV target) \u2014 reference: NFS11 NEWBR", "description": "Sends error information to the Tube co-processor via R2 and R4:\n  1. Sends &FF to R4 (WRIFOR) to signal error\n  2. Reads R2 data (flush any pending byte)\n  3. Sends &00 via R2, then error number from (&FD),0\n  4. Loops sending error string bytes via R2 until zero terminator\n  5. Falls through to tube_reset_stack \u2192 tube_main_loop\nThe main loop continuously polls R1 for WRCH requests (forwarded\nto OSWRITCH &FFCB) and R2 for command bytes (dispatched via the\n14-entry table at &0500). The R2 command byte is stored at &55\nbefore dispatch via JMP (&0500)."}, {"addr": 1024, "name": "tube_code_page4", "title": "Tube host code page 4 \u2014 reference: NFS12 (BEGIN, ADRR, SENDW)", "description": "Copied from ROM at &934C during init. The first 28 bytes (&0400-&041B)\noverlap with the end of the ZP block (the same ROM bytes serve both\nthe ZP copy at &005B-&0076 and this page at &0400-&041B). Contains:\n  &0400: JMP &0473 (BEGIN \u2014 CLI parser / startup entry)\n  &0403: JMP &06E2 (tube_escape_check)\n  &0406: tube_addr_claim \u2014 Tube address claim protocol (ADRR)\n  &0414: tube_post_init \u2014 called after ROM\u2192RAM copy\n  &0473: BEGIN \u2014 startup/CLI entry, break type check\n  &04E7: tube_rdch_handler \u2014 RDCHV target\n  &04EF: tube_restore_regs \u2014 restore X,Y, dispatch entry 6\n  &04F7: tube_read_r2 \u2014 poll R2 status, read data byte to A"}, {"addr": 1280, "name": "tube_dispatch_table", "title": "Tube host code page 5 \u2014 reference: NFS13 (TASKS, BPUT-FILE)", "description": "Copied from ROM at &944C during init. Contains:\n  &0500: tube_dispatch_table \u2014 14-entry handler address table\n  &051C: tube_wrch_handler \u2014 WRCHV target\n  &051F: tube_send_and_poll \u2014 send byte via R2, poll for reply\n  &0527: tube_poll_r1_wrch \u2014 service R1 WRCH while waiting for R2\n  &053D: tube_release_return \u2014 restore regs and RTS\n  &0543: tube_osbput \u2014 write byte to file\n  &0550: tube_osbget \u2014 read byte from file\n  &055B: tube_osrdch \u2014 read character\n  &0569: tube_osfind \u2014 open file\n  &0580: tube_osfind_close \u2014 close file (A=0)\n  &058C: tube_osargs \u2014 file argument read/write\n  &05B1: tube_read_string \u2014 read CR-terminated string into &0700\n  &05C5: tube_oscli \u2014 execute * command\n  &05CB: tube_reply_ack \u2014 send &7F acknowledge\n  &05CD: tube_reply_byte \u2014 send byte and return to main loop\n  &05D8: tube_osfile \u2014 whole file operation"}, {"addr": 1536, "name": "tube_code_page6", "title": "Tube host code page 6 \u2014 reference: NFS13 (GBPB-ESCA)", "description": "Copied from ROM at &954C during init. &0600-&0601 is the tail\nof tube_osfile (BEQ to tube_reply_byte when done). Contains:\n  &0602: tube_osgbpb \u2014 multi-byte file I/O\n  &0626: tube_osbyte_short \u2014 2-param OSBYTE (returns X)\n  &063B: tube_osbyte_long \u2014 3-param OSBYTE (returns carry+Y+X)\n  &065D: tube_osword \u2014 variable-length OSWORD (buffer at &0130)\n  &06A3: tube_osword_rdln \u2014 OSWORD 0 (read line, 5-byte params)\n  &06BB: tube_rdln_send_line \u2014 send input line from &0700\n  &06D0: tube_send_r2 \u2014 poll R2 status, write A to R2 data\n  &06D9: tube_send_r4 \u2014 poll R4 status, write A to R4 data\n  &06E2: tube_escape_check \u2014 check &FF, forward escape to R1\n  &06E8: tube_event_handler \u2014 EVNTV: forward event (A,X,Y) via R1\n  &06F7: tube_send_r1 \u2014 poll R1 status, write A to R1 data"}, {"addr": 37448, "name": "econet_tx_retry", "title": "Transmit with retry loop (XMITFS/XMITFY)", "description": "Calls the low-level transmit routine (BRIANX) with FSTRY (&FF = 255)\nretries and FSDELY (&60 = 96) ms delay between attempts. On each\niteration, checks the result code: zero means success, non-zero\nmeans retry. After all retries exhausted, reports a 'Net error'.\nEntry point XMITFY allows a custom delay in Y."}, {"addr": 37521, "name": "save_palette_vdu", "title": "Save palette and VDU state (CVIEW)", "description": "Part of the VIEW facility (second iteration, started 27/7/82).\nUses dynamically allocated buffer store. The WORKP1 pointer\n(&9E,&9F) serves double duty: non-zero indicates data ready AND\nprovides the buffer address \u2014 an efficient use of scarce zero-\npage space. This code must be user-transparent as the NFS may not\nbe the dominant filing system.\nReads all 16 palette entries using OSWORD &0B (read palette) and\nstores the results. Then reads cursor position (OSBYTE &85),\nshadow RAM allocation (OSBYTE &C2), and screen start address\n(OSBYTE &C3) using the 3-entry table at &9304 (osbyte_vdu_table).\nOn completion, restores the JSR buffer protection bits (LSTAT)\nfrom OLDJSR to re-enable JSR reception, which was disabled during\nthe screen data capture to prevent interference."}, {"addr": 39355, "name": "post_ack_scout", "title": "Post-ACK scout processing", "description": "Called after the scout ACK has been transmitted. Processes the\nreceived scout data stored in the buffer at &0D3D-&0D48.\nChecks the port byte (&0D40) against open receive blocks to\nfind a matching listener. If a match is found, sets up the\ndata RX handler chain for the four-way handshake data phase.\nIf no match, discards the frame."}, {"addr": 39513, "name": "immediate_op", "title": "Immediate operation handler (port = 0)", "description": "Handles immediate (non-data-transfer) operations received via\nscout frames with port byte = 0. The control byte (&0D3F)\ndetermines the operation type:\n  &81 = PEEK (read memory)\n  &82 = POKE (write memory)\n  &83 = JSR (remote procedure call)\n  &84 = user procedure\n  &85 = OS procedure\n  &86 = HALT\n  &87 = CONTINUE\nThe protection mask (LSTAT at &D63) controls which operations\nare permitted \u2014 each bit enables or disables an operation type.\nIf the operation is not permitted by the mask, it is silently\nignored. LSTAT can be read/set via OSWORD &12 sub-functions 4/5."}, {"addr": 39476, "name": "discard_reset_listen", "title": "Discard with full ADLC reset", "description": "Performs adlc_full_reset (CR1=&C1, reset both TX and RX sections),\nthen falls through to discard_after_reset. Used when the ADLC is\nin an unexpected state and needs a hard reset before returning\nto idle listen mode. 5 references \u2014 the main error recovery path."}, {"addr": 39488, "name": "discard_listen", "title": "Discard frame (gentle)", "description": "Sends RX_DISCONTINUE (CR1=&A2: RIE|RX_DISCONTINUE) to abort the\ncurrent frame reception without a full reset, then falls through\nto discard_after_reset. Used for clean rejection of frames that\nare correctly formatted but not for us (wrong station/network)."}, {"addr": 39491, "name": "discard_after_reset", "title": "Return to idle listen after reset/discard", "description": "Just calls adlc_rx_listen (CR1=&82, CR2=&67) to re-enter idle\nRX mode, then RTI. The simplest of the three discard paths \u2014\nused as the tail of both discard_reset_listen and discard_listen."}, {"addr": 40795, "name": "tx_calc_transfer", "title": "Calculate transfer size", "description": "Computes the number of bytes actually transferred during a data\nframe reception. Subtracts the low pointer (LPTR, offset 4 in\nthe RXCB) from the current buffer position to get the byte count,\nand stores it back into the RXCB's high pointer field (HPTR,\noffset 8). This tells the caller how much data was received."}, {"addr": 40907, "name": "nmi_bootstrap_entry", "title": "Bootstrap NMI entry point (in ROM)", "description": "An alternate NMI handler that lives in the ROM itself rather than\nin the RAM workspace at &0D00. Unlike the RAM shim (which uses a\nself-modifying JMP to dispatch to different handlers), this one\nhardcodes JMP nmi_rx_scout (&96F6). Used as the initial NMI handler\nbefore the workspace has been properly set up during initialisation.\nSame sequence as the RAM shim: BIT &FE18 (INTOFF), PHA, TYA, PHA,\nLDA romsel, STA &FE30, JMP &96F6."}, {"addr": 40921, "name": "rom_set_nmi_vector", "title": "ROM copy of set_nmi_vector + nmi_rti", "description": "A version of the NMI vector-setting subroutine and RTI sequence\nthat lives in ROM. The RAM workspace copy at &0D0E/&0D14 is the\none normally used at runtime; this ROM copy is used during early\ninitialisation before the RAM workspace has been set up, and as\nthe source for the initial copy to RAM."}, {"addr": 38620, "name": "adlc_full_reset", "title": "ADLC full reset", "description": "Aborts all activity and returns to idle RX listen mode."}, {"addr": 38635, "name": "adlc_rx_listen", "title": "Enter RX listen mode", "description": "TX held in reset, RX active with interrupts. Clears all status."}, {"addr": 38646, "name": "nmi_rx_scout", "title": "NMI RX scout handler (initial byte)", "description": "Default NMI handler for incoming scout frames. Checks if the frame\nis addressed to us or is a broadcast. Installed as the NMI target\nduring idle RX listen mode.\nTests SR2 bit0 (AP = Address Present) to detect incoming data.\nReads the first byte (destination station) from the RX FIFO and\ncompares against our station ID. Reading &FE18 also disables NMIs\n(INTOFF side effect)."}, {"addr": 38677, "name": "nmi_rx_scout_net", "title": "RX scout second byte handler", "description": "Reads the second byte of an incoming scout (destination network).\nChecks for network match: 0 = local network (accept), &FF = broadcast\n(accept and flag), anything else = reject.\nInstalls the scout data reading loop handler at &9747."}, {"addr": 38711, "name": "scout_error", "title": "Scout error/discard handler", "description": "Reached when the scout data loop sees no RDA (BPL at &974C) or\nwhen scout completion finds unexpected SR2 state.\nIf SR2 & &81 is non-zero (AP or RDA still active), performs full\nADLC reset and discards. If zero (clean end), discards via &9A40.\nThis path is a common landing for any unexpected ADLC state during\nscout reception."}, {"addr": 38727, "title": "Scout data reading loop", "description": "Reads the body of a scout frame, two bytes per iteration. Stores\nbytes at &0D3D+Y (scout buffer: src_stn, src_net, ctrl, port, ...).\nBetween each pair it checks SR2:\n  - SR2 & &81 tested at entry (&974A): AP|RDA bits\n    - Neither set (BEQ) -> discard (&9744 -> &9A40)\n    - AP without RDA (BPL) -> error (&9737)\n    - RDA set (BMI) -> read byte\n  - After first byte (&9755): full SR2 tested\n    - SR2 non-zero (BNE) -> scout completion (&9771)\n      This is the FV detection point: when FV is set (by inline refill\n      of the last byte during the preceding RX FIFO read), SR2 is\n      non-zero and the branch is taken.\n    - SR2 = 0 -> read second byte and loop\n  - After second byte (&9769): re-test SR2 & &81 for next pair\n    - RDA set (BMI) -> loop back to &974E\n    - Neither set -> RTI, wait for next NMI\nThe loop ends at Y=&0C (12 bytes max in scout buffer)."}, {"addr": 38769, "name": "scout_complete", "title": "Scout completion handler", "description": "Reached from the scout data loop when SR2 is non-zero (FV detected).\nDisables PSE to allow individual SR2 bit testing:\n  CR1=&00 (clear all enables)\n  CR2=&84 (RDA_SUPPRESS_FV | FC_TDRA) -- no PSE, no CLR bits\nThen checks FV (bit1) and RDA (bit7):\n  - No FV (BEQ) -> error &9737 (not a valid frame end)\n  - FV set, no RDA (BPL) -> error &9737 (missing last byte)\n  - FV set, RDA set -> read last byte, process scout\nAfter reading the last byte, the complete scout buffer (&0D3D-&0D48)\ncontains: src_stn, src_net, ctrl, port [, extra_data...].\nThe port byte at &0D40 determines further processing:\n  - Port = 0 -> immediate operation (&9A59)\n  - Port non-zero -> check if it matches an open receive block"}, {"addr": 38969, "name": "nmi_data_rx", "title": "Data frame RX handler (four-way handshake)", "description": "Receives the data frame after the scout ACK has been sent.\nFirst checks AP (Address Present) for the start of the data frame.\nReads and validates the first two address bytes (dest_stn, dest_net)\nagainst our station address, then installs continuation handlers\nto read the remaining data payload into the open port buffer.\n\nHandler chain: &9839 (AP+addr check) -> &984F (net=0 check) ->\n&9865 (skip ctrl+port) -> &989A (bulk data read) -> &98CE (completion)"}, {"addr": 39066, "name": "nmi_data_rx_bulk", "title": "Data frame bulk read loop", "description": "Reads data payload bytes from the RX FIFO and stores them into\nthe open port buffer at (open_port_buf),Y. Reads bytes in pairs\n(like the scout data loop), checking SR2 between each pair.\nSR2 non-zero (FV or other) -> frame completion at &98CE.\nSR2 = 0 -> RTI, wait for next NMI to continue."}, {"addr": 39118, "name": "data_rx_complete", "title": "Data frame completion", "description": "Reached when SR2 non-zero during data RX (FV detected).\nSame pattern as scout completion (&9771): disables PSE (CR1=&00,\nCR2=&84), then tests FV and RDA. If FV+RDA, reads the last byte.\nIf extra data available and buffer space remains, stores it.\nProceeds to send the final ACK via &995E."}, {"addr": 39262, "name": "ack_tx", "title": "ACK transmission", "description": "Sends a scout ACK or final ACK frame as part of the four-way handshake.\nIf bit7 of &0D4A is set, this is a final ACK -> completion (&9F39).\nOtherwise, configures for TX (CR1=&44, CR2=&A7) and sends the ACK\nframe (dst_stn, dst_net from &0D3D, src_stn from &FE18, src_net=0).\nThe ACK frame has no data payload -- just address bytes.\n\nAfter writing the address bytes to the TX FIFO, installs the next\nNMI handler from &0D4B/&0D4C (saved by the scout/data RX handler)\nand sends TX_LAST_DATA (CR2=&3F) to close the frame."}, {"addr": 39314, "name": "nmi_ack_tx_src", "title": "ACK TX continuation", "description": "Writes source station and network to TX FIFO, completing the 4-byte\nACK frame. Then sends TX_LAST_DATA (CR2=&3F) to close the frame."}, {"addr": 40008, "name": "inactive_poll", "title": "INACTIVE polling loop", "description": "Polls SR2 for INACTIVE (bit2) to confirm the network line is idle before\nattempting transmission. Uses a 3-byte timeout counter on the stack.\nThe timeout (~256^3 iterations) generates \"Line Jammed\" if INACTIVE\nnever appears.\nThe CTS check at &9C66-&9C6B works because CR2=&67 has RTS=0, so\ncts_input_ is always true, and SR1_CTS reflects presence of clock hardware."}, {"addr": 40072, "name": "tx_line_jammed", "title": "Timeout error: writes CR2=&07 to abort, cleans stack,", "description": "returns error &40 (\"Line Jammed\")."}, {"addr": 40098, "name": "tx_prepare", "title": "TX preparation", "description": "Configures ADLC for transmission: asserts RTS via CR2, enables TIE via CR1,\ninstalls NMI TX handler at &9D4C, and re-enables NMIs."}, {"addr": 40268, "name": "nmi_tx_data", "title": "NMI TX data handler", "description": "Writes 2 bytes per NMI invocation to the TX FIFO at &FEA2. Uses the\nBIT instruction on SR1 to test TDRA (V flag = bit6) and IRQ (N flag = bit7).\nAfter writing 2 bytes, checks if the frame is complete. If more data,\ntests SR1 bit7 (IRQ) via BMI -- if IRQ still asserted, writes 2 more bytes\nwithout returning from NMI (tight loop). Otherwise returns via RTI."}, {"addr": 40328, "name": "tx_last_data", "title": "TX_LAST_DATA and frame completion", "description": "Signals end of TX frame by writing CR2=&3F (TX_LAST_DATA). Then installs\nthe TX completion NMI handler at &9D94 which switches to RX mode.\nCR2=&3F = 0011_1111:\n  bit5: CLR_RX_ST -- clears fv_stored_ (prepares for RX of reply)\n  bit4: TX_LAST_DATA -- tells ADLC this is the final data byte\n  bit3: FLAG_IDLE -- send flags/idle after frame\n  bit2: FC_TDRA -- force clear TDRA\n  bit1: 2_1_BYTE -- two-byte transfer mode\n  bit0: PSE -- prioritised status enable\nNote: NO CLR_TX_ST (bit6=0), NO RTS (bit7=0 -- drops RTS after frame)"}, {"addr": 40340, "name": "nmi_tx_complete", "title": "TX completion: switch to RX mode", "description": "Called via NMI after the frame (including CRC and closing flag) has been\nfully transmitted. Switches from TX mode to RX mode by writing CR1=&82.\nCR1=&82 = 1000_0010: TX_RESET | RIE (listen for reply).\nChecks workspace flags to decide next action:\n  - bit6 set at &0D4A -> completion at &9F39\n  - bit0 set at &0D4A -> four-way handshake data phase at &9EDD\n  - Otherwise -> install RX reply handler at &9DB2"}, {"addr": 40370, "name": "nmi_reply_scout", "title": "RX reply scout handler", "description": "Handles reception of the reply scout frame after transmission.\nChecks SR2 bit0 (AP) for incoming data, reads the first byte\n(destination station) and compares to our station ID via &FE18\n(which also disables NMIs as a side effect)."}, {"addr": 40392, "name": "nmi_reply_cont", "title": "RX reply continuation handler", "description": "Reads the second byte of the reply scout (destination network) and\nvalidates it is zero (local network). Installs &9DE3 for the\nremaining two bytes (source station and network).\nOptimisation: checks SR1 bit7 (IRQ still asserted) via BMI at &9DD9.\nIf IRQ is still set, falls through directly to &9DE3 without an RTI,\navoiding NMI re-entry overhead for short frames where all bytes arrive\nin quick succession."}, {"addr": 40419, "name": "nmi_reply_validate", "title": "RX reply validation (Path 2 for FV/PSE interaction)", "description": "Reads the source station and source network from the reply scout and\nvalidates them against the original TX destination (&0D20/&0D21).\nSequence:\n  1. Check SR2 bit7 (RDA) at &9DE3 -- must see data available\n  2. Read source station at &9DE8, compare to &0D20 (tx_dst_stn)\n  3. Read source network at &9DF0, compare to &0D21 (tx_dst_net)\n  4. Check SR2 bit1 (FV) at &9DFA -- must see frame complete\nIf all checks pass, the reply scout is valid and the ROM proceeds\nto send the scout ACK (CR2=&A7 for RTS, CR1=&44 for TX mode)."}, {"addr": 40491, "name": "nmi_scout_ack_src", "title": "TX scout ACK: write source address", "description": "Writes our station ID and network=0 to TX FIFO, completing the\n4-byte scout ACK frame. Then proceeds to send the data frame."}, {"addr": 40528, "name": "nmi_data_tx", "title": "TX data phase: send payload", "description": "Sends the data frame payload from (open_port_buf),Y in pairs per NMI.\nSame pattern as the NMI TX handler at &9D4C but reads from the port\nbuffer instead of the TX workspace. Writes two bytes per iteration,\nchecking SR1 IRQ between pairs for tight looping."}, {"addr": 40669, "name": "handshake_await_ack", "title": "Four-way handshake: switch to RX for final ACK", "description": "After the data frame TX completes, switches to RX mode (CR1=&82)\nand installs &9EE9 to receive the final ACK from the remote station."}, {"addr": 40681, "name": "nmi_final_ack", "title": "RX final ACK handler", "description": "Receives the final ACK in a four-way handshake. Same validation\npattern as the reply scout handler (&9DB2-&9DE3):\n  &9EE9: Check AP, read dest_stn, compare to our station\n  &9EFF: Check RDA, read dest_net, validate = 0\n  &9F15: Check RDA, read src_stn/net, compare to TX dest\n  &9F32: Check FV for frame completion\nOn success, stores result=0 at &9F39. On any failure, error &41."}, {"addr": 40725, "name": "nmi_final_ack_validate", "title": "Final ACK validation", "description": "Reads and validates src_stn and src_net against original TX dest.\nThen checks FV for frame completion."}, {"addr": 40761, "name": "tx_result_ok", "title": "TX completion handler", "description": "Stores result code 0 (success) into the first byte of the TX control\nblock (nmi_tx_block),Y=0. Then sets &0D3A bit7 to signal completion\nand calls full ADLC reset + idle listen via &9A34."}, {"addr": 40767, "name": "tx_store_result", "title": "TX error handler", "description": "Stores error code (A) into the TX control block, sets &0D3A bit7\nfor completion, and returns to idle via &9A34.\nError codes: &00=success, &40=line jammed, &41=not listening,\n&42=net error."}], "external_labels": {"l0000": 0, "l0001": 1, "l0002": 2, "l0003": 3, "zp_temp_10": 16, "zp_temp_11": 17, "l0012": 18, "l0013": 19, "l0014": 20, "l0015": 21, "zp_63": 99, "l006d": 109, "escapable": 151, "need_release_tube": 152, "net_tx_ptr": 154, "net_tx_ptr_hi": 155, "net_rx_ptr": 156, "net_rx_ptr_hi": 157, "nfs_workspace": 158, "nfs_workspace_hi": 159, "nmi_tx_block": 160, "nmi_tx_block_hi": 161, "port_buf_len": 162, "port_buf_len_hi": 163, "open_port_buf": 164, "open_port_buf_hi": 165, "port_ws_offset": 166, "rx_buf_offset": 167, "rom_svc_num": 169, "l00ae": 174, "l00af": 175, "fs_load_addr": 176, "fs_load_addr_hi": 177, "fs_load_addr_2": 178, "l00b3": 179, "l00b4": 180, "l00b5": 181, "l00b6": 182, "l00b7": 183, "fs_error_ptr": 184, "fs_options": 187, "fs_block_offset": 188, "fs_last_byte_flag": 189, "fs_crc_lo": 190, "fs_crc_hi": 191, "l00c0": 192, "l00c1": 193, "l00c2": 194, "l00c4": 196, "l00c7": 199, "l00c8": 200, "fs_temp_cd": 205, "fs_temp_ce": 206, "l00cf": 207, "l00e7": 231, "l00ef": 239, "l00f0": 240, "l00f1": 241, "os_text_ptr": 242, "romsel_copy": 244, "osrdsc_ptr": 246, "l00f7": 247, "l00fd": 253, "l00ff": 255, "l0100": 256, "l0101": 257, "l0102": 258, "l0103": 259, "l0104": 260, "l0106": 262, "l0130": 304, "brkv": 514, "wrchv": 526, "rdchv": 528, "filev": 530, "fscv": 542, "evntv": 544, "netv": 548, "l0350": 848, "l0351": 849, "l0355": 853, "l0700": 1792, "l0cff": 3327, "nmi_shim_07": 3335, "nmi_jmp_lo": 3340, "nmi_jmp_hi": 3341, "set_nmi_vector": 3342, "nmi_rti": 3348, "nmi_shim_1a": 3354, "tx_dst_stn": 3360, "tx_dst_net": 3361, "tx_src_stn": 3362, "tx_src_net": 3363, "tx_ctrl_byte": 3364, "tx_port": 3365, "tx_data_start": 3366, "tx_data_len": 3370, "rx_status_flags": 3384, "tx_ctrl_status": 3386, "rx_ctrl_copy": 3387, "rx_src_stn": 3389, "rx_src_net": 3390, "rx_ctrl": 3391, "rx_port": 3392, "rx_remote_addr": 3393, "tx_flags": 3402, "nmi_next_lo": 3403, "nmi_next_hi": 3404, "tx_index": 3407, "tx_length": 3408, "tx_work_51": 3409, "tx_in_progress": 3410, "tx_work_57": 3415, "scout_status": 3420, "rx_extra_byte": 3421, "l0d60": 3424, "printer_buf_ptr": 3425, "tx_clear_flag": 3426, "prot_status": 3427, "rx_flags": 3428, "saved_jsr_mask": 3429, "econet_init_flag": 3430, "tube_flag": 3431, "l0dda": 3546, "fs_state_deb": 3563, "l0dfe": 3582, "fs_server_stn": 3584, "fs_server_net": 3585, "fs_urd_handle": 3586, "fs_csd_handle": 3587, "fs_lib_handle": 3588, "fs_boot_option": 3589, "fs_messages_flag": 3590, "fs_eof_flags": 3591, "fs_sequence_nos": 3592, "fs_last_error": 3593, "fs_cmd_context": 3594, "l0e0b": 3595, "l0e0c": 3596, "fs_reply_status": 3597, "fs_target_stn": 3598, "fs_cmd_ptr": 3600, "l0e11": 3601, "l0e16": 3606, "l0ef7": 3831, "fs_cmd_type": 3840, "fs_cmd_y_param": 3841, "fs_cmd_urd": 3842, "fs_cmd_csd": 3843, "fs_cmd_lib": 3844, "fs_cmd_data": 3845, "l0f06": 3846, "l0f07": 3847, "l0f08": 3848, "l0f09": 3849, "l0f0b": 3851, "l0f0c": 3852, "l0f0d": 3853, "l0f0e": 3854, "l0f10": 3856, "l0f11": 3857, "l0f12": 3858, "l0f13": 3859, "l0f14": 3860, "l0f16": 3862, "l0fc5": 4037, "l0fc6": 4038, "fs_putb_buf": 4060, "fs_getb_buf": 4061, "l0fde": 4062, "l0fdf": 4063, "l0fe0": 4064, "l212e": 8494, "l6465": 25701, "l7dfd": 32253, "pydis_end": 40960, "station_id_disable_net_nmis": 65048, "video_ula_control": 65056, "romsel": 65072, "system_via_sr": 65098, "system_via_acr": 65099, "system_via_ifr": 65101, "system_via_ier": 65102, "econet_control1_or_status1": 65184, "econet_control23_or_status2": 65185, "econet_data_continue_frame": 65186, "econet_data_terminate_frame": 65187, "tube_status_1_and_tube_control": 65248, "tube_data_register_1": 65249, "tube_status_register_2": 65250, "tube_data_register_2": 65251, "tube_status_register_3": 65252, "tube_data_register_3": 65253, "tube_status_register_4_and_cpu_control": 65254, "tube_data_register_4": 65255, "gsinit": 65474, "gsread": 65477, "nvrdch": 65480, "nvwrch": 65483, "osfind": 65486, "osgbpb": 65489, "osbput": 65492, "osbget": 65495, "osargs": 65498, "osfile": 65501, "osasci": 65507, "osnewl": 65511, "osword": 65521, "osbyte": 65524, "oscli": 65527}, "items": [{"addr": 32768, "bytes": [76, 153, 128], "labels": ["rom_header", "language_entry", "pydis_start"], "sub_labels": {"32769": ["l8001"], "32770": ["l8002"]}, "comments_before": ["Sideways ROM header", "NFS ROM 3.34 disassembly (Acorn Econet filing system)\n\nNMI handler architecture\n========================\nThe NFS ROM uses self-modifying code to implement a state machine for\nADLC communication. An NMI workspace shim is copied to &0D00 at init.\n\nNMI entry (&0D00):\n  BIT &FE18       ; INTOFF -- immediately disable further NMIs\n  PHA / TYA / PHA ; save A, Y\n  LDA #$nn        ; page in NFS ROM bank (self-modified at init)\n  STA &FE30\n  JMP $xxxx       ; self-modifying target at &0D0C/&0D0D\n\nset_nmi_vector (&0D0E): stores A->&0D0C (low), Y->&0D0D (high)\n  Falls through to nmi_rti.\n\nnmi_rti (&0D14):\n  LDA &F4         ; restore original ROM bank\n  STA &FE30\n  PLA / TAY / PLA ; restore Y, A\n  BIT &FE20       ; INTON -- re-enable NMIs\n  RTI\n\nNMI handler chain for outbound transmission (four-way handshake):\n  &96F6: RX scout (idle listen, default handler)\n  &9C48: INACTIVE polling (pre-TX, waits for idle line)\n  &9D4C: TX data (2 bytes per NMI, tight loop if IRQ persists)\n  &9D88: TX_LAST_DATA (close frame)\n  &9D94: TX completion (switch to RX: CR1=&82)\n  &9DB2: RX reply scout (check AP, read dest_stn)\n  &9DC8: RX reply continuation (read dest_net, validate)\n  &9DE3: RX reply validation (read src_stn/net, check FV)\n  &9E24: TX scout ACK (write dest/src addr, TX_LAST_DATA)\n  &9EDD: Four-way handshake data phase\n\nNMI handler chain for inbound reception (scout -> data):\n  &96F6: RX scout (idle listen)\n  &9715: RX scout second byte (dest_net, install &9747)\n  &9747: Scout data loop (read body in pairs, detect FV)\n  &9771: Scout completion (disable PSE, read last byte)\n  &995E: TX scout ACK\n  &9839: RX data frame (AP check, validate dest_stn/net)\n  &984F: RX data frame (validate src_net=0)\n  &9865: RX data frame (skip ctrl/port bytes)\n  &989A: RX data bulk read (read payload into buffer)\n  &98CE: RX data completion (disable PSE, check FV, read last)\n  &995E: TX final ACK\n\nKey ADLC register values:\n  CR1=&C1: full reset (TX_RESET|RX_RESET|AC)\n  CR1=&82: RX listen (TX_RESET|RIE)\n  CR1=&44: TX active (RX_RESET|TIE)\n  CR2=&67: clear all status (CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)\n  CR2=&E7: TX prepare (RTS|CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)\n  CR2=&3F: TX last data (CLR_RX_ST|TX_LAST_DATA|FLAG_IDLE|FC_TDRA|2_1_BYTE|PSE)\n  CR2=&A7: TX in handshake (RTS|CLR_TX_ST|FC_TDRA|2_1_BYTE|PSE)", "&8000 referenced 1 time by &048b[2]", "&8001 referenced 1 time by &0490[2]", "&8002 referenced 1 time by &0495[2]"], "references": [1163], "type": "code", "mnemonic": "jmp", "operand": "language_handler", "target": 32921, "target_label": "language_handler"}, {"addr": 32771, "bytes": [76, 175, 128], "labels": ["service_entry"], "sub_labels": {"32772": ["l8004"]}, "comments_before": ["&8003 referenced 1 time by &049a[2]", "&8004 referenced 1 time by &049d[2]"], "references": [1178], "type": "code", "mnemonic": "jmp", "operand": "service_handler", "target": 32943, "target_label": "service_handler"}, {"addr": 32774, "bytes": [130], "labels": ["rom_type"], "comments_before": ["&8006 referenced 1 time by &0482[2]"], "references": [1154], "type": "byte", "values": [130]}, {"addr": 32775, "bytes": [12], "labels": ["copyright_offset"], "comments_before": ["&8007 referenced 1 time by &0487[2]"], "references": [1159], "type": "byte", "values": [12]}, {"addr": 32776, "bytes": [3], "labels": ["binary_version"], "comments_before": ["&8008 referenced 2 times by &81a3, &81ac"], "references": [33187, 33196], "type": "byte", "values": [3]}, {"addr": 32777, "bytes": [78, 69, 84], "labels": ["title"], "type": "string", "string": "NET"}, {"addr": 32780, "bytes": [0], "labels": ["copyright"], "type": "byte", "values": [0]}, {"addr": 32781, "bytes": [40, 67, 41, 82, 79, 70, 70, 0], "labels": ["l800d"], "sub_labels": {"32788": ["l8014"]}, "comments_before": ["&8014 referenced 1 time by &842d"], "type": "string", "string": "(C)ROFF."}, {"addr": 32789, "bytes": [13, 24], "type": "byte", "values": [13, 24]}, {"addr": 32791, "bytes": [39, 49, 59, 59, 67, 79], "type": "string", "string": "'1;;CO"}, {"addr": 32797, "bytes": [1, 0, 52], "type": "byte", "values": [1, 0, 52]}, {"addr": 32800, "bytes": [3], "labels": ["dispatch_lo"], "comments_before": ["Dispatch table: low bytes of (handler_address - 1)\nEach entry stores the low byte of a handler address minus 1,\nfor use with the PHA/PHA/RTS dispatch trick at &809F.\nSee dispatch_hi (&8044) for the corresponding high bytes.\nIndexed by service number (1-13), language reason (14-18),\nor *NET command (33-36), with a base offset added by the caller.", "&8020 referenced 1 time by &80a8"], "references": [32936], "type": "byte", "values": [3]}, {"addr": 32801, "bytes": [68], "type": "byte", "values": [68]}, {"addr": 32802, "bytes": [110], "type": "byte", "values": [110]}, {"addr": 32803, "bytes": [119], "type": "byte", "values": [119]}, {"addr": 32804, "bytes": [208], "type": "byte", "values": [208]}, {"addr": 32805, "bytes": [113], "type": "byte", "values": [113]}, {"addr": 32806, "bytes": [107], "type": "byte", "values": [107]}, {"addr": 32807, "bytes": [68], "type": "byte", "values": [68]}, {"addr": 32808, "bytes": [104], "type": "byte", "values": [104]}, {"addr": 32809, "bytes": [246], "type": "byte", "values": [246]}, {"addr": 32810, "bytes": [187], "type": "byte", "values": [187]}, {"addr": 32811, "bytes": [68], "type": "byte", "values": [68]}, {"addr": 32812, "bytes": [104], "type": "byte", "values": [104]}, {"addr": 32813, "bytes": [101], "type": "byte", "values": [101]}, {"addr": 32814, "bytes": [73], "type": "byte", "values": [73]}, {"addr": 32815, "bytes": [251], "type": "byte", "values": [251]}, {"addr": 32816, "bytes": [144], "type": "byte", "values": [144]}, {"addr": 32817, "bytes": [41], "type": "byte", "values": [41]}, {"addr": 32818, "bytes": [57], "type": "byte", "values": [57]}, {"addr": 32819, "bytes": [160], "type": "byte", "values": [160]}, {"addr": 32820, "bytes": [30], "type": "byte", "values": [30]}, {"addr": 32821, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 32822, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 32823, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 32824, "bytes": [252], "type": "byte", "values": [252]}, {"addr": 32825, "bytes": [252], "type": "byte", "values": [252]}, {"addr": 32826, "bytes": [217], "type": "byte", "values": [217]}, {"addr": 32827, "bytes": [114], "type": "byte", "values": [114]}, {"addr": 32828, "bytes": [30], "type": "byte", "values": [30]}, {"addr": 32829, "bytes": [31], "type": "byte", "values": [31]}, {"addr": 32830, "bytes": [251], "type": "byte", "values": [251]}, {"addr": 32831, "bytes": [131], "type": "byte", "values": [131]}, {"addr": 32832, "bytes": [246], "type": "byte", "values": [246]}, {"addr": 32833, "bytes": [174], "type": "byte", "values": [174]}, {"addr": 32834, "bytes": [200], "type": "byte", "values": [200]}, {"addr": 32835, "bytes": [222], "type": "byte", "values": [222]}, {"addr": 32836, "bytes": [241], "labels": ["dispatch_hi"], "comments_before": ["Dispatch table: high bytes of (handler_address - 1)\nPaired with dispatch_lo (&8020). Together they form a table of\n37 handler addresses, used via the PHA/PHA/RTS trick at &809F.", "&8044 referenced 1 time by &80a4"], "references": [32932], "type": "byte", "values": [241]}, {"addr": 32837, "bytes": [129], "type": "byte", "values": [129]}, {"addr": 32838, "bytes": [130], "type": "byte", "values": [130]}, {"addr": 32839, "bytes": [130], "type": "byte", "values": [130]}, {"addr": 32840, "bytes": [129], "type": "byte", "values": [129]}, {"addr": 32841, "bytes": [129], "type": "byte", "values": [129]}, {"addr": 32842, "bytes": [150], "type": "byte", "values": [150]}, {"addr": 32843, "bytes": [129], "type": "byte", "values": [129]}, {"addr": 32844, "bytes": [128], "type": "byte", "values": [128]}, {"addr": 32845, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32846, "bytes": [129], "type": "byte", "values": [129]}, {"addr": 32847, "bytes": [129], "type": "byte", "values": [129]}, {"addr": 32848, "bytes": [150], "type": "byte", "values": [150]}, {"addr": 32849, "bytes": [150], "type": "byte", "values": [150]}, {"addr": 32850, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 32851, "bytes": [144], "type": "byte", "values": [144]}, {"addr": 32852, "bytes": [146], "type": "byte", "values": [146]}, {"addr": 32853, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 32854, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 32855, "bytes": [137], "type": "byte", "values": [137]}, {"addr": 32856, "bytes": [136], "type": "byte", "values": [136]}, {"addr": 32857, "bytes": [139], "type": "byte", "values": [139]}, {"addr": 32858, "bytes": [139], "type": "byte", "values": [139]}, {"addr": 32859, "bytes": [139], "type": "byte", "values": [139]}, {"addr": 32860, "bytes": [139], "type": "byte", "values": [139]}, {"addr": 32861, "bytes": [130], "type": "byte", "values": [130]}, {"addr": 32862, "bytes": [133], "type": "byte", "values": [133]}, {"addr": 32863, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32864, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32865, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32866, "bytes": [140], "type": "byte", "values": [140]}, {"addr": 32867, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32868, "bytes": [140], "type": "byte", "values": [140]}, {"addr": 32869, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32870, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32871, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32872, "bytes": [141], "type": "byte", "values": [141]}, {"addr": 32873, "bytes": [165, 239], "labels": ["dispatch_net_cmd"], "comments_before": ["***************************************************************************************", "*NET command dispatcher\n\nParses the character after *NET as '1'-'4', maps to table\nindices 33-36 via base offset Y=&20, and dispatches via &809F.\nCharacters outside '1'-'4' fall through to return_1 (RTS).", "***************************************************************************************"], "comment_inline": "Read command character following *NET", "type": "code", "mnemonic": "lda", "operand": "l00ef", "target": 239, "target_label": "l00ef"}, {"addr": 32875, "bytes": [233, 49], "comment_inline": "Subtract ASCII '1' to get 0-based command index", "type": "code", "mnemonic": "sbc", "operand": "#&31"}, {"addr": 32877, "bytes": [48, 63], "type": "code", "mnemonic": "bmi", "operand": "return_1", "target": 32942, "target_label": "return_1"}, {"addr": 32879, "bytes": [201, 4], "type": "code", "mnemonic": "cmp", "operand": "#4"}, {"addr": 32881, "bytes": [176, 59], "type": "code", "mnemonic": "bcs", "operand": "return_1", "target": 32942, "target_label": "return_1"}, {"addr": 32883, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 32884, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 32885, "bytes": [160, 32], "comment_inline": "Y=&20: base offset for *NET commands (index 33+)", "type": "code", "mnemonic": "ldy", "operand": "#&20"}, {"addr": 32887, "bytes": [208, 38], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "dispatch", "target": 32927, "target_label": "dispatch"}, {"addr": 32889, "bytes": [32, 99, 141], "labels": ["forward_star_cmd"], "comments_before": ["***************************************************************************************", "Forward unrecognised * command to fileserver (COMERR)\n\nCopies command text from (fs_crc_lo) to &0F05+ via copy_filename,\nprepares an FS command with function code 0, and sends it to the\nfileserver to request decoding. The server returns a command code\nindicating what action to take (e.g. code 4=INFO, 7=DIR, 9=LIB,\n5=load-as-command). This mechanism allows the fileserver to extend\nthe client's command set without ROM updates. Called from the \"I.\"\nand catch-all entries in the command match table at &8BD6, and\nfrom FSCV 2/3/4 indirectly. If CSD handle is zero (not logged\nin), returns without sending.", "***************************************************************************************", "&8079 referenced 1 time by &8d1c"], "references": [36124], "type": "code", "mnemonic": "jsr", "operand": "copy_filename", "target": 36195, "target_label": "copy_filename"}, {"addr": 32892, "bytes": [168], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "tay"}, {"addr": 32893, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 32896, "bytes": [174, 3, 15], "comment_inline": "X=depends on function", "type": "code", "mnemonic": "ldx", "operand": "fs_cmd_csd", "target": 3843, "target_label": "fs_cmd_csd"}, {"addr": 32899, "bytes": [240, 41], "type": "code", "mnemonic": "beq", "operand": "return_1", "target": 32942, "target_label": "return_1"}, {"addr": 32901, "bytes": [173, 5, 15], "comment_inline": "A=function code (0-7)", "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 32904, "bytes": [160, 22], "comment_inline": "Y=depends on function", "type": "code", "mnemonic": "ldy", "operand": "#&16"}, {"addr": 32906, "bytes": [208, 19], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "dispatch", "target": 32927, "target_label": "dispatch"}, {"addr": 32908, "bytes": [32, 8, 133], "labels": ["fscv_handler"], "comments_before": ["***************************************************************************************", "FSCV dispatch entry\n\nEntered via the extended vector table when the MOS calls FSCV.\nStores A/X/Y via save_fscv_args, compares A (function code) against 8,\nand dispatches codes 0-7 via the shared dispatch table at &8020\nwith base offset Y=&12 (table indices 19-26).\nFunction codes: 0=*OPT, 1=EOF, 2=*/, 3=unrecognised *,\n4=*RUN, 5=*CAT, 6=shutdown, 7=read handles.\n\nOn Entry:\n    A: function code (0-7)\n    X: depends on function\n    Y: depends on function\n\nOn Exit:\n    A: depends on handler (preserved if A >= 8)\n    X: depends on handler (preserved if A >= 8)\n    Y: depends on handler (preserved if A >= 8)", "***************************************************************************************"], "comment_inline": "Store A/X/Y in FS workspace", "type": "code", "mnemonic": "jsr", "operand": "save_fscv_args", "target": 34056, "target_label": "save_fscv_args"}, {"addr": 32911, "bytes": [201, 8], "comment_inline": "Function code >= 8? Return (unsupported)", "type": "code", "mnemonic": "cmp", "operand": "#8"}, {"addr": 32913, "bytes": [176, 27], "type": "code", "mnemonic": "bcs", "operand": "return_1", "target": 32942, "target_label": "return_1"}, {"addr": 32915, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 32916, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 32917, "bytes": [160, 18], "comment_inline": "Y=&12: base offset for FSCV dispatch (indices 19+)", "type": "code", "mnemonic": "ldy", "operand": "#&12"}, {"addr": 32919, "bytes": [208, 6], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "dispatch", "target": 32927, "target_label": "dispatch"}, {"addr": 32921, "bytes": [224, 5], "labels": ["language_handler"], "comments_before": ["***************************************************************************************", "Language entry dispatcher\n\nCalled when the NFS ROM is entered as a language. X = reason code\n(0-4). Dispatches via table indices 14-18 (base offset Y=&0D).", "***************************************************************************************", "&8099 referenced 1 time by &8000"], "references": [32768], "type": "code", "mnemonic": "cpx", "operand": "#5"}, {"addr": 32923, "bytes": [176, 17], "type": "code", "mnemonic": "bcs", "operand": "return_1", "target": 32942, "target_label": "return_1"}, {"addr": 32925, "bytes": [160, 13], "comment_inline": "Y=&0D: base offset for language handlers (index 14+)", "type": "code", "mnemonic": "ldy", "operand": "#&0d"}, {"addr": 32927, "bytes": [232], "labels": ["dispatch"], "comments_before": ["***************************************************************************************", "PHA/PHA/RTS computed dispatch\n\nX = command index within caller's group (e.g. service number)\nY = base offset into dispatch table (0, &0D, &20, etc.)\nThe loop adds Y+1 to X, so final X = command index + base + 1.\nThen high and low bytes of (handler-1) are pushed onto the stack,\nand RTS pops them and jumps to handler_address.\n\nThis is a standard 6502 trick: RTS increments the popped address\nby 1 before jumping, so the table stores (address - 1) to\ncompensate. Multiple callers share one table via different Y\nbase offsets.", "***************************************************************************************", "&809f referenced 5 times by &8077, &808a, &8097, &80a1, &8139"], "comment_inline": "Add base offset Y to index X (loop: X += Y+1)", "references": [32929, 32919, 32906, 32887, 33081], "type": "code", "mnemonic": "inx"}, {"addr": 32928, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 32929, "bytes": [16, 252], "type": "code", "mnemonic": "bpl", "operand": "dispatch", "target": 32927, "target_label": "dispatch"}, {"addr": 32931, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 32932, "bytes": [189, 68, 128], "comment_inline": "Load high byte of (handler - 1) from table", "type": "code", "mnemonic": "lda", "operand": "dispatch_hi,x", "target": 32836, "target_label": "dispatch_hi"}, {"addr": 32935, "bytes": [72], "comment_inline": "Push high byte onto stack", "type": "code", "mnemonic": "pha"}, {"addr": 32936, "bytes": [189, 32, 128], "comment_inline": "Load low byte of (handler - 1) from table", "type": "code", "mnemonic": "lda", "operand": "dispatch_lo,x", "target": 32800, "target_label": "dispatch_lo"}, {"addr": 32939, "bytes": [72], "comment_inline": "Push low byte onto stack", "type": "code", "mnemonic": "pha"}, {"addr": 32940, "bytes": [166, 187], "comment_inline": "Restore X (fileserver options) for use by handler", "type": "code", "mnemonic": "ldx", "operand": "fs_options", "target": 187, "target_label": "fs_options"}, {"addr": 32942, "bytes": [96], "labels": ["return_1"], "comments_before": ["&80ae referenced 6 times by &806d, &8071, &8083, &8091, &809b, &80b7"], "comment_inline": "RTS pops address, adds 1, jumps to handler", "references": [32923, 32877, 32913, 32881, 32899, 32951], "type": "code", "mnemonic": "rts"}, {"addr": 32943, "bytes": [201, 254], "labels": ["service_handler"], "comments_before": ["***************************************************************************************", "Service handler entry\n\nIntercepts three special service calls before normal dispatch:\n  &FE: Tube init \u2014 explode character definitions (OSBYTE &14, X=6)\n  &FF: Full init \u2014 set up WRCHV/RDCHV/BRKV/EVNTV, copy NMI handler\n       code from ROM to RAM pages &04-&06, copy workspace init to\n       &0016-&0076, then fall through to select NFS.\n  &12 with Y=5: Select NFS as active filing system.\nAll other service calls dispatch via dispatch_service (&8127).", "***************************************************************************************", "&80af referenced 1 time by &8003"], "references": [32771], "type": "code", "mnemonic": "cmp", "operand": "#&fe"}, {"addr": 32945, "bytes": [144, 108], "type": "code", "mnemonic": "bcc", "operand": "c811f", "target": 33055, "target_label": "c811f"}, {"addr": 32947, "bytes": [208, 19], "type": "code", "mnemonic": "bne", "operand": "init_vectors_and_copy", "target": 32968, "target_label": "init_vectors_and_copy"}, {"addr": 32949, "bytes": [192, 0], "type": "code", "mnemonic": "cpy", "operand": "#0"}, {"addr": 32951, "bytes": [240, 245], "type": "code", "mnemonic": "beq", "operand": "return_1", "target": 32942, "target_label": "return_1"}, {"addr": 32953, "bytes": [134, 17], "type": "code", "mnemonic": "stx", "operand": "zp_temp_11", "target": 17, "target_label": "zp_temp_11"}, {"addr": 32955, "bytes": [132, 16], "type": "code", "mnemonic": "sty", "operand": "zp_temp_10", "target": 16, "target_label": "zp_temp_10"}, {"addr": 32957, "bytes": [162, 6], "type": "code", "mnemonic": "ldx", "operand": "#6"}, {"addr": 32959, "bytes": [169, 20], "type": "code", "mnemonic": "lda", "operand": "#osbyte_explode_chars"}, {"addr": 32961, "bytes": [32, 244, 255], "comment_inline": "Explode character definition RAM (six extra pages), can redefine all characters 32-255 (X=6)", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 32964, "bytes": [166, 17], "type": "code", "mnemonic": "ldx", "operand": "zp_temp_11", "target": 17, "target_label": "zp_temp_11"}, {"addr": 32966, "bytes": [208, 83], "type": "code", "mnemonic": "bne", "operand": "c811b", "target": 33051, "target_label": "c811b"}, {"addr": 32968, "bytes": [169, 28], "labels": ["init_vectors_and_copy"], "comments_before": ["***************************************************************************************", "NFS initialisation (service &FF: full reset)\n\nSets up OS vectors for Tube co-processor support:\n  WRCHV = &051C (page 5 \u2014 WRCH handler)\n  RDCHV = &04E7 (page 4 \u2014 RDCH handler)\n  BRKV  = &0016 (workspace \u2014 BRK/error handler)\n  EVNTV = &06E8 (page 6 \u2014 event handler)\nWrites &8E to Tube control register (&FEE0).\nThen copies 3 pages of Tube host code from ROM (&934C/&944C/&954C)\nto RAM (&0400/&0500/&0600), calls tube_post_init (&0414), and copies\n97 bytes of workspace init from ROM (&9307) to &0016-&0076.", "***************************************************************************************", "&80c8 referenced 1 time by &80b3"], "comment_inline": "Set WRCHV = &051C (Tube WRCH handler)", "references": [32947], "type": "code", "mnemonic": "lda", "operand": "#&1c"}, {"addr": 32970, "bytes": [141, 14, 2], "type": "code", "mnemonic": "sta", "operand": "wrchv", "target": 526, "target_label": "wrchv"}, {"addr": 32973, "bytes": [169, 5], "type": "code", "mnemonic": "lda", "operand": "#5"}, {"addr": 32975, "bytes": [141, 15, 2], "type": "code", "mnemonic": "sta", "operand": "wrchv+1", "target": 527}, {"addr": 32978, "bytes": [169, 231], "comment_inline": "Set RDCHV = &04E7 (Tube RDCH handler)", "type": "code", "mnemonic": "lda", "operand": "#&e7"}, {"addr": 32980, "bytes": [141, 16, 2], "type": "code", "mnemonic": "sta", "operand": "rdchv", "target": 528, "target_label": "rdchv"}, {"addr": 32983, "bytes": [169, 4], "type": "code", "mnemonic": "lda", "operand": "#4"}, {"addr": 32985, "bytes": [141, 17, 2], "type": "code", "mnemonic": "sta", "operand": "rdchv+1", "target": 529}, {"addr": 32988, "bytes": [169, 22], "comment_inline": "Set BRKV = &0016 (BRK handler in workspace)", "type": "code", "mnemonic": "lda", "operand": "#&16"}, {"addr": 32990, "bytes": [141, 2, 2], "type": "code", "mnemonic": "sta", "operand": "brkv", "target": 514, "target_label": "brkv"}, {"addr": 32993, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 32995, "bytes": [141, 3, 2], "type": "code", "mnemonic": "sta", "operand": "brkv+1", "target": 515}, {"addr": 32998, "bytes": [169, 232], "comment_inline": "Set EVNTV = &06E8 (event handler in page 6)", "type": "code", "mnemonic": "lda", "operand": "#&e8"}, {"addr": 33000, "bytes": [141, 32, 2], "type": "code", "mnemonic": "sta", "operand": "evntv", "target": 544, "target_label": "evntv"}, {"addr": 33003, "bytes": [169, 6], "type": "code", "mnemonic": "lda", "operand": "#6"}, {"addr": 33005, "bytes": [141, 33, 2], "type": "code", "mnemonic": "sta", "operand": "evntv+1", "target": 545}, {"addr": 33008, "bytes": [169, 142], "comment_inline": "Write &8E to Tube control register", "type": "code", "mnemonic": "lda", "operand": "#&8e"}, {"addr": 33010, "bytes": [141, 224, 254], "type": "code", "mnemonic": "sta", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 33013, "bytes": [132, 16], "type": "code", "mnemonic": "sty", "operand": "zp_temp_10", "target": 16, "target_label": "zp_temp_10"}, {"addr": 33015, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 33017, "bytes": [185, 76, 147], "labels": ["cloop"], "comments_before": ["Copy NMI handler code from ROM to RAM pages &04-&06", "&80f9 referenced 1 time by &810c"], "references": [33036], "type": "code", "mnemonic": "lda", "operand": "c934c,y", "target": 37708, "target_label": "c934c"}, {"addr": 33020, "bytes": [153, 0, 4], "type": "code", "mnemonic": "sta", "operand": "tube_code_page4,y", "target": 1024, "target_label": "tube_code_page4"}, {"addr": 33023, "bytes": [185, 76, 148], "type": "code", "mnemonic": "lda", "operand": "l944c,y", "target": 37964, "target_label": "l944c"}, {"addr": 33026, "bytes": [153, 0, 5], "type": "code", "mnemonic": "sta", "operand": "tube_dispatch_table,y", "target": 1280, "target_label": "tube_dispatch_table"}, {"addr": 33029, "bytes": [185, 76, 149], "type": "code", "mnemonic": "lda", "operand": "c954c,y", "target": 38220, "target_label": "c954c"}, {"addr": 33032, "bytes": [153, 0, 6], "type": "code", "mnemonic": "sta", "operand": "tube_code_page6,y", "target": 1536, "target_label": "tube_code_page6"}, {"addr": 33035, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 33036, "bytes": [208, 235], "type": "code", "mnemonic": "bne", "operand": "cloop", "target": 33017, "target_label": "cloop"}, {"addr": 33038, "bytes": [32, 20, 4], "type": "code", "mnemonic": "jsr", "operand": "tube_post_init", "target": 1044, "target_label": "tube_post_init"}, {"addr": 33041, "bytes": [162, 96], "type": "code", "mnemonic": "ldx", "operand": "#&60"}, {"addr": 33043, "bytes": [189, 7, 147], "labels": ["loop_c8113"], "comments_before": ["Copy NMI workspace initialiser from ROM to &0016-&0076", "&8113 referenced 1 time by &8119"], "references": [33049], "type": "code", "mnemonic": "lda", "operand": "c9307,x", "target": 37639, "target_label": "c9307"}, {"addr": 33046, "bytes": [149, 22], "type": "code", "mnemonic": "sta", "operand": "nmi_workspace_start,x", "target": 22, "target_label": "nmi_workspace_start"}, {"addr": 33048, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 33049, "bytes": [16, 248], "type": "code", "mnemonic": "bpl", "operand": "loop_c8113", "target": 33043, "target_label": "loop_c8113"}, {"addr": 33051, "bytes": [164, 16], "labels": ["c811b"], "comments_before": ["&811b referenced 1 time by &80c6"], "references": [32966], "type": "code", "mnemonic": "ldy", "operand": "zp_temp_10", "target": 16, "target_label": "zp_temp_10"}, {"addr": 33053, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 33055, "bytes": [201, 18], "labels": ["c811f"], "comments_before": ["&811f referenced 1 time by &80b1"], "references": [32945], "type": "code", "mnemonic": "cmp", "operand": "#&12"}, {"addr": 33057, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "dispatch_service", "target": 33063, "target_label": "dispatch_service"}, {"addr": 33059, "bytes": [192, 5], "type": "code", "mnemonic": "cpy", "operand": "#5"}, {"addr": 33061, "bytes": [240, 93], "type": "code", "mnemonic": "beq", "operand": "select_nfs", "target": 33156, "target_label": "select_nfs"}, {"addr": 33063, "bytes": [201, 13], "labels": ["dispatch_service"], "comments_before": ["***************************************************************************************", "Service call dispatcher\n\nDispatches MOS service calls 0-12 via the shared dispatch table.\nUses base offset Y=0, so table index = service number + 1.\nService numbers >= 13 are ignored (branch to return_2).\nCalled via JSR &809F rather than fall-through, so it returns\nto &813C to restore saved registers.", "***************************************************************************************", "&8127 referenced 1 time by &8121"], "references": [33057], "type": "code", "mnemonic": "cmp", "operand": "#&0d"}, {"addr": 33065, "bytes": [176, 26], "type": "code", "mnemonic": "bcs", "operand": "return_2", "target": 33093, "target_label": "return_2"}, {"addr": 33067, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 33068, "bytes": [165, 206], "type": "code", "mnemonic": "lda", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 33070, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 33071, "bytes": [165, 205], "type": "code", "mnemonic": "lda", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33073, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 33074, "bytes": [134, 206], "type": "code", "mnemonic": "stx", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 33076, "bytes": [132, 205], "type": "code", "mnemonic": "sty", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33078, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 33079, "bytes": [160, 0], "comment_inline": "Y=0: base offset for service calls (index 1+)", "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 33081, "bytes": [32, 159, 128], "comment_inline": "JSR to dispatcher (returns here after handler completes)", "type": "code", "mnemonic": "jsr", "operand": "dispatch", "target": 32927, "target_label": "dispatch"}, {"addr": 33084, "bytes": [166, 206], "type": "code", "mnemonic": "ldx", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 33086, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33087, "bytes": [133, 205], "type": "code", "mnemonic": "sta", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33089, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33090, "bytes": [133, 206], "type": "code", "mnemonic": "sta", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 33092, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 33093, "bytes": [96], "labels": ["return_2"], "comments_before": ["&8145 referenced 2 times by &8129, &814a"], "references": [33065, 33098], "type": "code", "mnemonic": "rts"}, {"addr": 33094, "bytes": [160, 4], "labels": ["resume_after_remote"], "comments_before": ["***************************************************************************************", "Resume after remote operation / *ROFF handler (NROFF)\n\nChecks byte 4 of (net_rx_ptr): if non-zero, the keyboard was\ndisabled during a remote operation (peek/poke/boot). Clears\nthe flag, re-enables the keyboard via OSBYTE &C9, and sends\nfunction &0A to notify completion. Also handles *ROFF and the\ntriple-plus escape sequence (+++), which resets system masks\nvia OSBYTE &CE and returns control to the MOS, providing an\nescape route when a remote session becomes unresponsive.", "***************************************************************************************", "&8146 referenced 2 times by &817b, &8df2"], "references": [36338, 33147], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 33096, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 33098, "bytes": [240, 249], "type": "code", "mnemonic": "beq", "operand": "return_2", "target": 33093, "target_label": "return_2"}, {"addr": 33100, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 33102, "bytes": [170], "comment_inline": "X=&00", "type": "code", "mnemonic": "tax"}, {"addr": 33103, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 33105, "bytes": [168], "comment_inline": "Y=&00", "type": "code", "mnemonic": "tay"}, {"addr": 33106, "bytes": [169, 201], "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_write_econet_keyboard_disable"}, {"addr": 33108, "bytes": [32, 244, 255], "comment_inline": "Enable keyboard (for Econet)", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33111, "bytes": [169, 10], "type": "code", "mnemonic": "lda", "operand": "#&0a"}, {"addr": 33113, "bytes": [32, 75, 144], "type": "code", "mnemonic": "jsr", "operand": "setup_tx_and_send", "target": 36939, "target_label": "setup_tx_and_send"}, {"addr": 33116, "bytes": [134, 158], "labels": ["clear_osbyte_ce_cf"], "comments_before": ["&815c referenced 1 time by &911b"], "references": [37147], "type": "code", "mnemonic": "stx", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 33118, "bytes": [169, 206], "type": "code", "mnemonic": "lda", "operand": "#&ce"}, {"addr": 33120, "bytes": [166, 158], "labels": ["loop_c8160"], "comments_before": ["&8160 referenced 1 time by &816b"], "references": [33131], "type": "code", "mnemonic": "ldx", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 33122, "bytes": [160, 127], "type": "code", "mnemonic": "ldy", "operand": "#&7f"}, {"addr": 33124, "bytes": [32, 244, 255], "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33127, "bytes": [105, 1], "type": "code", "mnemonic": "adc", "operand": "#1"}, {"addr": 33129, "bytes": [201, 208], "type": "code", "mnemonic": "cmp", "operand": "#&d0"}, {"addr": 33131, "bytes": [240, 243], "type": "code", "mnemonic": "beq", "operand": "loop_c8160", "target": 33120, "target_label": "loop_c8160"}, {"addr": 33133, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 33135, "bytes": [133, 158], "type": "code", "mnemonic": "sta", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 33137, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33138, "bytes": [162, 8], "labels": ["svc_star_command"], "comments_before": ["***************************************************************************************", "Service 4: unrecognised * command\n\nMatches the command text against ROM string table entries:\n  X=8: matches \"ROFF\" at &8010 (within copyright string) \u2192 *ROFF\n       (log off from fileserver) \u2014 jumps to resume_after_remote\n  X=1: matches \"NET\" at &8009 (ROM title) \u2192 *NET (select NFS)\n       \u2014 falls through to select_nfs\nIf neither matches, returns with the service call unclaimed.", "***************************************************************************************"], "type": "code", "mnemonic": "ldx", "operand": "#8"}, {"addr": 33140, "bytes": [32, 155, 129], "type": "code", "mnemonic": "jsr", "operand": "match_rom_string", "target": 33179, "target_label": "match_rom_string"}, {"addr": 33143, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "c817d", "target": 33149, "target_label": "c817d"}, {"addr": 33145, "bytes": [133, 206], "type": "code", "mnemonic": "sta", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 33147, "bytes": [240, 201], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "resume_after_remote", "target": 33094, "target_label": "resume_after_remote"}, {"addr": 33149, "bytes": [162, 1], "labels": ["c817d"], "comments_before": ["&817d referenced 1 time by &8177"], "references": [33143], "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 33151, "bytes": [32, 155, 129], "type": "code", "mnemonic": "jsr", "operand": "match_rom_string", "target": 33179, "target_label": "match_rom_string"}, {"addr": 33154, "bytes": [208, 69], "type": "code", "mnemonic": "bne", "operand": "c81c9", "target": 33225, "target_label": "c81c9"}, {"addr": 33156, "bytes": [32, 204, 129], "labels": ["select_nfs"], "comments_before": ["***************************************************************************************", "Select NFS as active filing system (INIT)\n\nReached from service &12 (select FS) with Y=5, or when *NET command\nselects NFS. Notifies the current FS of shutdown via FSCV A=6 \u2014\nthis triggers the outgoing FS to save its context back to its\nworkspace page, allowing restoration if re-selected later (the\nFSDIE handoff mechanism). Then sets up the standard OS vector\nindirections (FILEV through FSCV) to NFS entry points, claims the\nextended vector table entries, and issues service &0F (vectors\nclaimed) to notify other ROMs. If fs_temp_cd is zero (auto-boot\nnot inhibited), injects the synthetic command \"I .BOOT\" through\nthe command decoder to trigger auto-boot login.", "***************************************************************************************", "&8184 referenced 1 time by &8125"], "references": [33061], "type": "code", "mnemonic": "jsr", "operand": "call_fscv_shutdown", "target": 33228, "target_label": "call_fscv_shutdown"}, {"addr": 33159, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 33160, "bytes": [102, 205], "type": "code", "mnemonic": "ror", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33162, "bytes": [32, 46, 130], "type": "code", "mnemonic": "jsr", "operand": "issue_vectors_claimed", "target": 33326, "target_label": "issue_vectors_claimed"}, {"addr": 33165, "bytes": [160, 29], "type": "code", "mnemonic": "ldy", "operand": "#&1d"}, {"addr": 33167, "bytes": [177, 156], "labels": ["initl"], "comments_before": ["&818f referenced 1 time by &8197"], "references": [33175], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 33169, "bytes": [153, 235, 13], "type": "code", "mnemonic": "sta", "operand": "fs_state_deb,y", "target": 3563, "target_label": "fs_state_deb"}, {"addr": 33172, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 33173, "bytes": [192, 20], "type": "code", "mnemonic": "cpy", "operand": "#&14"}, {"addr": 33175, "bytes": [208, 246], "type": "code", "mnemonic": "bne", "operand": "initl", "target": 33167, "target_label": "initl"}, {"addr": 33177, "bytes": [240, 124], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "setup_fs_vectors", "target": 33303, "target_label": "setup_fs_vectors"}, {"addr": 33179, "bytes": [164, 205], "labels": ["match_rom_string"], "comments_before": ["***************************************************************************************", "Match command text against ROM string table\n\nCompares characters from (os_text_ptr)+Y against bytes starting\nat binary_version+X (&8008+X). Input is uppercased via AND &DF.\nReturns with Z=1 if the ROM string's NUL terminator was reached\n(match), or Z=0 if a mismatch was found. On match, Y points\npast the matched text; on return, skips trailing spaces.", "***************************************************************************************", "&819b referenced 2 times by &8174, &817f"], "references": [33140, 33151], "type": "code", "mnemonic": "ldy", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33181, "bytes": [177, 242], "labels": ["loop_c819d"], "comments_before": ["&819d referenced 1 time by &81aa"], "references": [33194], "type": "code", "mnemonic": "lda", "operand": "(os_text_ptr),y", "target": 242, "target_label": "os_text_ptr"}, {"addr": 33183, "bytes": [41, 223], "type": "code", "mnemonic": "and", "operand": "#&df"}, {"addr": 33185, "bytes": [240, 9], "type": "code", "mnemonic": "beq", "operand": "cmd_name_matched", "target": 33196, "target_label": "cmd_name_matched"}, {"addr": 33187, "bytes": [221, 8, 128], "type": "code", "mnemonic": "cmp", "operand": "binary_version,x", "target": 32776, "target_label": "binary_version"}, {"addr": 33190, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "cmd_name_matched", "target": 33196, "target_label": "cmd_name_matched"}, {"addr": 33192, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33193, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 33194, "bytes": [208, 241], "type": "code", "mnemonic": "bne", "operand": "loop_c819d", "target": 33181, "target_label": "loop_c819d"}, {"addr": 33196, "bytes": [189, 8, 128], "labels": ["cmd_name_matched"], "comments_before": ["&81ac referenced 2 times by &81a1, &81a6"], "references": [33185, 33190], "type": "code", "mnemonic": "lda", "operand": "binary_version,x", "target": 32776, "target_label": "binary_version"}, {"addr": 33199, "bytes": [240, 2], "type": "code", "mnemonic": "beq", "operand": "skip_cmd_spaces", "target": 33203, "target_label": "skip_cmd_spaces"}, {"addr": 33201, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33202, "bytes": [200], "labels": ["skpspi"], "comments_before": ["&81b2 referenced 1 time by &81b7"], "references": [33207], "type": "code", "mnemonic": "iny"}, {"addr": 33203, "bytes": [177, 242], "labels": ["skip_cmd_spaces"], "comments_before": ["&81b3 referenced 1 time by &81af"], "references": [33199], "type": "code", "mnemonic": "lda", "operand": "(os_text_ptr),y", "target": 242, "target_label": "os_text_ptr"}, {"addr": 33205, "bytes": [201, 32], "type": "code", "mnemonic": "cmp", "operand": "#&20"}, {"addr": 33207, "bytes": [240, 249], "type": "code", "mnemonic": "beq", "operand": "skpspi", "target": 33202, "target_label": "skpspi"}, {"addr": 33209, "bytes": [73, 13], "type": "code", "mnemonic": "eor", "operand": "#&0d"}, {"addr": 33211, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33212, "bytes": [32, 59, 133], "labels": ["svc_help"], "comments_before": ["***************************************************************************************", "Service 9: *HELP\n\nPrints the ROM identification string using print_inline.", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 33215, "bytes": [13, 78, 70, 83, 32, 51, 46, 51, 52, 13], "type": "string", "string": ".NFS 3.34."}, {"addr": 33225, "bytes": [164, 205], "labels": ["c81c9"], "comments_before": ["&81c9 referenced 2 times by &8182, &81de"], "references": [33154, 33246], "type": "code", "mnemonic": "ldy", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33227, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33228, "bytes": [169, 6], "labels": ["call_fscv_shutdown"], "comments_before": ["***************************************************************************************", "Notify filing system of shutdown\n\nLoads A=6 (FS shutdown notification) and JMP (FSCV).\nThe FSCV handler's RTS returns to the caller of this routine\n(JSR/JMP trick saves one level of stack).", "***************************************************************************************", "&81cc referenced 2 times by &8184, &81d1"], "references": [33233, 33156], "type": "code", "mnemonic": "lda", "operand": "#6"}, {"addr": 33230, "bytes": [108, 30, 2], "type": "code", "mnemonic": "jmp", "operand": "(fscv)", "target": 542, "target_label": "fscv"}, {"addr": 33233, "bytes": [32, 204, 129], "labels": ["svc_autoboot"], "comments_before": ["***************************************************************************************", "Service 3: auto-boot\n\nNotifies current FS of shutdown via FSCV A=6. Scans keyboard\n(OSBYTE &7A): if no key is pressed, auto-boot proceeds; if the\n'N' key is pressed (matrix address &55), the boot is declined\nand the key is forgotten via OSBYTE &78. Any other key also\ndeclines. Prints \"Econet Station <n>\" and checks the ADLC SR2\nfor the network clock signal \u2014 prints \"No Clock\" if absent (no\nnetwork communication possible without it). Then falls through\nto set up NFS vectors (selecting NFS as the filing system).", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "call_fscv_shutdown", "target": 33228, "target_label": "call_fscv_shutdown"}, {"addr": 33236, "bytes": [169, 122], "type": "code", "mnemonic": "lda", "operand": "#osbyte_scan_keyboard_from_16"}, {"addr": 33238, "bytes": [32, 244, 255], "comment_inline": "Keyboard scan starting from key 16", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33241, "bytes": [138], "comment_inline": "X is key number if key is pressed, or &ff otherwise", "type": "code", "mnemonic": "txa"}, {"addr": 33242, "bytes": [48, 10], "type": "code", "mnemonic": "bmi", "operand": "c81e6", "target": 33254, "target_label": "c81e6"}, {"addr": 33244, "bytes": [73, 85], "type": "code", "mnemonic": "eor", "operand": "#&55"}, {"addr": 33246, "bytes": [208, 233], "type": "code", "mnemonic": "bne", "operand": "c81c9", "target": 33225, "target_label": "c81c9"}, {"addr": 33248, "bytes": [168], "comment_inline": "Y=key", "type": "code", "mnemonic": "tay"}, {"addr": 33249, "bytes": [169, 120], "type": "code", "mnemonic": "lda", "operand": "#osbyte_write_keys_pressed"}, {"addr": 33251, "bytes": [32, 244, 255], "comment_inline": "Write current keys pressed (X and Y)", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33254, "bytes": [32, 59, 133], "labels": ["c81e6"], "comments_before": ["&81e6 referenced 1 time by &81da"], "references": [33242], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 33257, "bytes": [69, 99, 111, 110, 101, 116, 32, 83, 116, 97, 116, 105, 111, 110, 32], "type": "string", "string": "Econet Station "}, {"addr": 33272, "bytes": [173, 98, 13], "type": "code", "mnemonic": "lda", "operand": "tx_clear_flag", "target": 3426, "target_label": "tx_clear_flag"}, {"addr": 33275, "bytes": [32, 175, 133], "type": "code", "mnemonic": "jsr", "operand": "print_decimal", "target": 34223, "target_label": "print_decimal"}, {"addr": 33278, "bytes": [169, 32], "type": "code", "mnemonic": "lda", "operand": "#&20"}, {"addr": 33280, "bytes": [44, 161, 254], "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 33283, "bytes": [240, 13], "type": "code", "mnemonic": "beq", "operand": "c8212", "target": 33298, "target_label": "c8212"}, {"addr": 33285, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 33288, "bytes": [32, 78, 111, 32, 67, 108, 111, 99, 107], "type": "string", "string": " No Clock"}, {"addr": 33297, "bytes": [234], "type": "code", "mnemonic": "nop"}, {"addr": 33298, "bytes": [32, 59, 133], "labels": ["c8212"], "comments_before": ["&8212 referenced 1 time by &8203"], "references": [33283], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 33301, "bytes": [13, 13], "type": "string", "string": ".."}, {"addr": 33303, "bytes": [160, 13], "labels": ["setup_fs_vectors"], "comments_before": ["***************************************************************************************", "Set up filing system vectors\n\nCopies 14 bytes from fs_vector_addrs (&824D) into FILEV-FSCV (&0212).\nThese set all 7 filing system vectors to the standard extended vector\ndispatch addresses (&FF1B, &FF1E, &FF21, &FF24, &FF27, &FF2A, &FF2D).\nThen calls setup_rom_ptrs_netv to install the extended vector table\nentries with the actual NFS handler addresses, and issues service\nrequests to notify other ROMs.", "***************************************************************************************", "&8217 referenced 1 time by &8199"], "comment_inline": "Copy 14 bytes: FS vector addresses \u2192 FILEV-FSCV", "references": [33177], "type": "code", "mnemonic": "ldy", "operand": "#&0d"}, {"addr": 33305, "bytes": [185, 77, 130], "labels": ["dofsl1"], "comments_before": ["&8219 referenced 1 time by &8220"], "references": [33312], "type": "code", "mnemonic": "lda", "operand": "fs_vector_addrs,y", "target": 33357, "target_label": "fs_vector_addrs"}, {"addr": 33308, "bytes": [153, 18, 2], "type": "code", "mnemonic": "sta", "operand": "filev,y", "target": 530, "target_label": "filev"}, {"addr": 33311, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 33312, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "dofsl1", "target": 33305, "target_label": "dofsl1"}, {"addr": 33314, "bytes": [32, 209, 130], "type": "code", "mnemonic": "jsr", "operand": "setup_rom_ptrs_netv", "target": 33489, "target_label": "setup_rom_ptrs_netv"}, {"addr": 33317, "bytes": [160, 27], "type": "code", "mnemonic": "ldy", "operand": "#&1b"}, {"addr": 33319, "bytes": [162, 7], "type": "code", "mnemonic": "ldx", "operand": "#7"}, {"addr": 33321, "bytes": [32, 229, 130], "type": "code", "mnemonic": "jsr", "operand": "store_rom_ptr_pair", "target": 33509, "target_label": "store_rom_ptr_pair"}, {"addr": 33324, "bytes": [134, 206], "type": "code", "mnemonic": "stx", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 33326, "bytes": [169, 143], "labels": ["issue_vectors_claimed"], "comments_before": ["***************************************************************************************", "Issue 'vectors claimed' service and optionally auto-boot\n\nIssues service &0F (vectors claimed) via OSBYTE &8F, then\nservice &0A. If fs_temp_cd is zero (auto-boot not inhibited),\nsets up the command string \"I .BOOT\" at &8245 and jumps to\nthe FSCV 3 unrecognised-command handler (which matches against\nthe command table at &8BD6). The \"I.\" prefix triggers the\ncatch-all entry which forwards the command to the fileserver.", "***************************************************************************************", "&822e referenced 1 time by &818a"], "references": [33162], "type": "code", "mnemonic": "lda", "operand": "#osbyte_issue_service_request"}, {"addr": 33328, "bytes": [162, 15], "type": "code", "mnemonic": "ldx", "operand": "#&0f"}, {"addr": 33330, "bytes": [32, 244, 255], "comment_inline": "Issue paged ROM service call, Reason X=15 - Vectors claimed", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33333, "bytes": [162, 10], "type": "code", "mnemonic": "ldx", "operand": "#&0a"}, {"addr": 33335, "bytes": [32, 244, 255], "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33338, "bytes": [166, 205], "type": "code", "mnemonic": "ldx", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33340, "bytes": [208, 55], "type": "code", "mnemonic": "bne", "operand": "return_3", "target": 33397, "target_label": "return_3"}, {"addr": 33342, "bytes": [162, 69], "type": "code", "mnemonic": "ldx", "operand": "#&45"}, {"addr": 33344, "bytes": [160, 130], "labels": ["c8240"], "comments_before": ["&8240 referenced 2 times by &82e5, &82eb"], "references": [33509, 33515], "type": "code", "mnemonic": "ldy", "operand": "#&82"}, {"addr": 33346, "bytes": [76, 146, 139], "type": "code", "mnemonic": "jmp", "operand": "fscv_star_handler", "target": 35730, "target_label": "fscv_star_handler"}, {"addr": 33349, "bytes": [73, 32, 46, 66, 79, 79, 84], "type": "string", "string": "I .BOOT"}, {"addr": 33356, "bytes": [13], "type": "byte", "values": [13]}, {"addr": 33357, "bytes": [27, 255, 30, 255, 33, 255, 36, 255, 39, 255, 42, 255, 45, 255, 148, 134, 0, 225, 136, 0, 133, 132, 0, 162, 131, 0, 234, 137, 0, 73, 137, 0, 140, 128], "labels": ["fs_vector_addrs"], "comments_before": ["&824d referenced 1 time by &8219"], "references": [33305], "type": "byte", "values": [27, 255, 30, 255, 33, 255, 36, 255, 39, 255, 42, 255, 45, 255, 148, 134, 0, 225, 136, 0, 133, 132, 0, 162, 131, 0, 234, 137, 0, 73, 137, 0, 140, 128]}, {"addr": 33391, "bytes": [192, 16], "labels": ["svc_abs_workspace"], "comments_before": ["***************************************************************************************", "Service 1: claim absolute workspace\n\nClaims pages up to &10 for NMI workspace (&0D), FS state (&0E),\nand FS command buffer (&0F). If Y >= &10, workspace already\nallocated \u2014 returns unchanged.", "***************************************************************************************"], "type": "code", "mnemonic": "cpy", "operand": "#&10"}, {"addr": 33393, "bytes": [176, 2], "type": "code", "mnemonic": "bcs", "operand": "return_3", "target": 33397, "target_label": "return_3"}, {"addr": 33395, "bytes": [160, 16], "type": "code", "mnemonic": "ldy", "operand": "#&10"}, {"addr": 33397, "bytes": [96], "labels": ["return_3"], "comments_before": ["&8275 referenced 2 times by &823c, &8271"], "references": [33393, 33340], "type": "code", "mnemonic": "rts"}, {"addr": 33398, "bytes": [7, 144], "type": "byte", "values": [7, 144]}, {"addr": 33400, "bytes": [132, 157], "labels": ["svc_private_workspace"], "comments_before": ["***************************************************************************************", "Service 2: claim private workspace and initialise NFS\n\nY = next available workspace page on entry.\nSets up net_rx_ptr (Y) and nfs_workspace (Y+1) page pointers.\nOn soft break (OSBYTE &FD returns 0): skips FS state init,\npreserving existing login state, file server selection, and\ncontrol block configuration \u2014 this is why pressing BREAK\nkeeps the user logged in.\nOn power-up/CTRL-BREAK (result non-zero):\n  - Sets FS server station to &FE (FS, the default; no server)\n  - Sets printer server to &EB (PS, the default)\n  - Clears FS handles, OPT byte, message flag, SEQNOS\n  - Initialises all RXCBs with &3F flag (available)\nIn both cases: reads station ID from &FE18 (only valid during\nreset), calls adlc_init, enables user-level RX (LFLAG=&40).", "***************************************************************************************"], "type": "code", "mnemonic": "sty", "operand": "net_rx_ptr_hi", "target": 157, "target_label": "net_rx_ptr_hi"}, {"addr": 33402, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33403, "bytes": [132, 159], "type": "code", "mnemonic": "sty", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 33405, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 33407, "bytes": [160, 4], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 33409, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 33411, "bytes": [160, 255], "type": "code", "mnemonic": "ldy", "operand": "#&ff"}, {"addr": 33413, "bytes": [133, 156], "type": "code", "mnemonic": "sta", "operand": "net_rx_ptr", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 33415, "bytes": [133, 158], "type": "code", "mnemonic": "sta", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 33417, "bytes": [133, 205], "type": "code", "mnemonic": "sta", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33419, "bytes": [141, 58, 13], "type": "code", "mnemonic": "sta", "operand": "tx_ctrl_status", "target": 3386, "target_label": "tx_ctrl_status"}, {"addr": 33422, "bytes": [170], "comment_inline": "X=&00", "type": "code", "mnemonic": "tax"}, {"addr": 33423, "bytes": [169, 253], "comment_inline": "OSBYTE &FD: read type of last reset", "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_write_last_break_type"}, {"addr": 33425, "bytes": [32, 244, 255], "comment_inline": "Read type of last reset", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33428, "bytes": [138], "comment_inline": "X=value of type of last reset", "type": "code", "mnemonic": "txa"}, {"addr": 33429, "bytes": [240, 44], "comment_inline": "Soft break (X=0): skip FS init", "type": "code", "mnemonic": "beq", "operand": "c82c3", "target": 33475, "target_label": "c82c3"}, {"addr": 33431, "bytes": [160, 21], "type": "code", "mnemonic": "ldy", "operand": "#&15"}, {"addr": 33433, "bytes": [169, 254], "type": "code", "mnemonic": "lda", "operand": "#&fe"}, {"addr": 33435, "bytes": [141, 0, 14], "comment_inline": "Station &FE = no server selected", "type": "code", "mnemonic": "sta", "operand": "fs_server_stn", "target": 3584, "target_label": "fs_server_stn"}, {"addr": 33438, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 33440, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 33442, "bytes": [169, 235], "type": "code", "mnemonic": "lda", "operand": "#&eb"}, {"addr": 33444, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 33446, "bytes": [200], "comment_inline": "Y=&03", "type": "code", "mnemonic": "iny"}, {"addr": 33447, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 33449, "bytes": [141, 1, 14], "type": "code", "mnemonic": "sta", "operand": "fs_server_net", "target": 3585, "target_label": "fs_server_net"}, {"addr": 33452, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 33454, "bytes": [141, 99, 13], "type": "code", "mnemonic": "sta", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 33457, "bytes": [141, 6, 14], "type": "code", "mnemonic": "sta", "operand": "fs_messages_flag", "target": 3590, "target_label": "fs_messages_flag"}, {"addr": 33460, "bytes": [165, 205], "labels": ["loop_c82b4"], "comments_before": ["&82b4 referenced 1 time by &82c1"], "references": [33473], "type": "code", "mnemonic": "lda", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33462, "bytes": [32, 183, 141], "type": "code", "mnemonic": "jsr", "operand": "calc_handle_offset", "target": 36279, "target_label": "calc_handle_offset"}, {"addr": 33465, "bytes": [176, 8], "type": "code", "mnemonic": "bcs", "operand": "c82c3", "target": 33475, "target_label": "c82c3"}, {"addr": 33467, "bytes": [169, 63], "type": "code", "mnemonic": "lda", "operand": "#&3f"}, {"addr": 33469, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 33471, "bytes": [230, 205], "type": "code", "mnemonic": "inc", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 33473, "bytes": [208, 241], "type": "code", "mnemonic": "bne", "operand": "loop_c82b4", "target": 33460, "target_label": "loop_c82b4"}, {"addr": 33475, "bytes": [173, 24, 254], "labels": ["c82c3"], "comments_before": ["&82c3 referenced 2 times by &8295, &82b9"], "comment_inline": "Read station ID (also INTOFF)", "references": [33429, 33465], "type": "code", "mnemonic": "lda", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 33478, "bytes": [141, 98, 13], "type": "code", "mnemonic": "sta", "operand": "tx_clear_flag", "target": 3426, "target_label": "tx_clear_flag"}, {"addr": 33481, "bytes": [32, 99, 150], "comment_inline": "Initialise ADLC hardware", "type": "code", "mnemonic": "jsr", "operand": "trampoline_adlc_init", "target": 38499, "target_label": "trampoline_adlc_init"}, {"addr": 33484, "bytes": [169, 64], "type": "code", "mnemonic": "lda", "operand": "#&40"}, {"addr": 33486, "bytes": [141, 56, 13], "type": "code", "mnemonic": "sta", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 33489, "bytes": [169, 168], "labels": ["setup_rom_ptrs_netv"], "comments_before": ["***************************************************************************************", "Set up ROM pointer table and NETV\n\nReads the ROM pointer table base address via OSBYTE &A8, stores\nit in osrdsc_ptr (&F6). Sets NETV low byte to &36. Then copies\none 3-byte extended vector entry (addr=&9007, rom=current) into\nthe ROM pointer table at offset &36, installing osword_dispatch\nas the NETV handler.", "***************************************************************************************", "&82d1 referenced 1 time by &8222"], "references": [33314], "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_rom_ptr_table_low"}, {"addr": 33491, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 33493, "bytes": [160, 255], "type": "code", "mnemonic": "ldy", "operand": "#&ff"}, {"addr": 33495, "bytes": [32, 244, 255], "comment_inline": "Read address of ROM pointer table", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33498, "bytes": [134, 246], "comment_inline": "X=value of address of ROM pointer table (low byte)", "type": "code", "mnemonic": "stx", "operand": "osrdsc_ptr", "target": 246, "target_label": "osrdsc_ptr"}, {"addr": 33500, "bytes": [132, 247], "comment_inline": "Y=value of address of ROM pointer table (high byte)", "type": "code", "mnemonic": "sty", "operand": "l00f7", "target": 247, "target_label": "l00f7"}, {"addr": 33502, "bytes": [160, 54], "type": "code", "mnemonic": "ldy", "operand": "#&36"}, {"addr": 33504, "bytes": [140, 36, 2], "type": "code", "mnemonic": "sty", "operand": "netv", "target": 548, "target_label": "netv"}, {"addr": 33507, "bytes": [162, 1], "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 33509, "bytes": [185, 64, 130], "labels": ["store_rom_ptr_pair"], "comments_before": ["&82e5 referenced 2 times by &8229, &82f7"], "references": [33321, 33527], "type": "code", "mnemonic": "lda", "operand": "c8240,y", "target": 33344, "target_label": "c8240"}, {"addr": 33512, "bytes": [145, 246], "type": "code", "mnemonic": "sta", "operand": "(osrdsc_ptr),y", "target": 246, "target_label": "osrdsc_ptr"}, {"addr": 33514, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33515, "bytes": [185, 64, 130], "type": "code", "mnemonic": "lda", "operand": "c8240,y", "target": 33344, "target_label": "c8240"}, {"addr": 33518, "bytes": [145, 246], "type": "code", "mnemonic": "sta", "operand": "(osrdsc_ptr),y", "target": 246, "target_label": "osrdsc_ptr"}, {"addr": 33520, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33521, "bytes": [165, 244], "type": "code", "mnemonic": "lda", "operand": "romsel_copy", "target": 244, "target_label": "romsel_copy"}, {"addr": 33523, "bytes": [145, 246], "type": "code", "mnemonic": "sta", "operand": "(osrdsc_ptr),y", "target": 246, "target_label": "osrdsc_ptr"}, {"addr": 33525, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33526, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 33527, "bytes": [208, 236], "type": "code", "mnemonic": "bne", "operand": "store_rom_ptr_pair", "target": 33509, "target_label": "store_rom_ptr_pair"}, {"addr": 33529, "bytes": [164, 159], "type": "code", "mnemonic": "ldy", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 33531, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33532, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33533, "bytes": [160, 29], "labels": ["fscv_shutdown"], "comments_before": ["***************************************************************************************", "FSCV 6: Filing system shutdown / save state (FSDIE)\n\nCalled when another filing system (e.g. DFS) is selected. Saves\nthe current NFS context (FSLOCN station number, URD/CSD/LIB\nhandles, OPT byte, etc.) from page &0E into the dynamic workspace\nbackup area. This allows the state to be restored when *NET is\nre-issued later, without losing the login session. Finally calls\nOSBYTE &77 (FXSPEX: close SPOOL and EXEC files) to avoid leaving\ndangling file handles across the FS switch.", "***************************************************************************************"], "type": "code", "mnemonic": "ldy", "operand": "#&1d"}, {"addr": 33535, "bytes": [185, 235, 13], "labels": ["fsdiel"], "comments_before": ["&82ff referenced 1 time by &8307"], "references": [33543], "type": "code", "mnemonic": "lda", "operand": "fs_state_deb,y", "target": 3563, "target_label": "fs_state_deb"}, {"addr": 33538, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 33540, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 33541, "bytes": [192, 20], "type": "code", "mnemonic": "cpy", "operand": "#&14"}, {"addr": 33543, "bytes": [208, 246], "type": "code", "mnemonic": "bne", "operand": "fsdiel", "target": 33535, "target_label": "fsdiel"}, {"addr": 33545, "bytes": [169, 123], "type": "code", "mnemonic": "lda", "operand": "#osbyte_printer_driver_going_dormant"}, {"addr": 33547, "bytes": [76, 244, 255], "comment_inline": "Printer driver going dormant", "type": "code", "mnemonic": "jmp", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33550, "bytes": [169, 144], "labels": ["init_tx_ctrl_data"], "comments_before": ["&830e referenced 1 time by &8381"], "references": [33665], "type": "code", "mnemonic": "lda", "operand": "#&90"}, {"addr": 33552, "bytes": [32, 28, 131], "labels": ["init_tx_ctrl_port"], "comments_before": ["&8310 referenced 2 times by &880e, &8f78"], "references": [36728, 34830], "type": "code", "mnemonic": "jsr", "operand": "init_tx_ctrl_block", "target": 33564, "target_label": "init_tx_ctrl_block"}, {"addr": 33555, "bytes": [133, 193], "type": "code", "mnemonic": "sta", "operand": "l00c1", "target": 193, "target_label": "l00c1"}, {"addr": 33557, "bytes": [169, 3], "type": "code", "mnemonic": "lda", "operand": "#3"}, {"addr": 33559, "bytes": [133, 196], "type": "code", "mnemonic": "sta", "operand": "l00c4", "target": 196, "target_label": "l00c4"}, {"addr": 33561, "bytes": [198, 192], "type": "code", "mnemonic": "dec", "operand": "l00c0", "target": 192, "target_label": "l00c0"}, {"addr": 33563, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33564, "bytes": [72], "labels": ["init_tx_ctrl_block"], "comments_before": ["***************************************************************************************", "Initialise TX control block at &00C0 from template\n\nCopies 12 bytes from tx_ctrl_template (&8334) to &00C0.\nFor the first 2 bytes (Y=0,1), also copies the fileserver\nstation/network from &0E00/&0E01 to &00C2/&00C3.\nThe template sets up: control=&80, port=&99 (FS command port),\ncommand data length=&0F, plus padding bytes.", "***************************************************************************************", "&831c referenced 3 times by &8310, &8370, &83b9"], "references": [33648, 33721, 33552], "type": "code", "mnemonic": "pha"}, {"addr": 33565, "bytes": [160, 11], "type": "code", "mnemonic": "ldy", "operand": "#&0b"}, {"addr": 33567, "bytes": [185, 52, 131], "labels": ["fstxl1"], "comments_before": ["&831f referenced 1 time by &8330"], "references": [33584], "type": "code", "mnemonic": "lda", "operand": "tx_ctrl_template,y", "target": 33588, "target_label": "tx_ctrl_template"}, {"addr": 33570, "bytes": [153, 192, 0], "type": "code", "mnemonic": "sta", "operand": "l00c0,y", "target": 192, "target_label": "l00c0"}, {"addr": 33573, "bytes": [192, 2], "type": "code", "mnemonic": "cpy", "operand": "#2"}, {"addr": 33575, "bytes": [16, 6], "type": "code", "mnemonic": "bpl", "operand": "fstxl2", "target": 33583, "target_label": "fstxl2"}, {"addr": 33577, "bytes": [185, 0, 14], "type": "code", "mnemonic": "lda", "operand": "fs_server_stn,y", "target": 3584, "target_label": "fs_server_stn"}, {"addr": 33580, "bytes": [153, 194, 0], "type": "code", "mnemonic": "sta", "operand": "l00c2,y", "target": 194, "target_label": "l00c2"}, {"addr": 33583, "bytes": [136], "labels": ["fstxl2"], "comments_before": ["&832f referenced 1 time by &8327"], "references": [33575], "type": "code", "mnemonic": "dey"}, {"addr": 33584, "bytes": [16, 237], "type": "code", "mnemonic": "bpl", "operand": "fstxl1", "target": 33567, "target_label": "fstxl1"}, {"addr": 33586, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33587, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33588, "bytes": [128, 153, 0, 0, 0, 15], "labels": ["tx_ctrl_template"], "comments_before": ["***************************************************************************************", "TX control block template (TXTAB, 12 bytes)\n\n&00C0: &80 (control flag)    &00C1: &99 (port \u2014 FS command port)\n&00C2: server station        &00C3: server network\n&00C4: &00 (data low)        &00C5: &0F (data high \u2014 buffer page)\n&00C6-&00CB: &FF (FILLER)\nThe &FF padding in the address fields is a recurring pattern:\nEconet control blocks use 4-byte addresses but NFS only needs\n2-byte addresses, so the upper two bytes are filled with &FF.", "***************************************************************************************", "&8334 referenced 1 time by &831f"], "references": [33567], "type": "byte", "values": [128, 153, 0, 0, 0, 15]}, {"addr": 33594, "bytes": [255, 255, 255, 15, 255, 255], "labels": ["l833a"], "comments_before": ["&833a referenced 3 times by &888f, &8969, &915d"], "references": [37213, 34959, 35177], "type": "byte", "values": [255, 255, 255, 15, 255, 255]}, {"addr": 33600, "bytes": [72], "labels": ["prepare_cmd_with_flag"], "comments_before": ["&8340 referenced 1 time by &8a3b"], "references": [35387], "type": "code", "mnemonic": "pha"}, {"addr": 33601, "bytes": [169, 42], "type": "code", "mnemonic": "lda", "operand": "#&2a"}, {"addr": 33603, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 33604, "bytes": [176, 20], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcs", "operand": "c835a", "target": 33626, "target_label": "c835a"}, {"addr": 33606, "bytes": [184], "labels": ["prepare_cmd_clv"], "comments_before": ["&8346 referenced 2 times by &86d7, &8780"], "references": [34519, 34688], "type": "code", "mnemonic": "clv"}, {"addr": 33607, "bytes": [80, 16], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bvc", "operand": "c8359", "target": 33625, "target_label": "c8359"}, {"addr": 33609, "bytes": [169, 119], "labels": ["bye_handler"], "comments_before": ["***************************************************************************************", "*BYE handler (logoff)\n\nCloses any open *SPOOL and *EXEC files via OSBYTE &77 (FXSPEX),\nthen falls into prepare_fs_cmd with Y=&17 (FCBYE: logoff code).\nDispatched from the command match table at &8BD6 for \"BYE\".", "***************************************************************************************"], "type": "code", "mnemonic": "lda", "operand": "#osbyte_close_spool_exec"}, {"addr": 33611, "bytes": [32, 244, 255], "comment_inline": "Close any *SPOOL and *EXEC files", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33614, "bytes": [160, 23], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#&17"}, {"addr": 33616, "bytes": [184], "labels": ["prepare_fs_cmd"], "comments_before": ["***************************************************************************************", "Prepare FS command buffer (12 references)\n\nBuilds the 5-byte FS protocol header at &0F00:\n  &0F00 HDRREP = reply port (set downstream, typically &90/PREPLY)\n  &0F01 HDRFN  = Y parameter (function code)\n  &0F02 HDRURD = URD handle (from &0E02)\n  &0F03 HDRCSD = CSD handle (from &0E03)\n  &0F04 HDRLIB = LIB handle (from &0E04)\nCommand-specific data follows at &0F05 (TXBUF). Also clears V flag.\nCalled before building specific FS commands for transmission.\n\nOn Entry:\n    Y: function code for HDRFN\n    X: preserved through header build\n\nOn Exit:\n    A: 0 on success (from build_send_fs_cmd)\n    X: 0 on success, &D6 on not-found\n    Y: 1 (offset past command code in reply)", "***************************************************************************************", "&8350 referenced 12 times by &807d, &8834, &88aa, &88fc, &8923, &8996, &89c0, &8a9a, &8b50, &8c18, &8c4f, &8cc8"], "references": [32893, 35222, 35264, 34986, 34868, 35864, 35068, 35482, 35107, 35919, 35664, 36040], "type": "code", "mnemonic": "clv"}, {"addr": 33617, "bytes": [173, 2, 14], "labels": ["prepare_fs_cmd_v"], "comments_before": ["&8351 referenced 2 times by &8892, &896c"], "references": [34962, 35180], "type": "code", "mnemonic": "lda", "operand": "fs_urd_handle", "target": 3586, "target_label": "fs_urd_handle"}, {"addr": 33620, "bytes": [141, 2, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_urd", "target": 3842, "target_label": "fs_cmd_urd"}, {"addr": 33623, "bytes": [169, 42], "type": "code", "mnemonic": "lda", "operand": "#&2a"}, {"addr": 33625, "bytes": [24], "labels": ["c8359"], "comments_before": ["&8359 referenced 1 time by &8347"], "references": [33607], "type": "code", "mnemonic": "clc"}, {"addr": 33626, "bytes": [140, 1, 15], "labels": ["c835a"], "comments_before": ["&835a referenced 1 time by &8344"], "references": [33604], "type": "code", "mnemonic": "sty", "operand": "fs_cmd_y_param", "target": 3841, "target_label": "fs_cmd_y_param"}, {"addr": 33629, "bytes": [133, 184], "type": "code", "mnemonic": "sta", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 33631, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 33633, "bytes": [185, 3, 14], "labels": ["loop_c8361"], "comments_before": ["&8361 referenced 1 time by &8368"], "comment_inline": "A=timeout period for FS reply", "references": [33640], "type": "code", "mnemonic": "lda", "operand": "fs_csd_handle,y", "target": 3587, "target_label": "fs_csd_handle"}, {"addr": 33636, "bytes": [153, 3, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_csd,y", "target": 3843, "target_label": "fs_cmd_csd"}, {"addr": 33639, "bytes": [136], "comment_inline": "Y=function code", "type": "code", "mnemonic": "dey"}, {"addr": 33640, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "loop_c8361", "target": 33633, "target_label": "loop_c8361"}, {"addr": 33642, "bytes": [8], "labels": ["build_send_fs_cmd"], "comments_before": ["***************************************************************************************", "Build and send FS command (DOFSOP)\n\nSets reply port to &90 (PREPLY) at &0F00, initialises the TX\ncontrol block, then adjusts TXCB's high pointer (HPTR) to X+5\n-- the 5-byte FS header (reply port, function code, URD, CSD,\nLIB) plus the command data -- so only meaningful bytes are\ntransmitted, conserving Econet bandwidth. If carry is set on\nentry (DOFSBX byte-stream path), takes the alternate path\nthrough econet_tx_retry for direct BSXMIT transmission.\nOtherwise sets up the TX pointer via setup_tx_ptr_c0 and falls\nthrough to send_fs_reply_cmd for reply handling. The carry flag\nis the sole discriminator between byte-stream and standard FS\nprotocol paths -- set by SEC at the BPUTV/BGETV entry points.\nOn return from WAITFS/BSXMIT, Y=0; INY advances past the\ncommand code to read the return code. Error &D6 (\"not found\")\nis detected via ADC #(&100-&D6) with C=0 -- if the return code\nwas exactly &D6, the result wraps to zero (Z=1). This is a\nbranchless comparison returning C=1, A=0 as a soft error that\ncallers can handle, vs hard errors which go through FSERR.\n\nOn Entry:\n    X: buffer extent (command-specific data bytes)\n    Y: function code\n    A: timeout period for FS reply\n    C: 0 for standard FS path, 1 for byte-stream (BSXMIT)\n\nOn Exit:\n    A: 0 on success\n    X: 0 on success, &D6 on not-found\n    Y: 1 (offset past command code in reply)", "***************************************************************************************", "&836a referenced 1 time by &8af3"], "references": [35571], "type": "code", "mnemonic": "php"}, {"addr": 33643, "bytes": [169, 144], "type": "code", "mnemonic": "lda", "operand": "#&90"}, {"addr": 33645, "bytes": [141, 0, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_type", "target": 3840, "target_label": "fs_cmd_type"}, {"addr": 33648, "bytes": [32, 28, 131], "type": "code", "mnemonic": "jsr", "operand": "init_tx_ctrl_block", "target": 33564, "target_label": "init_tx_ctrl_block"}, {"addr": 33651, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 33652, "bytes": [105, 5], "type": "code", "mnemonic": "adc", "operand": "#5"}, {"addr": 33654, "bytes": [133, 200], "type": "code", "mnemonic": "sta", "operand": "l00c8", "target": 200, "target_label": "l00c8"}, {"addr": 33656, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 33657, "bytes": [176, 28], "type": "code", "mnemonic": "bcs", "operand": "dofsl5", "target": 33687, "target_label": "dofsl5"}, {"addr": 33659, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 33660, "bytes": [32, 68, 134], "type": "code", "mnemonic": "jsr", "operand": "setup_tx_ptr_c0", "target": 34372, "target_label": "setup_tx_ptr_c0"}, {"addr": 33663, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 33664, "bytes": [8], "labels": ["send_fs_reply_cmd"], "comments_before": ["&8380 referenced 2 times by &8790, &8a77"], "references": [34704, 35447], "type": "code", "mnemonic": "php"}, {"addr": 33665, "bytes": [32, 14, 131], "type": "code", "mnemonic": "jsr", "operand": "init_tx_ctrl_data", "target": 33550, "target_label": "init_tx_ctrl_data"}, {"addr": 33668, "bytes": [165, 184], "type": "code", "mnemonic": "lda", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 33670, "bytes": [32, 74, 132], "type": "code", "mnemonic": "jsr", "operand": "send_to_fs", "target": 33866, "target_label": "send_to_fs"}, {"addr": 33673, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 33674, "bytes": [200], "labels": ["dofsl7"], "comments_before": ["&838a referenced 1 time by &83a0"], "references": [33696], "type": "code", "mnemonic": "iny"}, {"addr": 33675, "bytes": [177, 196], "type": "code", "mnemonic": "lda", "operand": "(l00c4),y", "target": 196, "target_label": "l00c4"}, {"addr": 33677, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 33678, "bytes": [240, 6], "type": "code", "mnemonic": "beq", "operand": "return_1", "target": 33686, "target_label": "return_1"}, {"addr": 33680, "bytes": [80, 2], "type": "code", "mnemonic": "bvc", "operand": "c8394", "target": 33684, "target_label": "c8394"}, {"addr": 33682, "bytes": [105, 42], "type": "code", "mnemonic": "adc", "operand": "#&2a"}, {"addr": 33684, "bytes": [208, 108], "labels": ["c8394"], "comments_before": ["&8394 referenced 1 time by &8390"], "references": [33680], "type": "code", "mnemonic": "bne", "operand": "store_fs_error", "target": 33794, "target_label": "store_fs_error"}, {"addr": 33686, "bytes": [96], "labels": ["return_1"], "comments_before": ["&8396 referenced 1 time by &838e"], "references": [33678], "type": "code", "mnemonic": "rts"}, {"addr": 33687, "bytes": [104], "labels": ["dofsl5"], "comments_before": ["&8397 referenced 1 time by &8379"], "references": [33657], "type": "code", "mnemonic": "pla"}, {"addr": 33688, "bytes": [162, 192], "type": "code", "mnemonic": "ldx", "operand": "#&c0"}, {"addr": 33690, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33691, "bytes": [32, 72, 146], "type": "code", "mnemonic": "jsr", "operand": "econet_tx_retry", "target": 37448, "target_label": "econet_tx_retry"}, {"addr": 33694, "bytes": [133, 179], "type": "code", "mnemonic": "sta", "operand": "l00b3", "target": 179, "target_label": "l00b3"}, {"addr": 33696, "bytes": [144, 232], "type": "code", "mnemonic": "bcc", "operand": "dofsl7", "target": 33674, "target_label": "dofsl7"}, {"addr": 33698, "bytes": [24], "labels": ["bputv_handler"], "type": "code", "mnemonic": "clc"}, {"addr": 33699, "bytes": [72], "labels": ["handle_bput_bget"], "comments_before": ["***************************************************************************************", "Handle BPUT/BGET file byte I/O\n\nBPUTV enters at &83A2 (CLC; fall through) and BGETV enters\nat &8485 (SEC; JSR here). The carry flag is preserved via\nPHP/PLP through the call chain and tested later (BCS) to\nselect byte-stream transmission (BSXMIT) vs normal FS\ntransmission (FSXMIT) -- a control-flow encoding using\nprocessor flags to avoid an extra flag variable.\n\nBSXMIT uses handle=0 for print stream transactions (which\nsidestep the SEQNOS sequence number manipulation) and non-zero\nhandles for file operations. After transmission, the high\npointer bytes of the CB are reset to &FF -- \"The BGET/PUT byte\nfix\" which prevents stale buffer pointers corrupting subsequent\nbyte-level operations.\n\nOn Entry:\n    C: 0 for BPUT (write byte), 1 for BGET (read byte)\n    A: byte to write (BPUT only)\n    Y: file handle\n\nOn Exit:\n    A: preserved\n    X: preserved\n    Y: preserved", "***************************************************************************************", "&83a3 referenced 1 time by &8486"], "references": [33926], "type": "code", "mnemonic": "pha"}, {"addr": 33700, "bytes": [141, 223, 15], "type": "code", "mnemonic": "sta", "operand": "l0fdf", "target": 4063, "target_label": "l0fdf"}, {"addr": 33703, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 33704, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 33705, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 33706, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 33707, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 33708, "bytes": [32, 137, 133], "type": "code", "mnemonic": "jsr", "operand": "handle_to_mask_clc", "target": 34185, "target_label": "handle_to_mask_clc"}, {"addr": 33711, "bytes": [140, 222, 15], "type": "code", "mnemonic": "sty", "operand": "l0fde", "target": 4062, "target_label": "l0fde"}, {"addr": 33714, "bytes": [132, 207], "type": "code", "mnemonic": "sty", "operand": "l00cf", "target": 207, "target_label": "l00cf"}, {"addr": 33716, "bytes": [160, 144], "type": "code", "mnemonic": "ldy", "operand": "#&90"}, {"addr": 33718, "bytes": [140, 220, 15], "type": "code", "mnemonic": "sty", "operand": "fs_putb_buf", "target": 4060, "target_label": "fs_putb_buf"}, {"addr": 33721, "bytes": [32, 28, 131], "type": "code", "mnemonic": "jsr", "operand": "init_tx_ctrl_block", "target": 33564, "target_label": "init_tx_ctrl_block"}, {"addr": 33724, "bytes": [169, 220], "type": "code", "mnemonic": "lda", "operand": "#&dc"}, {"addr": 33726, "bytes": [133, 196], "type": "code", "mnemonic": "sta", "operand": "l00c4", "target": 196, "target_label": "l00c4"}, {"addr": 33728, "bytes": [169, 224], "type": "code", "mnemonic": "lda", "operand": "#&e0"}, {"addr": 33730, "bytes": [133, 200], "type": "code", "mnemonic": "sta", "operand": "l00c8", "target": 200, "target_label": "l00c8"}, {"addr": 33732, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33733, "bytes": [162, 9], "type": "code", "mnemonic": "ldx", "operand": "#9"}, {"addr": 33735, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 33736, "bytes": [144, 1], "type": "code", "mnemonic": "bcc", "operand": "store_retry_count", "target": 33739, "target_label": "store_retry_count"}, {"addr": 33738, "bytes": [202], "comment_inline": "X=&08", "type": "code", "mnemonic": "dex"}, {"addr": 33739, "bytes": [142, 221, 15], "labels": ["store_retry_count"], "comments_before": ["&83cb referenced 1 time by &83c8"], "references": [33736], "type": "code", "mnemonic": "stx", "operand": "fs_getb_buf", "target": 4061, "target_label": "fs_getb_buf"}, {"addr": 33742, "bytes": [173, 222, 15], "type": "code", "mnemonic": "lda", "operand": "l0fde", "target": 4062, "target_label": "l0fde"}, {"addr": 33745, "bytes": [162, 192], "type": "code", "mnemonic": "ldx", "operand": "#&c0"}, {"addr": 33747, "bytes": [32, 72, 146], "type": "code", "mnemonic": "jsr", "operand": "econet_tx_retry", "target": 37448, "target_label": "econet_tx_retry"}, {"addr": 33750, "bytes": [174, 221, 15], "type": "code", "mnemonic": "ldx", "operand": "fs_getb_buf", "target": 4061, "target_label": "fs_getb_buf"}, {"addr": 33753, "bytes": [240, 64], "type": "code", "mnemonic": "beq", "operand": "update_sequence_return", "target": 33819, "target_label": "update_sequence_return"}, {"addr": 33755, "bytes": [160, 31], "type": "code", "mnemonic": "ldy", "operand": "#&1f"}, {"addr": 33757, "bytes": [185, 220, 15], "labels": ["error1"], "comments_before": ["&83dd referenced 1 time by &83e4"], "references": [33764], "type": "code", "mnemonic": "lda", "operand": "fs_putb_buf,y", "target": 4060, "target_label": "fs_putb_buf"}, {"addr": 33760, "bytes": [153, 224, 15], "type": "code", "mnemonic": "sta", "operand": "l0fe0,y", "target": 4064, "target_label": "l0fe0"}, {"addr": 33763, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 33764, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "error1", "target": 33757, "target_label": "error1"}, {"addr": 33766, "bytes": [170], "comment_inline": "X=File handle", "type": "code", "mnemonic": "tax"}, {"addr": 33767, "bytes": [169, 199], "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_write_spool_file_handle"}, {"addr": 33769, "bytes": [32, 244, 255], "comment_inline": "Read/Write *SPOOL file handle", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33772, "bytes": [138], "comment_inline": "X=value of *SPOOL file handle", "type": "code", "mnemonic": "txa"}, {"addr": 33773, "bytes": [32, 136, 133], "type": "code", "mnemonic": "jsr", "operand": "handle_to_mask_a", "target": 34184, "target_label": "handle_to_mask_a"}, {"addr": 33776, "bytes": [196, 207], "type": "code", "mnemonic": "cpy", "operand": "l00cf", "target": 207, "target_label": "l00cf"}, {"addr": 33778, "bytes": [208, 7], "type": "code", "mnemonic": "bne", "operand": "c83fb", "target": 33787, "target_label": "c83fb"}, {"addr": 33780, "bytes": [162, 68], "type": "code", "mnemonic": "ldx", "operand": "#<(l8444)"}, {"addr": 33782, "bytes": [160, 132], "type": "code", "mnemonic": "ldy", "operand": "#>(l8444)"}, {"addr": 33784, "bytes": [32, 247, 255], "type": "code", "mnemonic": "jsr", "operand": "oscli", "target": 65527, "target_label": "oscli"}, {"addr": 33787, "bytes": [169, 224], "labels": ["c83fb"], "comments_before": ["&83fb referenced 1 time by &83f2"], "references": [33778], "type": "code", "mnemonic": "lda", "operand": "#&e0"}, {"addr": 33789, "bytes": [133, 196], "type": "code", "mnemonic": "sta", "operand": "l00c4", "target": 196, "target_label": "l00c4"}, {"addr": 33791, "bytes": [174, 221, 15], "type": "code", "mnemonic": "ldx", "operand": "fs_getb_buf", "target": 4061, "target_label": "fs_getb_buf"}, {"addr": 33794, "bytes": [142, 9, 14], "labels": ["store_fs_error"], "comments_before": ["***************************************************************************************", "Handle fileserver error replies (FSERR)\n\nThe fileserver returns errors as: zero command code + error number +\nCR-terminated message string. This routine converts the reply buffer\nin-place to a standard MOS BRK error packet by:\n  1. Storing the error code at fs_last_error (&0E09)\n  2. Normalizing error codes below &A8 to &A8 (the standard FS error\n     number), since the MOS error space below &A8 has other meanings\n  3. Scanning for the CR terminator and replacing it with &00\n  4. JMPing indirect through (l00c4) to execute the buffer as a BRK\n     instruction \u2014 the zero command code serves as the BRK opcode\nN.B. This relies on the fileserver always returning a zero command\ncode in position 0 of the reply buffer.", "***************************************************************************************", "&8402 referenced 1 time by &8394"], "references": [33684], "type": "code", "mnemonic": "stx", "operand": "fs_last_error", "target": 3593, "target_label": "fs_last_error"}, {"addr": 33797, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 33799, "bytes": [224, 168], "type": "code", "mnemonic": "cpx", "operand": "#&a8"}, {"addr": 33801, "bytes": [176, 4], "type": "code", "mnemonic": "bcs", "operand": "c840f", "target": 33807, "target_label": "c840f"}, {"addr": 33803, "bytes": [169, 168], "type": "code", "mnemonic": "lda", "operand": "#&a8"}, {"addr": 33805, "bytes": [145, 196], "type": "code", "mnemonic": "sta", "operand": "(l00c4),y", "target": 196, "target_label": "l00c4"}, {"addr": 33807, "bytes": [200], "labels": ["c840f"], "comments_before": ["&840f referenced 2 times by &8409, &8414"], "references": [33801, 33812], "type": "code", "mnemonic": "iny"}, {"addr": 33808, "bytes": [169, 13], "type": "code", "mnemonic": "lda", "operand": "#&0d"}, {"addr": 33810, "bytes": [81, 196], "type": "code", "mnemonic": "eor", "operand": "(l00c4),y", "target": 196, "target_label": "l00c4"}, {"addr": 33812, "bytes": [208, 249], "type": "code", "mnemonic": "bne", "operand": "c840f", "target": 33807, "target_label": "c840f"}, {"addr": 33814, "bytes": [145, 196], "type": "code", "mnemonic": "sta", "operand": "(l00c4),y", "target": 196, "target_label": "l00c4"}, {"addr": 33816, "bytes": [108, 196, 0], "type": "code", "mnemonic": "jmp", "operand": "(l00c4)", "target": 196, "target_label": "l00c4"}, {"addr": 33819, "bytes": [141, 8, 14], "labels": ["update_sequence_return"], "comments_before": ["&841b referenced 1 time by &83d9"], "references": [33753], "type": "code", "mnemonic": "sta", "operand": "fs_sequence_nos", "target": 3592, "target_label": "fs_sequence_nos"}, {"addr": 33822, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33823, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 33824, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33825, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 33826, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33827, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33828, "bytes": [169, 8], "labels": ["c8424"], "comments_before": ["&8424 referenced 1 time by &8477"], "references": [33911], "type": "code", "mnemonic": "lda", "operand": "#8"}, {"addr": 33830, "bytes": [208, 4], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "set_listen_offset", "target": 33836, "target_label": "set_listen_offset"}, {"addr": 33832, "bytes": [161, 154], "labels": ["nlistn"], "comments_before": ["&8428 referenced 1 time by &868d"], "references": [34445], "type": "code", "mnemonic": "lda", "operand": "(net_tx_ptr,x)", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 33834, "bytes": [41, 7], "labels": ["nlisne"], "comments_before": ["&842a referenced 2 times by &8483, &89b8"], "references": [33923, 35256], "type": "code", "mnemonic": "and", "operand": "#7"}, {"addr": 33836, "bytes": [170], "labels": ["set_listen_offset"], "comments_before": ["&842c referenced 1 time by &8426"], "references": [33830], "type": "code", "mnemonic": "tax"}, {"addr": 33837, "bytes": [188, 20, 128], "type": "code", "mnemonic": "ldy", "operand": "l8014,x", "target": 32788, "target_label": "l8014"}, {"addr": 33840, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 33842, "bytes": [142, 0, 1], "type": "code", "mnemonic": "stx", "operand": "l0100", "target": 256, "target_label": "l0100"}, {"addr": 33845, "bytes": [185, 175, 132], "labels": ["loop_c8435"], "comments_before": ["&8435 referenced 1 time by &843f"], "references": [33855], "type": "code", "mnemonic": "lda", "operand": "error_msg_table,y", "target": 33967, "target_label": "error_msg_table"}, {"addr": 33848, "bytes": [157, 1, 1], "type": "code", "mnemonic": "sta", "operand": "l0101,x", "target": 257, "target_label": "l0101"}, {"addr": 33851, "bytes": [240, 4], "type": "code", "mnemonic": "beq", "operand": "c8441", "target": 33857, "target_label": "c8441"}, {"addr": 33853, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 33854, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33855, "bytes": [208, 244], "type": "code", "mnemonic": "bne", "operand": "loop_c8435", "target": 33845, "target_label": "loop_c8435"}, {"addr": 33857, "bytes": [76, 0, 1], "labels": ["c8441"], "comments_before": ["&8441 referenced 1 time by &843b"], "references": [33851], "type": "code", "mnemonic": "jmp", "operand": "l0100", "target": 256, "target_label": "l0100"}, {"addr": 33860, "bytes": [83, 80, 46], "labels": ["l8444"], "type": "string", "string": "SP."}, {"addr": 33863, "bytes": [13], "type": "byte", "values": [13]}, {"addr": 33864, "bytes": [169, 42], "labels": ["send_to_fs_star"], "comments_before": ["&8448 referenced 3 times by &8730, &8fbb, &927d"], "references": [34608, 37501, 36795], "type": "code", "mnemonic": "lda", "operand": "#&2a"}, {"addr": 33866, "bytes": [72], "labels": ["send_to_fs"], "comments_before": ["***************************************************************************************", "Send command to fileserver and handle reply (WAITFS)\n\nPerforms a complete FS transaction: transmit then wait for reply.\nSets bit 7 of rx_status_flags (mark FS transaction in progress),\nbuilds a TX frame from the data at (net_tx_ptr), and transmits\nit. The system RX flag (LFLAG bit 7) is only set when receiving\ninto the page-zero control block \u2014 if RXCBP's high byte is\nnon-zero, setting the system flag would interfere with other RX\noperations. The timeout counter uses the stack (indexed via TSX)\nrather than memory to avoid bus conflicts with Econet hardware\nduring the tight polling loop. Handles multi-block replies and\nchecks for escape conditions between blocks.", "***************************************************************************************", "&844a referenced 2 times by &8386, &881a"], "references": [33670, 34842], "type": "code", "mnemonic": "pha"}, {"addr": 33867, "bytes": [173, 56, 13], "type": "code", "mnemonic": "lda", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 33870, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 33871, "bytes": [9, 128], "type": "code", "mnemonic": "ora", "operand": "#&80"}, {"addr": 33873, "bytes": [141, 56, 13], "type": "code", "mnemonic": "sta", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 33876, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 33878, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 33879, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 33880, "bytes": [168], "comment_inline": "Y=&00", "type": "code", "mnemonic": "tay"}, {"addr": 33881, "bytes": [186], "type": "code", "mnemonic": "tsx"}, {"addr": 33882, "bytes": [177, 154], "labels": ["incpx"], "comments_before": ["&845a referenced 3 times by &8464, &8469, &846e"], "references": [33892, 33897, 33902], "type": "code", "mnemonic": "lda", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 33884, "bytes": [48, 18], "type": "code", "mnemonic": "bmi", "operand": "fs_wait_cleanup", "target": 33904, "target_label": "fs_wait_cleanup"}, {"addr": 33886, "bytes": [32, 122, 132], "type": "code", "mnemonic": "jsr", "operand": "check_escape", "target": 33914, "target_label": "check_escape"}, {"addr": 33889, "bytes": [222, 1, 1], "type": "code", "mnemonic": "dec", "operand": "l0101,x", "target": 257, "target_label": "l0101"}, {"addr": 33892, "bytes": [208, 244], "type": "code", "mnemonic": "bne", "operand": "incpx", "target": 33882, "target_label": "incpx"}, {"addr": 33894, "bytes": [222, 2, 1], "type": "code", "mnemonic": "dec", "operand": "l0102,x", "target": 258, "target_label": "l0102"}, {"addr": 33897, "bytes": [208, 239], "type": "code", "mnemonic": "bne", "operand": "incpx", "target": 33882, "target_label": "incpx"}, {"addr": 33899, "bytes": [222, 4, 1], "type": "code", "mnemonic": "dec", "operand": "l0104,x", "target": 260, "target_label": "l0104"}, {"addr": 33902, "bytes": [208, 234], "type": "code", "mnemonic": "bne", "operand": "incpx", "target": 33882, "target_label": "incpx"}, {"addr": 33904, "bytes": [104], "labels": ["fs_wait_cleanup"], "comments_before": ["&8470 referenced 1 time by &845c"], "references": [33884], "type": "code", "mnemonic": "pla"}, {"addr": 33905, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33906, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33907, "bytes": [141, 56, 13], "type": "code", "mnemonic": "sta", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 33910, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 33911, "bytes": [240, 171], "type": "code", "mnemonic": "beq", "operand": "c8424", "target": 33828, "target_label": "c8424"}, {"addr": 33913, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33914, "bytes": [169, 126], "labels": ["check_escape"], "comments_before": ["***************************************************************************************", "Check and handle escape condition (ESC)\n\nTwo-level escape gating: the MOS escape flag (&FF bit 7) is ANDed\nwith the software enable flag ESCAP. Both must have bit 7 set for\nescape to fire. ESCAP is set non-zero during data port operations\n(LOADOP stores the data port &90, serving double duty as both the\nport number and the escape-enable flag). ESCAP is disabled via LSR\nin the ENTER routine, which clears bit 7 \u2014 PHP/PLP around the LSR\npreserves the carry flag since ENTER is called from contexts where\ncarry has semantic meaning (e.g., PUTBYT vs BGET distinction).\nThis architecture allows escape between retransmission attempts\nbut prevents interruption during critical FS transactions. If\nescape fires: acknowledges via OSBYTE &7E, then checks whether\nthe failing handle is the current SPOOL or EXEC handle (OSBYTE\n&C6/&C7); if so, issues \"*SP.\" or \"*E.\" via OSCLI to gracefully\nclose the channel before raising the error \u2014 preventing the system\nfrom continuing to spool output to a broken file handle.", "***************************************************************************************", "&847a referenced 2 times by &845e, &8674"], "references": [33886, 34420], "type": "code", "mnemonic": "lda", "operand": "#osbyte_acknowledge_escape"}, {"addr": 33916, "bytes": [36, 255], "type": "code", "mnemonic": "bit", "operand": "l00ff", "target": 255, "target_label": "l00ff"}, {"addr": 33918, "bytes": [16, 35], "type": "code", "mnemonic": "bpl", "operand": "return_2", "target": 33955, "target_label": "return_2"}, {"addr": 33920, "bytes": [32, 244, 255], "comment_inline": "Clear escape condition and perform escape effects", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 33923, "bytes": [208, 165], "type": "code", "mnemonic": "bne", "operand": "nlisne", "target": 33834, "target_label": "nlisne"}, {"addr": 33925, "bytes": [56], "labels": ["bgetv_handler"], "type": "code", "mnemonic": "sec"}, {"addr": 33926, "bytes": [32, 163, 131], "comment_inline": "Handle BPUT/BGET file byte I/O", "type": "code", "mnemonic": "jsr", "operand": "handle_bput_bget", "target": 33699, "target_label": "handle_bput_bget"}, {"addr": 33929, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 33930, "bytes": [169, 254], "type": "code", "mnemonic": "lda", "operand": "#&fe"}, {"addr": 33932, "bytes": [44, 223, 15], "type": "code", "mnemonic": "bit", "operand": "l0fdf", "target": 4063, "target_label": "l0fdf"}, {"addr": 33935, "bytes": [112, 18], "type": "code", "mnemonic": "bvs", "operand": "return_2", "target": 33955, "target_label": "return_2"}, {"addr": 33937, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 33938, "bytes": [48, 7], "type": "code", "mnemonic": "bmi", "operand": "c849b", "target": 33947, "target_label": "c849b"}, {"addr": 33940, "bytes": [165, 207], "type": "code", "mnemonic": "lda", "operand": "l00cf", "target": 207, "target_label": "l00cf"}, {"addr": 33942, "bytes": [32, 223, 133], "type": "code", "mnemonic": "jsr", "operand": "clear_fs_flag", "target": 34271, "target_label": "clear_fs_flag"}, {"addr": 33945, "bytes": [144, 5], "type": "code", "mnemonic": "bcc", "operand": "c84a0", "target": 33952, "target_label": "c84a0"}, {"addr": 33947, "bytes": [165, 207], "labels": ["c849b"], "comments_before": ["&849b referenced 1 time by &8492"], "references": [33938], "type": "code", "mnemonic": "lda", "operand": "l00cf", "target": 207, "target_label": "l00cf"}, {"addr": 33949, "bytes": [32, 228, 133], "type": "code", "mnemonic": "jsr", "operand": "set_fs_flag", "target": 34276, "target_label": "set_fs_flag"}, {"addr": 33952, "bytes": [173, 222, 15], "labels": ["c84a0"], "comments_before": ["&84a0 referenced 1 time by &8499"], "references": [33945], "type": "code", "mnemonic": "lda", "operand": "l0fde", "target": 4062, "target_label": "l0fde"}, {"addr": 33955, "bytes": [96], "labels": ["return_2"], "comments_before": ["&84a3 referenced 2 times by &847e, &848f"], "references": [33918, 33935], "type": "code", "mnemonic": "rts"}, {"addr": 33956, "bytes": [200], "labels": ["add_5_to_y"], "comments_before": ["&84a4 referenced 1 time by &8760"], "references": [34656], "type": "code", "mnemonic": "iny"}, {"addr": 33957, "bytes": [200], "labels": ["add_4_to_y"], "comments_before": ["&84a5 referenced 1 time by &8a4d"], "references": [35405], "type": "code", "mnemonic": "iny"}, {"addr": 33958, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33959, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33960, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 33961, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33962, "bytes": [136], "labels": ["sub_4_from_y"], "comments_before": ["&84aa referenced 1 time by &874f"], "references": [34639], "type": "code", "mnemonic": "dey"}, {"addr": 33963, "bytes": [136], "labels": ["sub_3_from_y"], "comments_before": ["&84ab referenced 2 times by &885c, &8a55"], "references": [34908, 35413], "type": "code", "mnemonic": "dey"}, {"addr": 33964, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 33965, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 33966, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 33967, "bytes": [160, 76], "labels": ["error_msg_table"], "comments_before": ["***************************************************************************************", "Econet error message table (ERRTAB, 8 entries)\n\nEach entry: error number byte followed by NUL-terminated string.\n  &A0: \"Line Jammed\"     &A1: \"Net Error\"\n  &A2: \"Not listening\"   &A3: \"No Clock\"\n  &A4: \"Bad Txcb\"        &11: \"Escape\"\n  &CB: \"Bad Option\"      &A5: \"No reply\"\nIndexed by the low 3 bits of the TXCB flag byte (AND #&07),\nwhich encode the specific Econet failure reason. The NREPLY\nand NLISTN routines build a MOS BRK error block at &100 on the\nstack page: NREPLY fires when the fileserver does not respond\nwithin the timeout period; NLISTN fires when the destination\nstation actively refused the connection.\nIndexed via the error dispatch at c8424/c842c.", "***************************************************************************************", "&84af referenced 1 time by &8435"], "references": [33845], "type": "code", "mnemonic": "ldy", "operand": "#&4c"}, {"addr": 33969, "bytes": [105, 110], "type": "code", "mnemonic": "adc", "operand": "#&6e"}, {"addr": 33971, "bytes": [101, 32], "type": "code", "mnemonic": "adc", "operand": "c0020", "target": 32, "target_label": "c0020"}, {"addr": 33973, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 33974, "bytes": [97, 109], "type": "code", "mnemonic": "adc", "operand": "(l006d,x)", "target": 109, "target_label": "l006d"}, {"addr": 33976, "bytes": [109, 101, 100], "type": "code", "mnemonic": "adc", "operand": "l6465", "target": 25701, "target_label": "l6465"}, {"addr": 33979, "bytes": [0], "type": "code", "mnemonic": "brk"}, {"addr": 33980, "bytes": [161], "type": "byte", "values": [161]}, {"addr": 33981, "bytes": [78, 101, 116, 32, 69, 114, 114, 111, 114], "type": "string", "string": "Net Error"}, {"addr": 33990, "bytes": [0, 162], "type": "byte", "values": [0, 162]}, {"addr": 33992, "bytes": [78, 111, 116, 32, 108, 105, 115, 116, 101, 110, 105, 110, 103], "type": "string", "string": "Not listening"}, {"addr": 34005, "bytes": [0, 163], "type": "byte", "values": [0, 163]}, {"addr": 34007, "bytes": [78, 111, 32, 67, 108, 111, 99, 107], "type": "string", "string": "No Clock"}, {"addr": 34015, "bytes": [0, 164], "type": "byte", "values": [0, 164]}, {"addr": 34017, "bytes": [66, 97, 100, 32, 84, 120, 99, 98], "type": "string", "string": "Bad Txcb"}, {"addr": 34025, "bytes": [0, 17], "type": "byte", "values": [0, 17]}, {"addr": 34027, "bytes": [69, 115, 99, 97, 112, 101], "type": "string", "string": "Escape"}, {"addr": 34033, "bytes": [0, 203], "type": "byte", "values": [0, 203]}, {"addr": 34035, "bytes": [66, 97, 100, 32, 79, 112, 116, 105, 111, 110], "type": "string", "string": "Bad Option"}, {"addr": 34045, "bytes": [0, 165], "type": "byte", "values": [0, 165]}, {"addr": 34047, "bytes": [78, 111, 32, 114, 101, 112, 108, 121], "type": "string", "string": "No reply"}, {"addr": 34055, "bytes": [0], "type": "byte", "values": [0]}, {"addr": 34056, "bytes": [133, 189], "labels": ["save_fscv_args"], "comments_before": ["***************************************************************************************", "Save FSCV/vector arguments\n\nStores A, X, Y into the filing system workspace. Called at the\nstart of every FS vector handler (FILEV, ARGSV, BGETV, BPUTV,\nGBPBV, FINDV, FSCV). NFS repurposes CFS/RFS workspace locations:\n  &BD (fs_last_byte_flag) = A (function code / command)\n  &BB (fs_options)        = X (control block ptr low)\n  &BC (fs_block_offset)   = Y (control block ptr high)\n  &BE/&BF (fs_crc_lo/hi)  = X/Y (duplicate for indexed access)", "***************************************************************************************", "&8508 referenced 6 times by &808c, &8694, &88e1, &8949, &89ea, &8b92"], "references": [35730, 35306, 32908, 34452, 35041, 35145], "type": "code", "mnemonic": "sta", "operand": "fs_last_byte_flag", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 34058, "bytes": [134, 187], "type": "code", "mnemonic": "stx", "operand": "fs_options", "target": 187, "target_label": "fs_options"}, {"addr": 34060, "bytes": [132, 188], "type": "code", "mnemonic": "sty", "operand": "fs_block_offset", "target": 188, "target_label": "fs_block_offset"}, {"addr": 34062, "bytes": [134, 190], "type": "code", "mnemonic": "stx", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 34064, "bytes": [132, 191], "type": "code", "mnemonic": "sty", "operand": "fs_crc_hi", "target": 191, "target_label": "fs_crc_hi"}, {"addr": 34066, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34067, "bytes": [160, 14], "labels": ["decode_attribs_6bit"], "comments_before": ["***************************************************************************************", "Decode file attributes: FS \u2192 BBC format (FSBBC, 6-bit variant)\n\nReads attribute byte at offset &0E from the parameter block,\nmasks to 6 bits, then falls through to the shared bitmask\nbuilder. Converts fileserver protection format (5-6 bits) to\nBBC OSFILE attribute format (8 bits) via the lookup table at\n&8530. The two formats use different bit layouts for file\nprotection attributes.", "***************************************************************************************", "&8513 referenced 2 times by &886e, &8899"], "references": [34969, 34926], "type": "code", "mnemonic": "ldy", "operand": "#&0e"}, {"addr": 34069, "bytes": [177, 187], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34071, "bytes": [41, 63], "type": "code", "mnemonic": "and", "operand": "#&3f"}, {"addr": 34073, "bytes": [162, 4], "type": "code", "mnemonic": "ldx", "operand": "#4"}, {"addr": 34075, "bytes": [208, 4], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c8521", "target": 34081, "target_label": "c8521"}, {"addr": 34077, "bytes": [41, 31], "labels": ["decode_attribs_5bit"], "comments_before": ["***************************************************************************************", "Decode file attributes: BBC \u2192 FS format (BBCFS, 5-bit variant)\n\nMasks A to 5 bits and builds an access bitmask via the\nlookup table at &8530. Each input bit position maps to a\ndifferent output bit via the table. The conversion is done\nby iterating through the source bits and OR-ing in the\ncorresponding destination bits from the table, translating\nbetween BBC (8-bit) and fileserver (5-bit) protection formats.", "***************************************************************************************", "&851d referenced 2 times by &879b, &88b6"], "references": [34998, 34715], "type": "code", "mnemonic": "and", "operand": "#&1f"}, {"addr": 34079, "bytes": [162, 255], "type": "code", "mnemonic": "ldx", "operand": "#&ff"}, {"addr": 34081, "bytes": [133, 184], "labels": ["c8521"], "comments_before": ["&8521 referenced 1 time by &851b"], "references": [34075], "type": "code", "mnemonic": "sta", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34083, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 34085, "bytes": [232], "labels": ["loop_c8525"], "comments_before": ["&8525 referenced 1 time by &852d"], "references": [34093], "type": "code", "mnemonic": "inx"}, {"addr": 34086, "bytes": [70, 184], "type": "code", "mnemonic": "lsr", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34088, "bytes": [144, 3], "type": "code", "mnemonic": "bcc", "operand": "c852d", "target": 34093, "target_label": "c852d"}, {"addr": 34090, "bytes": [29, 48, 133], "type": "code", "mnemonic": "ora", "operand": "access_bit_table,x", "target": 34096, "target_label": "access_bit_table"}, {"addr": 34093, "bytes": [208, 246], "labels": ["c852d"], "comments_before": ["&852d referenced 1 time by &8528"], "references": [34088], "type": "code", "mnemonic": "bne", "operand": "loop_c8525", "target": 34085, "target_label": "loop_c8525"}, {"addr": 34095, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34096, "bytes": [80, 32, 5, 2, 136, 4, 8, 128, 16, 1, 2], "labels": ["access_bit_table"], "comments_before": ["&8530 referenced 1 time by &852a"], "references": [34090], "type": "byte", "values": [80, 32, 5, 2, 136, 4, 8, 128, 16, 1, 2]}, {"addr": 34107, "bytes": [104], "labels": ["print_inline"], "comments_before": ["***************************************************************************************", "Print inline string, high-bit terminated (VSTRNG)\n\nPops the return address from the stack, prints each byte via OSASCI\nuntil a byte with bit 7 set is found, then jumps to that address.\nThe high-bit byte serves as both the string terminator and the opcode\nof the first instruction after the string. N.B. Cannot be used for\nBRK error messages -- the stack manipulation means a BRK in the\ninline data would corrupt the stack rather than invoke the error\nhandler.\n\nOn Exit:\n    A: terminator byte (bit 7 set, also next opcode)\n    X: corrupted (by OSASCI)\n    Y: 0", "***************************************************************************************", "&853b referenced 13 times by &81bc, &81e6, &8205, &8212, &8c20, &8c2a, &8c38, &8c43, &8c5d, &8c6e, &8c81, &8c95, &8ca2"], "comment_inline": "Pop return address (low) \u2014 points to last byte of JSR", "references": [33212, 33285, 33298, 33254, 35872, 35882, 35896, 35907, 35933, 35950, 35969, 35989, 36002], "type": "code", "mnemonic": "pla"}, {"addr": 34108, "bytes": [133, 176], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34110, "bytes": [104], "comment_inline": "Pop return address (high)", "type": "code", "mnemonic": "pla"}, {"addr": 34111, "bytes": [133, 177], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr_hi", "target": 177, "target_label": "fs_load_addr_hi"}, {"addr": 34113, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 34115, "bytes": [230, 176], "labels": ["loop_c8543"], "comments_before": ["&8543 referenced 1 time by &8550"], "comment_inline": "Advance pointer past return address / to next char", "references": [34128], "type": "code", "mnemonic": "inc", "operand": "fs_load_addr", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34117, "bytes": [208, 2], "type": "code", "mnemonic": "bne", "operand": "c8549", "target": 34121, "target_label": "c8549"}, {"addr": 34119, "bytes": [230, 177], "type": "code", "mnemonic": "inc", "operand": "fs_load_addr_hi", "target": 177, "target_label": "fs_load_addr_hi"}, {"addr": 34121, "bytes": [177, 176], "labels": ["c8549"], "comments_before": ["&8549 referenced 1 time by &8545"], "comment_inline": "Load next byte from inline string", "references": [34117], "type": "code", "mnemonic": "lda", "operand": "(fs_load_addr),y", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34123, "bytes": [48, 5], "comment_inline": "Bit 7 set? Done \u2014 this byte is the next opcode", "type": "code", "mnemonic": "bmi", "operand": "c8552", "target": 34130, "target_label": "c8552"}, {"addr": 34125, "bytes": [32, 227, 255], "comment_inline": "Write character", "type": "code", "mnemonic": "jsr", "operand": "osasci", "target": 65507, "target_label": "osasci"}, {"addr": 34128, "bytes": [208, 241], "type": "code", "mnemonic": "bne", "operand": "loop_c8543", "target": 34115, "target_label": "loop_c8543"}, {"addr": 34130, "bytes": [108, 176, 0], "labels": ["c8552"], "comments_before": ["&8552 referenced 1 time by &854b"], "comment_inline": "Jump to address of high-bit byte (resumes code after string)", "references": [34123], "type": "code", "mnemonic": "jmp", "operand": "(fs_load_addr)", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34133, "bytes": [177, 187], "labels": ["skip_spaces"], "comments_before": ["***************************************************************************************", "Skip leading spaces in parameter block\n\nAdvances Y past space characters in (fs_options),Y.\nReturns with the first non-space character in A.\nSets carry if the character is >= 'A' (alphabetic).", "***************************************************************************************", "&8555 referenced 3 times by &855a, &8c0c, &8d06"], "references": [36102, 34138, 35852], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34135, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 34136, "bytes": [201, 32], "type": "code", "mnemonic": "cmp", "operand": "#&20"}, {"addr": 34138, "bytes": [240, 249], "type": "code", "mnemonic": "beq", "operand": "skip_spaces", "target": 34133, "target_label": "skip_spaces"}, {"addr": 34140, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34141, "bytes": [201, 65], "type": "code", "mnemonic": "cmp", "operand": "#&41"}, {"addr": 34143, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34144, "bytes": [170], "labels": ["parse_decimal"], "comments_before": ["***************************************************************************************", "Parse decimal number from (fs_options),Y (DECIN)\n\nReads ASCII digits and accumulates in &B2 (fs_load_addr_2).\nMultiplication by 10 uses the identity: n*10 = n*8 + n*2,\ncomputed as ASL &B2 (x2), then A = &B2*4 via two ASLs,\nthen ADC &B2 gives x10.\nTerminates on \".\" (pathname separator), control chars, or space.\nThe delimiter handling was revised to support dot-separated path\ncomponents (e.g. \"1.$.PROG\") -- originally stopped on any char\n>= &40 (any letter), but the revision allows numbers followed\nby dots.\n\nOn Entry:\n    Y: offset into (fs_options) buffer\n\nOn Exit:\n    A: parsed value (accumulated in &B2)\n    X: corrupted\n    Y: offset past last digit parsed", "***************************************************************************************", "&8560 referenced 2 times by &8d0d, &8d13"], "references": [36109, 36115], "type": "code", "mnemonic": "tax"}, {"addr": 34145, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 34147, "bytes": [133, 178], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 34149, "bytes": [177, 187], "labels": ["loop_c8565"], "comments_before": ["&8565 referenced 1 time by &8582"], "references": [34178], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34151, "bytes": [201, 64], "type": "code", "mnemonic": "cmp", "operand": "#&40"}, {"addr": 34153, "bytes": [176, 25], "type": "code", "mnemonic": "bcs", "operand": "c8584", "target": 34180, "target_label": "c8584"}, {"addr": 34155, "bytes": [201, 46], "type": "code", "mnemonic": "cmp", "operand": "#&2e"}, {"addr": 34157, "bytes": [240, 22], "type": "code", "mnemonic": "beq", "operand": "c8585", "target": 34181, "target_label": "c8585"}, {"addr": 34159, "bytes": [48, 19], "type": "code", "mnemonic": "bmi", "operand": "c8584", "target": 34180, "target_label": "c8584"}, {"addr": 34161, "bytes": [41, 15], "type": "code", "mnemonic": "and", "operand": "#&0f"}, {"addr": 34163, "bytes": [133, 179], "type": "code", "mnemonic": "sta", "operand": "l00b3", "target": 179, "target_label": "l00b3"}, {"addr": 34165, "bytes": [6, 178], "type": "code", "mnemonic": "asl", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 34167, "bytes": [165, 178], "type": "code", "mnemonic": "lda", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 34169, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 34170, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 34171, "bytes": [101, 178], "type": "code", "mnemonic": "adc", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 34173, "bytes": [101, 179], "type": "code", "mnemonic": "adc", "operand": "l00b3", "target": 179, "target_label": "l00b3"}, {"addr": 34175, "bytes": [133, 178], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 34177, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 34178, "bytes": [208, 225], "type": "code", "mnemonic": "bne", "operand": "loop_c8565", "target": 34149, "target_label": "loop_c8565"}, {"addr": 34180, "bytes": [24], "labels": ["c8584"], "comments_before": ["&8584 referenced 2 times by &8569, &856f"], "references": [34153, 34159], "type": "code", "mnemonic": "clc"}, {"addr": 34181, "bytes": [165, 178], "labels": ["c8585"], "comments_before": ["&8585 referenced 1 time by &856d"], "references": [34157], "type": "code", "mnemonic": "lda", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 34183, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34184, "bytes": [168], "labels": ["handle_to_mask_a"], "comments_before": ["&8588 referenced 3 times by &83ed, &8a05, &8ecc"], "references": [35333, 36556, 33773], "type": "code", "mnemonic": "tay"}, {"addr": 34185, "bytes": [24], "labels": ["handle_to_mask_clc"], "comments_before": ["&8589 referenced 3 times by &83ac, &8822, &88ec"], "references": [34850, 35052, 33708], "type": "code", "mnemonic": "clc"}, {"addr": 34186, "bytes": [72], "labels": ["handle_to_mask"], "comments_before": ["***************************************************************************************", "Convert file handle to bitmask (Y2FS)\n\nConverts fileserver handles to single-bit masks segregated inside\nthe BBC. NFS handles occupy the &20-&27 range (base HAND=&20),\nwhich cannot collide with local filing system or cassette handles\n-- the MOS routes OSFIND/OSBGET/OSBPUT to the correct filing\nsystem based on the handle value alone. The power-of-two encoding\nallows the EOF hint byte to track up to 8 files simultaneously\nwith one bit per file, and enables fast set operations (ORA to\nadd, EOR to toggle, AND to test) without loops. Handle 0 passes\nthrough unchanged (means \"no file\"). The bit-shift conversion loop\nhas a built-in validity check: if the handle is out of range, the\nrepeated ASL shifts all bits out, leaving A=0, which is converted\nto Y=&FF as a sentinel -- bad handles fail gracefully rather than\nindexing into garbage.\nThree entry points: &858A (direct), &8589 (CLC first), &8588 (TAY first).\n\nOn Entry:\n    Y: handle number\n    C: 0: convert, 1 with Y=0: skip, 1 with Y!=0: convert\n\nOn Exit:\n    A: preserved\n    X: preserved\n    Y: bitmask (single bit set) or &FF if handle invalid", "***************************************************************************************", "&858a referenced 1 time by &894d"], "references": [35149], "type": "code", "mnemonic": "pha"}, {"addr": 34187, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 34188, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34189, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 34190, "bytes": [144, 2], "type": "code", "mnemonic": "bcc", "operand": "y2fsl5", "target": 34194, "target_label": "y2fsl5"}, {"addr": 34192, "bytes": [240, 15], "type": "code", "mnemonic": "beq", "operand": "c85a1", "target": 34209, "target_label": "c85a1"}, {"addr": 34194, "bytes": [56], "labels": ["y2fsl5"], "comments_before": ["&8592 referenced 1 time by &858e"], "references": [34190], "type": "code", "mnemonic": "sec"}, {"addr": 34195, "bytes": [233, 31], "type": "code", "mnemonic": "sbc", "operand": "#&1f"}, {"addr": 34197, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 34198, "bytes": [169, 1], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 34200, "bytes": [10], "labels": ["y2fsl2"], "comments_before": ["&8598 referenced 1 time by &859a"], "references": [34202], "type": "code", "mnemonic": "asl"}, {"addr": 34201, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34202, "bytes": [208, 252], "type": "code", "mnemonic": "bne", "operand": "y2fsl2", "target": 34200, "target_label": "y2fsl2"}, {"addr": 34204, "bytes": [106], "type": "code", "mnemonic": "ror"}, {"addr": 34205, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 34206, "bytes": [208, 1], "type": "code", "mnemonic": "bne", "operand": "c85a1", "target": 34209, "target_label": "c85a1"}, {"addr": 34208, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34209, "bytes": [104], "labels": ["c85a1"], "comments_before": ["&85a1 referenced 2 times by &8590, &859e"], "references": [34192, 34206], "type": "code", "mnemonic": "pla"}, {"addr": 34210, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 34211, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34212, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34213, "bytes": [162, 0], "labels": ["mask_to_handle"], "comments_before": ["***************************************************************************************", "Convert bitmask to handle number (FS2A)\n\nInverse of Y2FS. Converts from the power-of-two FS format\nback to a sequential handle number by counting right shifts\nuntil A=0. Adds &1E to convert the 1-based bit position to\na handle number (handles start at &1F+1 = &20). Used when\nreceiving handle values from the fileserver in reply packets.\n\nOn Entry:\n    A: single-bit bitmask\n\nOn Exit:\n    A: handle number (&20-&27)\n    X: corrupted\n    Y: preserved", "***************************************************************************************", "&85a5 referenced 2 times by &8980, &8ee6"], "references": [36582, 35200], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 34215, "bytes": [232], "labels": ["fs2al1"], "comments_before": ["&85a7 referenced 1 time by &85a9"], "references": [34217], "type": "code", "mnemonic": "inx"}, {"addr": 34216, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 34217, "bytes": [208, 252], "type": "code", "mnemonic": "bne", "operand": "fs2al1", "target": 34215, "target_label": "fs2al1"}, {"addr": 34219, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 34220, "bytes": [105, 30], "type": "code", "mnemonic": "adc", "operand": "#&1e"}, {"addr": 34222, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34223, "bytes": [168], "labels": ["print_decimal"], "comments_before": ["***************************************************************************************", "Print byte as 3-digit decimal number\n\nPrints A as a decimal number using repeated subtraction\nfor each digit position (100, 10, 1). Leading zeros are\nprinted (no suppression). Used to display station numbers.", "***************************************************************************************", "&85af referenced 2 times by &81fb, &8c27"], "references": [33275, 35879], "type": "code", "mnemonic": "tay"}, {"addr": 34224, "bytes": [169, 100], "type": "code", "mnemonic": "lda", "operand": "#&64"}, {"addr": 34226, "bytes": [32, 188, 133], "type": "code", "mnemonic": "jsr", "operand": "print_decimal_digit", "target": 34236, "target_label": "print_decimal_digit"}, {"addr": 34229, "bytes": [169, 10], "type": "code", "mnemonic": "lda", "operand": "#&0a"}, {"addr": 34231, "bytes": [32, 188, 133], "type": "code", "mnemonic": "jsr", "operand": "print_decimal_digit", "target": 34236, "target_label": "print_decimal_digit"}, {"addr": 34234, "bytes": [169, 1], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 34236, "bytes": [133, 184], "labels": ["print_decimal_digit"], "comments_before": ["***************************************************************************************", "Print one decimal digit by repeated subtraction\n\nDivides Y by A using repeated subtraction. Prints the\nquotient as an ASCII digit ('0'-'9'). Returns with the\nremainder in Y. X starts at &2F ('0'-1) and increments\nonce per subtraction, giving the ASCII digit directly.", "***************************************************************************************", "&85bc referenced 2 times by &85b2, &85b7"], "references": [34226, 34231], "type": "code", "mnemonic": "sta", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34238, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 34239, "bytes": [162, 47], "type": "code", "mnemonic": "ldx", "operand": "#&2f"}, {"addr": 34241, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 34242, "bytes": [232], "labels": ["loop_c85c2"], "comments_before": ["&85c2 referenced 1 time by &85c5"], "references": [34245], "type": "code", "mnemonic": "inx"}, {"addr": 34243, "bytes": [229, 184], "type": "code", "mnemonic": "sbc", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34245, "bytes": [176, 251], "type": "code", "mnemonic": "bcs", "operand": "loop_c85c2", "target": 34242, "target_label": "loop_c85c2"}, {"addr": 34247, "bytes": [101, 184], "type": "code", "mnemonic": "adc", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34249, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 34250, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 34251, "bytes": [76, 227, 255], "labels": ["c85cb"], "comments_before": ["&85cb referenced 1 time by &85fe"], "comment_inline": "Write character", "references": [34302], "type": "code", "mnemonic": "jmp", "operand": "osasci", "target": 65507, "target_label": "osasci"}, {"addr": 34254, "bytes": [162, 4], "labels": ["compare_addresses"], "comments_before": ["***************************************************************************************", "Compare two 4-byte addresses\n\nCompares bytes at &B0-&B3 against &B4-&B7 using EOR.\nUsed by the OSFILE save handler to compare the current\ntransfer address (&C8-&CB, copied to &B0) against the end\naddress (&B4-&B7) during multi-block file data transfers.\n\nOn Exit:\n    A: corrupted (EOR result)\n    X: corrupted\n    Y: preserved", "***************************************************************************************", "&85ce referenced 2 times by &8716, &87c9"], "references": [34582, 34761], "type": "code", "mnemonic": "ldx", "operand": "#4"}, {"addr": 34256, "bytes": [181, 175], "labels": ["loop_c85d0"], "comments_before": ["&85d0 referenced 1 time by &85d7"], "references": [34263], "type": "code", "mnemonic": "lda", "operand": "l00af,x", "target": 175, "target_label": "l00af"}, {"addr": 34258, "bytes": [85, 179], "type": "code", "mnemonic": "eor", "operand": "l00b3,x", "target": 179, "target_label": "l00b3"}, {"addr": 34260, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "return_3", "target": 34265, "target_label": "return_3"}, {"addr": 34262, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34263, "bytes": [208, 247], "type": "code", "mnemonic": "bne", "operand": "loop_c85d0", "target": 34256, "target_label": "loop_c85d0"}, {"addr": 34265, "bytes": [96], "labels": ["return_3"], "comments_before": ["&85d9 referenced 1 time by &85d4"], "references": [34260], "type": "code", "mnemonic": "rts"}, {"addr": 34266, "bytes": [162, 32], "labels": ["fscv_read_handles"], "type": "code", "mnemonic": "ldx", "operand": "#&20"}, {"addr": 34268, "bytes": [160, 39], "type": "code", "mnemonic": "ldy", "operand": "#&27"}, {"addr": 34270, "bytes": [96], "labels": ["return_4"], "comments_before": ["&85de referenced 1 time by &8603"], "references": [34307], "type": "code", "mnemonic": "rts"}, {"addr": 34271, "bytes": [73, 255], "labels": ["clear_fs_flag"], "comments_before": ["***************************************************************************************", "Clear bit(s) in FS flags (&0E07)\n\nInverts A (EOR #&FF), then ANDs into fs_work_0e07 to clear\nthe specified bits. Falls through to set_fs_flag to store.", "***************************************************************************************", "&85df referenced 3 times by &8496, &883d, &8a81"], "references": [33942, 34877, 35457], "type": "code", "mnemonic": "eor", "operand": "#&ff"}, {"addr": 34273, "bytes": [45, 7, 14], "type": "code", "mnemonic": "and", "operand": "fs_eof_flags", "target": 3591, "target_label": "fs_eof_flags"}, {"addr": 34276, "bytes": [13, 7, 14], "labels": ["set_fs_flag"], "comments_before": ["***************************************************************************************", "Set bit(s) in FS flags (&0E07)\n\nORs A into fs_work_0e07 (EOF hint byte). Each bit represents\none of up to 8 open file handles. When clear, the file is\ndefinitely NOT at EOF. When set, the fileserver must be queried\nto confirm EOF status. This negative-cache optimisation avoids\nexpensive network round-trips for the common case. The hint is\ncleared when the file pointer is updated (since seeking away\nfrom EOF invalidates the hint) and set after BGET/OPEN/EOF\noperations that might have reached the end.", "***************************************************************************************", "&85e4 referenced 5 times by &849d, &8929, &8975, &899c, &8a84"], "references": [35228, 33949, 35113, 35189, 35460], "type": "code", "mnemonic": "ora", "operand": "fs_eof_flags", "target": 3591, "target_label": "fs_eof_flags"}, {"addr": 34279, "bytes": [141, 7, 14], "type": "code", "mnemonic": "sta", "operand": "fs_eof_flags", "target": 3591, "target_label": "fs_eof_flags"}, {"addr": 34282, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34283, "bytes": [72], "labels": ["print_hex"], "comments_before": ["***************************************************************************************", "Print byte as two hex digits\n\nPrints the high nibble first (via 4\u00d7 LSR), then the low\nnibble. Each nibble is converted to ASCII '0'-'9' or 'A'-'F'\nand output via OSASCI.", "***************************************************************************************", "&85eb referenced 2 times by &8639, &8c6b"], "references": [34361, 35947], "type": "code", "mnemonic": "pha"}, {"addr": 34284, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 34285, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 34286, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 34287, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 34288, "bytes": [32, 246, 133], "type": "code", "mnemonic": "jsr", "operand": "print_hex_nibble", "target": 34294, "target_label": "print_hex_nibble"}, {"addr": 34291, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34292, "bytes": [41, 15], "type": "code", "mnemonic": "and", "operand": "#&0f"}, {"addr": 34294, "bytes": [9, 48], "labels": ["print_hex_nibble"], "comments_before": ["&85f6 referenced 1 time by &85f0"], "references": [34288], "type": "code", "mnemonic": "ora", "operand": "#&30"}, {"addr": 34296, "bytes": [201, 58], "type": "code", "mnemonic": "cmp", "operand": "#&3a"}, {"addr": 34298, "bytes": [144, 2], "type": "code", "mnemonic": "bcc", "operand": "c85fe", "target": 34302, "target_label": "c85fe"}, {"addr": 34300, "bytes": [105, 6], "type": "code", "mnemonic": "adc", "operand": "#6"}, {"addr": 34302, "bytes": [208, 203], "labels": ["c85fe"], "comments_before": ["&85fe referenced 2 times by &85fa, &8642"], "references": [34370, 34298], "type": "code", "mnemonic": "bne", "operand": "c85cb", "target": 34251, "target_label": "c85cb"}, {"addr": 34304, "bytes": [172, 6, 14], "labels": ["print_file_info"], "comments_before": ["***************************************************************************************", "Print file catalogue line\n\nDisplays a formatted catalogue entry: filename (padded to 12\nchars with spaces), load address (4 hex bytes at offset 5-2),\nexec address (4 hex bytes at offset 9-6), and file length\n(3 hex bytes at offset &0C-&0A), followed by a newline.\nData is read from (fs_crc_lo) for the filename and from\n(fs_options) for the numeric fields. Returns immediately\nif fs_work_0e06 is zero (no info available).", "***************************************************************************************", "&8600 referenced 2 times by &8703, &8783"], "references": [34563, 34691], "type": "code", "mnemonic": "ldy", "operand": "fs_messages_flag", "target": 3590, "target_label": "fs_messages_flag"}, {"addr": 34307, "bytes": [240, 217], "type": "code", "mnemonic": "beq", "operand": "return_4", "target": 34270, "target_label": "return_4"}, {"addr": 34309, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 34311, "bytes": [177, 190], "labels": ["loop_c8607"], "comments_before": ["&8607 referenced 1 time by &8615"], "references": [34325], "type": "code", "mnemonic": "lda", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 34313, "bytes": [201, 13], "type": "code", "mnemonic": "cmp", "operand": "#&0d"}, {"addr": 34315, "bytes": [240, 10], "type": "code", "mnemonic": "beq", "operand": "pad_filename_spaces", "target": 34327, "target_label": "pad_filename_spaces"}, {"addr": 34317, "bytes": [201, 32], "type": "code", "mnemonic": "cmp", "operand": "#&20"}, {"addr": 34319, "bytes": [240, 6], "type": "code", "mnemonic": "beq", "operand": "pad_filename_spaces", "target": 34327, "target_label": "pad_filename_spaces"}, {"addr": 34321, "bytes": [32, 227, 255], "comment_inline": "Write character", "type": "code", "mnemonic": "jsr", "operand": "osasci", "target": 65507, "target_label": "osasci"}, {"addr": 34324, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 34325, "bytes": [208, 240], "type": "code", "mnemonic": "bne", "operand": "loop_c8607", "target": 34311, "target_label": "loop_c8607"}, {"addr": 34327, "bytes": [32, 64, 134], "labels": ["pad_filename_spaces"], "comments_before": ["&8617 referenced 3 times by &860b, &860f, &861d"], "references": [34315, 34319, 34333], "type": "code", "mnemonic": "jsr", "operand": "print_space", "target": 34368, "target_label": "print_space"}, {"addr": 34330, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 34331, "bytes": [192, 12], "type": "code", "mnemonic": "cpy", "operand": "#&0c"}, {"addr": 34333, "bytes": [144, 248], "type": "code", "mnemonic": "bcc", "operand": "pad_filename_spaces", "target": 34327, "target_label": "pad_filename_spaces"}, {"addr": 34335, "bytes": [160, 5], "type": "code", "mnemonic": "ldy", "operand": "#5"}, {"addr": 34337, "bytes": [32, 53, 134], "type": "code", "mnemonic": "jsr", "operand": "print_hex_bytes", "target": 34357, "target_label": "print_hex_bytes"}, {"addr": 34340, "bytes": [32, 42, 134], "type": "code", "mnemonic": "jsr", "operand": "print_exec_and_len", "target": 34346, "target_label": "print_exec_and_len"}, {"addr": 34343, "bytes": [76, 231, 255], "comment_inline": "Write newline (characters 10 and 13)", "type": "code", "mnemonic": "jmp", "operand": "osnewl", "target": 65511, "target_label": "osnewl"}, {"addr": 34346, "bytes": [160, 9], "labels": ["print_exec_and_len"], "comments_before": ["&862a referenced 1 time by &8624"], "references": [34340], "type": "code", "mnemonic": "ldy", "operand": "#9"}, {"addr": 34348, "bytes": [32, 53, 134], "type": "code", "mnemonic": "jsr", "operand": "print_hex_bytes", "target": 34357, "target_label": "print_hex_bytes"}, {"addr": 34351, "bytes": [160, 12], "type": "code", "mnemonic": "ldy", "operand": "#&0c"}, {"addr": 34353, "bytes": [162, 3], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 34355, "bytes": [208, 2], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "num01", "target": 34359, "target_label": "num01"}, {"addr": 34357, "bytes": [162, 4], "labels": ["print_hex_bytes"], "comments_before": ["&8635 referenced 2 times by &8621, &862c"], "references": [34337, 34348], "type": "code", "mnemonic": "ldx", "operand": "#4"}, {"addr": 34359, "bytes": [177, 187], "labels": ["num01"], "comments_before": ["&8637 referenced 2 times by &8633, &863e"], "references": [34355, 34366], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34361, "bytes": [32, 235, 133], "type": "code", "mnemonic": "jsr", "operand": "print_hex", "target": 34283, "target_label": "print_hex"}, {"addr": 34364, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34365, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34366, "bytes": [208, 247], "type": "code", "mnemonic": "bne", "operand": "num01", "target": 34359, "target_label": "num01"}, {"addr": 34368, "bytes": [169, 32], "labels": ["print_space"], "comments_before": ["&8640 referenced 2 times by &8617, &8d5c"], "references": [36188, 34327], "type": "code", "mnemonic": "lda", "operand": "#&20"}, {"addr": 34370, "bytes": [208, 186], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c85fe", "target": 34302, "target_label": "c85fe"}, {"addr": 34372, "bytes": [162, 192], "labels": ["setup_tx_ptr_c0"], "comments_before": ["***************************************************************************************", "Set up TX pointer to control block at &00C0\n\nPoints net_tx_ptr to &00C0 where the TX control block has\nbeen built by init_tx_ctrl_block. Falls through to tx_poll_ff\nto initiate transmission with full retry.", "***************************************************************************************", "&8644 referenced 2 times by &837c, &8809"], "references": [33660, 34825], "type": "code", "mnemonic": "ldx", "operand": "#&c0"}, {"addr": 34374, "bytes": [134, 154], "type": "code", "mnemonic": "stx", "operand": "net_tx_ptr", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 34376, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 34378, "bytes": [134, 155], "type": "code", "mnemonic": "stx", "operand": "net_tx_ptr_hi", "target": 155, "target_label": "net_tx_ptr_hi"}, {"addr": 34380, "bytes": [169, 255], "labels": ["tx_poll_ff"], "comments_before": ["***************************************************************************************", "Transmit and poll for result (full retry)\n\nSets A=&FF (retry count) and Y=&60 (timeout parameter).\nFalls through to tx_poll_core.", "***************************************************************************************", "&864c referenced 3 times by &9001, &905b, &925b"], "references": [36955, 37467, 36865], "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 34382, "bytes": [160, 96], "labels": ["tx_poll_timeout"], "comments_before": ["&864e referenced 1 time by &8fa4"], "comment_inline": "Y=timeout parameter (&60 = standard)", "references": [36772], "type": "code", "mnemonic": "ldy", "operand": "#&60"}, {"addr": 34384, "bytes": [72], "labels": ["tx_poll_core"], "comments_before": ["***************************************************************************************", "Core transmit and poll routine (XMIT)\n\nClaims the TX semaphore (tx_ctrl_status) via ASL -- a busy-wait\nspinlock where carry=0 means the semaphore is held by another\noperation. Only after claiming the semaphore is the TX pointer\ncopied to nmi_tx_block, ensuring the low-level transmit code\nsees a consistent pointer. Then calls the ADLC TX setup routine\nand polls the control byte for completion:\n  bit 7 set = still busy (loop)\n  bit 6 set = error (check escape or report)\n  bit 6 clear = success (clean return)\nOn error, checks for escape condition and handles retries.\nTwo entry points: setup_tx_ptr_c0 (&8644) always uses the\nstandard TXCB; tx_poll_core (&8650) is general-purpose.\n\nOn Entry:\n    A: retry count (&FF = full retry)\n    Y: timeout parameter (&60 = standard)\n\nOn Exit:\n    A: entry A (retry count, restored from stack)\n    X: 0\n    Y: 0", "***************************************************************************************", "&8650 referenced 1 time by &8fe6"], "references": [36838], "type": "code", "mnemonic": "pha"}, {"addr": 34385, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 34386, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34387, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 34389, "bytes": [161, 154], "type": "code", "mnemonic": "lda", "operand": "(net_tx_ptr,x)", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 34391, "bytes": [129, 154], "labels": ["c8657"], "comments_before": ["&8657 referenced 1 time by &868a"], "references": [34442], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr,x)", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 34393, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34394, "bytes": [14, 58, 13], "labels": ["loop_c865a"], "comments_before": ["&865a referenced 1 time by &865d"], "references": [34397], "type": "code", "mnemonic": "asl", "operand": "tx_ctrl_status", "target": 3386, "target_label": "tx_ctrl_status"}, {"addr": 34397, "bytes": [144, 251], "type": "code", "mnemonic": "bcc", "operand": "loop_c865a", "target": 34394, "target_label": "loop_c865a"}, {"addr": 34399, "bytes": [165, 154], "type": "code", "mnemonic": "lda", "operand": "net_tx_ptr", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 34401, "bytes": [133, 160], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 34403, "bytes": [165, 155], "type": "code", "mnemonic": "lda", "operand": "net_tx_ptr_hi", "target": 155, "target_label": "net_tx_ptr_hi"}, {"addr": 34405, "bytes": [133, 161], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block_hi", "target": 161, "target_label": "nmi_tx_block_hi"}, {"addr": 34407, "bytes": [32, 96, 150], "type": "code", "mnemonic": "jsr", "operand": "trampoline_tx_setup", "target": 38496, "target_label": "trampoline_tx_setup"}, {"addr": 34410, "bytes": [161, 154], "labels": ["l4"], "comments_before": ["&866a referenced 1 time by &866c"], "references": [34412], "type": "code", "mnemonic": "lda", "operand": "(net_tx_ptr,x)", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 34412, "bytes": [48, 252], "type": "code", "mnemonic": "bmi", "operand": "l4", "target": 34410, "target_label": "l4"}, {"addr": 34414, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 34415, "bytes": [16, 31], "type": "code", "mnemonic": "bpl", "operand": "c8690", "target": 34448, "target_label": "c8690"}, {"addr": 34417, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 34418, "bytes": [240, 24], "type": "code", "mnemonic": "beq", "operand": "c868c", "target": 34444, "target_label": "c868c"}, {"addr": 34420, "bytes": [32, 122, 132], "type": "code", "mnemonic": "jsr", "operand": "check_escape", "target": 33914, "target_label": "check_escape"}, {"addr": 34423, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34424, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 34425, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34426, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 34427, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34428, "bytes": [240, 14], "type": "code", "mnemonic": "beq", "operand": "c868c", "target": 34444, "target_label": "c868c"}, {"addr": 34430, "bytes": [233, 1], "type": "code", "mnemonic": "sbc", "operand": "#1"}, {"addr": 34432, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34433, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 34434, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34435, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 34436, "bytes": [202], "labels": ["delay_1ms"], "comments_before": ["&8684 referenced 2 times by &8685, &8688"], "references": [34437, 34440], "type": "code", "mnemonic": "dex"}, {"addr": 34437, "bytes": [208, 253], "type": "code", "mnemonic": "bne", "operand": "delay_1ms", "target": 34436, "target_label": "delay_1ms"}, {"addr": 34439, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34440, "bytes": [208, 250], "type": "code", "mnemonic": "bne", "operand": "delay_1ms", "target": 34436, "target_label": "delay_1ms"}, {"addr": 34442, "bytes": [240, 203], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "c8657", "target": 34391, "target_label": "c8657"}, {"addr": 34444, "bytes": [170], "labels": ["c868c"], "comments_before": ["&868c referenced 2 times by &8672, &867c"], "references": [34418, 34428], "type": "code", "mnemonic": "tax"}, {"addr": 34445, "bytes": [76, 40, 132], "type": "code", "mnemonic": "jmp", "operand": "nlistn", "target": 33832, "target_label": "nlistn"}, {"addr": 34448, "bytes": [104], "labels": ["c8690"], "comments_before": ["&8690 referenced 1 time by &866f"], "references": [34415], "type": "code", "mnemonic": "pla"}, {"addr": 34449, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34450, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34451, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34452, "bytes": [32, 8, 133], "labels": ["filev_handler"], "comments_before": ["***************************************************************************************", "FILEV handler (OSFILE entry point)\n\nSaves A/X/Y, copies the filename pointer from the parameter block\nto os_text_ptr, then uses GSINIT/GSREAD to parse the filename into\n&0FC5+. Sets fs_crc_lo/hi to point at the parsed filename buffer.\nDispatches by function code A:\n  A=&FF: load file (send_fs_examine at &86D0)\n  A=&00: save file (filev_save at &8746)\n  A=&01-&06: attribute operations (filev_attrib_dispatch at &8844)\n  Other: restore_args_return (unsupported, no-op)\n\nOn Entry:\n    A: function code (&FF=load, &00=save, &01-&06=attrs)\n    X: parameter block address low byte\n    Y: parameter block address high byte\n\nOn Exit:\n    A: restored\n    X: restored\n    Y: restored", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "save_fscv_args", "target": 34056, "target_label": "save_fscv_args"}, {"addr": 34455, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 34457, "bytes": [177, 187], "labels": ["file1"], "comments_before": ["&8699 referenced 1 time by &869f"], "references": [34463], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34459, "bytes": [153, 242, 0], "type": "code", "mnemonic": "sta", "operand": "os_text_ptr,y", "target": 242, "target_label": "os_text_ptr"}, {"addr": 34462, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34463, "bytes": [16, 248], "type": "code", "mnemonic": "bpl", "operand": "file1", "target": 34457, "target_label": "file1"}, {"addr": 34465, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 34466, "bytes": [162, 255], "type": "code", "mnemonic": "ldx", "operand": "#&ff"}, {"addr": 34468, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 34469, "bytes": [32, 194, 255], "type": "code", "mnemonic": "jsr", "operand": "gsinit", "target": 65474, "target_label": "gsinit"}, {"addr": 34472, "bytes": [32, 197, 255], "labels": ["quote1"], "comments_before": ["&86a8 referenced 1 time by &86b1"], "references": [34481], "type": "code", "mnemonic": "jsr", "operand": "gsread", "target": 65477, "target_label": "gsread"}, {"addr": 34475, "bytes": [176, 6], "type": "code", "mnemonic": "bcs", "operand": "c86b3", "target": 34483, "target_label": "c86b3"}, {"addr": 34477, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 34478, "bytes": [157, 197, 15], "type": "code", "mnemonic": "sta", "operand": "l0fc5,x", "target": 4037, "target_label": "l0fc5"}, {"addr": 34481, "bytes": [144, 245], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcc", "operand": "quote1", "target": 34472, "target_label": "quote1"}, {"addr": 34483, "bytes": [169, 13], "labels": ["c86b3"], "comments_before": ["&86b3 referenced 1 time by &86ab"], "references": [34475], "type": "code", "mnemonic": "lda", "operand": "#&0d"}, {"addr": 34485, "bytes": [157, 198, 15], "type": "code", "mnemonic": "sta", "operand": "l0fc6,x", "target": 4038, "target_label": "l0fc6"}, {"addr": 34488, "bytes": [169, 197], "type": "code", "mnemonic": "lda", "operand": "#&c5"}, {"addr": 34490, "bytes": [133, 190], "type": "code", "mnemonic": "sta", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 34492, "bytes": [169, 15], "type": "code", "mnemonic": "lda", "operand": "#&0f"}, {"addr": 34494, "bytes": [133, 191], "type": "code", "mnemonic": "sta", "operand": "fs_crc_hi", "target": 191, "target_label": "fs_crc_hi"}, {"addr": 34496, "bytes": [165, 189], "type": "code", "mnemonic": "lda", "operand": "fs_last_byte_flag", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 34498, "bytes": [16, 125], "type": "code", "mnemonic": "bpl", "operand": "saveop", "target": 34625, "target_label": "saveop"}, {"addr": 34500, "bytes": [201, 255], "type": "code", "mnemonic": "cmp", "operand": "#&ff"}, {"addr": 34502, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "loadop", "target": 34507, "target_label": "loadop"}, {"addr": 34504, "bytes": [76, 44, 137], "type": "code", "mnemonic": "jmp", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 34507, "bytes": [32, 99, 141], "labels": ["loadop"], "comments_before": ["&86cb referenced 1 time by &86c6"], "references": [34502], "type": "code", "mnemonic": "jsr", "operand": "copy_filename", "target": 36195, "target_label": "copy_filename"}, {"addr": 34510, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 34512, "bytes": [169, 146], "labels": ["send_fs_examine"], "comments_before": ["***************************************************************************************", "Send FS examine command\n\nSends FS command &03 (FCEXAM: examine file) to the fileserver.\nSets &0F02=&03 and error pointer to '*'. Called for OSFILE &FF\n(load file) with the filename already in the command buffer.\nThe FS reply contains load/exec addresses and file length which\nare used to set up the data transfer. The header URD field\nis repurposed to carry the Econet data port number (PLDATA=&92)\nfor the subsequent block data transfer.", "***************************************************************************************", "&86d0 referenced 1 time by &8d90"], "references": [36240], "type": "code", "mnemonic": "lda", "operand": "#&92"}, {"addr": 34514, "bytes": [141, 2, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_urd", "target": 3842, "target_label": "fs_cmd_urd"}, {"addr": 34517, "bytes": [169, 42], "type": "code", "mnemonic": "lda", "operand": "#&2a"}, {"addr": 34519, "bytes": [32, 70, 131], "type": "code", "mnemonic": "jsr", "operand": "prepare_cmd_clv", "target": 33606, "target_label": "prepare_cmd_clv"}, {"addr": 34522, "bytes": [160, 6], "type": "code", "mnemonic": "ldy", "operand": "#6"}, {"addr": 34524, "bytes": [177, 187], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34526, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "lodfil", "target": 34536, "target_label": "lodfil"}, {"addr": 34528, "bytes": [32, 173, 135], "type": "code", "mnemonic": "jsr", "operand": "copy_load_addr_from_params", "target": 34733, "target_label": "copy_load_addr_from_params"}, {"addr": 34531, "bytes": [32, 186, 135], "type": "code", "mnemonic": "jsr", "operand": "copy_reply_to_params", "target": 34746, "target_label": "copy_reply_to_params"}, {"addr": 34534, "bytes": [144, 6], "type": "code", "mnemonic": "bcc", "operand": "c86ee", "target": 34542, "target_label": "c86ee"}, {"addr": 34536, "bytes": [32, 186, 135], "labels": ["lodfil"], "comments_before": ["&86e8 referenced 1 time by &86de"], "references": [34526], "type": "code", "mnemonic": "jsr", "operand": "copy_reply_to_params", "target": 34746, "target_label": "copy_reply_to_params"}, {"addr": 34539, "bytes": [32, 173, 135], "type": "code", "mnemonic": "jsr", "operand": "copy_load_addr_from_params", "target": 34733, "target_label": "copy_load_addr_from_params"}, {"addr": 34542, "bytes": [160, 4], "labels": ["c86ee"], "comments_before": ["&86ee referenced 1 time by &86e6"], "references": [34534], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 34544, "bytes": [181, 176], "labels": ["loop_c86f0"], "comments_before": ["&86f0 referenced 1 time by &86fb"], "references": [34555], "type": "code", "mnemonic": "lda", "operand": "fs_load_addr,x", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34546, "bytes": [149, 200], "type": "code", "mnemonic": "sta", "operand": "l00c8,x", "target": 200, "target_label": "l00c8"}, {"addr": 34548, "bytes": [125, 13, 15], "type": "code", "mnemonic": "adc", "operand": "l0f0d,x", "target": 3853, "target_label": "l0f0d"}, {"addr": 34551, "bytes": [149, 180], "type": "code", "mnemonic": "sta", "operand": "l00b4,x", "target": 180, "target_label": "l00b4"}, {"addr": 34553, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 34554, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34555, "bytes": [208, 243], "type": "code", "mnemonic": "bne", "operand": "loop_c86f0", "target": 34544, "target_label": "loop_c86f0"}, {"addr": 34557, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 34558, "bytes": [237, 16, 15], "type": "code", "mnemonic": "sbc", "operand": "l0f10", "target": 3856, "target_label": "l0f10"}, {"addr": 34561, "bytes": [133, 183], "type": "code", "mnemonic": "sta", "operand": "l00b7", "target": 183, "target_label": "l00b7"}, {"addr": 34563, "bytes": [32, 0, 134], "type": "code", "mnemonic": "jsr", "operand": "print_file_info", "target": 34304, "target_label": "print_file_info"}, {"addr": 34566, "bytes": [32, 22, 135], "type": "code", "mnemonic": "jsr", "operand": "send_data_blocks", "target": 34582, "target_label": "send_data_blocks"}, {"addr": 34569, "bytes": [162, 2], "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 34571, "bytes": [189, 16, 15], "labels": ["floop"], "comments_before": ["&870b referenced 1 time by &8712"], "references": [34578], "type": "code", "mnemonic": "lda", "operand": "l0f10,x", "target": 3856, "target_label": "l0f10"}, {"addr": 34574, "bytes": [157, 5, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 34577, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34578, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "floop", "target": 34571, "target_label": "floop"}, {"addr": 34580, "bytes": [48, 118], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bmi", "operand": "c878c", "target": 34700, "target_label": "c878c"}, {"addr": 34582, "bytes": [32, 206, 133], "labels": ["send_data_blocks"], "comments_before": ["***************************************************************************************", "Send file data in multi-block chunks\n\nRepeatedly sends &80-byte (128-byte) blocks of file data to the\nfileserver using command &7F. Compares current address (&C8-&CB)\nagainst end address (&B4-&B7) via compare_addresses, and loops\nuntil the entire file has been transferred. Each block is sent\nvia send_to_fs_star.", "***************************************************************************************", "&8716 referenced 2 times by &8706, &8a70"], "comment_inline": "Compare two 4-byte addresses", "references": [34566, 35440], "type": "code", "mnemonic": "jsr", "operand": "compare_addresses", "target": 34254, "target_label": "compare_addresses"}, {"addr": 34585, "bytes": [240, 37], "type": "code", "mnemonic": "beq", "operand": "return_5", "target": 34624, "target_label": "return_5"}, {"addr": 34587, "bytes": [169, 146], "type": "code", "mnemonic": "lda", "operand": "#&92"}, {"addr": 34589, "bytes": [133, 193], "type": "code", "mnemonic": "sta", "operand": "l00c1", "target": 193, "target_label": "l00c1"}, {"addr": 34591, "bytes": [162, 3], "labels": ["loop_c871f"], "comments_before": ["&871f referenced 1 time by &873b"], "references": [34619], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 34593, "bytes": [181, 200], "labels": ["loop_c8721"], "comments_before": ["&8721 referenced 1 time by &872a"], "references": [34602], "type": "code", "mnemonic": "lda", "operand": "l00c8,x", "target": 200, "target_label": "l00c8"}, {"addr": 34595, "bytes": [149, 196], "type": "code", "mnemonic": "sta", "operand": "l00c4,x", "target": 196, "target_label": "l00c4"}, {"addr": 34597, "bytes": [181, 180], "type": "code", "mnemonic": "lda", "operand": "l00b4,x", "target": 180, "target_label": "l00b4"}, {"addr": 34599, "bytes": [149, 200], "type": "code", "mnemonic": "sta", "operand": "l00c8,x", "target": 200, "target_label": "l00c8"}, {"addr": 34601, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34602, "bytes": [16, 245], "type": "code", "mnemonic": "bpl", "operand": "loop_c8721", "target": 34593, "target_label": "loop_c8721"}, {"addr": 34604, "bytes": [169, 127], "type": "code", "mnemonic": "lda", "operand": "#&7f"}, {"addr": 34606, "bytes": [133, 192], "type": "code", "mnemonic": "sta", "operand": "l00c0", "target": 192, "target_label": "l00c0"}, {"addr": 34608, "bytes": [32, 72, 132], "type": "code", "mnemonic": "jsr", "operand": "send_to_fs_star", "target": 33864, "target_label": "send_to_fs_star"}, {"addr": 34611, "bytes": [160, 3], "type": "code", "mnemonic": "ldy", "operand": "#3"}, {"addr": 34613, "bytes": [185, 200, 0], "labels": ["lodchk"], "comments_before": ["&8735 referenced 1 time by &873e"], "references": [34622], "type": "code", "mnemonic": "lda", "operand": "l00c8,y", "target": 200, "target_label": "l00c8"}, {"addr": 34616, "bytes": [89, 180, 0], "type": "code", "mnemonic": "eor", "operand": "l00b4,y", "target": 180, "target_label": "l00b4"}, {"addr": 34619, "bytes": [208, 226], "type": "code", "mnemonic": "bne", "operand": "loop_c871f", "target": 34591, "target_label": "loop_c871f"}, {"addr": 34621, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34622, "bytes": [16, 245], "type": "code", "mnemonic": "bpl", "operand": "lodchk", "target": 34613, "target_label": "lodchk"}, {"addr": 34624, "bytes": [96], "labels": ["return_5"], "comments_before": ["&8740 referenced 1 time by &8719"], "references": [34585], "type": "code", "mnemonic": "rts"}, {"addr": 34625, "bytes": [240, 3], "labels": ["saveop"], "comments_before": ["&8741 referenced 1 time by &86c2"], "references": [34498], "type": "code", "mnemonic": "beq", "operand": "filev_save", "target": 34630, "target_label": "filev_save"}, {"addr": 34627, "bytes": [76, 68, 136], "type": "code", "mnemonic": "jmp", "operand": "filev_attrib_dispatch", "target": 34884, "target_label": "filev_attrib_dispatch"}, {"addr": 34630, "bytes": [162, 4], "labels": ["filev_save"], "comments_before": ["***************************************************************************************", "OSFILE save handler (A=&00)\n\nCopies 4-byte load/exec/length addresses from the parameter block\nto the FS command buffer, along with the filename. Sends FS\ncommand &91 with function &14 to initiate the save, then\ncalls print_file_info to display the filename being saved.\nHandles both host and Tube-based data sources.\nWhen receiving the save acknowledgement, the RX low pointer is\nincremented by 1 to skip the command code (CC) byte, which\nindicates the FS type and must be preserved. N.B. this assumes\nthe RX buffer does not cross a page boundary.", "***************************************************************************************", "&8746 referenced 1 time by &8741"], "references": [34625], "type": "code", "mnemonic": "ldx", "operand": "#4"}, {"addr": 34632, "bytes": [160, 14], "type": "code", "mnemonic": "ldy", "operand": "#&0e"}, {"addr": 34634, "bytes": [177, 187], "labels": ["savsiz"], "comments_before": ["&874a referenced 1 time by &8764"], "references": [34660], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34636, "bytes": [153, 166, 0], "type": "code", "mnemonic": "sta", "operand": "port_ws_offset,y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 34639, "bytes": [32, 170, 132], "type": "code", "mnemonic": "jsr", "operand": "sub_4_from_y", "target": 33962, "target_label": "sub_4_from_y"}, {"addr": 34642, "bytes": [241, 187], "type": "code", "mnemonic": "sbc", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34644, "bytes": [153, 3, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_csd,y", "target": 3843, "target_label": "fs_cmd_csd"}, {"addr": 34647, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34648, "bytes": [177, 187], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34650, "bytes": [153, 166, 0], "type": "code", "mnemonic": "sta", "operand": "port_ws_offset,y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 34653, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34654, "bytes": [145, 187], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34656, "bytes": [32, 164, 132], "type": "code", "mnemonic": "jsr", "operand": "add_5_to_y", "target": 33956, "target_label": "add_5_to_y"}, {"addr": 34659, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34660, "bytes": [208, 228], "type": "code", "mnemonic": "bne", "operand": "savsiz", "target": 34634, "target_label": "savsiz"}, {"addr": 34662, "bytes": [160, 9], "type": "code", "mnemonic": "ldy", "operand": "#9"}, {"addr": 34664, "bytes": [177, 187], "labels": ["loop_c8768"], "comments_before": ["&8768 referenced 1 time by &876e"], "references": [34670], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34666, "bytes": [153, 3, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_csd,y", "target": 3843, "target_label": "fs_cmd_csd"}, {"addr": 34669, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34670, "bytes": [208, 248], "type": "code", "mnemonic": "bne", "operand": "loop_c8768", "target": 34664, "target_label": "loop_c8768"}, {"addr": 34672, "bytes": [169, 145], "type": "code", "mnemonic": "lda", "operand": "#&91"}, {"addr": 34674, "bytes": [141, 2, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_urd", "target": 3842, "target_label": "fs_cmd_urd"}, {"addr": 34677, "bytes": [133, 184], "type": "code", "mnemonic": "sta", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34679, "bytes": [162, 11], "type": "code", "mnemonic": "ldx", "operand": "#&0b"}, {"addr": 34681, "bytes": [32, 101, 141], "type": "code", "mnemonic": "jsr", "operand": "copy_string_to_cmd", "target": 36197, "target_label": "copy_string_to_cmd"}, {"addr": 34684, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 34686, "bytes": [169, 20], "type": "code", "mnemonic": "lda", "operand": "#&14"}, {"addr": 34688, "bytes": [32, 70, 131], "type": "code", "mnemonic": "jsr", "operand": "prepare_cmd_clv", "target": 33606, "target_label": "prepare_cmd_clv"}, {"addr": 34691, "bytes": [32, 0, 134], "type": "code", "mnemonic": "jsr", "operand": "print_file_info", "target": 34304, "target_label": "print_file_info"}, {"addr": 34694, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 34697, "bytes": [32, 200, 135], "type": "code", "mnemonic": "jsr", "operand": "transfer_file_blocks", "target": 34760, "target_label": "transfer_file_blocks"}, {"addr": 34700, "bytes": [169, 42], "labels": ["c878c"], "comments_before": ["&878c referenced 1 time by &8714"], "references": [34580], "type": "code", "mnemonic": "lda", "operand": "#&2a"}, {"addr": 34702, "bytes": [133, 184], "type": "code", "mnemonic": "sta", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34704, "bytes": [32, 128, 131], "type": "code", "mnemonic": "jsr", "operand": "send_fs_reply_cmd", "target": 33664, "target_label": "send_fs_reply_cmd"}, {"addr": 34707, "bytes": [142, 8, 15], "type": "code", "mnemonic": "stx", "operand": "l0f08", "target": 3848, "target_label": "l0f08"}, {"addr": 34710, "bytes": [160, 14], "type": "code", "mnemonic": "ldy", "operand": "#&0e"}, {"addr": 34712, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 34715, "bytes": [32, 29, 133], "type": "code", "mnemonic": "jsr", "operand": "decode_attribs_5bit", "target": 34077, "target_label": "decode_attribs_5bit"}, {"addr": 34718, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "c87a3", "target": 34723, "target_label": "c87a3"}, {"addr": 34720, "bytes": [185, 247, 14], "labels": ["loop_c87a0"], "comments_before": ["&87a0 referenced 1 time by &87a8"], "references": [34728], "type": "code", "mnemonic": "lda", "operand": "l0ef7,y", "target": 3831, "target_label": "l0ef7"}, {"addr": 34723, "bytes": [145, 187], "labels": ["c87a3"], "comments_before": ["&87a3 referenced 1 time by &879e"], "references": [34718], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34725, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 34726, "bytes": [192, 18], "type": "code", "mnemonic": "cpy", "operand": "#&12"}, {"addr": 34728, "bytes": [208, 246], "type": "code", "mnemonic": "bne", "operand": "loop_c87a0", "target": 34720, "target_label": "loop_c87a0"}, {"addr": 34730, "bytes": [76, 44, 137], "type": "code", "mnemonic": "jmp", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 34733, "bytes": [160, 5], "labels": ["copy_load_addr_from_params"], "comments_before": ["***************************************************************************************", "Copy load address from parameter block\n\nCopies 4 bytes from (fs_options)+2..5 (the load address in the\nOSFILE parameter block) to &AE-&B3 (local workspace).", "***************************************************************************************", "&87ad referenced 2 times by &86e0, &86eb"], "references": [34528, 34539], "type": "code", "mnemonic": "ldy", "operand": "#5"}, {"addr": 34735, "bytes": [177, 187], "labels": ["lodrl1"], "comments_before": ["&87af referenced 1 time by &87b7"], "references": [34743], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34737, "bytes": [153, 174, 0], "type": "code", "mnemonic": "sta", "operand": "l00ae,y", "target": 174, "target_label": "l00ae"}, {"addr": 34740, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34741, "bytes": [192, 2], "type": "code", "mnemonic": "cpy", "operand": "#2"}, {"addr": 34743, "bytes": [176, 246], "type": "code", "mnemonic": "bcs", "operand": "lodrl1", "target": 34735, "target_label": "lodrl1"}, {"addr": 34745, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34746, "bytes": [160, 13], "labels": ["copy_reply_to_params"], "comments_before": ["***************************************************************************************", "Copy FS reply data to parameter block\n\nCopies bytes from the FS command reply buffer (&0F02+) into the\nparameter block at (fs_options)+2..13. Used to fill in the OSFILE\nparameter block with information returned by the fileserver.", "***************************************************************************************", "&87ba referenced 2 times by &86e3, &86e8"], "references": [34536, 34531], "type": "code", "mnemonic": "ldy", "operand": "#&0d"}, {"addr": 34748, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 34749, "bytes": [145, 187], "labels": ["lodrl2"], "comments_before": ["&87bd referenced 1 time by &87c5"], "references": [34757], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34751, "bytes": [185, 2, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_urd,y", "target": 3842, "target_label": "fs_cmd_urd"}, {"addr": 34754, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34755, "bytes": [192, 2], "type": "code", "mnemonic": "cpy", "operand": "#2"}, {"addr": 34757, "bytes": [176, 246], "type": "code", "mnemonic": "bcs", "operand": "lodrl2", "target": 34749, "target_label": "lodrl2"}, {"addr": 34759, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34760, "bytes": [72], "labels": ["transfer_file_blocks"], "comments_before": ["***************************************************************************************", "Multi-block file data transfer\n\nManages the transfer of file data in chunks between the local\nmachine and the fileserver. Entry conditions: WORK (&B0-&B3) and\nWORK+4 (&B4-&B7) hold the low and high addresses of the data\nbeing sent/received. Sets up source (&C4-&C7) and destination\n(&C8-&CB) from the FS reply, sends &80-byte (128-byte) blocks\nwith command &91, and continues until all data has been\ntransferred. Handles address overflow and Tube co-processor\ntransfers. For SAVE, WORK+8 holds the port on which to receive\nbyte-level ACKs for each data block (flow control).", "***************************************************************************************", "&87c8 referenced 2 times by &8789, &8a6b"], "references": [34697, 35435], "type": "code", "mnemonic": "pha"}, {"addr": 34761, "bytes": [32, 206, 133], "comment_inline": "Compare two 4-byte addresses", "type": "code", "mnemonic": "jsr", "operand": "compare_addresses", "target": 34254, "target_label": "compare_addresses"}, {"addr": 34764, "bytes": [240, 114], "type": "code", "mnemonic": "beq", "operand": "c8840", "target": 34880, "target_label": "c8840"}, {"addr": 34766, "bytes": [162, 0], "labels": ["c87ce"], "comments_before": ["&87ce referenced 1 time by &881d"], "references": [34845], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 34768, "bytes": [160, 4], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 34770, "bytes": [142, 8, 15], "type": "code", "mnemonic": "stx", "operand": "l0f08", "target": 3848, "target_label": "l0f08"}, {"addr": 34773, "bytes": [142, 9, 15], "type": "code", "mnemonic": "stx", "operand": "l0f09", "target": 3849, "target_label": "l0f09"}, {"addr": 34776, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 34777, "bytes": [181, 176], "labels": ["loop_c87d9"], "comments_before": ["&87d9 referenced 1 time by &87e6"], "references": [34790], "type": "code", "mnemonic": "lda", "operand": "fs_load_addr,x", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34779, "bytes": [149, 196], "type": "code", "mnemonic": "sta", "operand": "l00c4,x", "target": 196, "target_label": "l00c4"}, {"addr": 34781, "bytes": [125, 6, 15], "type": "code", "mnemonic": "adc", "operand": "l0f06,x", "target": 3846, "target_label": "l0f06"}, {"addr": 34784, "bytes": [149, 200], "type": "code", "mnemonic": "sta", "operand": "l00c8,x", "target": 200, "target_label": "l00c8"}, {"addr": 34786, "bytes": [149, 176], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr,x", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34788, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 34789, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34790, "bytes": [208, 241], "type": "code", "mnemonic": "bne", "operand": "loop_c87d9", "target": 34777, "target_label": "loop_c87d9"}, {"addr": 34792, "bytes": [176, 13], "type": "code", "mnemonic": "bcs", "operand": "c87f7", "target": 34807, "target_label": "c87f7"}, {"addr": 34794, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 34795, "bytes": [185, 176, 0], "labels": ["savchk"], "comments_before": ["&87eb referenced 1 time by &87f3"], "references": [34803], "type": "code", "mnemonic": "lda", "operand": "fs_load_addr,y", "target": 176, "target_label": "fs_load_addr"}, {"addr": 34798, "bytes": [249, 180, 0], "type": "code", "mnemonic": "sbc", "operand": "l00b4,y", "target": 180, "target_label": "l00b4"}, {"addr": 34801, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 34802, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34803, "bytes": [208, 246], "type": "code", "mnemonic": "bne", "operand": "savchk", "target": 34795, "target_label": "savchk"}, {"addr": 34805, "bytes": [144, 9], "type": "code", "mnemonic": "bcc", "operand": "c8800", "target": 34816, "target_label": "c8800"}, {"addr": 34807, "bytes": [162, 3], "labels": ["c87f7"], "comments_before": ["&87f7 referenced 1 time by &87e8"], "references": [34792], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 34809, "bytes": [181, 180], "labels": ["loop_c87f9"], "comments_before": ["&87f9 referenced 1 time by &87fe"], "references": [34814], "type": "code", "mnemonic": "lda", "operand": "l00b4,x", "target": 180, "target_label": "l00b4"}, {"addr": 34811, "bytes": [149, 200], "type": "code", "mnemonic": "sta", "operand": "l00c8,x", "target": 200, "target_label": "l00c8"}, {"addr": 34813, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34814, "bytes": [16, 249], "type": "code", "mnemonic": "bpl", "operand": "loop_c87f9", "target": 34809, "target_label": "loop_c87f9"}, {"addr": 34816, "bytes": [104], "labels": ["c8800"], "comments_before": ["&8800 referenced 1 time by &87f5"], "references": [34805], "type": "code", "mnemonic": "pla"}, {"addr": 34817, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34818, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 34819, "bytes": [133, 193], "type": "code", "mnemonic": "sta", "operand": "l00c1", "target": 193, "target_label": "l00c1"}, {"addr": 34821, "bytes": [169, 128], "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 34823, "bytes": [133, 192], "type": "code", "mnemonic": "sta", "operand": "l00c0", "target": 192, "target_label": "l00c0"}, {"addr": 34825, "bytes": [32, 68, 134], "type": "code", "mnemonic": "jsr", "operand": "setup_tx_ptr_c0", "target": 34372, "target_label": "setup_tx_ptr_c0"}, {"addr": 34828, "bytes": [165, 184], "type": "code", "mnemonic": "lda", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 34830, "bytes": [32, 16, 131], "type": "code", "mnemonic": "jsr", "operand": "init_tx_ctrl_port", "target": 33552, "target_label": "init_tx_ctrl_port"}, {"addr": 34833, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 34834, "bytes": [176, 44], "type": "code", "mnemonic": "bcs", "operand": "c8840", "target": 34880, "target_label": "c8840"}, {"addr": 34836, "bytes": [169, 145], "type": "code", "mnemonic": "lda", "operand": "#&91"}, {"addr": 34838, "bytes": [133, 193], "type": "code", "mnemonic": "sta", "operand": "l00c1", "target": 193, "target_label": "l00c1"}, {"addr": 34840, "bytes": [169, 42], "type": "code", "mnemonic": "lda", "operand": "#&2a"}, {"addr": 34842, "bytes": [32, 74, 132], "type": "code", "mnemonic": "jsr", "operand": "send_to_fs", "target": 33866, "target_label": "send_to_fs"}, {"addr": 34845, "bytes": [208, 175], "type": "code", "mnemonic": "bne", "operand": "c87ce", "target": 34766, "target_label": "c87ce"}, {"addr": 34847, "bytes": [72], "labels": ["eof_handler"], "comments_before": ["***************************************************************************************", "FSCV 1: EOF handler\n\nChecks whether a file handle has reached end-of-file. Converts\nthe handle via handle_to_mask_clc, tests the result against the\nEOF hint byte (&0E07). If the hint bit is clear, returns X=0\nimmediately (definitely not at EOF \u2014 no network call needed).\nIf the hint bit is set, sends FS command &11 (FCEOF) to query\nthe fileserver for definitive EOF status. Returns X=&FF if at\nEOF, X=&00 if not. This two-level check avoids an expensive\nnetwork round-trip when the file is known to not be at EOF.", "***************************************************************************************"], "type": "code", "mnemonic": "pha"}, {"addr": 34848, "bytes": [132, 188], "type": "code", "mnemonic": "sty", "operand": "fs_block_offset", "target": 188, "target_label": "fs_block_offset"}, {"addr": 34850, "bytes": [32, 137, 133], "type": "code", "mnemonic": "jsr", "operand": "handle_to_mask_clc", "target": 34185, "target_label": "handle_to_mask_clc"}, {"addr": 34853, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 34854, "bytes": [45, 7, 14], "type": "code", "mnemonic": "and", "operand": "fs_eof_flags", "target": 3591, "target_label": "fs_eof_flags"}, {"addr": 34857, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 34858, "bytes": [240, 20], "type": "code", "mnemonic": "beq", "operand": "c8840", "target": 34880, "target_label": "c8840"}, {"addr": 34860, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 34861, "bytes": [140, 5, 15], "type": "code", "mnemonic": "sty", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 34864, "bytes": [160, 17], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#&11"}, {"addr": 34866, "bytes": [162, 1], "comment_inline": "X=preserved through header build", "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 34868, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 34871, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 34872, "bytes": [174, 5, 15], "type": "code", "mnemonic": "ldx", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 34875, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "c8840", "target": 34880, "target_label": "c8840"}, {"addr": 34877, "bytes": [32, 223, 133], "type": "code", "mnemonic": "jsr", "operand": "clear_fs_flag", "target": 34271, "target_label": "clear_fs_flag"}, {"addr": 34880, "bytes": [104], "labels": ["c8840"], "comments_before": ["&8840 referenced 4 times by &87cc, &8812, &882a, &883b"], "references": [34764, 34858, 34875, 34834], "type": "code", "mnemonic": "pla"}, {"addr": 34881, "bytes": [164, 188], "type": "code", "mnemonic": "ldy", "operand": "fs_block_offset", "target": 188, "target_label": "fs_block_offset"}, {"addr": 34883, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 34884, "bytes": [141, 5, 15], "labels": ["filev_attrib_dispatch"], "comments_before": ["***************************************************************************************", "FILEV attribute dispatch (A=1-6)\n\nDispatches OSFILE operations by function code:\n  A=1: write catalogue info (load/exec/length/attrs) \u2014 FS &14\n  A=2: write load address only\n  A=3: write exec address only\n  A=4: write file attributes\n  A=5: read catalogue info, returns type in A \u2014 FS &12\n  A=6: delete named object \u2014 FS &14 (FCDEL)\n  A>=7: falls through to restore_args_return (no-op)\nEach handler builds the appropriate FS command, sends it to\nthe fileserver, and copies the reply into the parameter block.\nThe control block layout uses dual-purpose fields: the 'data\nstart' field doubles as 'length' and 'data end' doubles as\n'protection' depending on whether reading or writing attrs.", "***************************************************************************************", "&8844 referenced 1 time by &8743"], "references": [34627], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 34887, "bytes": [201, 6], "type": "code", "mnemonic": "cmp", "operand": "#6"}, {"addr": 34889, "bytes": [240, 63], "type": "code", "mnemonic": "beq", "operand": "cha6", "target": 34954, "target_label": "cha6"}, {"addr": 34891, "bytes": [176, 72], "type": "code", "mnemonic": "bcs", "operand": "c8895", "target": 34965, "target_label": "c8895"}, {"addr": 34893, "bytes": [201, 5], "type": "code", "mnemonic": "cmp", "operand": "#5"}, {"addr": 34895, "bytes": [240, 82], "type": "code", "mnemonic": "beq", "operand": "cha5", "target": 34979, "target_label": "cha5"}, {"addr": 34897, "bytes": [201, 4], "type": "code", "mnemonic": "cmp", "operand": "#4"}, {"addr": 34899, "bytes": [240, 68], "type": "code", "mnemonic": "beq", "operand": "cha4", "target": 34969, "target_label": "cha4"}, {"addr": 34901, "bytes": [201, 1], "type": "code", "mnemonic": "cmp", "operand": "#1"}, {"addr": 34903, "bytes": [240, 21], "type": "code", "mnemonic": "beq", "operand": "get_file_protection", "target": 34926, "target_label": "get_file_protection"}, {"addr": 34905, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 34906, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 34907, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 34908, "bytes": [32, 171, 132], "type": "code", "mnemonic": "jsr", "operand": "sub_3_from_y", "target": 33963, "target_label": "sub_3_from_y"}, {"addr": 34911, "bytes": [162, 3], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 34913, "bytes": [177, 187], "labels": ["chalp1"], "comments_before": ["&8861 referenced 1 time by &8868"], "references": [34920], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34915, "bytes": [157, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06,x", "target": 3846, "target_label": "l0f06"}, {"addr": 34918, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34919, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34920, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "chalp1", "target": 34913, "target_label": "chalp1"}, {"addr": 34922, "bytes": [162, 5], "type": "code", "mnemonic": "ldx", "operand": "#5"}, {"addr": 34924, "bytes": [208, 21], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "copy_filename_to_cmd", "target": 34947, "target_label": "copy_filename_to_cmd"}, {"addr": 34926, "bytes": [32, 19, 133], "labels": ["get_file_protection"], "comments_before": ["&886e referenced 1 time by &8857"], "references": [34903], "type": "code", "mnemonic": "jsr", "operand": "decode_attribs_6bit", "target": 34067, "target_label": "decode_attribs_6bit"}, {"addr": 34929, "bytes": [141, 14, 15], "type": "code", "mnemonic": "sta", "operand": "l0f0e", "target": 3854, "target_label": "l0f0e"}, {"addr": 34932, "bytes": [160, 9], "type": "code", "mnemonic": "ldy", "operand": "#9"}, {"addr": 34934, "bytes": [162, 8], "type": "code", "mnemonic": "ldx", "operand": "#8"}, {"addr": 34936, "bytes": [177, 187], "labels": ["chalp2"], "comments_before": ["&8878 referenced 1 time by &887f"], "references": [34943], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 34938, "bytes": [157, 5, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 34941, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 34942, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 34943, "bytes": [208, 247], "type": "code", "mnemonic": "bne", "operand": "chalp2", "target": 34936, "target_label": "chalp2"}, {"addr": 34945, "bytes": [162, 10], "type": "code", "mnemonic": "ldx", "operand": "#&0a"}, {"addr": 34947, "bytes": [32, 101, 141], "labels": ["copy_filename_to_cmd"], "comments_before": ["&8883 referenced 2 times by &886c, &88a1"], "references": [34977, 34924], "type": "code", "mnemonic": "jsr", "operand": "copy_string_to_cmd", "target": 36197, "target_label": "copy_string_to_cmd"}, {"addr": 34950, "bytes": [160, 19], "type": "code", "mnemonic": "ldy", "operand": "#&13"}, {"addr": 34952, "bytes": [208, 5], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c888f", "target": 34959, "target_label": "c888f"}, {"addr": 34954, "bytes": [32, 99, 141], "labels": ["cha6"], "comments_before": ["&888a referenced 1 time by &8849"], "references": [34889], "type": "code", "mnemonic": "jsr", "operand": "copy_filename", "target": 36195, "target_label": "copy_filename"}, {"addr": 34957, "bytes": [160, 20], "type": "code", "mnemonic": "ldy", "operand": "#&14"}, {"addr": 34959, "bytes": [44, 58, 131], "labels": ["c888f"], "comments_before": ["&888f referenced 1 time by &8888"], "references": [34952], "type": "code", "mnemonic": "bit", "operand": "l833a", "target": 33594, "target_label": "l833a"}, {"addr": 34962, "bytes": [32, 81, 131], "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd_v", "target": 33617, "target_label": "prepare_fs_cmd_v"}, {"addr": 34965, "bytes": [176, 72], "labels": ["c8895"], "comments_before": ["&8895 referenced 1 time by &884b"], "references": [34891], "type": "code", "mnemonic": "bcs", "operand": "c88df", "target": 35039, "target_label": "c88df"}, {"addr": 34967, "bytes": [144, 119], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcc", "operand": "c8910", "target": 35088, "target_label": "c8910"}, {"addr": 34969, "bytes": [32, 19, 133], "labels": ["cha4"], "comments_before": ["&8899 referenced 1 time by &8853"], "references": [34899], "type": "code", "mnemonic": "jsr", "operand": "decode_attribs_6bit", "target": 34067, "target_label": "decode_attribs_6bit"}, {"addr": 34972, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 34975, "bytes": [162, 2], "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 34977, "bytes": [208, 224], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "copy_filename_to_cmd", "target": 34947, "target_label": "copy_filename_to_cmd"}, {"addr": 34979, "bytes": [162, 1], "labels": ["cha5"], "comments_before": ["&88a3 referenced 1 time by &884f"], "references": [34895], "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 34981, "bytes": [32, 101, 141], "type": "code", "mnemonic": "jsr", "operand": "copy_string_to_cmd", "target": 36197, "target_label": "copy_string_to_cmd"}, {"addr": 34984, "bytes": [160, 18], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#&12"}, {"addr": 34986, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 34989, "bytes": [173, 17, 15], "type": "code", "mnemonic": "lda", "operand": "l0f11", "target": 3857, "target_label": "l0f11"}, {"addr": 34992, "bytes": [142, 17, 15], "comment_inline": "X=0 on success, &D6 on not-found", "type": "code", "mnemonic": "stx", "operand": "l0f11", "target": 3857, "target_label": "l0f11"}, {"addr": 34995, "bytes": [142, 20, 15], "type": "code", "mnemonic": "stx", "operand": "l0f14", "target": 3860, "target_label": "l0f14"}, {"addr": 34998, "bytes": [32, 29, 133], "type": "code", "mnemonic": "jsr", "operand": "decode_attribs_5bit", "target": 34077, "target_label": "decode_attribs_5bit"}, {"addr": 35001, "bytes": [174, 5, 15], "type": "code", "mnemonic": "ldx", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35004, "bytes": [240, 32], "type": "code", "mnemonic": "beq", "operand": "c88de", "target": 35038, "target_label": "c88de"}, {"addr": 35006, "bytes": [160, 14], "type": "code", "mnemonic": "ldy", "operand": "#&0e"}, {"addr": 35008, "bytes": [145, 187], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35010, "bytes": [136], "comment_inline": "Y=&0d", "type": "code", "mnemonic": "dey"}, {"addr": 35011, "bytes": [162, 12], "type": "code", "mnemonic": "ldx", "operand": "#&0c"}, {"addr": 35013, "bytes": [189, 5, 15], "labels": ["copy_fs_reply_to_cb"], "comments_before": ["&88c5 referenced 1 time by &88cc"], "references": [35020], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35016, "bytes": [145, 187], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35018, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35019, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35020, "bytes": [208, 247], "type": "code", "mnemonic": "bne", "operand": "copy_fs_reply_to_cb", "target": 35013, "target_label": "copy_fs_reply_to_cb"}, {"addr": 35022, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35023, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35024, "bytes": [160, 17], "type": "code", "mnemonic": "ldy", "operand": "#&11"}, {"addr": 35026, "bytes": [189, 18, 15], "labels": ["cha5lp"], "comments_before": ["&88d2 referenced 1 time by &88d9"], "references": [35033], "type": "code", "mnemonic": "lda", "operand": "l0f12,x", "target": 3858, "target_label": "l0f12"}, {"addr": 35029, "bytes": [145, 187], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35031, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35032, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35033, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "cha5lp", "target": 35026, "target_label": "cha5lp"}, {"addr": 35035, "bytes": [174, 5, 15], "type": "code", "mnemonic": "ldx", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35038, "bytes": [138], "labels": ["c88de"], "comments_before": ["&88de referenced 1 time by &88bc"], "references": [35004], "type": "code", "mnemonic": "txa"}, {"addr": 35039, "bytes": [16, 77], "labels": ["c88df"], "comments_before": ["&88df referenced 1 time by &8895"], "references": [34965], "type": "code", "mnemonic": "bpl", "operand": "c892e", "target": 35118, "target_label": "c892e"}, {"addr": 35041, "bytes": [32, 8, 133], "labels": ["argsv_handler"], "comments_before": ["***************************************************************************************", "ARGSV handler (OSARGS entry point)\n\n  A=0, Y=0: return filing system number (10 = network FS)\n  A=0, Y>0: read file pointer via FS command &0A (FCRDSE)\n  A=1, Y>0: write file pointer via FS command &14 (FCWRSE)\n  A>=3 (ensure): silently returns -- NFS has no local write buffer\n     to flush, since all data is sent to the fileserver immediately\nThe handle in Y is converted via handle_to_mask_clc. For writes\n(A=1), the carry flag from the mask conversion is used to branch\nto save_args_handle, which records the handle for later use.\n\nOn Entry:\n    A: function code (0=query, 1=write ptr, >=3=ensure)\n    Y: file handle (0=FS-level query, >0=per-file)\n\nOn Exit:\n    A: filing system number if A=0/Y=0 query, else restored\n    X: restored\n    Y: restored", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "save_fscv_args", "target": 34056, "target_label": "save_fscv_args"}, {"addr": 35044, "bytes": [201, 3], "type": "code", "mnemonic": "cmp", "operand": "#3"}, {"addr": 35046, "bytes": [176, 68], "type": "code", "mnemonic": "bcs", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 35048, "bytes": [192, 0], "type": "code", "mnemonic": "cpy", "operand": "#0"}, {"addr": 35050, "bytes": [240, 71], "type": "code", "mnemonic": "beq", "operand": "c8933", "target": 35123, "target_label": "c8933"}, {"addr": 35052, "bytes": [32, 137, 133], "type": "code", "mnemonic": "jsr", "operand": "handle_to_mask_clc", "target": 34185, "target_label": "handle_to_mask_clc"}, {"addr": 35055, "bytes": [140, 5, 15], "type": "code", "mnemonic": "sty", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35058, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 35059, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35062, "bytes": [176, 26], "type": "code", "mnemonic": "bcs", "operand": "save_args_handle", "target": 35090, "target_label": "save_args_handle"}, {"addr": 35064, "bytes": [160, 12], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#&0c"}, {"addr": 35066, "bytes": [162, 2], "comment_inline": "X=preserved through header build", "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 35068, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35071, "bytes": [133, 189], "comment_inline": "A=0 on success (from build_send_fs_cmd)", "type": "code", "mnemonic": "sta", "operand": "fs_last_byte_flag", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 35073, "bytes": [166, 187], "type": "code", "mnemonic": "ldx", "operand": "fs_options", "target": 187, "target_label": "fs_options"}, {"addr": 35075, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 35077, "bytes": [149, 3], "type": "code", "mnemonic": "sta", "operand": "l0003,x", "target": 3, "target_label": "l0003"}, {"addr": 35079, "bytes": [185, 5, 15], "labels": ["loop_c8907"], "comments_before": ["&8907 referenced 1 time by &890e"], "references": [35086], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data,y", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35082, "bytes": [149, 2], "type": "code", "mnemonic": "sta", "operand": "l0002,x", "target": 2, "target_label": "l0002"}, {"addr": 35084, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35085, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35086, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "loop_c8907", "target": 35079, "target_label": "loop_c8907"}, {"addr": 35088, "bytes": [144, 26], "labels": ["c8910"], "comments_before": ["&8910 referenced 1 time by &8897"], "references": [34967], "type": "code", "mnemonic": "bcc", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 35090, "bytes": [152], "labels": ["save_args_handle"], "comments_before": ["&8912 referenced 1 time by &88f6"], "references": [35062], "type": "code", "mnemonic": "tya"}, {"addr": 35091, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 35092, "bytes": [160, 3], "type": "code", "mnemonic": "ldy", "operand": "#3"}, {"addr": 35094, "bytes": [181, 3], "labels": ["loop_c8916"], "comments_before": ["&8916 referenced 1 time by &891d"], "references": [35101], "type": "code", "mnemonic": "lda", "operand": "l0003,x", "target": 3, "target_label": "l0003"}, {"addr": 35096, "bytes": [153, 7, 15], "type": "code", "mnemonic": "sta", "operand": "l0f07,y", "target": 3847, "target_label": "l0f07"}, {"addr": 35099, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35100, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35101, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "loop_c8916", "target": 35094, "target_label": "loop_c8916"}, {"addr": 35103, "bytes": [160, 13], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#&0d"}, {"addr": 35105, "bytes": [162, 5], "comment_inline": "X=preserved through header build", "type": "code", "mnemonic": "ldx", "operand": "#5"}, {"addr": 35107, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35110, "bytes": [134, 189], "comment_inline": "X=0 on success, &D6 on not-found", "type": "code", "mnemonic": "stx", "operand": "fs_last_byte_flag", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 35112, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 35113, "bytes": [32, 228, 133], "type": "code", "mnemonic": "jsr", "operand": "set_fs_flag", "target": 34276, "target_label": "set_fs_flag"}, {"addr": 35116, "bytes": [165, 189], "labels": ["restore_args_return"], "comments_before": ["***************************************************************************************", "Restore arguments and return\n\nCommon exit point for FS vector handlers. Reloads A from\nfs_last_byte_flag (&BD), X from fs_options (&BB), and Y from\nfs_block_offset (&BC) \u2014 the values saved at entry by\nsave_fscv_args \u2014 and returns to the caller.", "***************************************************************************************", "&892c referenced 8 times by &86c8, &87aa, &88e6, &8910, &893b, &899f, &89f5, &8cff"], "references": [36095, 35046, 35131, 35317, 35088, 35231, 34504, 34730], "type": "code", "mnemonic": "lda", "operand": "fs_last_byte_flag", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 35118, "bytes": [166, 187], "labels": ["c892e"], "comments_before": ["&892e referenced 5 times by &88df, &8938, &8947, &896f, &8983"], "references": [35128, 35039, 35143, 35183, 35203], "type": "code", "mnemonic": "ldx", "operand": "fs_options", "target": 187, "target_label": "fs_options"}, {"addr": 35120, "bytes": [164, 188], "type": "code", "mnemonic": "ldy", "operand": "fs_block_offset", "target": 188, "target_label": "fs_block_offset"}, {"addr": 35122, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 35123, "bytes": [168], "labels": ["c8933"], "comments_before": ["&8933 referenced 1 time by &88ea"], "references": [35050], "type": "code", "mnemonic": "tay"}, {"addr": 35124, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "c893a", "target": 35130, "target_label": "c893a"}, {"addr": 35126, "bytes": [169, 5], "type": "code", "mnemonic": "lda", "operand": "#5"}, {"addr": 35128, "bytes": [208, 244], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c892e", "target": 35118, "target_label": "c892e"}, {"addr": 35130, "bytes": [74], "labels": ["c893a"], "comments_before": ["&893a referenced 1 time by &8934"], "references": [35124], "type": "code", "mnemonic": "lsr"}, {"addr": 35131, "bytes": [208, 239], "type": "code", "mnemonic": "bne", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 35133, "bytes": [185, 11, 14], "labels": ["osarg1"], "comments_before": ["&893d referenced 1 time by &8943"], "references": [35139], "type": "code", "mnemonic": "lda", "operand": "l0e0b,y", "target": 3595, "target_label": "l0e0b"}, {"addr": 35136, "bytes": [145, 187], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35138, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35139, "bytes": [16, 248], "type": "code", "mnemonic": "bpl", "operand": "osarg1", "target": 35133, "target_label": "osarg1"}, {"addr": 35141, "bytes": [169, 0], "labels": ["c8945"], "comments_before": ["&8945 referenced 3 times by &8955, &8a95, &8b32"], "comment_inline": "A=operation (0=close, &40=read, &80=write, &C0=R/W)", "references": [35157, 35634, 35477], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 35143, "bytes": [16, 229], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bpl", "operand": "c892e", "target": 35118, "target_label": "c892e"}, {"addr": 35145, "bytes": [32, 8, 133], "labels": ["findv_handler"], "comments_before": ["***************************************************************************************", "FINDV handler (OSFIND entry point)\n\n  A=0: close file -- delegates to close_handle (&8985)\n  A>0: open file -- modes &40=read, &80=write/update, &C0=read/write\nFor open: the mode byte is converted to the fileserver's two-flag\nformat by flipping bit 7 (EOR #&80) and shifting. This produces\nFlag 1 (read/write direction) and Flag 2 (create/existing),\nmatching the fileserver protocol. After a successful open, the\nnew handle's bit is OR'd into the EOF hint byte (marks it as\n\"might be at EOF, query the server\"), and into the sequence\nnumber tracking byte for the byte-stream protocol.\n\nOn Entry:\n    A: operation (0=close, &40=read, &80=write, &C0=R/W)\n    X: filename pointer low (open)\n    Y: file handle (close) or filename pointer high (open)\n\nOn Exit:\n    A: handle on open, 0 on close-all, restored on close-one\n    X: restored\n    Y: restored", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "save_fscv_args", "target": 34056, "target_label": "save_fscv_args"}, {"addr": 35148, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 35149, "bytes": [32, 138, 133], "comment_inline": "Convert file handle to bitmask (Y2FS)", "type": "code", "mnemonic": "jsr", "operand": "handle_to_mask", "target": 34186, "target_label": "handle_to_mask"}, {"addr": 35152, "bytes": [170], "comment_inline": "A=preserved", "type": "code", "mnemonic": "tax"}, {"addr": 35153, "bytes": [240, 50], "type": "code", "mnemonic": "beq", "operand": "close_handle", "target": 35205, "target_label": "close_handle"}, {"addr": 35155, "bytes": [41, 63], "type": "code", "mnemonic": "and", "operand": "#&3f"}, {"addr": 35157, "bytes": [208, 238], "type": "code", "mnemonic": "bne", "operand": "c8945", "target": 35141, "target_label": "c8945"}, {"addr": 35159, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 35160, "bytes": [73, 128], "type": "code", "mnemonic": "eor", "operand": "#&80"}, {"addr": 35162, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 35163, "bytes": [141, 5, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35166, "bytes": [42], "type": "code", "mnemonic": "rol"}, {"addr": 35167, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35170, "bytes": [162, 2], "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 35172, "bytes": [32, 101, 141], "type": "code", "mnemonic": "jsr", "operand": "copy_string_to_cmd", "target": 36197, "target_label": "copy_string_to_cmd"}, {"addr": 35175, "bytes": [160, 6], "type": "code", "mnemonic": "ldy", "operand": "#6"}, {"addr": 35177, "bytes": [44, 58, 131], "type": "code", "mnemonic": "bit", "operand": "l833a", "target": 33594, "target_label": "l833a"}, {"addr": 35180, "bytes": [32, 81, 131], "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd_v", "target": 33617, "target_label": "prepare_fs_cmd_v"}, {"addr": 35183, "bytes": [176, 189], "type": "code", "mnemonic": "bcs", "operand": "c892e", "target": 35118, "target_label": "c892e"}, {"addr": 35185, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35188, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 35189, "bytes": [32, 228, 133], "type": "code", "mnemonic": "jsr", "operand": "set_fs_flag", "target": 34276, "target_label": "set_fs_flag"}, {"addr": 35192, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 35193, "bytes": [13, 8, 14], "type": "code", "mnemonic": "ora", "operand": "fs_sequence_nos", "target": 3592, "target_label": "fs_sequence_nos"}, {"addr": 35196, "bytes": [141, 8, 14], "type": "code", "mnemonic": "sta", "operand": "fs_sequence_nos", "target": 3592, "target_label": "fs_sequence_nos"}, {"addr": 35199, "bytes": [138], "comment_inline": "A=single-bit bitmask", "type": "code", "mnemonic": "txa"}, {"addr": 35200, "bytes": [32, 165, 133], "comment_inline": "Convert bitmask to handle number (FS2A)", "type": "code", "mnemonic": "jsr", "operand": "mask_to_handle", "target": 34213, "target_label": "mask_to_handle"}, {"addr": 35203, "bytes": [208, 169], "type": "code", "mnemonic": "bne", "operand": "c892e", "target": 35118, "target_label": "c892e"}, {"addr": 35205, "bytes": [152], "labels": ["close_handle"], "comments_before": ["***************************************************************************************", "Close file handle(s) (CLOSE)\n\n  Y=0: close all files \u2014 first calls OSBYTE &77 (close SPOOL and\n       EXEC files) to coordinate with the MOS before sending the\n       close-all command to the fileserver. This ensures locally-\n       managed file handles are released before the server-side\n       handles are invalidated, preventing the MOS from writing to\n       a closed spool file.\n  Y>0: close single handle \u2014 sends FS close command and clears\n       the handle's bit in both the EOF hint byte and the sequence\n       number tracking byte.", "***************************************************************************************", "&8985 referenced 1 time by &8951"], "comment_inline": "Y=preserved", "references": [35153], "type": "code", "mnemonic": "tya"}, {"addr": 35206, "bytes": [208, 7], "type": "code", "mnemonic": "bne", "operand": "close_single_handle", "target": 35215, "target_label": "close_single_handle"}, {"addr": 35208, "bytes": [169, 119], "type": "code", "mnemonic": "lda", "operand": "#osbyte_close_spool_exec"}, {"addr": 35210, "bytes": [32, 244, 255], "comment_inline": "Close any *SPOOL and *EXEC files", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 35213, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 35215, "bytes": [140, 5, 15], "labels": ["close_single_handle"], "comments_before": ["&898f referenced 1 time by &8986"], "references": [35206], "type": "code", "mnemonic": "sty", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35218, "bytes": [162, 1], "comment_inline": "X=preserved through header build", "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 35220, "bytes": [160, 7], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#7"}, {"addr": 35222, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35225, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35228, "bytes": [32, 228, 133], "type": "code", "mnemonic": "jsr", "operand": "set_fs_flag", "target": 34276, "target_label": "set_fs_flag"}, {"addr": 35231, "bytes": [144, 139], "labels": ["c899f"], "comments_before": ["&899f referenced 1 time by &89c8"], "references": [35272], "type": "code", "mnemonic": "bcc", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 35233, "bytes": [224, 4], "labels": ["opt_handler"], "comments_before": ["***************************************************************************************", "FSCV 0: *OPT handler (OPTION)\n\nHandles *OPT X,Y to set filing system options:\n  *OPT 1,Y (Y=0/1): set local user option in &0E06 (OPT)\n  *OPT 4,Y (Y=0-3): set boot option via FS command &16 (FCOPT)\nOther combinations generate error &CB (OPTER: \"bad option\").", "***************************************************************************************"], "type": "code", "mnemonic": "cpx", "operand": "#4"}, {"addr": 35235, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "c89a9", "target": 35241, "target_label": "c89a9"}, {"addr": 35237, "bytes": [192, 4], "type": "code", "mnemonic": "cpy", "operand": "#4"}, {"addr": 35239, "bytes": [144, 18], "type": "code", "mnemonic": "bcc", "operand": "optl1", "target": 35259, "target_label": "optl1"}, {"addr": 35241, "bytes": [224, 1], "labels": ["c89a9"], "comments_before": ["&89a9 referenced 1 time by &89a3"], "references": [35235], "type": "code", "mnemonic": "cpx", "operand": "#1"}, {"addr": 35243, "bytes": [208, 9], "type": "code", "mnemonic": "bne", "operand": "opter1", "target": 35254, "target_label": "opter1"}, {"addr": 35245, "bytes": [192, 2], "type": "code", "mnemonic": "cpy", "operand": "#2"}, {"addr": 35247, "bytes": [176, 5], "type": "code", "mnemonic": "bcs", "operand": "opter1", "target": 35254, "target_label": "opter1"}, {"addr": 35249, "bytes": [140, 6, 14], "type": "code", "mnemonic": "sty", "operand": "fs_messages_flag", "target": 3590, "target_label": "fs_messages_flag"}, {"addr": 35252, "bytes": [144, 18], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcc", "operand": "c89c8", "target": 35272, "target_label": "c89c8"}, {"addr": 35254, "bytes": [169, 7], "labels": ["opter1"], "comments_before": ["&89b6 referenced 2 times by &89ab, &89af"], "references": [35243, 35247], "type": "code", "mnemonic": "lda", "operand": "#7"}, {"addr": 35256, "bytes": [76, 42, 132], "type": "code", "mnemonic": "jmp", "operand": "nlisne", "target": 33834, "target_label": "nlisne"}, {"addr": 35259, "bytes": [140, 5, 15], "labels": ["optl1"], "comments_before": ["&89bb referenced 1 time by &89a7"], "references": [35239], "type": "code", "mnemonic": "sty", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35262, "bytes": [160, 22], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#&16"}, {"addr": 35264, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35267, "bytes": [164, 188], "type": "code", "mnemonic": "ldy", "operand": "fs_block_offset", "target": 188, "target_label": "fs_block_offset"}, {"addr": 35269, "bytes": [140, 5, 14], "type": "code", "mnemonic": "sty", "operand": "fs_boot_option", "target": 3589, "target_label": "fs_boot_option"}, {"addr": 35272, "bytes": [144, 213], "labels": ["c89c8"], "comments_before": ["&89c8 referenced 1 time by &89b4"], "references": [35252], "type": "code", "mnemonic": "bcc", "operand": "c899f", "target": 35231, "target_label": "c899f"}, {"addr": 35274, "bytes": [160, 9], "labels": ["adjust_addrs_9"], "comments_before": ["&89ca referenced 1 time by &8a89"], "references": [35465], "type": "code", "mnemonic": "ldy", "operand": "#9"}, {"addr": 35276, "bytes": [32, 209, 137], "type": "code", "mnemonic": "jsr", "operand": "adjust_addrs_clc", "target": 35281, "target_label": "adjust_addrs_clc"}, {"addr": 35279, "bytes": [160, 1], "labels": ["adjust_addrs_1"], "comments_before": ["&89cf referenced 1 time by &8b79"], "references": [35705], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 35281, "bytes": [24], "labels": ["adjust_addrs_clc"], "comments_before": ["&89d1 referenced 1 time by &89cc"], "references": [35276], "type": "code", "mnemonic": "clc"}, {"addr": 35282, "bytes": [162, 252], "labels": ["adjust_addrs"], "comments_before": ["***************************************************************************************", "Bidirectional 4-byte address adjustment\n\nAdjusts a 4-byte value in the parameter block at (fs_options)+Y:\n  If fs_load_addr_2 (&B2) is positive: adds fs_lib_handle+X values\n  If fs_load_addr_2 (&B2) is negative: subtracts fs_lib_handle+X\nStarting offset X=&FC means it reads from &0E06-&0E09 area.\nUsed to convert between absolute and relative file positions.", "***************************************************************************************", "&89d2 referenced 2 times by &8a8f, &8b85"], "references": [35717, 35471], "type": "code", "mnemonic": "ldx", "operand": "#&fc"}, {"addr": 35284, "bytes": [177, 187], "labels": ["loop_c89d4"], "comments_before": ["&89d4 referenced 1 time by &89e7"], "references": [35303], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35286, "bytes": [36, 178], "type": "code", "mnemonic": "bit", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35288, "bytes": [48, 6], "type": "code", "mnemonic": "bmi", "operand": "c89e0", "target": 35296, "target_label": "c89e0"}, {"addr": 35290, "bytes": [125, 10, 14], "type": "code", "mnemonic": "adc", "operand": "fs_cmd_context,x", "target": 3594, "target_label": "fs_cmd_context"}, {"addr": 35293, "bytes": [76, 227, 137], "type": "code", "mnemonic": "jmp", "operand": "gbpbx", "target": 35299, "target_label": "gbpbx"}, {"addr": 35296, "bytes": [253, 10, 14], "labels": ["c89e0"], "comments_before": ["&89e0 referenced 1 time by &89d8"], "references": [35288], "type": "code", "mnemonic": "sbc", "operand": "fs_cmd_context,x", "target": 3594, "target_label": "fs_cmd_context"}, {"addr": 35299, "bytes": [145, 187], "labels": ["gbpbx"], "comments_before": ["&89e3 referenced 1 time by &89dd"], "references": [35293], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35301, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 35302, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35303, "bytes": [208, 235], "type": "code", "mnemonic": "bne", "operand": "loop_c89d4", "target": 35284, "target_label": "loop_c89d4"}, {"addr": 35305, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 35306, "bytes": [32, 8, 133], "labels": ["gbpbv_handler"], "comments_before": ["***************************************************************************************", "GBPBV handler (OSGBPB entry point)\n\n  A=1-4: file read/write operations (handle-based)\n  A=5-8: info queries (disc title, current dir, lib, filenames)\nCalls 1-4 are standard file data transfers via the fileserver.\nCalls 5-8 were a late addition to the MOS spec and are the only\nNFS operations requiring Tube data transfer -- described in the\noriginal source as \"untidy but useful in theory.\" The data format\nuses length-prefixed strings (<name length><object name>) rather\nthan the CR-terminated strings used elsewhere in the FS.\n\nOn Entry:\n    A: call number (1-8)\n    X: parameter block address low byte\n    Y: parameter block address high byte\n\nOn Exit:\n    A: 0 after FS operation, else restored\n    X: restored\n    Y: restored", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "save_fscv_args", "target": 34056, "target_label": "save_fscv_args"}, {"addr": 35309, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 35310, "bytes": [240, 5], "type": "code", "mnemonic": "beq", "operand": "gbpbx0", "target": 35317, "target_label": "gbpbx0"}, {"addr": 35312, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35313, "bytes": [224, 8], "type": "code", "mnemonic": "cpx", "operand": "#8"}, {"addr": 35315, "bytes": [144, 3], "type": "code", "mnemonic": "bcc", "operand": "gbpbx1", "target": 35320, "target_label": "gbpbx1"}, {"addr": 35317, "bytes": [76, 44, 137], "labels": ["gbpbx0"], "comments_before": ["&89f5 referenced 1 time by &89ee"], "references": [35310], "type": "code", "mnemonic": "jmp", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 35320, "bytes": [138], "labels": ["gbpbx1"], "comments_before": ["&89f8 referenced 1 time by &89f3"], "references": [35315], "type": "code", "mnemonic": "txa"}, {"addr": 35321, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 35323, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 35324, "bytes": [201, 4], "type": "code", "mnemonic": "cmp", "operand": "#4"}, {"addr": 35326, "bytes": [144, 3], "type": "code", "mnemonic": "bcc", "operand": "gbpbe1", "target": 35331, "target_label": "gbpbe1"}, {"addr": 35328, "bytes": [76, 173, 138], "type": "code", "mnemonic": "jmp", "operand": "osgbpb_info", "target": 35501, "target_label": "osgbpb_info"}, {"addr": 35331, "bytes": [177, 187], "labels": ["gbpbe1"], "comments_before": ["&8a03 referenced 1 time by &89fe"], "references": [35326], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35333, "bytes": [32, 136, 133], "type": "code", "mnemonic": "jsr", "operand": "handle_to_mask_a", "target": 34184, "target_label": "handle_to_mask_a"}, {"addr": 35336, "bytes": [140, 5, 15], "type": "code", "mnemonic": "sty", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35339, "bytes": [160, 11], "type": "code", "mnemonic": "ldy", "operand": "#&0b"}, {"addr": 35341, "bytes": [162, 6], "type": "code", "mnemonic": "ldx", "operand": "#6"}, {"addr": 35343, "bytes": [177, 187], "labels": ["gbpbf1"], "comments_before": ["&8a0f referenced 1 time by &8a1b"], "references": [35355], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35345, "bytes": [157, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06,x", "target": 3846, "target_label": "l0f06"}, {"addr": 35348, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35349, "bytes": [192, 8], "type": "code", "mnemonic": "cpy", "operand": "#8"}, {"addr": 35351, "bytes": [208, 1], "type": "code", "mnemonic": "bne", "operand": "gbpbf2", "target": 35354, "target_label": "gbpbf2"}, {"addr": 35353, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35354, "bytes": [202], "labels": ["gbpbf2"], "comments_before": ["&8a1a referenced 1 time by &8a17"], "references": [35351], "type": "code", "mnemonic": "dex"}, {"addr": 35355, "bytes": [208, 242], "type": "code", "mnemonic": "bne", "operand": "gbpbf1", "target": 35343, "target_label": "gbpbf1"}, {"addr": 35357, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 35358, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 35359, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 35360, "bytes": [144, 1], "type": "code", "mnemonic": "bcc", "operand": "gbpbl1", "target": 35363, "target_label": "gbpbl1"}, {"addr": 35362, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35363, "bytes": [142, 6, 15], "labels": ["gbpbl1"], "comments_before": ["&8a23 referenced 1 time by &8a20"], "references": [35360], "type": "code", "mnemonic": "stx", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35366, "bytes": [160, 11], "type": "code", "mnemonic": "ldy", "operand": "#&0b"}, {"addr": 35368, "bytes": [162, 145], "type": "code", "mnemonic": "ldx", "operand": "#&91"}, {"addr": 35370, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 35371, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 35372, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "c8a31", "target": 35377, "target_label": "c8a31"}, {"addr": 35374, "bytes": [162, 146], "type": "code", "mnemonic": "ldx", "operand": "#&92"}, {"addr": 35376, "bytes": [136], "comment_inline": "Y=&0a", "type": "code", "mnemonic": "dey"}, {"addr": 35377, "bytes": [142, 2, 15], "labels": ["c8a31"], "comments_before": ["&8a31 referenced 1 time by &8a2c"], "references": [35372], "type": "code", "mnemonic": "stx", "operand": "fs_cmd_urd", "target": 3842, "target_label": "fs_cmd_urd"}, {"addr": 35380, "bytes": [134, 184], "type": "code", "mnemonic": "stx", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 35382, "bytes": [162, 8], "type": "code", "mnemonic": "ldx", "operand": "#8"}, {"addr": 35384, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35387, "bytes": [32, 64, 131], "type": "code", "mnemonic": "jsr", "operand": "prepare_cmd_with_flag", "target": 33600, "target_label": "prepare_cmd_with_flag"}, {"addr": 35390, "bytes": [165, 179], "type": "code", "mnemonic": "lda", "operand": "l00b3", "target": 179, "target_label": "l00b3"}, {"addr": 35392, "bytes": [141, 8, 14], "type": "code", "mnemonic": "sta", "operand": "fs_sequence_nos", "target": 3592, "target_label": "fs_sequence_nos"}, {"addr": 35395, "bytes": [162, 4], "type": "code", "mnemonic": "ldx", "operand": "#4"}, {"addr": 35397, "bytes": [177, 187], "labels": ["gbpbl3"], "comments_before": ["&8a45 referenced 1 time by &8a59"], "references": [35417], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35399, "bytes": [153, 175, 0], "type": "code", "mnemonic": "sta", "operand": "l00af,y", "target": 175, "target_label": "l00af"}, {"addr": 35402, "bytes": [153, 199, 0], "type": "code", "mnemonic": "sta", "operand": "l00c7,y", "target": 199, "target_label": "l00c7"}, {"addr": 35405, "bytes": [32, 165, 132], "type": "code", "mnemonic": "jsr", "operand": "add_4_to_y", "target": 33957, "target_label": "add_4_to_y"}, {"addr": 35408, "bytes": [113, 187], "type": "code", "mnemonic": "adc", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35410, "bytes": [153, 175, 0], "type": "code", "mnemonic": "sta", "operand": "l00af,y", "target": 175, "target_label": "l00af"}, {"addr": 35413, "bytes": [32, 171, 132], "type": "code", "mnemonic": "jsr", "operand": "sub_3_from_y", "target": 33963, "target_label": "sub_3_from_y"}, {"addr": 35416, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35417, "bytes": [208, 234], "type": "code", "mnemonic": "bne", "operand": "gbpbl3", "target": 35397, "target_label": "gbpbl3"}, {"addr": 35419, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35420, "bytes": [189, 3, 15], "labels": ["gbpbf3"], "comments_before": ["&8a5c referenced 1 time by &8a63"], "references": [35427], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_csd,x", "target": 3843, "target_label": "fs_cmd_csd"}, {"addr": 35423, "bytes": [157, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06,x", "target": 3846, "target_label": "l0f06"}, {"addr": 35426, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35427, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "gbpbf3", "target": 35420, "target_label": "gbpbf3"}, {"addr": 35429, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 35430, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "c8a70", "target": 35440, "target_label": "c8a70"}, {"addr": 35432, "bytes": [173, 2, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_urd", "target": 3842, "target_label": "fs_cmd_urd"}, {"addr": 35435, "bytes": [32, 200, 135], "type": "code", "mnemonic": "jsr", "operand": "transfer_file_blocks", "target": 34760, "target_label": "transfer_file_blocks"}, {"addr": 35438, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "c8a73", "target": 35443, "target_label": "c8a73"}, {"addr": 35440, "bytes": [32, 22, 135], "labels": ["c8a70"], "comments_before": ["&8a70 referenced 1 time by &8a66"], "references": [35430], "type": "code", "mnemonic": "jsr", "operand": "send_data_blocks", "target": 34582, "target_label": "send_data_blocks"}, {"addr": 35443, "bytes": [169, 42], "labels": ["c8a73"], "comments_before": ["&8a73 referenced 1 time by &8a6e"], "references": [35438], "type": "code", "mnemonic": "lda", "operand": "#&2a"}, {"addr": 35445, "bytes": [133, 184], "type": "code", "mnemonic": "sta", "operand": "fs_error_ptr", "target": 184, "target_label": "fs_error_ptr"}, {"addr": 35447, "bytes": [32, 128, 131], "type": "code", "mnemonic": "jsr", "operand": "send_fs_reply_cmd", "target": 33664, "target_label": "send_fs_reply_cmd"}, {"addr": 35450, "bytes": [161, 187], "type": "code", "mnemonic": "lda", "operand": "(fs_options,x)", "target": 187, "target_label": "fs_options"}, {"addr": 35452, "bytes": [44, 5, 15], "type": "code", "mnemonic": "bit", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35455, "bytes": [48, 3], "type": "code", "mnemonic": "bmi", "operand": "c8a84", "target": 35460, "target_label": "c8a84"}, {"addr": 35457, "bytes": [32, 223, 133], "type": "code", "mnemonic": "jsr", "operand": "clear_fs_flag", "target": 34271, "target_label": "clear_fs_flag"}, {"addr": 35460, "bytes": [32, 228, 133], "labels": ["c8a84"], "comments_before": ["&8a84 referenced 1 time by &8a7f"], "references": [35455], "type": "code", "mnemonic": "jsr", "operand": "set_fs_flag", "target": 34276, "target_label": "set_fs_flag"}, {"addr": 35463, "bytes": [134, 178], "type": "code", "mnemonic": "stx", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35465, "bytes": [32, 202, 137], "type": "code", "mnemonic": "jsr", "operand": "adjust_addrs_9", "target": 35274, "target_label": "adjust_addrs_9"}, {"addr": 35468, "bytes": [198, 178], "type": "code", "mnemonic": "dec", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35470, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 35471, "bytes": [32, 210, 137], "type": "code", "mnemonic": "jsr", "operand": "adjust_addrs", "target": 35282, "target_label": "adjust_addrs"}, {"addr": 35474, "bytes": [14, 5, 15], "type": "code", "mnemonic": "asl", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35477, "bytes": [76, 69, 137], "type": "code", "mnemonic": "jmp", "operand": "c8945", "target": 35141, "target_label": "c8945"}, {"addr": 35480, "bytes": [160, 21], "labels": ["c8a98"], "comments_before": ["&8a98 referenced 1 time by &8ac8"], "comment_inline": "Y=function code for HDRFN", "references": [35528], "type": "code", "mnemonic": "ldy", "operand": "#&15"}, {"addr": 35482, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35485, "bytes": [173, 5, 14], "type": "code", "mnemonic": "lda", "operand": "fs_boot_option", "target": 3589, "target_label": "fs_boot_option"}, {"addr": 35488, "bytes": [141, 22, 15], "type": "code", "mnemonic": "sta", "operand": "l0f16", "target": 3862, "target_label": "l0f16"}, {"addr": 35491, "bytes": [134, 176], "comment_inline": "X=0 on success, &D6 on not-found", "type": "code", "mnemonic": "stx", "operand": "fs_load_addr", "target": 176, "target_label": "fs_load_addr"}, {"addr": 35493, "bytes": [134, 177], "type": "code", "mnemonic": "stx", "operand": "fs_load_addr_hi", "target": 177, "target_label": "fs_load_addr_hi"}, {"addr": 35495, "bytes": [169, 18], "type": "code", "mnemonic": "lda", "operand": "#&12"}, {"addr": 35497, "bytes": [133, 178], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35499, "bytes": [208, 78], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "copy_reply_to_caller", "target": 35579, "target_label": "copy_reply_to_caller"}, {"addr": 35501, "bytes": [160, 4], "labels": ["osgbpb_info"], "comments_before": ["***************************************************************************************", "OSGBPB 5-8 info handler (OSINFO)\n\nHandles the \"messy interface tacked onto OSGBPB\" (original source).\nChecks whether the destination address is in Tube space by comparing\nthe high bytes against TBFLAG. If in Tube space, data must be\ncopied via the Tube FIFO registers (with delays to accommodate the\nslow 16032 co-processor) instead of direct memory access.", "***************************************************************************************", "&8aad referenced 1 time by &8a00"], "references": [35328], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 35503, "bytes": [173, 82, 13], "type": "code", "mnemonic": "lda", "operand": "tx_in_progress", "target": 3410, "target_label": "tx_in_progress"}, {"addr": 35506, "bytes": [240, 7], "type": "code", "mnemonic": "beq", "operand": "c8abb", "target": 35515, "target_label": "c8abb"}, {"addr": 35508, "bytes": [209, 187], "type": "code", "mnemonic": "cmp", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35510, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "c8abb", "target": 35515, "target_label": "c8abb"}, {"addr": 35512, "bytes": [136], "comment_inline": "Y=&03", "type": "code", "mnemonic": "dey"}, {"addr": 35513, "bytes": [241, 187], "type": "code", "mnemonic": "sbc", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35515, "bytes": [133, 206], "labels": ["c8abb"], "comments_before": ["&8abb referenced 2 times by &8ab2, &8ab6"], "references": [35506, 35510], "type": "code", "mnemonic": "sta", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 35517, "bytes": [177, 187], "labels": ["info2"], "comments_before": ["&8abd referenced 1 time by &8ac3"], "references": [35523], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35519, "bytes": [153, 189, 0], "type": "code", "mnemonic": "sta", "operand": "fs_last_byte_flag,y", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 35522, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 35523, "bytes": [208, 248], "type": "code", "mnemonic": "bne", "operand": "info2", "target": 35517, "target_label": "info2"}, {"addr": 35525, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 35526, "bytes": [41, 3], "type": "code", "mnemonic": "and", "operand": "#3"}, {"addr": 35528, "bytes": [240, 206], "type": "code", "mnemonic": "beq", "operand": "c8a98", "target": 35480, "target_label": "c8a98"}, {"addr": 35530, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 35531, "bytes": [240, 2], "type": "code", "mnemonic": "beq", "operand": "c8acf", "target": 35535, "target_label": "c8acf"}, {"addr": 35533, "bytes": [176, 102], "type": "code", "mnemonic": "bcs", "operand": "c8b35", "target": 35637, "target_label": "c8b35"}, {"addr": 35535, "bytes": [168], "labels": ["c8acf"], "comments_before": ["&8acf referenced 1 time by &8acb"], "comment_inline": "Y=function code", "references": [35531], "type": "code", "mnemonic": "tay"}, {"addr": 35536, "bytes": [185, 3, 14], "type": "code", "mnemonic": "lda", "operand": "fs_csd_handle,y", "target": 3587, "target_label": "fs_csd_handle"}, {"addr": 35539, "bytes": [141, 3, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_csd", "target": 3843, "target_label": "fs_cmd_csd"}, {"addr": 35542, "bytes": [173, 4, 14], "type": "code", "mnemonic": "lda", "operand": "fs_lib_handle", "target": 3588, "target_label": "fs_lib_handle"}, {"addr": 35545, "bytes": [141, 4, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_lib", "target": 3844, "target_label": "fs_cmd_lib"}, {"addr": 35548, "bytes": [173, 2, 14], "type": "code", "mnemonic": "lda", "operand": "fs_urd_handle", "target": 3586, "target_label": "fs_urd_handle"}, {"addr": 35551, "bytes": [141, 2, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_urd", "target": 3842, "target_label": "fs_cmd_urd"}, {"addr": 35554, "bytes": [162, 18], "comment_inline": "X=buffer extent (command-specific data bytes)", "type": "code", "mnemonic": "ldx", "operand": "#&12"}, {"addr": 35556, "bytes": [142, 1, 15], "type": "code", "mnemonic": "stx", "operand": "fs_cmd_y_param", "target": 3841, "target_label": "fs_cmd_y_param"}, {"addr": 35559, "bytes": [169, 13], "type": "code", "mnemonic": "lda", "operand": "#&0d"}, {"addr": 35561, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35564, "bytes": [133, 178], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35566, "bytes": [74], "comment_inline": "A=timeout period for FS reply", "type": "code", "mnemonic": "lsr"}, {"addr": 35567, "bytes": [141, 5, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35570, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 35571, "bytes": [32, 106, 131], "comment_inline": "Build and send FS command (DOFSOP)", "type": "code", "mnemonic": "jsr", "operand": "build_send_fs_cmd", "target": 33642, "target_label": "build_send_fs_cmd"}, {"addr": 35574, "bytes": [134, 177], "comment_inline": "X=0 on success, &D6 on not-found", "type": "code", "mnemonic": "stx", "operand": "fs_load_addr_hi", "target": 177, "target_label": "fs_load_addr_hi"}, {"addr": 35576, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35577, "bytes": [134, 176], "type": "code", "mnemonic": "stx", "operand": "fs_load_addr", "target": 176, "target_label": "fs_load_addr"}, {"addr": 35579, "bytes": [165, 206], "labels": ["copy_reply_to_caller"], "comments_before": ["&8afb referenced 2 times by &8aab, &8b6e"], "references": [35499, 35694], "type": "code", "mnemonic": "lda", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 35581, "bytes": [208, 17], "type": "code", "mnemonic": "bne", "operand": "c8b10", "target": 35600, "target_label": "c8b10"}, {"addr": 35583, "bytes": [166, 176], "type": "code", "mnemonic": "ldx", "operand": "fs_load_addr", "target": 176, "target_label": "fs_load_addr"}, {"addr": 35585, "bytes": [164, 177], "type": "code", "mnemonic": "ldy", "operand": "fs_load_addr_hi", "target": 177, "target_label": "fs_load_addr_hi"}, {"addr": 35587, "bytes": [189, 5, 15], "labels": ["loop_c8b03"], "comments_before": ["&8b03 referenced 1 time by &8b0c"], "references": [35596], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35590, "bytes": [145, 190], "type": "code", "mnemonic": "sta", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 35592, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35593, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 35594, "bytes": [198, 178], "type": "code", "mnemonic": "dec", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35596, "bytes": [208, 245], "type": "code", "mnemonic": "bne", "operand": "loop_c8b03", "target": 35587, "target_label": "loop_c8b03"}, {"addr": 35598, "bytes": [240, 34], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "c8b32", "target": 35634, "target_label": "c8b32"}, {"addr": 35600, "bytes": [32, 138, 139], "labels": ["c8b10"], "comments_before": ["&8b10 referenced 1 time by &8afd"], "references": [35581], "type": "code", "mnemonic": "jsr", "operand": "tube_claim_loop", "target": 35722, "target_label": "tube_claim_loop"}, {"addr": 35603, "bytes": [169, 1], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 35605, "bytes": [166, 187], "type": "code", "mnemonic": "ldx", "operand": "fs_options", "target": 187, "target_label": "fs_options"}, {"addr": 35607, "bytes": [164, 188], "type": "code", "mnemonic": "ldy", "operand": "fs_block_offset", "target": 188, "target_label": "fs_block_offset"}, {"addr": 35609, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35610, "bytes": [208, 1], "type": "code", "mnemonic": "bne", "operand": "c8b1d", "target": 35613, "target_label": "c8b1d"}, {"addr": 35612, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 35613, "bytes": [32, 6, 4], "labels": ["c8b1d"], "comments_before": ["&8b1d referenced 1 time by &8b1a"], "references": [35610], "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 35616, "bytes": [166, 176], "type": "code", "mnemonic": "ldx", "operand": "fs_load_addr", "target": 176, "target_label": "fs_load_addr"}, {"addr": 35618, "bytes": [189, 5, 15], "labels": ["tbcop1"], "comments_before": ["&8b22 referenced 1 time by &8b2b"], "references": [35627], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35621, "bytes": [141, 229, 254], "type": "code", "mnemonic": "sta", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 35624, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35625, "bytes": [198, 178], "type": "code", "mnemonic": "dec", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35627, "bytes": [208, 245], "type": "code", "mnemonic": "bne", "operand": "tbcop1", "target": 35618, "target_label": "tbcop1"}, {"addr": 35629, "bytes": [169, 131], "type": "code", "mnemonic": "lda", "operand": "#&83"}, {"addr": 35631, "bytes": [32, 6, 4], "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 35634, "bytes": [76, 69, 137], "labels": ["c8b32"], "comments_before": ["&8b32 referenced 2 times by &8b0e, &8b88"], "references": [35598, 35720], "type": "code", "mnemonic": "jmp", "operand": "c8945", "target": 35141, "target_label": "c8945"}, {"addr": 35637, "bytes": [160, 9], "labels": ["c8b35"], "comments_before": ["&8b35 referenced 1 time by &8acd"], "references": [35533], "type": "code", "mnemonic": "ldy", "operand": "#9"}, {"addr": 35639, "bytes": [177, 187], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35641, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35644, "bytes": [160, 5], "type": "code", "mnemonic": "ldy", "operand": "#5"}, {"addr": 35646, "bytes": [177, 187], "type": "code", "mnemonic": "lda", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35648, "bytes": [141, 7, 15], "type": "code", "mnemonic": "sta", "operand": "l0f07", "target": 3847, "target_label": "l0f07"}, {"addr": 35651, "bytes": [162, 13], "comment_inline": "X=preserved through header build", "type": "code", "mnemonic": "ldx", "operand": "#&0d"}, {"addr": 35653, "bytes": [142, 8, 15], "type": "code", "mnemonic": "stx", "operand": "l0f08", "target": 3848, "target_label": "l0f08"}, {"addr": 35656, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 35658, "bytes": [132, 176], "type": "code", "mnemonic": "sty", "operand": "fs_load_addr", "target": 176, "target_label": "fs_load_addr"}, {"addr": 35660, "bytes": [140, 5, 15], "type": "code", "mnemonic": "sty", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35663, "bytes": [200], "comment_inline": "Y=function code for HDRFN Y=&03", "type": "code", "mnemonic": "iny"}, {"addr": 35664, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35667, "bytes": [134, 177], "comment_inline": "X=0 on success, &D6 on not-found", "type": "code", "mnemonic": "stx", "operand": "fs_load_addr_hi", "target": 177, "target_label": "fs_load_addr_hi"}, {"addr": 35669, "bytes": [173, 6, 15], "type": "code", "mnemonic": "lda", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35672, "bytes": [129, 187], "type": "code", "mnemonic": "sta", "operand": "(fs_options,x)", "target": 187, "target_label": "fs_options"}, {"addr": 35674, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35677, "bytes": [160, 9], "type": "code", "mnemonic": "ldy", "operand": "#9"}, {"addr": 35679, "bytes": [113, 187], "type": "code", "mnemonic": "adc", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35681, "bytes": [145, 187], "type": "code", "mnemonic": "sta", "operand": "(fs_options),y", "target": 187, "target_label": "fs_options"}, {"addr": 35683, "bytes": [165, 200], "type": "code", "mnemonic": "lda", "operand": "l00c8", "target": 200, "target_label": "l00c8"}, {"addr": 35685, "bytes": [233, 7], "type": "code", "mnemonic": "sbc", "operand": "#7"}, {"addr": 35687, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35690, "bytes": [133, 178], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35692, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "c8b71", "target": 35697, "target_label": "c8b71"}, {"addr": 35694, "bytes": [32, 251, 138], "type": "code", "mnemonic": "jsr", "operand": "copy_reply_to_caller", "target": 35579, "target_label": "copy_reply_to_caller"}, {"addr": 35697, "bytes": [162, 2], "labels": ["c8b71"], "comments_before": ["&8b71 referenced 1 time by &8b6c"], "references": [35692], "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 35699, "bytes": [157, 7, 15], "labels": ["loop_c8b73"], "comments_before": ["&8b73 referenced 1 time by &8b77"], "references": [35703], "type": "code", "mnemonic": "sta", "operand": "l0f07,x", "target": 3847, "target_label": "l0f07"}, {"addr": 35702, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35703, "bytes": [16, 250], "type": "code", "mnemonic": "bpl", "operand": "loop_c8b73", "target": 35699, "target_label": "loop_c8b73"}, {"addr": 35705, "bytes": [32, 207, 137], "type": "code", "mnemonic": "jsr", "operand": "adjust_addrs_1", "target": 35279, "target_label": "adjust_addrs_1"}, {"addr": 35708, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 35709, "bytes": [198, 178], "type": "code", "mnemonic": "dec", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 35711, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35714, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 35717, "bytes": [32, 210, 137], "type": "code", "mnemonic": "jsr", "operand": "adjust_addrs", "target": 35282, "target_label": "adjust_addrs"}, {"addr": 35720, "bytes": [240, 168], "type": "code", "mnemonic": "beq", "operand": "c8b32", "target": 35634, "target_label": "c8b32"}, {"addr": 35722, "bytes": [169, 195], "labels": ["tube_claim_loop"], "comments_before": ["&8b8a referenced 3 times by &8b10, &8b8f, &8da0"], "references": [36256, 35727, 35600], "type": "code", "mnemonic": "lda", "operand": "#&c3"}, {"addr": 35724, "bytes": [32, 6, 4], "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 35727, "bytes": [144, 249], "type": "code", "mnemonic": "bcc", "operand": "tube_claim_loop", "target": 35722, "target_label": "tube_claim_loop"}, {"addr": 35729, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 35730, "bytes": [32, 8, 133], "labels": ["fscv_star_handler"], "comments_before": ["***************************************************************************************", "FSCV 2/3/4: unrecognised * command handler (DECODE)\n\nCLI parser originally by Roger Wilson (later Sophie Wilson,\nco-designer of ARM). Matches command text against the table\nat &8BD6 using case-insensitive comparison with abbreviation\nsupport \u2014 commands can be shortened with '.' (e.g. \"I.\" for\n\"INFO\"). The \"I.\" entry is a special fudge placed first in the\ntable: since \"I.\" could match multiple commands, it jumps to\nforward_star_cmd to let the fileserver resolve the ambiguity.\n\nThe matching loop compares input characters against table\nentries. On mismatch, it skips to the next entry. On match\nof all table characters, or when '.' abbreviation is found,\nit dispatches via PHA/PHA/RTS to the entry's handler address.\n\nAfter matching, adjusts fs_crc_lo/fs_crc_hi to point past\nthe matched command text.", "***************************************************************************************", "&8b92 referenced 1 time by &8242"], "references": [33346], "type": "code", "mnemonic": "jsr", "operand": "save_fscv_args", "target": 34056, "target_label": "save_fscv_args"}, {"addr": 35733, "bytes": [162, 255], "type": "code", "mnemonic": "ldx", "operand": "#&ff"}, {"addr": 35735, "bytes": [160, 255], "labels": ["loop_c8b97"], "comments_before": ["&8b97 referenced 1 time by &8bb2"], "references": [35762], "type": "code", "mnemonic": "ldy", "operand": "#&ff"}, {"addr": 35737, "bytes": [200], "labels": ["decfir"], "comments_before": ["&8b99 referenced 1 time by &8ba4"], "references": [35748], "type": "code", "mnemonic": "iny"}, {"addr": 35738, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35739, "bytes": [189, 214, 139], "labels": ["decmor"], "comments_before": ["&8b9b referenced 1 time by &8bb6"], "references": [35766], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_match_table,x", "target": 35798, "target_label": "fs_cmd_match_table"}, {"addr": 35742, "bytes": [48, 24], "type": "code", "mnemonic": "bmi", "operand": "c8bb8", "target": 35768, "target_label": "c8bb8"}, {"addr": 35744, "bytes": [81, 190], "type": "code", "mnemonic": "eor", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 35746, "bytes": [41, 223], "type": "code", "mnemonic": "and", "operand": "#&df"}, {"addr": 35748, "bytes": [240, 243], "type": "code", "mnemonic": "beq", "operand": "decfir", "target": 35737, "target_label": "decfir"}, {"addr": 35750, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35751, "bytes": [232], "labels": ["decmin"], "comments_before": ["&8ba7 referenced 1 time by &8bab"], "references": [35755], "type": "code", "mnemonic": "inx"}, {"addr": 35752, "bytes": [189, 214, 139], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_match_table,x", "target": 35798, "target_label": "fs_cmd_match_table"}, {"addr": 35755, "bytes": [16, 250], "type": "code", "mnemonic": "bpl", "operand": "decmin", "target": 35751, "target_label": "decmin"}, {"addr": 35757, "bytes": [177, 190], "type": "code", "mnemonic": "lda", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 35759, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35760, "bytes": [201, 46], "type": "code", "mnemonic": "cmp", "operand": "#&2e"}, {"addr": 35762, "bytes": [208, 227], "type": "code", "mnemonic": "bne", "operand": "loop_c8b97", "target": 35735, "target_label": "loop_c8b97"}, {"addr": 35764, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 35765, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 35766, "bytes": [176, 227], "type": "code", "mnemonic": "bcs", "operand": "decmor", "target": 35739, "target_label": "decmor"}, {"addr": 35768, "bytes": [72], "labels": ["c8bb8"], "comments_before": ["&8bb8 referenced 1 time by &8b9e"], "references": [35742], "type": "code", "mnemonic": "pha"}, {"addr": 35769, "bytes": [189, 215, 139], "type": "code", "mnemonic": "lda", "operand": "l8bd7,x", "target": 35799, "target_label": "l8bd7"}, {"addr": 35772, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 35773, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 35774, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 35775, "bytes": [166, 191], "type": "code", "mnemonic": "ldx", "operand": "fs_crc_hi", "target": 191, "target_label": "fs_crc_hi"}, {"addr": 35777, "bytes": [101, 190], "type": "code", "mnemonic": "adc", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 35779, "bytes": [141, 11, 14], "type": "code", "mnemonic": "sta", "operand": "l0e0b", "target": 3595, "target_label": "l0e0b"}, {"addr": 35782, "bytes": [141, 16, 14], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_ptr", "target": 3600, "target_label": "fs_cmd_ptr"}, {"addr": 35785, "bytes": [144, 1], "type": "code", "mnemonic": "bcc", "operand": "c8bcc", "target": 35788, "target_label": "c8bcc"}, {"addr": 35787, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35788, "bytes": [142, 12, 14], "labels": ["c8bcc"], "comments_before": ["&8bcc referenced 1 time by &8bc9"], "references": [35785], "type": "code", "mnemonic": "stx", "operand": "l0e0c", "target": 3596, "target_label": "l0e0c"}, {"addr": 35791, "bytes": [142, 17, 14], "type": "code", "mnemonic": "stx", "operand": "l0e11", "target": 3601, "target_label": "l0e11"}, {"addr": 35794, "bytes": [142, 22, 14], "type": "code", "mnemonic": "stx", "operand": "l0e16", "target": 3606, "target_label": "l0e16"}, {"addr": 35797, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 35798, "bytes": [73, 46], "labels": ["fs_cmd_match_table"], "sub_labels": {"35799": ["l8bd7"]}, "comments_before": ["***************************************************************************************", "FS command match table (COMTAB)\n\nFormat: command letters (bit 7 clear), then dispatch address\nas two bytes: high|(bit 7 set), low. The PHA/PHA/RTS trick\nadds 1 to the stored (address-1). Matching is case-insensitive\n(AND &DF) and supports '.' abbreviation (standard Acorn pattern).\n\nEntries:\n  \"I.\"     \u2192 &8079 (forward_star_cmd) \u2014 placed first as a fudge\n             to catch *I. abbreviation before matching *I AM\n  \"I AM\"   \u2192 &8D06 (i_am_handler: parse station.net, logon)\n  \"EX \"    \u2192 &8BF2 (ex_handler: extended catalogue)\n  \"EX\"\\r   \u2192 &8BF2 (same, exact match at end of line)\n  \"BYE\"\\r  \u2192 &8349 (bye_handler: logoff)\n  <catch-all> \u2192 &8079 (forward anything else to FS)", "***************************************************************************************", "&8bd6 referenced 2 times by &8b9b, &8ba8", "&8bd7 referenced 1 time by &8bb9"], "references": [35739, 35752], "type": "code", "mnemonic": "eor", "operand": "#&2e"}, {"addr": 35800, "bytes": [128], "type": "byte", "values": [128]}, {"addr": 35801, "bytes": [120, 73, 32, 65, 77], "type": "string", "string": "xI AM"}, {"addr": 35806, "bytes": [141, 5], "type": "byte", "values": [141, 5]}, {"addr": 35808, "bytes": [69, 88, 32], "type": "string", "string": "EX "}, {"addr": 35811, "bytes": [139, 241, 69, 88, 13, 139, 241], "type": "byte", "values": [139, 241, 69, 88, 13, 139, 241]}, {"addr": 35818, "bytes": [66, 89, 69], "type": "string", "string": "BYE"}, {"addr": 35821, "bytes": [13, 131, 72, 128, 120], "type": "byte", "values": [13, 131, 72, 128, 120]}, {"addr": 35826, "bytes": [136], "labels": ["ex_handler"], "comments_before": ["***************************************************************************************", "*EX handler (extended catalogue)\n\nSets column width &B6=&50 (80 columns, one file per line with\nfull details) and &B7=&01, then branches into cat_handler at\n&8C07, bypassing cat_handler's default 20-column setup.", "***************************************************************************************"], "type": "code", "mnemonic": "dey"}, {"addr": 35827, "bytes": [162, 1], "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 35829, "bytes": [134, 183], "type": "code", "mnemonic": "stx", "operand": "l00b7", "target": 183, "target_label": "l00b7"}, {"addr": 35831, "bytes": [162, 80], "type": "code", "mnemonic": "ldx", "operand": "#&50"}, {"addr": 35833, "bytes": [134, 182], "type": "code", "mnemonic": "stx", "operand": "l00b6", "target": 182, "target_label": "l00b6"}, {"addr": 35835, "bytes": [208, 10], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c8c07", "target": 35847, "target_label": "c8c07"}, {"addr": 35837, "bytes": [162, 20], "labels": ["cat_handler"], "comments_before": ["***************************************************************************************", "*CAT handler (directory catalogue)\n\nSets column width &B6=&14 (20 columns, four files per 80-column\nline) and &B7=&03. The catalogue protocol is multi-step: first\nsends FCUSER (&15: read user environment) to get CSD, disc, and\nlibrary names, then sends FCREAD (&12: examine) repeatedly to\nfetch entries in batches until zero are returned (end of dir).\nThe receive buffer abuts the examine request buffer and ends at\nRXBUFE, allowing seamless data handling across request cycles.\n\nThe command code byte in the fileserver reply indicates FS type:\nzero means an old-format FS (client must format data locally),\nnon-zero means new-format (server returns pre-formatted strings).\nThis enables backward compatibility with older Acorn fileservers.\n\nDisplay format:\n  - Station number in parentheses\n  - \"Owner\" or \"Public\" access level\n  - Boot option with name (Off/Load/Run/Exec)\n  - Current directory and library paths\n  - Directory entries: CRFLAG (&CF) cycles 0-3 for multi-column\n    layout; at count 0 a newline is printed, others get spaces.\n    *EX sets CRFLAG=&FF to force one entry per line.", "***************************************************************************************"], "type": "code", "mnemonic": "ldx", "operand": "#&14"}, {"addr": 35839, "bytes": [134, 182], "type": "code", "mnemonic": "stx", "operand": "l00b6", "target": 182, "target_label": "l00b6"}, {"addr": 35841, "bytes": [162, 3], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 35843, "bytes": [134, 183], "type": "code", "mnemonic": "stx", "operand": "l00b7", "target": 183, "target_label": "l00b7"}, {"addr": 35845, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 35847, "bytes": [169, 6], "labels": ["c8c07"], "comments_before": ["&8c07 referenced 1 time by &8bfb"], "references": [35835], "type": "code", "mnemonic": "lda", "operand": "#6"}, {"addr": 35849, "bytes": [141, 5, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 35852, "bytes": [32, 85, 133], "type": "code", "mnemonic": "jsr", "operand": "skip_spaces", "target": 34133, "target_label": "skip_spaces"}, {"addr": 35855, "bytes": [132, 179], "type": "code", "mnemonic": "sty", "operand": "l00b3", "target": 179, "target_label": "l00b3"}, {"addr": 35857, "bytes": [162, 1], "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 35859, "bytes": [32, 103, 141], "type": "code", "mnemonic": "jsr", "operand": "copy_string_from_offset", "target": 36199, "target_label": "copy_string_from_offset"}, {"addr": 35862, "bytes": [160, 18], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#&12"}, {"addr": 35864, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35867, "bytes": [162, 3], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 35869, "bytes": [32, 79, 141], "type": "code", "mnemonic": "jsr", "operand": "print_reply_bytes", "target": 36175, "target_label": "print_reply_bytes"}, {"addr": 35872, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35875, "bytes": [40], "type": "string", "string": "("}, {"addr": 35876, "bytes": [173, 19, 15], "type": "code", "mnemonic": "lda", "operand": "l0f13", "target": 3859, "target_label": "l0f13"}, {"addr": 35879, "bytes": [32, 175, 133], "type": "code", "mnemonic": "jsr", "operand": "print_decimal", "target": 34223, "target_label": "print_decimal"}, {"addr": 35882, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35885, "bytes": [41], "type": "string", "string": ")"}, {"addr": 35886, "bytes": [162, 5], "type": "code", "mnemonic": "ldx", "operand": "#5"}, {"addr": 35888, "bytes": [32, 92, 141], "type": "code", "mnemonic": "jsr", "operand": "print_spaces", "target": 36188, "target_label": "print_spaces"}, {"addr": 35891, "bytes": [174, 18, 15], "type": "code", "mnemonic": "ldx", "operand": "l0f12", "target": 3858, "target_label": "l0f12"}, {"addr": 35894, "bytes": [208, 11], "type": "code", "mnemonic": "bne", "operand": "c8c43", "target": 35907, "target_label": "c8c43"}, {"addr": 35896, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35899, "bytes": [79, 119, 110, 101, 114, 13], "type": "string", "string": "Owner."}, {"addr": 35905, "bytes": [208, 10], "type": "code", "mnemonic": "bne", "operand": "c8c4d", "target": 35917, "target_label": "c8c4d"}, {"addr": 35907, "bytes": [32, 59, 133], "labels": ["c8c43"], "comments_before": ["&8c43 referenced 1 time by &8c36"], "references": [35894], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35910, "bytes": [80, 117, 98, 108, 105, 99, 13], "type": "string", "string": "Public."}, {"addr": 35917, "bytes": [160, 21], "labels": ["c8c4d"], "comments_before": ["&8c4d referenced 1 time by &8c41"], "comment_inline": "Y=function code for HDRFN", "references": [35905], "type": "code", "mnemonic": "ldy", "operand": "#&15"}, {"addr": 35919, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 35922, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 35923, "bytes": [160, 16], "type": "code", "mnemonic": "ldy", "operand": "#&10"}, {"addr": 35925, "bytes": [32, 81, 141], "type": "code", "mnemonic": "jsr", "operand": "print_reply_counted", "target": 36177, "target_label": "print_reply_counted"}, {"addr": 35928, "bytes": [162, 4], "type": "code", "mnemonic": "ldx", "operand": "#4"}, {"addr": 35930, "bytes": [32, 92, 141], "type": "code", "mnemonic": "jsr", "operand": "print_spaces", "target": 36188, "target_label": "print_spaces"}, {"addr": 35933, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35936, "bytes": [79, 112, 116, 105, 111, 110, 32], "type": "string", "string": "Option "}, {"addr": 35943, "bytes": [173, 5, 14], "type": "code", "mnemonic": "lda", "operand": "fs_boot_option", "target": 3589, "target_label": "fs_boot_option"}, {"addr": 35946, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 35947, "bytes": [32, 235, 133], "type": "code", "mnemonic": "jsr", "operand": "print_hex", "target": 34283, "target_label": "print_hex"}, {"addr": 35950, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35953, "bytes": [32, 40], "type": "string", "string": " ("}, {"addr": 35955, "bytes": [188, 75, 141], "type": "code", "mnemonic": "ldy", "operand": "option_name_offsets,x", "target": 36171, "target_label": "option_name_offsets"}, {"addr": 35958, "bytes": [185, 58, 141], "labels": ["loop_c8c76"], "comments_before": ["&8c76 referenced 1 time by &8c7f"], "references": [35967], "type": "code", "mnemonic": "lda", "operand": "option_name_strings,y", "target": 36154, "target_label": "option_name_strings"}, {"addr": 35961, "bytes": [240, 6], "type": "code", "mnemonic": "beq", "operand": "c8c81", "target": 35969, "target_label": "c8c81"}, {"addr": 35963, "bytes": [32, 227, 255], "comment_inline": "Write character", "type": "code", "mnemonic": "jsr", "operand": "osasci", "target": 65507, "target_label": "osasci"}, {"addr": 35966, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 35967, "bytes": [208, 245], "type": "code", "mnemonic": "bne", "operand": "loop_c8c76", "target": 35958, "target_label": "loop_c8c76"}, {"addr": 35969, "bytes": [32, 59, 133], "labels": ["c8c81"], "comments_before": ["&8c81 referenced 1 time by &8c79"], "references": [35961], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35972, "bytes": [41, 13, 68, 105, 114, 46, 32], "type": "string", "string": ").Dir. "}, {"addr": 35979, "bytes": [162, 17], "type": "code", "mnemonic": "ldx", "operand": "#&11"}, {"addr": 35981, "bytes": [32, 79, 141], "type": "code", "mnemonic": "jsr", "operand": "print_reply_bytes", "target": 36175, "target_label": "print_reply_bytes"}, {"addr": 35984, "bytes": [162, 5], "type": "code", "mnemonic": "ldx", "operand": "#5"}, {"addr": 35986, "bytes": [32, 92, 141], "type": "code", "mnemonic": "jsr", "operand": "print_spaces", "target": 36188, "target_label": "print_spaces"}, {"addr": 35989, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 35992, "bytes": [76, 105, 98, 46, 32], "type": "string", "string": "Lib. "}, {"addr": 35997, "bytes": [162, 27], "type": "code", "mnemonic": "ldx", "operand": "#&1b"}, {"addr": 35999, "bytes": [32, 79, 141], "type": "code", "mnemonic": "jsr", "operand": "print_reply_bytes", "target": 36175, "target_label": "print_reply_bytes"}, {"addr": 36002, "bytes": [32, 59, 133], "type": "code", "mnemonic": "jsr", "operand": "print_inline", "target": 34107, "target_label": "print_inline"}, {"addr": 36005, "bytes": [13, 13], "type": "string", "string": ".."}, {"addr": 36007, "bytes": [140, 6, 15], "type": "code", "mnemonic": "sty", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 36010, "bytes": [132, 180], "type": "code", "mnemonic": "sty", "operand": "l00b4", "target": 180, "target_label": "l00b4"}, {"addr": 36012, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 36013, "bytes": [73, 255], "type": "code", "mnemonic": "eor", "operand": "#&ff"}, {"addr": 36015, "bytes": [56], "labels": ["loop_c8caf"], "comments_before": ["&8caf referenced 1 time by &8cb3"], "references": [36019], "type": "code", "mnemonic": "sec"}, {"addr": 36016, "bytes": [229, 182], "type": "code", "mnemonic": "sbc", "operand": "l00b6", "target": 182, "target_label": "l00b6"}, {"addr": 36018, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36019, "bytes": [176, 250], "type": "code", "mnemonic": "bcs", "operand": "loop_c8caf", "target": 36015, "target_label": "loop_c8caf"}, {"addr": 36021, "bytes": [140, 7, 15], "type": "code", "mnemonic": "sty", "operand": "l0f07", "target": 3847, "target_label": "l0f07"}, {"addr": 36024, "bytes": [132, 181], "type": "code", "mnemonic": "sty", "operand": "l00b5", "target": 181, "target_label": "l00b5"}, {"addr": 36026, "bytes": [164, 179], "labels": ["c8cba"], "comments_before": ["&8cba referenced 1 time by &8ce5"], "references": [36069], "type": "code", "mnemonic": "ldy", "operand": "l00b3", "target": 179, "target_label": "l00b3"}, {"addr": 36028, "bytes": [166, 183], "type": "code", "mnemonic": "ldx", "operand": "l00b7", "target": 183, "target_label": "l00b7"}, {"addr": 36030, "bytes": [142, 5, 15], "type": "code", "mnemonic": "stx", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 36033, "bytes": [162, 3], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 36035, "bytes": [32, 103, 141], "type": "code", "mnemonic": "jsr", "operand": "copy_string_from_offset", "target": 36199, "target_label": "copy_string_from_offset"}, {"addr": 36038, "bytes": [160, 3], "comment_inline": "Y=function code for HDRFN", "type": "code", "mnemonic": "ldy", "operand": "#3"}, {"addr": 36040, "bytes": [32, 80, 131], "comment_inline": "Prepare FS command buffer (12 references)", "type": "code", "mnemonic": "jsr", "operand": "prepare_fs_cmd", "target": 33616, "target_label": "prepare_fs_cmd"}, {"addr": 36043, "bytes": [173, 5, 15], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 36046, "bytes": [240, 47], "type": "code", "mnemonic": "beq", "operand": "c8cff", "target": 36095, "target_label": "c8cff"}, {"addr": 36048, "bytes": [162, 2], "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 36050, "bytes": [32, 117, 141], "type": "code", "mnemonic": "jsr", "operand": "print_dir_from_offset", "target": 36213, "target_label": "print_dir_from_offset"}, {"addr": 36053, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 36054, "bytes": [165, 180], "type": "code", "mnemonic": "lda", "operand": "l00b4", "target": 180, "target_label": "l00b4"}, {"addr": 36056, "bytes": [109, 5, 15], "type": "code", "mnemonic": "adc", "operand": "fs_cmd_data", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 36059, "bytes": [141, 6, 15], "type": "code", "mnemonic": "sta", "operand": "l0f06", "target": 3846, "target_label": "l0f06"}, {"addr": 36062, "bytes": [133, 180], "type": "code", "mnemonic": "sta", "operand": "l00b4", "target": 180, "target_label": "l00b4"}, {"addr": 36064, "bytes": [165, 181], "type": "code", "mnemonic": "lda", "operand": "l00b5", "target": 181, "target_label": "l00b5"}, {"addr": 36066, "bytes": [141, 7, 15], "type": "code", "mnemonic": "sta", "operand": "l0f07", "target": 3847, "target_label": "l0f07"}, {"addr": 36069, "bytes": [208, 211], "type": "code", "mnemonic": "bne", "operand": "c8cba", "target": 36026, "target_label": "c8cba"}, {"addr": 36071, "bytes": [76, 46, 33], "type": "code", "mnemonic": "jmp", "operand": "l212e", "target": 8494, "target_label": "l212e"}, {"addr": 36074, "bytes": [66, 79, 79, 84], "labels": ["boot_cmd_strings"], "comments_before": ["***************************************************************************************", "Boot command strings for auto-boot\n\nThe four boot options use OSCLI strings at offsets within page &8C:\n  Option 0 (Off):  offset &F6 \u2192 &8CF6 = bare CR (empty command)\n  Option 1 (Load): offset &E7 \u2192 &8CE7 = \"L.!BOOT\" (dual-purpose:\n      the JMP &212E instruction at &8CE7 has opcode &4C='L' and\n      operand bytes &2E='.' &21='!', forming the string \"L.!\")\n  Option 2 (Run):  offset &E9 \u2192 &8CE9 = \"!BOOT\" (bare filename = *RUN)\n  Option 3 (Exec): offset &EF \u2192 &8CEF = \"E.!BOOT\"\n\nThis is a classic BBC ROM space optimisation: the JMP instruction's\nbytes serve double duty as both executable code and ASCII text.", "***************************************************************************************"], "type": "string", "string": "BOOT"}, {"addr": 36078, "bytes": [13], "type": "byte", "values": [13]}, {"addr": 36079, "bytes": [69, 46, 33, 66, 79, 79, 84], "type": "string", "string": "E.!BOOT"}, {"addr": 36086, "bytes": [13], "type": "byte", "values": [13]}, {"addr": 36087, "bytes": [140, 4, 14], "labels": ["set_lib_handle"], "comments_before": ["***************************************************************************************", "Set library handle\n\nStores Y into &0E04 (library directory handle in FS workspace).\nFalls through to c8cff (JMP c892c) if Y is non-zero.", "***************************************************************************************"], "type": "code", "mnemonic": "sty", "operand": "fs_lib_handle", "target": 3588, "target_label": "fs_lib_handle"}, {"addr": 36090, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "c8cff", "target": 36095, "target_label": "c8cff"}, {"addr": 36092, "bytes": [140, 3, 14], "labels": ["set_csd_handle"], "comments_before": ["***************************************************************************************", "Set CSD handle\n\nStores Y into &0E03 (current selected directory handle).\nFalls through to c8cff (JMP c892c).", "***************************************************************************************"], "type": "code", "mnemonic": "sty", "operand": "fs_csd_handle", "target": 3587, "target_label": "fs_csd_handle"}, {"addr": 36095, "bytes": [76, 44, 137], "labels": ["c8cff"], "comments_before": ["&8cff referenced 3 times by &8cce, &8cfa, &8d2d"], "references": [36090, 36141, 36046], "type": "code", "mnemonic": "jmp", "operand": "restore_args_return", "target": 35116, "target_label": "restore_args_return"}, {"addr": 36098, "bytes": [246, 231], "labels": ["boot_option_offsets"], "comments_before": ["***************************************************************************************", "Boot option \u2192 OSCLI string offset table\n\nFour bytes indexed by the boot option value (0-3). Each byte\nis the low byte of a pointer into page &8C, where the OSCLI\ncommand string for that boot option lives. See boot_cmd_strings.", "***************************************************************************************", "&8d02 referenced 1 time by &8d32"], "references": [36146], "type": "code", "mnemonic": "inc", "operand": "l00e7,x", "target": 231, "target_label": "l00e7"}, {"addr": 36100, "bytes": [233, 239], "type": "code", "mnemonic": "sbc", "operand": "#&ef"}, {"addr": 36102, "bytes": [32, 85, 133], "labels": ["i_am_handler"], "comments_before": ["***************************************************************************************", "\"I AM\" command handler\n\nDispatched from the command match table when the user types\n\"*I AM <station>\" or \"*I AM <station>.<network>\".\nParses the station number (and optional network number after '.')\nusing skip_spaces and parse_decimal. Stores the results in:\n  &0E00 = station number (or fileserver station)\n  &0E01 = network number\nThen forwards the command to the fileserver via forward_star_cmd.", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "skip_spaces", "target": 34133, "target_label": "skip_spaces"}, {"addr": 36105, "bytes": [176, 17], "type": "code", "mnemonic": "bcs", "operand": "c8d1c", "target": 36124, "target_label": "c8d1c"}, {"addr": 36107, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 36109, "bytes": [32, 96, 133], "comment_inline": "Parse decimal number from (fs_options),Y (DECIN)", "type": "code", "mnemonic": "jsr", "operand": "parse_decimal", "target": 34144, "target_label": "parse_decimal"}, {"addr": 36112, "bytes": [144, 4], "type": "code", "mnemonic": "bcc", "operand": "c8d16", "target": 36118, "target_label": "c8d16"}, {"addr": 36114, "bytes": [200], "comment_inline": "Y=offset into (fs_options) buffer", "type": "code", "mnemonic": "iny"}, {"addr": 36115, "bytes": [32, 96, 133], "comment_inline": "Parse decimal number from (fs_options),Y (DECIN)", "type": "code", "mnemonic": "jsr", "operand": "parse_decimal", "target": 34144, "target_label": "parse_decimal"}, {"addr": 36118, "bytes": [141, 0, 14], "labels": ["c8d16"], "comments_before": ["&8d16 referenced 1 time by &8d10"], "comment_inline": "A=parsed value (accumulated in &B2)", "references": [36112], "type": "code", "mnemonic": "sta", "operand": "fs_server_stn", "target": 3584, "target_label": "fs_server_stn"}, {"addr": 36121, "bytes": [142, 1, 14], "comment_inline": "X=corrupted", "type": "code", "mnemonic": "stx", "operand": "fs_server_net", "target": 3585, "target_label": "fs_server_net"}, {"addr": 36124, "bytes": [76, 121, 128], "labels": ["c8d1c"], "comments_before": ["&8d1c referenced 1 time by &8d09"], "references": [36105], "type": "code", "mnemonic": "jmp", "operand": "forward_star_cmd", "target": 32889, "target_label": "forward_star_cmd"}, {"addr": 36127, "bytes": [56], "labels": ["copy_handles_and_boot"], "comments_before": ["***************************************************************************************", "Copy FS reply handles to workspace and execute boot command\n\nSEC entry (LOGIN): copies 4 bytes from &0F05-&0F08 (FS reply) to\n&0E02-&0E05 (URD, CSD, LIB handles and boot option), then\nlooks up the boot option in boot_option_offsets to get the\nOSCLI command string and executes it via JMP oscli.\nThe carry flag distinguishes LOGIN (SEC) from SDISC (CLC) \u2014 both\nshare the handle-copying code, but only LOGIN executes the boot\ncommand. This use of the carry flag to select behaviour between\ntwo callers avoids duplicating the handle-copy loop.", "***************************************************************************************"], "type": "code", "mnemonic": "sec"}, {"addr": 36128, "bytes": [162, 3], "labels": ["copy_handles"], "comments_before": ["***************************************************************************************", "Copy FS reply handles to workspace (no boot)\n\nCLC entry (SDISC): copies handles only, then jumps to c8cff.\nCalled when the FS reply contains updated handle values\nbut no boot action is needed.", "***************************************************************************************"], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 36130, "bytes": [144, 6], "type": "code", "mnemonic": "bcc", "operand": "logon3", "target": 36138, "target_label": "logon3"}, {"addr": 36132, "bytes": [189, 5, 15], "labels": ["logon2"], "comments_before": ["&8d24 referenced 1 time by &8d2b"], "references": [36139], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 36135, "bytes": [157, 2, 14], "type": "code", "mnemonic": "sta", "operand": "fs_urd_handle,x", "target": 3586, "target_label": "fs_urd_handle"}, {"addr": 36138, "bytes": [202], "labels": ["logon3"], "comments_before": ["&8d2a referenced 1 time by &8d22"], "references": [36130], "type": "code", "mnemonic": "dex"}, {"addr": 36139, "bytes": [16, 247], "type": "code", "mnemonic": "bpl", "operand": "logon2", "target": 36132, "target_label": "logon2"}, {"addr": 36141, "bytes": [144, 208], "type": "code", "mnemonic": "bcc", "operand": "c8cff", "target": 36095, "target_label": "c8cff"}, {"addr": 36143, "bytes": [172, 5, 14], "type": "code", "mnemonic": "ldy", "operand": "fs_boot_option", "target": 3589, "target_label": "fs_boot_option"}, {"addr": 36146, "bytes": [190, 2, 141], "type": "code", "mnemonic": "ldx", "operand": "boot_option_offsets,y", "target": 36098, "target_label": "boot_option_offsets"}, {"addr": 36149, "bytes": [160, 140], "type": "code", "mnemonic": "ldy", "operand": "#&8c"}, {"addr": 36151, "bytes": [76, 247, 255], "type": "code", "mnemonic": "jmp", "operand": "oscli", "target": 65527, "target_label": "oscli"}, {"addr": 36154, "bytes": [79, 102, 102], "labels": ["option_name_strings"], "comments_before": ["***************************************************************************************", "Option name strings\n\nNull-terminated strings for the four boot option names:\n  \"Off\", \"Load\", \"Run\", \"Exec\"\nUsed by cat_handler to display the current boot option setting.", "***************************************************************************************", "&8d3a referenced 1 time by &8c76"], "references": [35958], "type": "string", "string": "Off"}, {"addr": 36157, "bytes": [0], "type": "byte", "values": [0]}, {"addr": 36158, "bytes": [76, 111, 97, 100], "type": "string", "string": "Load"}, {"addr": 36162, "bytes": [0], "type": "byte", "values": [0]}, {"addr": 36163, "bytes": [82, 117, 110], "type": "string", "string": "Run"}, {"addr": 36166, "bytes": [0], "type": "byte", "values": [0]}, {"addr": 36167, "bytes": [69, 120, 101, 99], "type": "string", "string": "Exec"}, {"addr": 36171, "bytes": [0], "labels": ["option_name_offsets"], "comments_before": ["***************************************************************************************", "Option name offsets\n\nFour-byte table of offsets into option_name_strings:\n  0, 4, 9, &0D \u2014 one per boot option value (0-3).", "***************************************************************************************", "&8d4b referenced 1 time by &8c73"], "references": [35955], "type": "code", "mnemonic": "brk"}, {"addr": 36172, "bytes": [4, 9, 13], "type": "byte", "values": [4, 9, 13]}, {"addr": 36175, "bytes": [160, 10], "labels": ["print_reply_bytes"], "comments_before": ["***************************************************************************************", "Print reply buffer bytes\n\nPrints Y characters from the FS reply buffer (&0F05+X) to\nthe screen via OSASCI. X = starting offset, Y = count.\nUsed by cat_handler to display directory and library names.", "***************************************************************************************", "&8d4f referenced 3 times by &8c1d, &8c8d, &8c9f"], "references": [35869, 35981, 35999], "type": "code", "mnemonic": "ldy", "operand": "#&0a"}, {"addr": 36177, "bytes": [189, 5, 15], "labels": ["print_reply_counted"], "comments_before": ["&8d51 referenced 2 times by &8c55, &8d59"], "references": [36185, 35925], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 36180, "bytes": [32, 227, 255], "comment_inline": "Write character", "type": "code", "mnemonic": "jsr", "operand": "osasci", "target": 65507, "target_label": "osasci"}, {"addr": 36183, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 36184, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36185, "bytes": [208, 246], "type": "code", "mnemonic": "bne", "operand": "print_reply_counted", "target": 36177, "target_label": "print_reply_counted"}, {"addr": 36187, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36188, "bytes": [32, 64, 134], "labels": ["print_spaces"], "comments_before": ["***************************************************************************************", "Print spaces\n\nPrints X space characters via print_space. Used by cat_handler\nto align columns in the directory listing.", "***************************************************************************************", "&8d5c referenced 4 times by &8c30, &8c5a, &8c92, &8d60"], "references": [36192, 35888, 35930, 35986], "type": "code", "mnemonic": "jsr", "operand": "print_space", "target": 34368, "target_label": "print_space"}, {"addr": 36191, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 36192, "bytes": [208, 250], "type": "code", "mnemonic": "bne", "operand": "print_spaces", "target": 36188, "target_label": "print_spaces"}, {"addr": 36194, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36195, "bytes": [162, 0], "labels": ["copy_filename"], "comments_before": ["***************************************************************************************", "Copy filename to FS command buffer\n\nEntry with X=0: copies from (fs_crc_lo),Y to &0F05+X until CR.\nUsed to place a filename into the FS command buffer before\nsending to the fileserver. Falls through to copy_string_to_cmd.", "***************************************************************************************", "&8d63 referenced 3 times by &8079, &86cb, &888a"], "references": [32889, 34954, 34507], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 36197, "bytes": [160, 0], "labels": ["copy_string_to_cmd"], "comments_before": ["***************************************************************************************", "Copy string to FS command buffer\n\nEntry with X and Y specified: copies bytes from (fs_crc_lo),Y\nto &0F05+X, stopping when a CR (&0D) is encountered. The CR\nitself is also copied. Returns with X pointing past the last\nbyte written.", "***************************************************************************************", "&8d65 referenced 4 times by &8779, &8883, &88a5, &8964"], "references": [34981, 34947, 35172, 34681], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 36199, "bytes": [177, 190], "labels": ["copy_string_from_offset"], "comments_before": ["&8d67 referenced 3 times by &8c13, &8cc3, &8d70"], "references": [36208, 35859, 36035], "type": "code", "mnemonic": "lda", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36201, "bytes": [157, 5, 15], "type": "code", "mnemonic": "sta", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 36204, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 36205, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36206, "bytes": [73, 13], "type": "code", "mnemonic": "eor", "operand": "#&0d"}, {"addr": 36208, "bytes": [208, 245], "type": "code", "mnemonic": "bne", "operand": "copy_string_from_offset", "target": 36199, "target_label": "copy_string_from_offset"}, {"addr": 36210, "bytes": [96], "labels": ["return_6"], "comments_before": ["&8d72 referenced 1 time by &8d78"], "references": [36216], "type": "code", "mnemonic": "rts"}, {"addr": 36211, "bytes": [162, 0], "labels": ["print_dir_name"], "comments_before": ["***************************************************************************************", "Print directory name from reply buffer\n\nPrints characters from the FS reply buffer (&0F05+X onwards).\nNull bytes (&00) are replaced with CR (&0D) for display.\nStops when a byte with bit 7 set is encountered (high-bit\nterminator). Used by cat_handler to display Dir. and Lib. paths.", "***************************************************************************************"], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 36213, "bytes": [189, 5, 15], "labels": ["print_dir_from_offset"], "comments_before": ["&8d75 referenced 2 times by &8cd2, &8d82"], "references": [36226, 36050], "type": "code", "mnemonic": "lda", "operand": "fs_cmd_data,x", "target": 3845, "target_label": "fs_cmd_data"}, {"addr": 36216, "bytes": [48, 248], "type": "code", "mnemonic": "bmi", "operand": "return_6", "target": 36210, "target_label": "return_6"}, {"addr": 36218, "bytes": [208, 2], "type": "code", "mnemonic": "bne", "operand": "infol2", "target": 36222, "target_label": "infol2"}, {"addr": 36220, "bytes": [169, 13], "type": "code", "mnemonic": "lda", "operand": "#&0d"}, {"addr": 36222, "bytes": [32, 227, 255], "labels": ["infol2"], "comments_before": ["&8d7e referenced 1 time by &8d7a"], "comment_inline": "Write character 13", "references": [36218], "type": "code", "mnemonic": "jsr", "operand": "osasci", "target": 65507, "target_label": "osasci"}, {"addr": 36225, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 36226, "bytes": [208, 241], "type": "code", "mnemonic": "bne", "operand": "print_dir_from_offset", "target": 36213, "target_label": "print_dir_from_offset"}, {"addr": 36228, "bytes": [162, 14], "labels": ["notify_and_exec"], "comments_before": ["***************************************************************************************", "Send FS load-as-command and execute response\n\nSets up an FS command with function code &05 (FCCMND: load as\ncommand) using send_fs_examine. If a Tube co-processor is\npresent (tx_in_progress != 0), transfers the response data\nto the Tube via tube_addr_claim. Otherwise jumps via the\nindirect pointer at (&0F09) to execute at the load address.", "***************************************************************************************"], "type": "code", "mnemonic": "ldx", "operand": "#&0e"}, {"addr": 36230, "bytes": [134, 188], "type": "code", "mnemonic": "stx", "operand": "fs_block_offset", "target": 188, "target_label": "fs_block_offset"}, {"addr": 36232, "bytes": [169, 16], "type": "code", "mnemonic": "lda", "operand": "#&10"}, {"addr": 36234, "bytes": [133, 187], "type": "code", "mnemonic": "sta", "operand": "fs_options", "target": 187, "target_label": "fs_options"}, {"addr": 36236, "bytes": [162, 74], "type": "code", "mnemonic": "ldx", "operand": "#&4a"}, {"addr": 36238, "bytes": [160, 5], "type": "code", "mnemonic": "ldy", "operand": "#5"}, {"addr": 36240, "bytes": [32, 208, 134], "type": "code", "mnemonic": "jsr", "operand": "send_fs_examine", "target": 34512, "target_label": "send_fs_examine"}, {"addr": 36243, "bytes": [173, 82, 13], "type": "code", "mnemonic": "lda", "operand": "tx_in_progress", "target": 3410, "target_label": "tx_in_progress"}, {"addr": 36246, "bytes": [240, 20], "type": "code", "mnemonic": "beq", "operand": "c8dac", "target": 36268, "target_label": "c8dac"}, {"addr": 36248, "bytes": [109, 11, 15], "type": "code", "mnemonic": "adc", "operand": "l0f0b", "target": 3851, "target_label": "l0f0b"}, {"addr": 36251, "bytes": [109, 12, 15], "type": "code", "mnemonic": "adc", "operand": "l0f0c", "target": 3852, "target_label": "l0f0c"}, {"addr": 36254, "bytes": [176, 12], "type": "code", "mnemonic": "bcs", "operand": "c8dac", "target": 36268, "target_label": "c8dac"}, {"addr": 36256, "bytes": [32, 138, 139], "type": "code", "mnemonic": "jsr", "operand": "tube_claim_loop", "target": 35722, "target_label": "tube_claim_loop"}, {"addr": 36259, "bytes": [162, 9], "type": "code", "mnemonic": "ldx", "operand": "#9"}, {"addr": 36261, "bytes": [160, 15], "type": "code", "mnemonic": "ldy", "operand": "#&0f"}, {"addr": 36263, "bytes": [169, 4], "type": "code", "mnemonic": "lda", "operand": "#4"}, {"addr": 36265, "bytes": [76, 6, 4], "type": "code", "mnemonic": "jmp", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 36268, "bytes": [108, 9, 15], "labels": ["c8dac"], "comments_before": ["&8dac referenced 2 times by &8d96, &8d9e"], "references": [36246, 36254], "type": "code", "mnemonic": "jmp", "operand": "(l0f09)", "target": 3849, "target_label": "l0f09"}, {"addr": 36271, "bytes": [160, 111], "labels": ["net1_read_handle"], "comments_before": ["***************************************************************************************", "*NET1: read file handle from received packet\n\nReads a file handle byte from offset &6F in the RX buffer\n(net_rx_ptr), stores it in &F0, then falls through to the\ncommon handle workspace cleanup at c8dda (clear fs_temp_ce).", "***************************************************************************************"], "type": "code", "mnemonic": "ldy", "operand": "#&6f"}, {"addr": 36273, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36275, "bytes": [133, 240], "type": "code", "mnemonic": "sta", "operand": "l00f0", "target": 240, "target_label": "l00f0"}, {"addr": 36277, "bytes": [144, 35], "type": "code", "mnemonic": "bcc", "operand": "c8dda", "target": 36314, "target_label": "c8dda"}, {"addr": 36279, "bytes": [10], "labels": ["calc_handle_offset"], "comments_before": ["***************************************************************************************", "Calculate handle workspace offset\n\nConverts a file handle number (in A) to a byte offset (in Y)\ninto the NFS handle workspace. The calculation is A*12:\n  ASL A (A*2), ASL A (A*4), PHA, ASL A (A*8),\n  ADC stack (A*8 + A*4 = A*12).\nValidates that the offset is < &48 (max 6 handles \u00d7 12 bytes\nper handle entry = 72 bytes). If invalid (>= &48), returns\nwith C set and Y=0, A=0 as an error indicator.", "***************************************************************************************", "&8db7 referenced 5 times by &82b6, &8dcb, &8de1, &8f01, &8f1a"], "references": [36299, 36321, 36634, 36609, 33462], "type": "code", "mnemonic": "asl"}, {"addr": 36280, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 36281, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36282, "bytes": [10], "type": "code", "mnemonic": "asl"}, {"addr": 36283, "bytes": [186], "type": "code", "mnemonic": "tsx"}, {"addr": 36284, "bytes": [125, 1, 1], "type": "code", "mnemonic": "adc", "operand": "l0101,x", "target": 257, "target_label": "l0101"}, {"addr": 36287, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 36288, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 36289, "bytes": [201, 72], "type": "code", "mnemonic": "cmp", "operand": "#&48"}, {"addr": 36291, "bytes": [144, 3], "type": "code", "mnemonic": "bcc", "operand": "return_7", "target": 36296, "target_label": "return_7"}, {"addr": 36293, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 36295, "bytes": [152], "comment_inline": "A=&00", "type": "code", "mnemonic": "tya"}, {"addr": 36296, "bytes": [96], "labels": ["return_7"], "comments_before": ["&8dc8 referenced 1 time by &8dc3"], "references": [36291], "type": "code", "mnemonic": "rts"}, {"addr": 36297, "bytes": [165, 240], "labels": ["net2_read_handle_entry"], "comments_before": ["***************************************************************************************", "*NET2: read handle entry from workspace\n\nLooks up the handle in &F0 via calc_handle_offset. If the\nworkspace slot contains &3F ('?', meaning unused/closed),\nreturns 0. Otherwise returns the stored handle value.\nClears fs_temp_ce on exit.", "***************************************************************************************"], "type": "code", "mnemonic": "lda", "operand": "l00f0", "target": 240, "target_label": "l00f0"}, {"addr": 36299, "bytes": [32, 183, 141], "type": "code", "mnemonic": "jsr", "operand": "calc_handle_offset", "target": 36279, "target_label": "calc_handle_offset"}, {"addr": 36302, "bytes": [176, 6], "type": "code", "mnemonic": "bcs", "operand": "rxpol2", "target": 36310, "target_label": "rxpol2"}, {"addr": 36304, "bytes": [177, 158], "type": "code", "mnemonic": "lda", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36306, "bytes": [201, 63], "type": "code", "mnemonic": "cmp", "operand": "#&3f"}, {"addr": 36308, "bytes": [208, 2], "type": "code", "mnemonic": "bne", "operand": "c8dd8", "target": 36312, "target_label": "c8dd8"}, {"addr": 36310, "bytes": [169, 0], "labels": ["rxpol2"], "comments_before": ["&8dd6 referenced 2 times by &8dce, &8de4"], "references": [36302, 36324], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 36312, "bytes": [133, 240], "labels": ["c8dd8"], "comments_before": ["&8dd8 referenced 1 time by &8dd4"], "references": [36308], "type": "code", "mnemonic": "sta", "operand": "l00f0", "target": 240, "target_label": "l00f0"}, {"addr": 36314, "bytes": [169, 0], "labels": ["c8dda"], "comments_before": ["&8dda referenced 3 times by &8db5, &8df0, &8df5"], "references": [36341, 36277, 36336], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 36316, "bytes": [133, 206], "type": "code", "mnemonic": "sta", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 36318, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36319, "bytes": [165, 240], "labels": ["net3_close_handle"], "comments_before": ["***************************************************************************************", "*NET3: close handle (mark as unused)\n\nLooks up the handle in &F0 via calc_handle_offset. Writes\n&3F ('?') to mark the handle slot as closed in the NFS\nworkspace. Preserves the carry flag state across the write\nusing ROL/ROR on rx_status_flags. Clears fs_temp_ce on exit.", "***************************************************************************************"], "type": "code", "mnemonic": "lda", "operand": "l00f0", "target": 240, "target_label": "l00f0"}, {"addr": 36321, "bytes": [32, 183, 141], "type": "code", "mnemonic": "jsr", "operand": "calc_handle_offset", "target": 36279, "target_label": "calc_handle_offset"}, {"addr": 36324, "bytes": [176, 240], "type": "code", "mnemonic": "bcs", "operand": "rxpol2", "target": 36310, "target_label": "rxpol2"}, {"addr": 36326, "bytes": [46, 56, 13], "type": "code", "mnemonic": "rol", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 36329, "bytes": [169, 63], "type": "code", "mnemonic": "lda", "operand": "#&3f"}, {"addr": 36331, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36333, "bytes": [110, 56, 13], "type": "code", "mnemonic": "ror", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 36336, "bytes": [144, 232], "type": "code", "mnemonic": "bcc", "operand": "c8dda", "target": 36314, "target_label": "c8dda"}, {"addr": 36338, "bytes": [32, 70, 129], "labels": ["net4_resume_remote"], "comments_before": ["***************************************************************************************", "*NET4: resume after remote operation\n\nCalls resume_after_remote (&8146) to re-enable the keyboard\nand send a completion notification. The BVC always branches\nto c8dda (clear fs_temp_ce) since resume_after_remote\nreturns with V clear (from CLV in prepare_cmd_clv).", "***************************************************************************************"], "type": "code", "mnemonic": "jsr", "operand": "resume_after_remote", "target": 33094, "target_label": "resume_after_remote"}, {"addr": 36341, "bytes": [80, 227], "type": "code", "mnemonic": "bvc", "operand": "c8dda", "target": 36314, "target_label": "c8dda"}, {"addr": 36343, "bytes": [165, 239], "labels": ["osword_fs_entry"], "comments_before": ["***************************************************************************************", "Filing system OSWORD entry\n\nSubtracts &0F from the command code in &EF, giving a 0-4 index\nfor OSWORD calls &0F-&13 (15-19). Falls through to the\nPHA/PHA/RTS dispatch at &8E01.", "***************************************************************************************"], "comment_inline": "Command code from &EF", "type": "code", "mnemonic": "lda", "operand": "l00ef", "target": 239, "target_label": "l00ef"}, {"addr": 36345, "bytes": [233, 15], "comment_inline": "Subtract &0F: OSWORD &0F-&13 become indices 0-4", "type": "code", "mnemonic": "sbc", "operand": "#&0f"}, {"addr": 36347, "bytes": [48, 53], "type": "code", "mnemonic": "bmi", "operand": "return_8", "target": 36402, "target_label": "return_8"}, {"addr": 36349, "bytes": [201, 5], "type": "code", "mnemonic": "cmp", "operand": "#5"}, {"addr": 36351, "bytes": [176, 49], "type": "code", "mnemonic": "bcs", "operand": "return_8", "target": 36402, "target_label": "return_8"}, {"addr": 36353, "bytes": [170], "labels": ["fs_osword_dispatch"], "comments_before": ["***************************************************************************************", "PHA/PHA/RTS dispatch for filing system OSWORDs\n\nX = OSWORD number - &0F (0-4). Dispatches via the 5-entry table\nat &8E18 (low) / &8E1D (high).", "***************************************************************************************"], "type": "code", "mnemonic": "tax"}, {"addr": 36354, "bytes": [189, 29, 142], "type": "code", "mnemonic": "lda", "operand": "fs_osword_tbl_hi,x", "target": 36381, "target_label": "fs_osword_tbl_hi"}, {"addr": 36357, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36358, "bytes": [189, 24, 142], "type": "code", "mnemonic": "lda", "operand": "fs_osword_tbl_lo,x", "target": 36376, "target_label": "fs_osword_tbl_lo"}, {"addr": 36361, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36362, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 36364, "bytes": [185, 189, 0], "labels": ["save1"], "comments_before": ["&8e0c referenced 1 time by &8e12"], "references": [36370], "type": "code", "mnemonic": "lda", "operand": "fs_last_byte_flag,y", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 36367, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36369, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36370, "bytes": [16, 248], "type": "code", "mnemonic": "bpl", "operand": "save1", "target": 36364, "target_label": "save1"}, {"addr": 36372, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36373, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36375, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36376, "bytes": [50], "labels": ["fs_osword_tbl_lo"], "comments_before": ["&8e18 referenced 1 time by &8e06"], "comment_inline": "Dispatch table: low bytes for OSWORD &0F-&13 handlers", "references": [36358], "type": "byte", "values": [50]}, {"addr": 36377, "bytes": [239], "type": "byte", "values": [239]}, {"addr": 36378, "bytes": [82], "type": "byte", "values": [82]}, {"addr": 36379, "bytes": [122], "type": "byte", "values": [122]}, {"addr": 36380, "bytes": [113], "type": "byte", "values": [113]}, {"addr": 36381, "bytes": [142], "labels": ["fs_osword_tbl_hi"], "comments_before": ["&8e1d referenced 1 time by &8e02"], "comment_inline": "Dispatch table: high bytes for OSWORD &0F-&13 handlers", "references": [36354], "type": "byte", "values": [142]}, {"addr": 36382, "bytes": [142], "type": "byte", "values": [142]}, {"addr": 36383, "bytes": [142], "type": "byte", "values": [142]}, {"addr": 36384, "bytes": [142], "type": "byte", "values": [142]}, {"addr": 36385, "bytes": [143], "type": "byte", "values": [143]}, {"addr": 36386, "bytes": [144, 6], "labels": ["copy_param_block"], "comments_before": ["***************************************************************************************", "Bidirectional block copy between OSWORD param block and workspace.\n\nC=1: copy X+1 bytes from (&F0),Y to (fs_crc_lo),Y (param to workspace)\nC=0: copy X+1 bytes from (fs_crc_lo),Y to (&F0),Y (workspace to param)", "***************************************************************************************", "&8e22 referenced 5 times by &8e30, &8e46, &8e62, &8e96, &8f31"], "references": [36400, 36422, 36450, 36502, 36657], "type": "code", "mnemonic": "bcc", "operand": "c8e2a", "target": 36394, "target_label": "c8e2a"}, {"addr": 36388, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36390, "bytes": [145, 190], "type": "code", "mnemonic": "sta", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36392, "bytes": [176, 4], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcs", "operand": "copyl3", "target": 36398, "target_label": "copyl3"}, {"addr": 36394, "bytes": [177, 190], "labels": ["c8e2a"], "comments_before": ["&8e2a referenced 1 time by &8e22"], "references": [36386], "type": "code", "mnemonic": "lda", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36396, "bytes": [145, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36398, "bytes": [200], "labels": ["copyl3"], "comments_before": ["&8e2e referenced 1 time by &8e28"], "references": [36392], "type": "code", "mnemonic": "iny"}, {"addr": 36399, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 36400, "bytes": [16, 240], "type": "code", "mnemonic": "bpl", "operand": "copy_param_block", "target": 36386, "target_label": "copy_param_block"}, {"addr": 36402, "bytes": [96], "labels": ["return_8"], "comments_before": ["&8e32 referenced 2 times by &8dfb, &8dff"], "references": [36347, 36351], "type": "code", "mnemonic": "rts"}, {"addr": 36403, "bytes": [14, 58, 13], "labels": ["osword_0f_handler"], "comments_before": ["***************************************************************************************", "OSWORD &0F handler: initiate transmit (CALLTX)\n\nChecks the TX semaphore (TXCLR at &0D62) via ASL -- if carry is\nclear, a TX is already in progress and the call returns an error,\npreventing user code from corrupting a system transmit. Otherwise\ncopies 16 bytes from the caller's OSWORD parameter block into the\nuser TX control block (UTXCB) in static workspace. The TXCB\npointer is copied to LTXCBP only after the semaphore is claimed,\nensuring the low-level transmit code (BRIANX) sees a consistent\npointer -- if copied before claiming, another transmitter could\nmodify TXCBP between the copy and the claim.\n\nOn Entry:\n    X: parameter block address low byte\n    Y: parameter block address high byte\n\nOn Exit:\n    A: corrupted\n    X: corrupted\n    Y: &FF", "***************************************************************************************"], "type": "code", "mnemonic": "asl", "operand": "tx_ctrl_status", "target": 3386, "target_label": "tx_ctrl_status"}, {"addr": 36406, "bytes": [144, 23], "type": "code", "mnemonic": "bcc", "operand": "c8e4f", "target": 36431, "target_label": "c8e4f"}, {"addr": 36408, "bytes": [165, 157], "type": "code", "mnemonic": "lda", "operand": "net_rx_ptr_hi", "target": 157, "target_label": "net_rx_ptr_hi"}, {"addr": 36410, "bytes": [133, 191], "type": "code", "mnemonic": "sta", "operand": "fs_crc_hi", "target": 191, "target_label": "fs_crc_hi"}, {"addr": 36412, "bytes": [133, 161], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block_hi", "target": 161, "target_label": "nmi_tx_block_hi"}, {"addr": 36414, "bytes": [169, 111], "type": "code", "mnemonic": "lda", "operand": "#&6f"}, {"addr": 36416, "bytes": [133, 190], "type": "code", "mnemonic": "sta", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36418, "bytes": [133, 160], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 36420, "bytes": [162, 15], "type": "code", "mnemonic": "ldx", "operand": "#&0f"}, {"addr": 36422, "bytes": [32, 34, 142], "type": "code", "mnemonic": "jsr", "operand": "copy_param_block", "target": 36386, "target_label": "copy_param_block"}, {"addr": 36425, "bytes": [32, 96, 150], "type": "code", "mnemonic": "jsr", "operand": "trampoline_tx_setup", "target": 38496, "target_label": "trampoline_tx_setup"}, {"addr": 36428, "bytes": [76, 72, 143], "type": "code", "mnemonic": "jmp", "operand": "c8f48", "target": 36680, "target_label": "c8f48"}, {"addr": 36431, "bytes": [56], "labels": ["c8e4f"], "comments_before": ["&8e4f referenced 1 time by &8e36"], "references": [36406], "type": "code", "mnemonic": "sec"}, {"addr": 36432, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 36433, "bytes": [176, 34], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcs", "operand": "readry", "target": 36469, "target_label": "readry"}, {"addr": 36435, "bytes": [165, 157], "labels": ["osword_11_handler"], "comments_before": ["***************************************************************************************", "OSWORD &11 handler: read JSR arguments (READRA)\n\nCopies the JSR (remote procedure call) argument buffer from the\nstatic workspace page back to the caller's OSWORD parameter block.\nReads the buffer size from workspace offset JSRSIZ, then copies\nthat many bytes. After the copy, clears the old LSTAT byte via\nCLRJSR to reset the protection status. Also provides READRB as\na sub-entry (&8E6A) to return just the buffer size and args size\nwithout copying the data.", "***************************************************************************************"], "type": "code", "mnemonic": "lda", "operand": "net_rx_ptr_hi", "target": 157, "target_label": "net_rx_ptr_hi"}, {"addr": 36437, "bytes": [133, 191], "type": "code", "mnemonic": "sta", "operand": "fs_crc_hi", "target": 191, "target_label": "fs_crc_hi"}, {"addr": 36439, "bytes": [160, 127], "type": "code", "mnemonic": "ldy", "operand": "#&7f"}, {"addr": 36441, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36443, "bytes": [200], "comment_inline": "Y=&80", "type": "code", "mnemonic": "iny"}, {"addr": 36444, "bytes": [132, 190], "type": "code", "mnemonic": "sty", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36446, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 36447, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 36448, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 36450, "bytes": [32, 34, 142], "type": "code", "mnemonic": "jsr", "operand": "copy_param_block", "target": 36386, "target_label": "copy_param_block"}, {"addr": 36453, "bytes": [32, 214, 146], "type": "code", "mnemonic": "jsr", "operand": "clear_jsr_protection", "target": 37590, "target_label": "clear_jsr_protection"}, {"addr": 36456, "bytes": [144, 66], "type": "code", "mnemonic": "bcc", "operand": "c8eac", "target": 36524, "target_label": "c8eac"}, {"addr": 36458, "bytes": [160, 127], "labels": ["read_args_size"], "comments_before": ["&8e6a referenced 1 time by &8ebd"], "references": [36541], "type": "code", "mnemonic": "ldy", "operand": "#&7f"}, {"addr": 36460, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36462, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 36464, "bytes": [145, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36466, "bytes": [200], "comment_inline": "Y=&02", "type": "code", "mnemonic": "iny"}, {"addr": 36467, "bytes": [169, 128], "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 36469, "bytes": [145, 240], "labels": ["readry"], "comments_before": ["&8e75 referenced 1 time by &8e51"], "references": [36433], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36471, "bytes": [176, 104], "type": "code", "mnemonic": "bcs", "operand": "c8ee1", "target": 36577, "target_label": "c8ee1"}, {"addr": 36473, "bytes": [255, 1], "labels": ["l8e79"], "comments_before": ["&8e79 referenced 1 time by &8e8d"], "references": [36493], "type": "byte", "values": [255, 1]}, {"addr": 36475, "bytes": [201, 6], "labels": ["osword_12_handler"], "comments_before": ["***************************************************************************************", "OSWORD &12 handler: read/set state information (RS)\n\nDispatches on the sub-function code (0-9):\n  0: read FS station (FSLOCN at &0E00)\n  1: set FS station\n  2: read printer server station (PSLOCN)\n  3: set printer server station\n  4: read protection masks (LSTAT at &D63)\n  5: set protection masks\n  6: read context handles (URD/CSD/LIB, converted from\n     internal single-bit form back to handle numbers)\n  7: set context handles (converted to internal form)\n  8: read local station number\n  9: read JSR arguments buffer size\nEven-numbered sub-functions read; odd-numbered ones write.\nUses the bidirectional copy at &8E22 for station read/set.", "***************************************************************************************"], "type": "code", "mnemonic": "cmp", "operand": "#6"}, {"addr": 36477, "bytes": [176, 56], "type": "code", "mnemonic": "bcs", "operand": "rsl1", "target": 36535, "target_label": "rsl1"}, {"addr": 36479, "bytes": [201, 4], "type": "code", "mnemonic": "cmp", "operand": "#4"}, {"addr": 36481, "bytes": [176, 24], "type": "code", "mnemonic": "bcs", "operand": "rssl1", "target": 36507, "target_label": "rssl1"}, {"addr": 36483, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 36484, "bytes": [162, 13], "type": "code", "mnemonic": "ldx", "operand": "#&0d"}, {"addr": 36486, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 36487, "bytes": [240, 2], "type": "code", "mnemonic": "beq", "operand": "c8e8b", "target": 36491, "target_label": "c8e8b"}, {"addr": 36489, "bytes": [166, 159], "type": "code", "mnemonic": "ldx", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 36491, "bytes": [134, 191], "labels": ["c8e8b"], "comments_before": ["&8e8b referenced 1 time by &8e87"], "references": [36487], "type": "code", "mnemonic": "stx", "operand": "fs_crc_hi", "target": 191, "target_label": "fs_crc_hi"}, {"addr": 36493, "bytes": [185, 121, 142], "type": "code", "mnemonic": "lda", "operand": "l8e79,y", "target": 36473, "target_label": "l8e79"}, {"addr": 36496, "bytes": [133, 190], "type": "code", "mnemonic": "sta", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36498, "bytes": [162, 1], "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 36500, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 36502, "bytes": [32, 34, 142], "type": "code", "mnemonic": "jsr", "operand": "copy_param_block", "target": 36386, "target_label": "copy_param_block"}, {"addr": 36505, "bytes": [208, 17], "type": "code", "mnemonic": "bne", "operand": "c8eac", "target": 36524, "target_label": "c8eac"}, {"addr": 36507, "bytes": [74], "labels": ["rssl1"], "comments_before": ["&8e9b referenced 1 time by &8e81"], "references": [36481], "type": "code", "mnemonic": "lsr"}, {"addr": 36508, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36509, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36511, "bytes": [176, 5], "type": "code", "mnemonic": "bcs", "operand": "rssl2", "target": 36518, "target_label": "rssl2"}, {"addr": 36513, "bytes": [173, 99, 13], "type": "code", "mnemonic": "lda", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 36516, "bytes": [145, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36518, "bytes": [141, 99, 13], "labels": ["rssl2"], "comments_before": ["&8ea6 referenced 1 time by &8e9f"], "references": [36511], "type": "code", "mnemonic": "sta", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 36521, "bytes": [141, 59, 13], "type": "code", "mnemonic": "sta", "operand": "rx_ctrl_copy", "target": 3387, "target_label": "rx_ctrl_copy"}, {"addr": 36524, "bytes": [56], "labels": ["c8eac"], "comments_before": ["&8eac referenced 2 times by &8e68, &8e99"], "references": [36456, 36505], "type": "code", "mnemonic": "sec"}, {"addr": 36525, "bytes": [176, 50], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcs", "operand": "c8ee1", "target": 36577, "target_label": "c8ee1"}, {"addr": 36527, "bytes": [173, 98, 13], "labels": ["loop_c8eaf"], "comments_before": ["&8eaf referenced 1 time by &8eb9"], "references": [36537], "type": "code", "mnemonic": "lda", "operand": "tx_clear_flag", "target": 3426, "target_label": "tx_clear_flag"}, {"addr": 36530, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36531, "bytes": [145, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36533, "bytes": [176, 42], "type": "code", "mnemonic": "bcs", "operand": "c8ee1", "target": 36577, "target_label": "c8ee1"}, {"addr": 36535, "bytes": [201, 8], "labels": ["rsl1"], "comments_before": ["&8eb7 referenced 1 time by &8e7d"], "references": [36477], "type": "code", "mnemonic": "cmp", "operand": "#8"}, {"addr": 36537, "bytes": [240, 244], "type": "code", "mnemonic": "beq", "operand": "loop_c8eaf", "target": 36527, "target_label": "loop_c8eaf"}, {"addr": 36539, "bytes": [201, 9], "type": "code", "mnemonic": "cmp", "operand": "#9"}, {"addr": 36541, "bytes": [240, 171], "type": "code", "mnemonic": "beq", "operand": "read_args_size", "target": 36458, "target_label": "read_args_size"}, {"addr": 36543, "bytes": [16, 26], "type": "code", "mnemonic": "bpl", "operand": "c8edb", "target": 36571, "target_label": "c8edb"}, {"addr": 36545, "bytes": [160, 3], "type": "code", "mnemonic": "ldy", "operand": "#3"}, {"addr": 36547, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 36548, "bytes": [144, 29], "type": "code", "mnemonic": "bcc", "operand": "readc1", "target": 36579, "target_label": "readc1"}, {"addr": 36550, "bytes": [132, 205], "type": "code", "mnemonic": "sty", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 36552, "bytes": [164, 205], "labels": ["loop_c8ec8"], "comments_before": ["&8ec8 referenced 1 time by &8ed7"], "references": [36567], "type": "code", "mnemonic": "ldy", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 36554, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36556, "bytes": [32, 136, 133], "type": "code", "mnemonic": "jsr", "operand": "handle_to_mask_a", "target": 34184, "target_label": "handle_to_mask_a"}, {"addr": 36559, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 36560, "bytes": [164, 205], "type": "code", "mnemonic": "ldy", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 36562, "bytes": [153, 1, 14], "type": "code", "mnemonic": "sta", "operand": "fs_server_net,y", "target": 3585, "target_label": "fs_server_net"}, {"addr": 36565, "bytes": [198, 205], "type": "code", "mnemonic": "dec", "operand": "fs_temp_cd", "target": 205, "target_label": "fs_temp_cd"}, {"addr": 36567, "bytes": [208, 239], "type": "code", "mnemonic": "bne", "operand": "loop_c8ec8", "target": 36552, "target_label": "loop_c8ec8"}, {"addr": 36569, "bytes": [240, 109], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "c8f48", "target": 36680, "target_label": "c8f48"}, {"addr": 36571, "bytes": [200], "labels": ["c8edb"], "comments_before": ["&8edb referenced 1 time by &8ebf"], "references": [36543], "type": "code", "mnemonic": "iny"}, {"addr": 36572, "bytes": [173, 9, 14], "type": "code", "mnemonic": "lda", "operand": "fs_last_error", "target": 3593, "target_label": "fs_last_error"}, {"addr": 36575, "bytes": [145, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36577, "bytes": [176, 101], "labels": ["c8ee1"], "comments_before": ["&8ee1 referenced 3 times by &8e77, &8ead, &8eb5"], "references": [36471, 36533, 36525], "type": "code", "mnemonic": "bcs", "operand": "c8f48", "target": 36680, "target_label": "c8f48"}, {"addr": 36579, "bytes": [185, 1, 14], "labels": ["readc1"], "comments_before": ["&8ee3 referenced 2 times by &8ec4, &8eec"], "comment_inline": "A=single-bit bitmask", "references": [36548, 36588], "type": "code", "mnemonic": "lda", "operand": "fs_server_net,y", "target": 3585, "target_label": "fs_server_net"}, {"addr": 36582, "bytes": [32, 165, 133], "comment_inline": "Convert bitmask to handle number (FS2A)", "type": "code", "mnemonic": "jsr", "operand": "mask_to_handle", "target": 34213, "target_label": "mask_to_handle"}, {"addr": 36585, "bytes": [145, 240], "comment_inline": "A=handle number (&20-&27) Y=preserved", "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36587, "bytes": [136], "comment_inline": "Y=parameter block address high byte", "type": "code", "mnemonic": "dey"}, {"addr": 36588, "bytes": [208, 245], "type": "code", "mnemonic": "bne", "operand": "readc1", "target": 36579, "target_label": "readc1"}, {"addr": 36590, "bytes": [240, 88], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "c8f48", "target": 36680, "target_label": "c8f48"}, {"addr": 36592, "bytes": [166, 159], "labels": ["osword_10_handler"], "comments_before": ["***************************************************************************************", "OSWORD &10 handler: open/read RX control block (OPENRX)\n\nIf the first byte of the caller's parameter block is zero, scans\nfor a free RXCB (flag byte = &3F = deleted) starting from RXCB #3\n(RXCBs 0-2 are dedicated: printer, remote, FS). Returns the RXCB\nnumber in the first byte, or zero if none free. If the first byte\nis non-zero, reads the specified RXCB's data back into the caller's\nparameter block (12 bytes) and then deletes the RXCB by setting\nits flag byte to &3F -- a consume-once semantic so user code reads\nreceived data and frees the CB in a single atomic operation,\npreventing double-reads. The low-level user RX flag (LFLAG) is\ntemporarily disabled via ROR/ROL during the operation to prevent\nthe interrupt-driven receive code from modifying a CB that is\nbeing read or opened.\n\nOn Entry:\n    X: parameter block address low byte\n    Y: parameter block address high byte\n\nOn Exit:\n    A: corrupted\n    X: corrupted\n    Y: &FF", "***************************************************************************************"], "type": "code", "mnemonic": "ldx", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 36594, "bytes": [134, 191], "type": "code", "mnemonic": "stx", "operand": "fs_crc_hi", "target": 191, "target_label": "fs_crc_hi"}, {"addr": 36596, "bytes": [132, 190], "type": "code", "mnemonic": "sty", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36598, "bytes": [110, 56, 13], "type": "code", "mnemonic": "ror", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 36601, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36603, "bytes": [133, 189], "type": "code", "mnemonic": "sta", "operand": "fs_last_byte_flag", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 36605, "bytes": [208, 27], "type": "code", "mnemonic": "bne", "operand": "c8f1a", "target": 36634, "target_label": "c8f1a"}, {"addr": 36607, "bytes": [169, 3], "type": "code", "mnemonic": "lda", "operand": "#3"}, {"addr": 36609, "bytes": [32, 183, 141], "labels": ["scan0"], "comments_before": ["&8f01 referenced 1 time by &8f13"], "references": [36627], "type": "code", "mnemonic": "jsr", "operand": "calc_handle_offset", "target": 36279, "target_label": "calc_handle_offset"}, {"addr": 36612, "bytes": [176, 61], "type": "code", "mnemonic": "bcs", "operand": "openl4", "target": 36675, "target_label": "openl4"}, {"addr": 36614, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 36615, "bytes": [74], "type": "code", "mnemonic": "lsr"}, {"addr": 36616, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 36617, "bytes": [177, 190], "type": "code", "mnemonic": "lda", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36619, "bytes": [240, 54], "type": "code", "mnemonic": "beq", "operand": "openl4", "target": 36675, "target_label": "openl4"}, {"addr": 36621, "bytes": [201, 63], "type": "code", "mnemonic": "cmp", "operand": "#&3f"}, {"addr": 36623, "bytes": [240, 4], "type": "code", "mnemonic": "beq", "operand": "scan1", "target": 36629, "target_label": "scan1"}, {"addr": 36625, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 36626, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 36627, "bytes": [208, 236], "type": "code", "mnemonic": "bne", "operand": "scan0", "target": 36609, "target_label": "scan0"}, {"addr": 36629, "bytes": [138], "labels": ["scan1"], "comments_before": ["&8f15 referenced 1 time by &8f0f"], "references": [36623], "type": "code", "mnemonic": "txa"}, {"addr": 36630, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 36632, "bytes": [129, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0,x)", "target": 240, "target_label": "l00f0"}, {"addr": 36634, "bytes": [32, 183, 141], "labels": ["c8f1a"], "comments_before": ["&8f1a referenced 1 time by &8efd"], "references": [36605], "type": "code", "mnemonic": "jsr", "operand": "calc_handle_offset", "target": 36279, "target_label": "calc_handle_offset"}, {"addr": 36637, "bytes": [176, 36], "type": "code", "mnemonic": "bcs", "operand": "openl4", "target": 36675, "target_label": "openl4"}, {"addr": 36639, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36640, "bytes": [132, 190], "type": "code", "mnemonic": "sty", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36642, "bytes": [169, 192], "type": "code", "mnemonic": "lda", "operand": "#&c0"}, {"addr": 36644, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 36646, "bytes": [162, 11], "type": "code", "mnemonic": "ldx", "operand": "#&0b"}, {"addr": 36648, "bytes": [196, 189], "type": "code", "mnemonic": "cpy", "operand": "fs_last_byte_flag", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 36650, "bytes": [113, 190], "type": "code", "mnemonic": "adc", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36652, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "openl6", "target": 36657, "target_label": "openl6"}, {"addr": 36654, "bytes": [48, 14], "type": "code", "mnemonic": "bmi", "operand": "openl7", "target": 36670, "target_label": "openl7"}, {"addr": 36656, "bytes": [24], "labels": ["loop_c8f30"], "comments_before": ["&8f30 referenced 1 time by &8f40"], "references": [36672], "type": "code", "mnemonic": "clc"}, {"addr": 36657, "bytes": [32, 34, 142], "labels": ["openl6"], "comments_before": ["&8f31 referenced 1 time by &8f2c"], "references": [36652], "type": "code", "mnemonic": "jsr", "operand": "copy_param_block", "target": 36386, "target_label": "copy_param_block"}, {"addr": 36660, "bytes": [176, 15], "type": "code", "mnemonic": "bcs", "operand": "c8f45", "target": 36677, "target_label": "c8f45"}, {"addr": 36662, "bytes": [169, 63], "type": "code", "mnemonic": "lda", "operand": "#&3f"}, {"addr": 36664, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 36666, "bytes": [145, 190], "type": "code", "mnemonic": "sta", "operand": "(fs_crc_lo),y", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36668, "bytes": [208, 7], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c8f45", "target": 36677, "target_label": "c8f45"}, {"addr": 36670, "bytes": [105, 1], "labels": ["openl7"], "comments_before": ["&8f3e referenced 1 time by &8f2e"], "references": [36654], "type": "code", "mnemonic": "adc", "operand": "#1"}, {"addr": 36672, "bytes": [208, 238], "type": "code", "mnemonic": "bne", "operand": "loop_c8f30", "target": 36656, "target_label": "loop_c8f30"}, {"addr": 36674, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36675, "bytes": [145, 240], "labels": ["openl4"], "comments_before": ["&8f43 referenced 3 times by &8f04, &8f0b, &8f1d"], "references": [36637, 36612, 36619], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36677, "bytes": [46, 56, 13], "labels": ["c8f45"], "comments_before": ["&8f45 referenced 2 times by &8f34, &8f3c"], "references": [36660, 36668], "type": "code", "mnemonic": "rol", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 36680, "bytes": [160, 0], "labels": ["c8f48"], "comments_before": ["&8f48 referenced 6 times by &8e4c, &8ed9, &8ee1, &8eee, &8fbe, &9004"], "references": [36577, 36428, 36590, 36569, 36868, 36798], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 36682, "bytes": [132, 206], "type": "code", "mnemonic": "sty", "operand": "fs_temp_ce", "target": 206, "target_label": "fs_temp_ce"}, {"addr": 36684, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 36686, "bytes": [177, 156], "labels": ["rest1"], "comments_before": ["&8f4e referenced 1 time by &8f54"], "references": [36692], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36688, "bytes": [153, 189, 0], "type": "code", "mnemonic": "sta", "operand": "fs_last_byte_flag,y", "target": 189, "target_label": "fs_last_byte_flag"}, {"addr": 36691, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36692, "bytes": [16, 248], "type": "code", "mnemonic": "bpl", "operand": "rest1", "target": 36686, "target_label": "rest1"}, {"addr": 36694, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36695, "bytes": [160, 40], "labels": ["setup_rx_buffer_ptrs"], "comments_before": ["***************************************************************************************", "Set up RX buffer pointers in NFS workspace\n\nCalculates the start address of the RX data area (&F0+1) and stores\nit at workspace offset &28. Also reads the data length from (&F0)+1\nand adds it to &F0 to compute the end address at offset &2C.", "***************************************************************************************", "&8f57 referenced 1 time by &8f8a"], "references": [36746], "type": "code", "mnemonic": "ldy", "operand": "#&28"}, {"addr": 36697, "bytes": [165, 240], "type": "code", "mnemonic": "lda", "operand": "l00f0", "target": 240, "target_label": "l00f0"}, {"addr": 36699, "bytes": [105, 1], "type": "code", "mnemonic": "adc", "operand": "#1"}, {"addr": 36701, "bytes": [32, 104, 143], "type": "code", "mnemonic": "jsr", "operand": "store_16bit_at_y", "target": 36712, "target_label": "store_16bit_at_y"}, {"addr": 36704, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 36706, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36708, "bytes": [160, 44], "type": "code", "mnemonic": "ldy", "operand": "#&2c"}, {"addr": 36710, "bytes": [101, 240], "type": "code", "mnemonic": "adc", "operand": "l00f0", "target": 240, "target_label": "l00f0"}, {"addr": 36712, "bytes": [145, 158], "labels": ["store_16bit_at_y"], "comments_before": ["&8f68 referenced 1 time by &8f5d"], "references": [36701], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36714, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36715, "bytes": [165, 241], "type": "code", "mnemonic": "lda", "operand": "l00f1", "target": 241, "target_label": "l00f1"}, {"addr": 36717, "bytes": [105, 0], "type": "code", "mnemonic": "adc", "operand": "#0"}, {"addr": 36719, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36721, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36722, "bytes": [201, 1], "labels": ["econet_tx_rx"], "comments_before": ["***************************************************************************************", "Econet transmit/receive handler\n\nA=0: Initialise TX control block from ROM template at &8310\n     (zero entries substituted from NMI workspace &0DDA), transmit\n     it, set up RX control block, and receive reply.\nA>=1: Handle transmit result (branch to cleanup at &8F48).", "***************************************************************************************"], "comment_inline": "A=0: set up and transmit; A>=1: handle result", "type": "code", "mnemonic": "cmp", "operand": "#1"}, {"addr": 36724, "bytes": [176, 74], "type": "code", "mnemonic": "bcs", "operand": "c8fc0", "target": 36800, "target_label": "c8fc0"}, {"addr": 36726, "bytes": [160, 47], "type": "code", "mnemonic": "ldy", "operand": "#&2f"}, {"addr": 36728, "bytes": [185, 16, 131], "labels": ["dofs01"], "comments_before": ["&8f78 referenced 1 time by &8f85"], "comment_inline": "Load from ROM template (zero = use NMI workspace value)", "references": [36741], "type": "code", "mnemonic": "lda", "operand": "init_tx_ctrl_port,y", "target": 33552, "target_label": "init_tx_ctrl_port"}, {"addr": 36731, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "c8f80", "target": 36736, "target_label": "c8f80"}, {"addr": 36733, "bytes": [185, 218, 13], "type": "code", "mnemonic": "lda", "operand": "l0dda,y", "target": 3546, "target_label": "l0dda"}, {"addr": 36736, "bytes": [145, 158], "labels": ["c8f80"], "comments_before": ["&8f80 referenced 1 time by &8f7b"], "references": [36731], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36738, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36739, "bytes": [192, 35], "type": "code", "mnemonic": "cpy", "operand": "#&23"}, {"addr": 36741, "bytes": [208, 241], "type": "code", "mnemonic": "bne", "operand": "dofs01", "target": 36728, "target_label": "dofs01"}, {"addr": 36743, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36744, "bytes": [132, 154], "type": "code", "mnemonic": "sty", "operand": "net_tx_ptr", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 36746, "bytes": [32, 87, 143], "type": "code", "mnemonic": "jsr", "operand": "setup_rx_buffer_ptrs", "target": 36695, "target_label": "setup_rx_buffer_ptrs"}, {"addr": 36749, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 36751, "bytes": [169, 144], "type": "code", "mnemonic": "lda", "operand": "#&90"}, {"addr": 36753, "bytes": [145, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36755, "bytes": [200], "comment_inline": "Y=&03", "type": "code", "mnemonic": "iny"}, {"addr": 36756, "bytes": [200], "comment_inline": "Y=&04", "type": "code", "mnemonic": "iny"}, {"addr": 36757, "bytes": [185, 254, 13], "labels": ["loop_c8f95"], "comments_before": ["&8f95 referenced 1 time by &8f9d"], "references": [36765], "type": "code", "mnemonic": "lda", "operand": "l0dfe,y", "target": 3582, "target_label": "l0dfe"}, {"addr": 36760, "bytes": [145, 240], "type": "code", "mnemonic": "sta", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36762, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36763, "bytes": [192, 7], "type": "code", "mnemonic": "cpy", "operand": "#7"}, {"addr": 36765, "bytes": [208, 246], "type": "code", "mnemonic": "bne", "operand": "loop_c8f95", "target": 36757, "target_label": "loop_c8f95"}, {"addr": 36767, "bytes": [165, 159], "type": "code", "mnemonic": "lda", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 36769, "bytes": [133, 155], "type": "code", "mnemonic": "sta", "operand": "net_tx_ptr_hi", "target": 155, "target_label": "net_tx_ptr_hi"}, {"addr": 36771, "bytes": [88], "comment_inline": "Enable interrupts before transmit", "type": "code", "mnemonic": "cli"}, {"addr": 36772, "bytes": [32, 78, 134], "type": "code", "mnemonic": "jsr", "operand": "tx_poll_timeout", "target": 34382, "target_label": "tx_poll_timeout"}, {"addr": 36775, "bytes": [160, 44], "type": "code", "mnemonic": "ldy", "operand": "#&2c"}, {"addr": 36777, "bytes": [169, 255], "comment_inline": "Dest station = &FFFF (accept reply from any station)", "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 36779, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36781, "bytes": [200], "comment_inline": "Y=&2d", "type": "code", "mnemonic": "iny"}, {"addr": 36782, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36784, "bytes": [160, 37], "type": "code", "mnemonic": "ldy", "operand": "#&25"}, {"addr": 36786, "bytes": [169, 144], "type": "code", "mnemonic": "lda", "operand": "#&90"}, {"addr": 36788, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36790, "bytes": [136], "comment_inline": "Y=&24", "type": "code", "mnemonic": "dey"}, {"addr": 36791, "bytes": [169, 127], "type": "code", "mnemonic": "lda", "operand": "#&7f"}, {"addr": 36793, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36795, "bytes": [32, 72, 132], "comment_inline": "Initiate receive with timeout", "type": "code", "mnemonic": "jsr", "operand": "send_to_fs_star", "target": 33864, "target_label": "send_to_fs_star"}, {"addr": 36798, "bytes": [208, 136], "comment_inline": "Non-zero = error/timeout: jump to cleanup", "type": "code", "mnemonic": "bne", "operand": "c8f48", "target": 36680, "target_label": "c8f48"}, {"addr": 36800, "bytes": [8], "labels": ["c8fc0"], "comments_before": ["&8fc0 referenced 1 time by &8f74"], "references": [36724], "type": "code", "mnemonic": "php"}, {"addr": 36801, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 36803, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36805, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 36806, "bytes": [200], "comment_inline": "Y=&02", "type": "code", "mnemonic": "iny"}, {"addr": 36807, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36809, "bytes": [200], "comment_inline": "Y=&03", "type": "code", "mnemonic": "iny"}, {"addr": 36810, "bytes": [132, 190], "type": "code", "mnemonic": "sty", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36812, "bytes": [160, 114], "type": "code", "mnemonic": "ldy", "operand": "#&72"}, {"addr": 36814, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36816, "bytes": [136], "comment_inline": "Y=&71", "type": "code", "mnemonic": "dey"}, {"addr": 36817, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 36818, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36820, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 36821, "bytes": [208, 30], "type": "code", "mnemonic": "bne", "operand": "dofs2", "target": 36853, "target_label": "dofs2"}, {"addr": 36823, "bytes": [164, 190], "labels": ["loop_c8fd7"], "comments_before": ["&8fd7 referenced 1 time by &8ff1"], "comment_inline": "Receive data blocks until command byte = &00 or &0D", "references": [36849], "type": "code", "mnemonic": "ldy", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36825, "bytes": [230, 190], "type": "code", "mnemonic": "inc", "operand": "fs_crc_lo", "target": 190, "target_label": "fs_crc_lo"}, {"addr": 36827, "bytes": [177, 240], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 36829, "bytes": [160, 125], "type": "code", "mnemonic": "ldy", "operand": "#&7d"}, {"addr": 36831, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36833, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36834, "bytes": [32, 89, 145], "type": "code", "mnemonic": "jsr", "operand": "ctrl_block_setup_alt", "target": 37209, "target_label": "ctrl_block_setup_alt"}, {"addr": 36837, "bytes": [88], "type": "code", "mnemonic": "cli"}, {"addr": 36838, "bytes": [32, 80, 134], "comment_inline": "Core transmit and poll routine (XMIT)", "type": "code", "mnemonic": "jsr", "operand": "tx_poll_core", "target": 34384, "target_label": "tx_poll_core"}, {"addr": 36841, "bytes": [202], "labels": ["loop_c8fe9"], "comments_before": ["&8fe9 referenced 1 time by &8fea"], "references": [36842], "type": "code", "mnemonic": "dex"}, {"addr": 36842, "bytes": [208, 253], "type": "code", "mnemonic": "bne", "operand": "loop_c8fe9", "target": 36841, "target_label": "loop_c8fe9"}, {"addr": 36844, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 36845, "bytes": [240, 4], "type": "code", "mnemonic": "beq", "operand": "c8ff3", "target": 36851, "target_label": "c8ff3"}, {"addr": 36847, "bytes": [73, 13], "comment_inline": "Test for end-of-data marker (&0D)", "type": "code", "mnemonic": "eor", "operand": "#&0d"}, {"addr": 36849, "bytes": [208, 228], "type": "code", "mnemonic": "bne", "operand": "loop_c8fd7", "target": 36823, "target_label": "loop_c8fd7"}, {"addr": 36851, "bytes": [240, 15], "labels": ["c8ff3"], "comments_before": ["&8ff3 referenced 1 time by &8fed"], "references": [36845], "type": "code", "mnemonic": "beq", "operand": "c9004", "target": 36868, "target_label": "c9004"}, {"addr": 36853, "bytes": [32, 89, 145], "labels": ["dofs2"], "comments_before": ["&8ff5 referenced 1 time by &8fd5"], "references": [36821], "type": "code", "mnemonic": "jsr", "operand": "ctrl_block_setup_alt", "target": 37209, "target_label": "ctrl_block_setup_alt"}, {"addr": 36856, "bytes": [160, 123], "type": "code", "mnemonic": "ldy", "operand": "#&7b"}, {"addr": 36858, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36860, "bytes": [105, 3], "type": "code", "mnemonic": "adc", "operand": "#3"}, {"addr": 36862, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 36864, "bytes": [88], "type": "code", "mnemonic": "cli"}, {"addr": 36865, "bytes": [32, 76, 134], "type": "code", "mnemonic": "jsr", "operand": "tx_poll_ff", "target": 34380, "target_label": "tx_poll_ff"}, {"addr": 36868, "bytes": [76, 72, 143], "labels": ["c9004"], "comments_before": ["&9004 referenced 1 time by &8ff3"], "references": [36851], "type": "code", "mnemonic": "jmp", "operand": "c8f48", "target": 36680, "target_label": "c8f48"}, {"addr": 36871, "bytes": [8], "labels": ["osword_dispatch"], "comments_before": ["***************************************************************************************", "NETVEC dispatch handler (ENTRY)\n\nIndirected from NETVEC at &0224. Saves all registers and flags,\nretrieves the reason code from the stacked A, and dispatches to\none of 9 handlers (codes 0-8) via the PHA/PHA/RTS trampoline at\n&9020. Reason codes >= 9 are ignored.\n\nDispatch targets (from NFS09):\n  0:   no-op (RTS)\n  1-3: PRINT -- chars in printer buffer / Ctrl-B / Ctrl-C\n  4:   NWRCH -- write character to screen (net write char)\n  5:   SELECT -- printer selection changed\n  6:   no-op (net read char -- not implemented)\n  7:   NBYTE -- remote OSBYTE call\n  8:   NWORD -- remote OSWORD call\n\nOn Entry:\n    A: reason code (0-8)\n\nOn Exit:\n    A: preserved\n    X: preserved\n    Y: preserved", "***************************************************************************************"], "type": "code", "mnemonic": "php"}, {"addr": 36872, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36873, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 36874, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36875, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 36876, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36877, "bytes": [186], "type": "code", "mnemonic": "tsx"}, {"addr": 36878, "bytes": [189, 3, 1], "comment_inline": "Retrieve original A (function code) from stack", "type": "code", "mnemonic": "lda", "operand": "l0103,x", "target": 259, "target_label": "l0103"}, {"addr": 36881, "bytes": [201, 9], "type": "code", "mnemonic": "cmp", "operand": "#9"}, {"addr": 36883, "bytes": [176, 4], "type": "code", "mnemonic": "bcs", "operand": "entry1", "target": 36889, "target_label": "entry1"}, {"addr": 36885, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 36886, "bytes": [32, 32, 144], "type": "code", "mnemonic": "jsr", "operand": "osword_trampoline", "target": 36896, "target_label": "osword_trampoline"}, {"addr": 36889, "bytes": [104], "labels": ["entry1"], "comments_before": ["&9019 referenced 1 time by &9013"], "references": [36883], "type": "code", "mnemonic": "pla"}, {"addr": 36890, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 36891, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 36892, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 36893, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 36894, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 36895, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36896, "bytes": [189, 52, 144], "labels": ["osword_trampoline"], "comments_before": ["&9020 referenced 1 time by &9016"], "comment_inline": "PHA/PHA/RTS trampoline: push handler addr-1, RTS jumps to it", "references": [36886], "type": "code", "mnemonic": "lda", "operand": "osword_tbl_hi,x", "target": 36916, "target_label": "osword_tbl_hi"}, {"addr": 36899, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36900, "bytes": [189, 43, 144], "type": "code", "mnemonic": "lda", "operand": "osword_tbl_lo,x", "target": 36907, "target_label": "osword_tbl_lo"}, {"addr": 36903, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 36904, "bytes": [165, 239], "type": "code", "mnemonic": "lda", "operand": "l00ef", "target": 239, "target_label": "l00ef"}, {"addr": 36906, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36907, "bytes": [68], "labels": ["osword_tbl_lo"], "comments_before": ["&902b referenced 1 time by &9024"], "references": [36900], "type": "byte", "values": [68]}, {"addr": 36908, "bytes": [198], "type": "byte", "values": [198]}, {"addr": 36909, "bytes": [198], "type": "byte", "values": [198]}, {"addr": 36910, "bytes": [198], "type": "byte", "values": [198]}, {"addr": 36911, "bytes": [60], "type": "byte", "values": [60]}, {"addr": 36912, "bytes": [180], "type": "byte", "values": [180]}, {"addr": 36913, "bytes": [68], "type": "byte", "values": [68]}, {"addr": 36914, "bytes": [98], "type": "byte", "values": [98]}, {"addr": 36915, "bytes": [204], "type": "byte", "values": [204]}, {"addr": 36916, "bytes": [129], "labels": ["osword_tbl_hi"], "comments_before": ["&9034 referenced 1 time by &9020"], "references": [36896], "type": "byte", "values": [129]}, {"addr": 36917, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 36918, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 36919, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 36920, "bytes": [144], "type": "byte", "values": [144]}, {"addr": 36921, "bytes": [145], "type": "byte", "values": [145]}, {"addr": 36922, "bytes": [129], "type": "byte", "values": [129]}, {"addr": 36923, "bytes": [144], "type": "byte", "values": [144]}, {"addr": 36924, "bytes": [144], "type": "byte", "values": [144]}, {"addr": 36925, "bytes": [186], "labels": ["net_write_char"], "comments_before": ["***************************************************************************************", "Fn 4: net write character (NWRCH)\n\nWrites a character (passed in Y) to the screen via OSWRITCH.\nBefore the write, uses TSX to reach into the stack and zero the\ncarry flag in the caller's saved processor status byte -- ROR\nfollowed by ASL on the stacked P byte (&0106,X) shifts carry\nout and back in as zero. This ensures the calling code's PLP\nrestores carry=0, signalling \"character accepted\" without needing\na separate CLC/PHP sequence. A classic 6502 trick for modifying\nreturn flags without touching the actual processor status.\n\nOn Entry:\n    Y: character to write\n\nOn Exit:\n    A: &3F\n    X: 0\n    Y: 0", "***************************************************************************************"], "type": "code", "mnemonic": "tsx"}, {"addr": 36926, "bytes": [126, 6, 1], "comment_inline": "ROR/ASL on stacked P: zeros carry to signal success", "type": "code", "mnemonic": "ror", "operand": "l0106,x", "target": 262, "target_label": "l0106"}, {"addr": 36929, "bytes": [30, 6, 1], "type": "code", "mnemonic": "asl", "operand": "l0106,x", "target": 262, "target_label": "l0106"}, {"addr": 36932, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 36933, "bytes": [160, 218], "type": "code", "mnemonic": "ldy", "operand": "#&da"}, {"addr": 36935, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36937, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 36939, "bytes": [160, 217], "labels": ["setup_tx_and_send"], "comments_before": ["***************************************************************************************", "Set up TX control block and send\n\nBuilds a TX control block at (nfs_workspace)+&0C from the current\nworkspace state, then initiates transmission via the ADLC TX path.\nThis is the common send routine used after command data has been\nprepared. The exact control block layout and field mapping need\nfurther analysis.", "***************************************************************************************", "&904b referenced 3 times by &8159, &9092, &90f3"], "references": [33113, 37010, 37107], "type": "code", "mnemonic": "ldy", "operand": "#&d9"}, {"addr": 36941, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36943, "bytes": [169, 128], "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 36945, "bytes": [160, 12], "type": "code", "mnemonic": "ldy", "operand": "#&0c"}, {"addr": 36947, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 36949, "bytes": [132, 154], "type": "code", "mnemonic": "sty", "operand": "net_tx_ptr", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 36951, "bytes": [166, 159], "type": "code", "mnemonic": "ldx", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 36953, "bytes": [134, 155], "type": "code", "mnemonic": "stx", "operand": "net_tx_ptr_hi", "target": 155, "target_label": "net_tx_ptr_hi"}, {"addr": 36955, "bytes": [32, 76, 134], "type": "code", "mnemonic": "jsr", "operand": "tx_poll_ff", "target": 34380, "target_label": "tx_poll_ff"}, {"addr": 36958, "bytes": [169, 63], "type": "code", "mnemonic": "lda", "operand": "#&3f"}, {"addr": 36960, "bytes": [129, 154], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr,x)", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 36962, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 36963, "bytes": [164, 241], "labels": ["remote_cmd_dispatch"], "comments_before": ["***************************************************************************************", "Fn 7: remote OSBYTE handler (NBYTE)\n\nFull RPC mechanism for OSBYTE calls across the network. When a\nmachine is remoted, OSBYTE/OSWORD calls that affect terminal-side\nhardware (keyboard scanning, flash rates, etc.) must be indirected\nacross the net. OSBYTE calls are classified into three categories:\n  Y>0 (NCTBPL table): executed on BOTH machines (flash rates etc.)\n  Y<0 (NCTBMI table): executed on terminal only, result sent back\n  Y=0: not recognised, passed through unhandled\nResults returned via stack manipulation: the saved processor status\nbyte at &0106 has V-flag (bit 6) forced on to tell the MOS the\ncall was claimed (preventing dispatch to other ROMs), and the I-bit\n(bit 2) forced on to disable interrupts during register restoration,\npreventing race conditions. The carry flag in the saved P is also\nmanipulated via ROR/ASL to zero it, signaling success to the caller.\nOSBYTE &81 (INKEY) gets special handling as it must read the\nterminal's keyboard.", "***************************************************************************************"], "type": "code", "mnemonic": "ldy", "operand": "l00f1", "target": 241, "target_label": "l00f1"}, {"addr": 36965, "bytes": [201, 129], "type": "code", "mnemonic": "cmp", "operand": "#&81"}, {"addr": 36967, "bytes": [240, 19], "type": "code", "mnemonic": "beq", "operand": "c907c", "target": 36988, "target_label": "c907c"}, {"addr": 36969, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 36971, "bytes": [162, 7], "type": "code", "mnemonic": "ldx", "operand": "#7"}, {"addr": 36973, "bytes": [32, 181, 144], "type": "code", "mnemonic": "jsr", "operand": "match_osbyte_code", "target": 37045, "target_label": "match_osbyte_code"}, {"addr": 36976, "bytes": [240, 10], "type": "code", "mnemonic": "beq", "operand": "c907c", "target": 36988, "target_label": "c907c"}, {"addr": 36978, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36979, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 36980, "bytes": [162, 14], "type": "code", "mnemonic": "ldx", "operand": "#&0e"}, {"addr": 36982, "bytes": [32, 181, 144], "type": "code", "mnemonic": "jsr", "operand": "match_osbyte_code", "target": 37045, "target_label": "match_osbyte_code"}, {"addr": 36985, "bytes": [240, 1], "type": "code", "mnemonic": "beq", "operand": "c907c", "target": 36988, "target_label": "c907c"}, {"addr": 36987, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 36988, "bytes": [162, 2], "labels": ["c907c"], "comments_before": ["&907c referenced 3 times by &9067, &9070, &9079"], "references": [36967, 36976, 36985], "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 36990, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 36991, "bytes": [240, 51], "type": "code", "mnemonic": "beq", "operand": "return_9", "target": 37044, "target_label": "return_9"}, {"addr": 36993, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 36994, "bytes": [16, 1], "type": "code", "mnemonic": "bpl", "operand": "nbyte6", "target": 36997, "target_label": "nbyte6"}, {"addr": 36996, "bytes": [232], "comment_inline": "X=&03", "type": "code", "mnemonic": "inx"}, {"addr": 36997, "bytes": [160, 220], "labels": ["nbyte6"], "comments_before": ["&9085 referenced 1 time by &9082"], "references": [36994], "type": "code", "mnemonic": "ldy", "operand": "#&dc"}, {"addr": 36999, "bytes": [185, 21, 0], "labels": ["nbyte1"], "comments_before": ["&9087 referenced 1 time by &908f"], "references": [37007], "type": "code", "mnemonic": "lda", "operand": "l0015,y", "target": 21, "target_label": "l0015"}, {"addr": 37002, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37004, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 37005, "bytes": [192, 218], "type": "code", "mnemonic": "cpy", "operand": "#&da"}, {"addr": 37007, "bytes": [16, 246], "type": "code", "mnemonic": "bpl", "operand": "nbyte1", "target": 36999, "target_label": "nbyte1"}, {"addr": 37009, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 37010, "bytes": [32, 75, 144], "type": "code", "mnemonic": "jsr", "operand": "setup_tx_and_send", "target": 36939, "target_label": "setup_tx_and_send"}, {"addr": 37013, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 37014, "bytes": [16, 28], "type": "code", "mnemonic": "bpl", "operand": "return_9", "target": 37044, "target_label": "return_9"}, {"addr": 37016, "bytes": [169, 127], "type": "code", "mnemonic": "lda", "operand": "#&7f"}, {"addr": 37018, "bytes": [129, 154], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr,x)", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37020, "bytes": [161, 154], "labels": ["loop_c909c"], "comments_before": ["&909c referenced 1 time by &909e"], "references": [37022], "type": "code", "mnemonic": "lda", "operand": "(net_tx_ptr,x)", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37022, "bytes": [16, 252], "type": "code", "mnemonic": "bpl", "operand": "loop_c909c", "target": 37020, "target_label": "loop_c909c"}, {"addr": 37024, "bytes": [186], "type": "code", "mnemonic": "tsx"}, {"addr": 37025, "bytes": [160, 221], "type": "code", "mnemonic": "ldy", "operand": "#&dd"}, {"addr": 37027, "bytes": [177, 158], "type": "code", "mnemonic": "lda", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37029, "bytes": [9, 68], "type": "code", "mnemonic": "ora", "operand": "#&44"}, {"addr": 37031, "bytes": [208, 4], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "nbyte5", "target": 37037, "target_label": "nbyte5"}, {"addr": 37033, "bytes": [136], "labels": ["nbyte4"], "comments_before": ["&90a9 referenced 1 time by &90b2"], "references": [37042], "type": "code", "mnemonic": "dey"}, {"addr": 37034, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 37035, "bytes": [177, 158], "type": "code", "mnemonic": "lda", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37037, "bytes": [157, 6, 1], "labels": ["nbyte5"], "comments_before": ["&90ad referenced 1 time by &90a7"], "references": [37031], "type": "code", "mnemonic": "sta", "operand": "l0106,x", "target": 262, "target_label": "l0106"}, {"addr": 37040, "bytes": [192, 218], "type": "code", "mnemonic": "cpy", "operand": "#&da"}, {"addr": 37042, "bytes": [208, 245], "type": "code", "mnemonic": "bne", "operand": "nbyte4", "target": 37033, "target_label": "nbyte4"}, {"addr": 37044, "bytes": [96], "labels": ["return_9"], "comments_before": ["&90b4 referenced 2 times by &907f, &9096"], "references": [36991, 37014], "type": "code", "mnemonic": "rts"}, {"addr": 37045, "bytes": [221, 190, 144], "labels": ["match_osbyte_code"], "comments_before": ["&90b5 referenced 3 times by &906d, &9076, &90bb"], "references": [36973, 37051, 36982], "type": "code", "mnemonic": "cmp", "operand": "l90be,x", "target": 37054, "target_label": "l90be"}, {"addr": 37048, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "return_10", "target": 37053, "target_label": "return_10"}, {"addr": 37050, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 37051, "bytes": [16, 248], "type": "code", "mnemonic": "bpl", "operand": "match_osbyte_code", "target": 37045, "target_label": "match_osbyte_code"}, {"addr": 37053, "bytes": [96], "labels": ["return_10"], "comments_before": ["&90bd referenced 1 time by &90b8"], "references": [37048], "type": "code", "mnemonic": "rts"}, {"addr": 37054, "bytes": [4, 9, 10, 20, 154, 155, 156, 226, 11, 12, 15, 121, 122, 227, 228], "labels": ["l90be"], "comments_before": ["&90be referenced 1 time by &90b5"], "references": [37045], "type": "byte", "values": [4, 9, 10, 20, 154, 155, 156, 226, 11, 12, 15, 121, 122, 227, 228]}, {"addr": 37069, "bytes": [160, 14], "labels": ["remote_cmd_data"], "comments_before": ["***************************************************************************************", "Fn 8: remote OSWORD handler (NWORD)\n\nOnly intercepts OSWORD 7 (make a sound) and OSWORD 8 (define an\nenvelope). Unlike NBYTE which returns results, NWORD is entirely\nfire-and-forget \u2014 no return path is implemented. The developer\nexplicitly noted this was acceptable since sound/envelope commands\ndon't return meaningful results. Copies up to 14 parameter bytes\nfrom the RX buffer to workspace, tags the message as RWORD, and\ntransmits.", "***************************************************************************************"], "type": "code", "mnemonic": "ldy", "operand": "#&0e"}, {"addr": 37071, "bytes": [201, 7], "type": "code", "mnemonic": "cmp", "operand": "#7"}, {"addr": 37073, "bytes": [240, 4], "type": "code", "mnemonic": "beq", "operand": "c90d7", "target": 37079, "target_label": "c90d7"}, {"addr": 37075, "bytes": [201, 8], "type": "code", "mnemonic": "cmp", "operand": "#8"}, {"addr": 37077, "bytes": [208, 36], "type": "code", "mnemonic": "bne", "operand": "return_11", "target": 37115, "target_label": "return_11"}, {"addr": 37079, "bytes": [162, 219], "labels": ["c90d7"], "comments_before": ["&90d7 referenced 1 time by &90d1"], "references": [37073], "type": "code", "mnemonic": "ldx", "operand": "#&db"}, {"addr": 37081, "bytes": [134, 158], "type": "code", "mnemonic": "stx", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37083, "bytes": [177, 240], "labels": ["loop_c90db"], "comments_before": ["&90db referenced 1 time by &90e0"], "references": [37088], "type": "code", "mnemonic": "lda", "operand": "(l00f0),y", "target": 240, "target_label": "l00f0"}, {"addr": 37085, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37087, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 37088, "bytes": [16, 249], "type": "code", "mnemonic": "bpl", "operand": "loop_c90db", "target": 37083, "target_label": "loop_c90db"}, {"addr": 37090, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 37091, "bytes": [198, 158], "type": "code", "mnemonic": "dec", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37093, "bytes": [165, 239], "type": "code", "mnemonic": "lda", "operand": "l00ef", "target": 239, "target_label": "l00ef"}, {"addr": 37095, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37097, "bytes": [132, 158], "type": "code", "mnemonic": "sty", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37099, "bytes": [160, 20], "type": "code", "mnemonic": "ldy", "operand": "#&14"}, {"addr": 37101, "bytes": [169, 233], "type": "code", "mnemonic": "lda", "operand": "#&e9"}, {"addr": 37103, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37105, "bytes": [169, 1], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 37107, "bytes": [32, 75, 144], "type": "code", "mnemonic": "jsr", "operand": "setup_tx_and_send", "target": 36939, "target_label": "setup_tx_and_send"}, {"addr": 37110, "bytes": [134, 158], "type": "code", "mnemonic": "stx", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37112, "bytes": [32, 89, 145], "type": "code", "mnemonic": "jsr", "operand": "ctrl_block_setup_alt", "target": 37209, "target_label": "ctrl_block_setup_alt"}, {"addr": 37115, "bytes": [96], "labels": ["return_11"], "comments_before": ["&90fb referenced 1 time by &90d5"], "references": [37077], "type": "code", "mnemonic": "rts"}, {"addr": 37116, "bytes": [160, 4], "labels": ["remote_boot_handler"], "comments_before": ["***************************************************************************************", "Remote boot/execute handler\n\nValidates byte 4 of the RX control block (must be zero), copies the\n2-byte execution address from RX offsets &80/&81 into NFS workspace,\nsets up a control block, disables keyboard (OSBYTE &C9), then falls\nthrough to execute_at_0100.", "***************************************************************************************"], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 37118, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37120, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "remot1", "target": 37125, "target_label": "remot1"}, {"addr": 37122, "bytes": [76, 214, 146], "labels": ["rchex"], "comments_before": ["&9102 referenced 1 time by &9148"], "references": [37192], "type": "code", "mnemonic": "jmp", "operand": "clear_jsr_protection", "target": 37590, "target_label": "clear_jsr_protection"}, {"addr": 37125, "bytes": [9, 9], "labels": ["remot1"], "comments_before": ["&9105 referenced 2 times by &9100, &913e"], "references": [37120, 37182], "type": "code", "mnemonic": "ora", "operand": "#9"}, {"addr": 37127, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37129, "bytes": [162, 128], "type": "code", "mnemonic": "ldx", "operand": "#&80"}, {"addr": 37131, "bytes": [160, 128], "type": "code", "mnemonic": "ldy", "operand": "#&80"}, {"addr": 37133, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37135, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37136, "bytes": [200], "comment_inline": "Y=&81", "type": "code", "mnemonic": "iny"}, {"addr": 37137, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37139, "bytes": [160, 15], "type": "code", "mnemonic": "ldy", "operand": "#&0f"}, {"addr": 37141, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37143, "bytes": [136], "comment_inline": "Y=&0e", "type": "code", "mnemonic": "dey"}, {"addr": 37144, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37145, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37147, "bytes": [32, 92, 129], "type": "code", "mnemonic": "jsr", "operand": "clear_osbyte_ce_cf", "target": 33116, "target_label": "clear_osbyte_ce_cf"}, {"addr": 37150, "bytes": [32, 98, 145], "type": "code", "mnemonic": "jsr", "operand": "ctrl_block_setup", "target": 37218, "target_label": "ctrl_block_setup"}, {"addr": 37153, "bytes": [162, 1], "type": "code", "mnemonic": "ldx", "operand": "#1"}, {"addr": 37155, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 37157, "bytes": [169, 201], "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_write_econet_keyboard_disable"}, {"addr": 37159, "bytes": [32, 244, 255], "comment_inline": "Disable keyboard (for Econet)", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 37162, "bytes": [162, 2], "labels": ["execute_at_0100"], "comments_before": ["***************************************************************************************", "Execute downloaded code at &0100\n\nZeroes &0100-&0102 (safe BRK default), restores the protection mask,\nand JMP &0100 to execute code received over the network.", "***************************************************************************************"], "type": "code", "mnemonic": "ldx", "operand": "#2"}, {"addr": 37164, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 37166, "bytes": [157, 0, 1], "labels": ["loop_c912e"], "comments_before": ["&912e referenced 1 time by &9132"], "references": [37170], "type": "code", "mnemonic": "sta", "operand": "l0100,x", "target": 256, "target_label": "l0100"}, {"addr": 37169, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 37170, "bytes": [16, 250], "type": "code", "mnemonic": "bpl", "operand": "loop_c912e", "target": 37166, "target_label": "loop_c912e"}, {"addr": 37172, "bytes": [32, 214, 146], "type": "code", "mnemonic": "jsr", "operand": "clear_jsr_protection", "target": 37590, "target_label": "clear_jsr_protection"}, {"addr": 37175, "bytes": [76, 0, 1], "type": "code", "mnemonic": "jmp", "operand": "l0100", "target": 256, "target_label": "l0100"}, {"addr": 37178, "bytes": [160, 4], "labels": ["remote_validated"], "comments_before": ["***************************************************************************************", "Remote operation with source validation (REMOT)\n\nValidates that the source station/network in the received packet\nmatches the controlling station stored in the remote RXCB. This\nensures that only the station that initiated the remote session\ncan send commands \u2014 characters from other stations are rejected.\nFull init sequence: 1) disable keyboard, 2) set workspace ptr,\n3) set status busy, 4) set R/W/byte/word masks, 5) set up CB,\n6) set MODE 7 (the only mode guaranteed for terminal emulation),\n7) set auto repeat rates, 8) enter current language. This is\nessentially a \"thin terminal\" setup \u2014 the local machine becomes\na remote display/keyboard for the controlling station.\nBit 0 of the status byte disallows further remote takeover\nattempts (preventing re-entrant remote control), while bit 3\nmarks the machine as currently remoted.", "***************************************************************************************"], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 37180, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37182, "bytes": [240, 197], "type": "code", "mnemonic": "beq", "operand": "remot1", "target": 37125, "target_label": "remot1"}, {"addr": 37184, "bytes": [160, 128], "type": "code", "mnemonic": "ldy", "operand": "#&80"}, {"addr": 37186, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37188, "bytes": [160, 14], "type": "code", "mnemonic": "ldy", "operand": "#&0e"}, {"addr": 37190, "bytes": [209, 158], "type": "code", "mnemonic": "cmp", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37192, "bytes": [208, 184], "type": "code", "mnemonic": "bne", "operand": "rchex", "target": 37122, "target_label": "rchex"}, {"addr": 37194, "bytes": [160, 130], "labels": ["insert_remote_key"], "comments_before": ["***************************************************************************************", "Insert remote keypress\n\nReads a character from RX block offset &82 and inserts it into\nkeyboard input buffer 0 via OSBYTE &99.", "***************************************************************************************"], "type": "code", "mnemonic": "ldy", "operand": "#&82"}, {"addr": 37196, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37198, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 37199, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 37201, "bytes": [32, 214, 146], "type": "code", "mnemonic": "jsr", "operand": "clear_jsr_protection", "target": 37590, "target_label": "clear_jsr_protection"}, {"addr": 37204, "bytes": [169, 153], "type": "code", "mnemonic": "lda", "operand": "#osbyte_insert_input_buffer"}, {"addr": 37206, "bytes": [76, 244, 255], "comment_inline": "Insert character Y into input buffer X", "type": "code", "mnemonic": "jmp", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 37209, "bytes": [162, 13], "labels": ["ctrl_block_setup_alt"], "comments_before": ["***************************************************************************************", "Alternate entry into control block setup\n\nSets X=&0D, Y=&7C. Tests bit 6 of &833A to choose target:\n  V=0 (bit 6 clear): stores to (nfs_workspace)\n  V=1 (bit 6 set):   stores to (net_rx_ptr)", "***************************************************************************************", "&9159 referenced 3 times by &8fe2, &8ff5, &90f8"], "references": [36853, 37112, 36834], "type": "code", "mnemonic": "ldx", "operand": "#&0d"}, {"addr": 37211, "bytes": [160, 124], "type": "code", "mnemonic": "ldy", "operand": "#&7c"}, {"addr": 37213, "bytes": [44, 58, 131], "type": "code", "mnemonic": "bit", "operand": "l833a", "target": 33594, "target_label": "l833a"}, {"addr": 37216, "bytes": [112, 5], "type": "code", "mnemonic": "bvs", "operand": "cbset2", "target": 37223, "target_label": "cbset2"}, {"addr": 37218, "bytes": [160, 23], "labels": ["ctrl_block_setup"], "comments_before": ["***************************************************************************************", "Control block setup \u2014 main entry\n\nSets X=&1A, Y=&17, clears V (stores to nfs_workspace).\nReads the template table at &918E indexed by X, storing each\nvalue into the target workspace at offset Y. Both X and Y\nare decremented on each iteration.\n\nTemplate sentinel values:\n  &FE = stop (end of template for this entry path)\n  &FD = skip (leave existing value unchanged)\n  &FC = use page high byte of target pointer", "***************************************************************************************", "&9162 referenced 1 time by &911e"], "references": [37150], "type": "code", "mnemonic": "ldy", "operand": "#&17"}, {"addr": 37220, "bytes": [162, 26], "type": "code", "mnemonic": "ldx", "operand": "#&1a"}, {"addr": 37222, "bytes": [184], "labels": ["ctrl_block_setup_clv"], "comments_before": ["&9166 referenced 1 time by &922b"], "references": [37419], "type": "code", "mnemonic": "clv"}, {"addr": 37223, "bytes": [189, 142, 145], "labels": ["cbset2"], "comments_before": ["&9167 referenced 2 times by &9160, &9188"], "comment_inline": "Load template byte from ctrl_block_template[X]", "references": [37216, 37256], "type": "code", "mnemonic": "lda", "operand": "ctrl_block_template,x", "target": 37262, "target_label": "ctrl_block_template"}, {"addr": 37226, "bytes": [201, 254], "type": "code", "mnemonic": "cmp", "operand": "#&fe"}, {"addr": 37228, "bytes": [240, 28], "type": "code", "mnemonic": "beq", "operand": "c918a", "target": 37258, "target_label": "c918a"}, {"addr": 37230, "bytes": [201, 253], "type": "code", "mnemonic": "cmp", "operand": "#&fd"}, {"addr": 37232, "bytes": [240, 20], "type": "code", "mnemonic": "beq", "operand": "c9186", "target": 37254, "target_label": "c9186"}, {"addr": 37234, "bytes": [201, 252], "type": "code", "mnemonic": "cmp", "operand": "#&fc"}, {"addr": 37236, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "cbset3", "target": 37246, "target_label": "cbset3"}, {"addr": 37238, "bytes": [165, 157], "type": "code", "mnemonic": "lda", "operand": "net_rx_ptr_hi", "target": 157, "target_label": "net_rx_ptr_hi"}, {"addr": 37240, "bytes": [112, 2], "type": "code", "mnemonic": "bvs", "operand": "c917c", "target": 37244, "target_label": "c917c"}, {"addr": 37242, "bytes": [165, 159], "type": "code", "mnemonic": "lda", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 37244, "bytes": [133, 155], "labels": ["c917c"], "comments_before": ["&917c referenced 1 time by &9178"], "references": [37240], "type": "code", "mnemonic": "sta", "operand": "net_tx_ptr_hi", "target": 155, "target_label": "net_tx_ptr_hi"}, {"addr": 37246, "bytes": [112, 4], "labels": ["cbset3"], "comments_before": ["&917e referenced 1 time by &9174"], "references": [37236], "type": "code", "mnemonic": "bvs", "operand": "cbset4", "target": 37252, "target_label": "cbset4"}, {"addr": 37248, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37250, "bytes": [80, 2], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bvc", "operand": "c9186", "target": 37254, "target_label": "c9186"}, {"addr": 37252, "bytes": [145, 156], "labels": ["cbset4"], "comments_before": ["&9184 referenced 1 time by &917e"], "references": [37246], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37254, "bytes": [136], "labels": ["c9186"], "comments_before": ["&9186 referenced 2 times by &9170, &9182"], "references": [37232, 37250], "type": "code", "mnemonic": "dey"}, {"addr": 37255, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 37256, "bytes": [16, 221], "type": "code", "mnemonic": "bpl", "operand": "cbset2", "target": 37223, "target_label": "cbset2"}, {"addr": 37258, "bytes": [200], "labels": ["c918a"], "comments_before": ["&918a referenced 1 time by &916c"], "references": [37228], "type": "code", "mnemonic": "iny"}, {"addr": 37259, "bytes": [132, 154], "type": "code", "mnemonic": "sty", "operand": "net_tx_ptr", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37261, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 37262, "bytes": [133, 0], "labels": ["ctrl_block_template"], "comments_before": ["***************************************************************************************", "Control block initialisation template\n\nRead by the loop at &9167, indexed by X from a starting value\ndown to 0. Values are stored into either (nfs_workspace) or\n(net_rx_ptr) at offset Y, depending on the V flag.\n\nTwo entry paths read different slices of this table:\n  ctrl_block_setup:   X=&1A (26) down, Y=&17 (23) down, V=0\n  ctrl_block_setup_alt: X=&0D (13) down, Y=&7C (124) down, V from BIT &833A\n\nSentinel values:\n  &FE = stop processing\n  &FD = skip this offset (decrement Y but don't store)\n  &FC = substitute the page byte (net_rx_ptr_hi or nfs_workspace_hi)", "***************************************************************************************", "&918e referenced 1 time by &9167"], "references": [37223], "type": "code", "mnemonic": "sta", "operand": "l0000", "target": 0, "target_label": "l0000"}, {"addr": 37264, "bytes": [253, 253, 125], "type": "code", "mnemonic": "sbc", "operand": "l7dfd,x", "target": 32253, "target_label": "l7dfd"}, {"addr": 37267, "bytes": [252, 255, 255, 126, 252, 255, 255, 0, 0, 254, 128, 147, 253, 253, 217, 252, 255, 255, 222, 252, 255, 255, 254, 209, 253, 253, 31, 253, 255, 255, 253, 253, 255, 255], "type": "byte", "values": [252, 255, 255, 126, 252, 255, 255, 0, 0, 254, 128, 147, 253, 253, 217, 252, 255, 255, 222, 252, 255, 255, 254, 209, 253, 253, 31, 253, 255, 255, 253, 253, 255, 255]}, {"addr": 37301, "bytes": [169, 0], "labels": ["remote_display_setup"], "comments_before": ["***************************************************************************************", "Fn 5: printer selection changed (SELECT)\n\nCalled when the printer selection changes. Compares the new\nselection (in PARMX) against the network printer (buffer 4).\nIf it matches, initialises the printer buffer pointer (PBUFFP)\nand sets the initial flag byte (&41). Otherwise just updates\nthe printer status flags (PFLAGS).", "***************************************************************************************"], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 37303, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 37304, "bytes": [228, 240], "type": "code", "mnemonic": "cpx", "operand": "l00f0", "target": 240, "target_label": "l00f0"}, {"addr": 37306, "bytes": [208, 7], "type": "code", "mnemonic": "bne", "operand": "setup1", "target": 37315, "target_label": "setup1"}, {"addr": 37308, "bytes": [169, 31], "type": "code", "mnemonic": "lda", "operand": "#&1f"}, {"addr": 37310, "bytes": [141, 97, 13], "type": "code", "mnemonic": "sta", "operand": "printer_buf_ptr", "target": 3425, "target_label": "printer_buf_ptr"}, {"addr": 37313, "bytes": [169, 67], "type": "code", "mnemonic": "lda", "operand": "#&43"}, {"addr": 37315, "bytes": [141, 96, 13], "labels": ["setup1"], "comments_before": ["&91c3 referenced 1 time by &91ba"], "references": [37306], "type": "code", "mnemonic": "sta", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37318, "bytes": [96], "labels": ["return_12"], "comments_before": ["&91c6 referenced 2 times by &91c9, &91dd"], "references": [37321, 37341], "type": "code", "mnemonic": "rts"}, {"addr": 37319, "bytes": [192, 4], "labels": ["remote_print_handler"], "comments_before": ["***************************************************************************************", "Fn 1/2/3: network printer handler (PRINT)\n\nHandles network printer output. Reason 1 = chars in buffer (extract\nfrom MOS buffer 3 and accumulate), reason 2 = Ctrl-B (start print),\nreason 3 = Ctrl-C (end print). The printer status byte PFLAGS uses:\n  bit 7 = sequence number (toggles per packet for dup detection)\n  bit 6 = always 1 (validity marker)\n  bit 0 = 0 when print active\nPrint streams reuse the BSXMIT (byte-stream transmit) code with\nhandle=0, which causes the AND SEQNOS to produce zero and sidestep\nper-file sequence tracking. After transmission, TXCB pointer bytes\nare filled with &FF to prevent stale values corrupting subsequent\nBGET/BPUT operations (a historically significant bug fix).\nN.B. The printer and REMOTE facility share the same dynamically\nallocated static workspace page via WORKP1 (&9E,&9F) \u2014 care must\nbe taken to never leave the pointer corrupted, as corruption would\ncause one subsystem to overwrite the other's data.\nOnly handles buffer 4 (network printer); others are ignored.", "***************************************************************************************"], "type": "code", "mnemonic": "cpy", "operand": "#4"}, {"addr": 37321, "bytes": [208, 251], "type": "code", "mnemonic": "bne", "operand": "return_12", "target": 37318, "target_label": "return_12"}, {"addr": 37323, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 37324, "bytes": [202], "type": "code", "mnemonic": "dex"}, {"addr": 37325, "bytes": [208, 38], "type": "code", "mnemonic": "bne", "operand": "c91f5", "target": 37365, "target_label": "c91f5"}, {"addr": 37327, "bytes": [186], "type": "code", "mnemonic": "tsx"}, {"addr": 37328, "bytes": [29, 6, 1], "type": "code", "mnemonic": "ora", "operand": "l0106,x", "target": 262, "target_label": "l0106"}, {"addr": 37331, "bytes": [157, 6, 1], "type": "code", "mnemonic": "sta", "operand": "l0106,x", "target": 262, "target_label": "l0106"}, {"addr": 37334, "bytes": [169, 145], "labels": ["prlp1"], "comments_before": ["&91d6 referenced 2 times by &91e5, &91ea"], "references": [37349, 37354], "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_buffer"}, {"addr": 37336, "bytes": [162, 3], "type": "code", "mnemonic": "ldx", "operand": "#buffer_printer"}, {"addr": 37338, "bytes": [32, 244, 255], "comment_inline": "Get character from input buffer (C is set if the buffer is empty, otherwise Y=extracted character)", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 37341, "bytes": [176, 231], "type": "code", "mnemonic": "bcs", "operand": "return_12", "target": 37318, "target_label": "return_12"}, {"addr": 37343, "bytes": [152], "comment_inline": "Y is the character extracted from the buffer", "type": "code", "mnemonic": "tya"}, {"addr": 37344, "bytes": [32, 236, 145], "type": "code", "mnemonic": "jsr", "operand": "store_output_byte", "target": 37356, "target_label": "store_output_byte"}, {"addr": 37347, "bytes": [192, 110], "type": "code", "mnemonic": "cpy", "operand": "#&6e"}, {"addr": 37349, "bytes": [144, 239], "type": "code", "mnemonic": "bcc", "operand": "prlp1", "target": 37334, "target_label": "prlp1"}, {"addr": 37351, "bytes": [32, 23, 146], "type": "code", "mnemonic": "jsr", "operand": "flush_output_block", "target": 37399, "target_label": "flush_output_block"}, {"addr": 37354, "bytes": [208, 234], "type": "code", "mnemonic": "bne", "operand": "prlp1", "target": 37334, "target_label": "prlp1"}, {"addr": 37356, "bytes": [172, 97, 13], "labels": ["store_output_byte"], "comments_before": ["***************************************************************************************", "Store output byte to network buffer\n\nStores byte A at the current output offset in the RX buffer\npointed to by (net_rx_ptr). Advances the offset counter and\ntriggers a flush if the buffer is full.", "***************************************************************************************", "&91ec referenced 2 times by &91e0, &91f6"], "references": [37366, 37344], "type": "code", "mnemonic": "ldy", "operand": "printer_buf_ptr", "target": 3425, "target_label": "printer_buf_ptr"}, {"addr": 37359, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 37361, "bytes": [238, 97, 13], "type": "code", "mnemonic": "inc", "operand": "printer_buf_ptr", "target": 3425, "target_label": "printer_buf_ptr"}, {"addr": 37364, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 37365, "bytes": [72], "labels": ["c91f5"], "comments_before": ["&91f5 referenced 1 time by &91cd"], "references": [37325], "type": "code", "mnemonic": "pha"}, {"addr": 37366, "bytes": [32, 236, 145], "type": "code", "mnemonic": "jsr", "operand": "store_output_byte", "target": 37356, "target_label": "store_output_byte"}, {"addr": 37369, "bytes": [77, 96, 13], "type": "code", "mnemonic": "eor", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37372, "bytes": [106], "type": "code", "mnemonic": "ror"}, {"addr": 37373, "bytes": [144, 15], "type": "code", "mnemonic": "bcc", "operand": "c920e", "target": 37390, "target_label": "c920e"}, {"addr": 37375, "bytes": [173, 96, 13], "type": "code", "mnemonic": "lda", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37378, "bytes": [106], "type": "code", "mnemonic": "ror"}, {"addr": 37379, "bytes": [144, 6], "type": "code", "mnemonic": "bcc", "operand": "c920b", "target": 37387, "target_label": "c920b"}, {"addr": 37381, "bytes": [42], "type": "code", "mnemonic": "rol"}, {"addr": 37382, "bytes": [41, 127], "type": "code", "mnemonic": "and", "operand": "#&7f"}, {"addr": 37384, "bytes": [141, 96, 13], "type": "code", "mnemonic": "sta", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37387, "bytes": [32, 23, 146], "labels": ["c920b"], "comments_before": ["&920b referenced 1 time by &9203"], "references": [37379], "type": "code", "mnemonic": "jsr", "operand": "flush_output_block", "target": 37399, "target_label": "flush_output_block"}, {"addr": 37390, "bytes": [110, 96, 13], "labels": ["c920e"], "comments_before": ["&920e referenced 1 time by &91fd"], "references": [37373], "type": "code", "mnemonic": "ror", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37393, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37394, "bytes": [106], "type": "code", "mnemonic": "ror"}, {"addr": 37395, "bytes": [46, 96, 13], "type": "code", "mnemonic": "rol", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37398, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 37399, "bytes": [160, 8], "labels": ["flush_output_block"], "comments_before": ["***************************************************************************************", "Flush output block\n\nSends the accumulated output block over the network, resets the\nbuffer pointer, and prepares for the next block of output data.", "***************************************************************************************", "&9217 referenced 2 times by &91e7, &920b"], "references": [37387, 37351], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 37401, "bytes": [173, 97, 13], "type": "code", "mnemonic": "lda", "operand": "printer_buf_ptr", "target": 3425, "target_label": "printer_buf_ptr"}, {"addr": 37404, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37406, "bytes": [165, 157], "type": "code", "mnemonic": "lda", "operand": "net_rx_ptr_hi", "target": 157, "target_label": "net_rx_ptr_hi"}, {"addr": 37408, "bytes": [200], "comment_inline": "Y=&09", "type": "code", "mnemonic": "iny"}, {"addr": 37409, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37411, "bytes": [160, 5], "type": "code", "mnemonic": "ldy", "operand": "#5"}, {"addr": 37413, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37415, "bytes": [160, 11], "type": "code", "mnemonic": "ldy", "operand": "#&0b"}, {"addr": 37417, "bytes": [162, 38], "type": "code", "mnemonic": "ldx", "operand": "#&26"}, {"addr": 37419, "bytes": [32, 102, 145], "type": "code", "mnemonic": "jsr", "operand": "ctrl_block_setup_clv", "target": 37222, "target_label": "ctrl_block_setup_clv"}, {"addr": 37422, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 37423, "bytes": [173, 96, 13], "type": "code", "mnemonic": "lda", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37426, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37427, "bytes": [42], "type": "code", "mnemonic": "rol"}, {"addr": 37428, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37429, "bytes": [73, 128], "type": "code", "mnemonic": "eor", "operand": "#&80"}, {"addr": 37431, "bytes": [141, 96, 13], "type": "code", "mnemonic": "sta", "operand": "l0d60", "target": 3424, "target_label": "l0d60"}, {"addr": 37434, "bytes": [42], "type": "code", "mnemonic": "rol"}, {"addr": 37435, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37437, "bytes": [160, 31], "type": "code", "mnemonic": "ldy", "operand": "#&1f"}, {"addr": 37439, "bytes": [140, 97, 13], "type": "code", "mnemonic": "sty", "operand": "printer_buf_ptr", "target": 3425, "target_label": "printer_buf_ptr"}, {"addr": 37442, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 37444, "bytes": [170], "comment_inline": "X=&00", "type": "code", "mnemonic": "tax"}, {"addr": 37445, "bytes": [164, 159], "type": "code", "mnemonic": "ldy", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 37447, "bytes": [88], "type": "code", "mnemonic": "cli"}, {"addr": 37448, "bytes": [134, 154], "labels": ["econet_tx_retry"], "comments_before": ["***************************************************************************************", "Transmit with retry loop (XMITFS/XMITFY)\n\nCalls the low-level transmit routine (BRIANX) with FSTRY (&FF = 255)\nretries and FSDELY (&60 = 96) ms delay between attempts. On each\niteration, checks the result code: zero means success, non-zero\nmeans retry. After all retries exhausted, reports a 'Net error'.\nEntry point XMITFY allows a custom delay in Y.", "***************************************************************************************", "&9248 referenced 2 times by &839b, &83d3"], "references": [33691, 33747], "type": "code", "mnemonic": "stx", "operand": "net_tx_ptr", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37450, "bytes": [132, 155], "type": "code", "mnemonic": "sty", "operand": "net_tx_ptr_hi", "target": 155, "target_label": "net_tx_ptr_hi"}, {"addr": 37452, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37453, "bytes": [45, 8, 14], "type": "code", "mnemonic": "and", "operand": "fs_sequence_nos", "target": 3592, "target_label": "fs_sequence_nos"}, {"addr": 37456, "bytes": [240, 2], "type": "code", "mnemonic": "beq", "operand": "bsxl1", "target": 37460, "target_label": "bsxl1"}, {"addr": 37458, "bytes": [169, 1], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 37460, "bytes": [160, 0], "labels": ["bsxl1"], "comments_before": ["&9254 referenced 1 time by &9250"], "references": [37456], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 37462, "bytes": [17, 154], "type": "code", "mnemonic": "ora", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37464, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37465, "bytes": [145, 154], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37467, "bytes": [32, 76, 134], "type": "code", "mnemonic": "jsr", "operand": "tx_poll_ff", "target": 34380, "target_label": "tx_poll_ff"}, {"addr": 37470, "bytes": [169, 255], "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 37472, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 37474, "bytes": [145, 154], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37476, "bytes": [200], "comment_inline": "Y=&09", "type": "code", "mnemonic": "iny"}, {"addr": 37477, "bytes": [145, 154], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37479, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37480, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 37481, "bytes": [160, 209], "type": "code", "mnemonic": "ldy", "operand": "#&d1"}, {"addr": 37483, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37484, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37485, "bytes": [240, 2], "type": "code", "mnemonic": "beq", "operand": "bspsx", "target": 37489, "target_label": "bspsx"}, {"addr": 37487, "bytes": [160, 144], "type": "code", "mnemonic": "ldy", "operand": "#&90"}, {"addr": 37489, "bytes": [152], "labels": ["bspsx"], "comments_before": ["&9271 referenced 1 time by &926d"], "references": [37485], "type": "code", "mnemonic": "tya"}, {"addr": 37490, "bytes": [160, 1], "type": "code", "mnemonic": "ldy", "operand": "#1"}, {"addr": 37492, "bytes": [145, 154], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37494, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 37495, "bytes": [136], "comment_inline": "Y=&00", "type": "code", "mnemonic": "dey"}, {"addr": 37496, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37497, "bytes": [169, 127], "labels": ["bsxl0"], "comments_before": ["&9279 referenced 1 time by &9285"], "references": [37509], "type": "code", "mnemonic": "lda", "operand": "#&7f"}, {"addr": 37499, "bytes": [145, 154], "type": "code", "mnemonic": "sta", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37501, "bytes": [32, 72, 132], "type": "code", "mnemonic": "jsr", "operand": "send_to_fs_star", "target": 33864, "target_label": "send_to_fs_star"}, {"addr": 37504, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37505, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37506, "bytes": [81, 154], "type": "code", "mnemonic": "eor", "operand": "(net_tx_ptr),y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 37508, "bytes": [106], "type": "code", "mnemonic": "ror"}, {"addr": 37509, "bytes": [176, 242], "type": "code", "mnemonic": "bcs", "operand": "bsxl0", "target": 37497, "target_label": "bsxl0"}, {"addr": 37511, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37512, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37513, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 37514, "bytes": [232], "type": "code", "mnemonic": "inx"}, {"addr": 37515, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "return_13", "target": 37520, "target_label": "return_13"}, {"addr": 37517, "bytes": [77, 8, 14], "type": "code", "mnemonic": "eor", "operand": "fs_sequence_nos", "target": 3592, "target_label": "fs_sequence_nos"}, {"addr": 37520, "bytes": [96], "labels": ["return_13"], "comments_before": ["&9290 referenced 1 time by &928b"], "references": [37515], "type": "code", "mnemonic": "rts"}, {"addr": 37521, "bytes": [165, 178], "labels": ["save_palette_vdu"], "comments_before": ["***************************************************************************************", "Save palette and VDU state (CVIEW)\n\nPart of the VIEW facility (second iteration, started 27/7/82).\nUses dynamically allocated buffer store. The WORKP1 pointer\n(&9E,&9F) serves double duty: non-zero indicates data ready AND\nprovides the buffer address \u2014 an efficient use of scarce zero-\npage space. This code must be user-transparent as the NFS may not\nbe the dominant filing system.\nReads all 16 palette entries using OSWORD &0B (read palette) and\nstores the results. Then reads cursor position (OSBYTE &85),\nshadow RAM allocation (OSBYTE &C2), and screen start address\n(OSBYTE &C3) using the 3-entry table at &9304 (osbyte_vdu_table).\nOn completion, restores the JSR buffer protection bits (LSTAT)\nfrom OLDJSR to re-enable JSR reception, which was disabled during\nthe screen data capture to prevent interference.", "***************************************************************************************"], "type": "code", "mnemonic": "lda", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37523, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37524, "bytes": [169, 233], "type": "code", "mnemonic": "lda", "operand": "#&e9"}, {"addr": 37526, "bytes": [133, 158], "type": "code", "mnemonic": "sta", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37528, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 37530, "bytes": [132, 178], "type": "code", "mnemonic": "sty", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37532, "bytes": [173, 80, 3], "type": "code", "mnemonic": "lda", "operand": "l0350", "target": 848, "target_label": "l0350"}, {"addr": 37535, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37537, "bytes": [230, 158], "type": "code", "mnemonic": "inc", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37539, "bytes": [173, 81, 3], "type": "code", "mnemonic": "lda", "operand": "l0351", "target": 849, "target_label": "l0351"}, {"addr": 37542, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37543, "bytes": [152], "comment_inline": "A=&00", "type": "code", "mnemonic": "tya"}, {"addr": 37544, "bytes": [145, 158], "labels": ["loop_c92a8"], "comments_before": ["&92a8 referenced 1 time by &92c7"], "references": [37575], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37546, "bytes": [166, 158], "type": "code", "mnemonic": "ldx", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37548, "bytes": [164, 159], "type": "code", "mnemonic": "ldy", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 37550, "bytes": [169, 11], "type": "code", "mnemonic": "lda", "operand": "#osword_read_palette"}, {"addr": 37552, "bytes": [32, 241, 255], "comment_inline": "Read palette", "type": "code", "mnemonic": "jsr", "operand": "osword", "target": 65521, "target_label": "osword"}, {"addr": 37555, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37556, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 37558, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37560, "bytes": [200], "comment_inline": "Y=&01", "type": "code", "mnemonic": "iny"}, {"addr": 37561, "bytes": [177, 158], "type": "code", "mnemonic": "lda", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37563, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 37564, "bytes": [166, 158], "type": "code", "mnemonic": "ldx", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37566, "bytes": [230, 158], "type": "code", "mnemonic": "inc", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37568, "bytes": [230, 178], "type": "code", "mnemonic": "inc", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37570, "bytes": [136], "comment_inline": "Y=&00", "type": "code", "mnemonic": "dey"}, {"addr": 37571, "bytes": [165, 178], "type": "code", "mnemonic": "lda", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37573, "bytes": [224, 249], "type": "code", "mnemonic": "cpx", "operand": "#&f9"}, {"addr": 37575, "bytes": [208, 223], "type": "code", "mnemonic": "bne", "operand": "loop_c92a8", "target": 37544, "target_label": "loop_c92a8"}, {"addr": 37577, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37578, "bytes": [132, 178], "type": "code", "mnemonic": "sty", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37580, "bytes": [230, 158], "type": "code", "mnemonic": "inc", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37582, "bytes": [32, 221, 146], "type": "code", "mnemonic": "jsr", "operand": "save_vdu_state", "target": 37597, "target_label": "save_vdu_state"}, {"addr": 37585, "bytes": [230, 158], "type": "code", "mnemonic": "inc", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37587, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 37588, "bytes": [133, 178], "type": "code", "mnemonic": "sta", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37590, "bytes": [173, 59, 13], "labels": ["clear_jsr_protection"], "comments_before": ["&92d6 referenced 4 times by &8e65, &9102, &9134, &9151"], "references": [37122, 37201, 37172, 36453], "type": "code", "mnemonic": "lda", "operand": "rx_ctrl_copy", "target": 3387, "target_label": "rx_ctrl_copy"}, {"addr": 37593, "bytes": [141, 99, 13], "type": "code", "mnemonic": "sta", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 37596, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 37597, "bytes": [173, 85, 3], "labels": ["save_vdu_state"], "comments_before": ["***************************************************************************************", "Save VDU workspace state\n\nStores the cursor position value from &0355 into NFS workspace,\nthen reads cursor position (OSBYTE &85), shadow RAM (OSBYTE &C2),\nand screen start (OSBYTE &C3) via read_vdu_osbyte, storing\neach result into consecutive workspace bytes.", "***************************************************************************************", "&92dd referenced 1 time by &92ce"], "references": [37582], "type": "code", "mnemonic": "lda", "operand": "l0355", "target": 853, "target_label": "l0355"}, {"addr": 37600, "bytes": [145, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace),y", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37602, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 37603, "bytes": [32, 240, 146], "type": "code", "mnemonic": "jsr", "operand": "read_vdu_osbyte", "target": 37616, "target_label": "read_vdu_osbyte"}, {"addr": 37606, "bytes": [230, 158], "type": "code", "mnemonic": "inc", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37608, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 37609, "bytes": [129, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace,x)", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37611, "bytes": [32, 238, 146], "type": "code", "mnemonic": "jsr", "operand": "read_vdu_osbyte_x0", "target": 37614, "target_label": "read_vdu_osbyte_x0"}, {"addr": 37614, "bytes": [162, 0], "labels": ["read_vdu_osbyte_x0"], "comments_before": ["&92ee referenced 1 time by &92eb"], "references": [37611], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 37616, "bytes": [164, 178], "labels": ["read_vdu_osbyte"], "comments_before": ["&92f0 referenced 1 time by &92e3"], "references": [37603], "type": "code", "mnemonic": "ldy", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37618, "bytes": [230, 178], "type": "code", "mnemonic": "inc", "operand": "fs_load_addr_2", "target": 178, "target_label": "fs_load_addr_2"}, {"addr": 37620, "bytes": [230, 158], "type": "code", "mnemonic": "inc", "operand": "nfs_workspace", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37622, "bytes": [185, 4, 147], "type": "code", "mnemonic": "lda", "operand": "osbyte_vdu_table,y", "target": 37636, "target_label": "osbyte_vdu_table"}, {"addr": 37625, "bytes": [160, 255], "type": "code", "mnemonic": "ldy", "operand": "#&ff"}, {"addr": 37627, "bytes": [32, 244, 255], "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 37630, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 37631, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 37633, "bytes": [129, 158], "type": "code", "mnemonic": "sta", "operand": "(nfs_workspace,x)", "target": 158, "target_label": "nfs_workspace"}, {"addr": 37635, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 37636, "bytes": [133, 194, 195], "labels": ["osbyte_vdu_table"], "comments_before": ["Table of 3 OSBYTE codes used by save_palette_vdu_state (&9291):\n  &85 = read cursor position\n  &C2 = read shadow RAM allocation\n  &C3 = read screen start address", "&9304 referenced 1 time by &92f6"], "references": [37622], "type": "byte", "values": [133, 194, 195]}, {"addr": 22, "bytes": [169, 255], "binary_addr": 37639, "labels": ["nmi_workspace_start", "tube_brk_handler"], "comments_before": ["***************************************************************************************", "Tube BRK handler (BRKV target) \u2014 reference: NFS11 NEWBR\n\nSends error information to the Tube co-processor via R2 and R4:\n  1. Sends &FF to R4 (WRIFOR) to signal error\n  2. Reads R2 data (flush any pending byte)\n  3. Sends &00 via R2, then error number from (&FD),0\n  4. Loops sending error string bytes via R2 until zero terminator\n  5. Falls through to tube_reset_stack \u2192 tube_main_loop\nThe main loop continuously polls R1 for WRCH requests (forwarded\nto OSWRITCH &FFCB) and R2 for command bytes (dispatched via the\n14-entry table at &0500). The R2 command byte is stored at &55\nbefore dispatch via JMP (&0500).", "***************************************************************************************", "&9307 referenced 1 time by &8116"], "references": [33046], "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 24, "bytes": [32, 217, 6], "binary_addr": 37641, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r4", "target": 1753, "target_label": "tube_send_r4"}, {"addr": 27, "bytes": [173, 227, 254], "binary_addr": 37644, "type": "code", "mnemonic": "lda", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 30, "bytes": [169, 0], "binary_addr": 37647, "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 32, "bytes": [32, 208, 6], "binary_addr": 37649, "labels": ["c0020"], "comments_before": ["&9311 referenced 1 time by &84b3"], "references": [33971], "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 35, "bytes": [168], "binary_addr": 37652, "type": "code", "mnemonic": "tay"}, {"addr": 36, "bytes": [177, 253], "binary_addr": 37653, "type": "code", "mnemonic": "lda", "operand": "(l00fd),y", "target": 253, "target_label": "l00fd"}, {"addr": 38, "bytes": [32, 208, 6], "binary_addr": 37655, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 41, "bytes": [200], "binary_addr": 37658, "labels": ["tube_brk_send_loop"], "comments_before": ["&931a referenced 1 time by &0030[1]"], "references": [48], "type": "code", "mnemonic": "iny"}, {"addr": 42, "bytes": [177, 253], "binary_addr": 37659, "type": "code", "mnemonic": "lda", "operand": "(l00fd),y", "target": 253, "target_label": "l00fd"}, {"addr": 44, "bytes": [32, 208, 6], "binary_addr": 37661, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 47, "bytes": [170], "binary_addr": 37664, "type": "code", "mnemonic": "tax"}, {"addr": 48, "bytes": [208, 247], "binary_addr": 37665, "type": "code", "mnemonic": "bne", "operand": "tube_brk_send_loop", "target": 41, "target_label": "tube_brk_send_loop"}, {"addr": 50, "bytes": [162, 255], "binary_addr": 37667, "labels": ["tube_reset_stack"], "type": "code", "mnemonic": "ldx", "operand": "#&ff"}, {"addr": 52, "bytes": [154], "binary_addr": 37669, "type": "code", "mnemonic": "txs"}, {"addr": 53, "bytes": [88], "binary_addr": 37670, "type": "code", "mnemonic": "cli"}, {"addr": 54, "bytes": [134, 17], "binary_addr": 37671, "labels": ["c0036"], "comments_before": ["&9327 referenced 2 times by &04ec[2], &053a[3]"], "references": [1260, 1338], "type": "code", "mnemonic": "stx", "operand": "zp_temp_11", "target": 17, "target_label": "zp_temp_11"}, {"addr": 56, "bytes": [132, 16], "binary_addr": 37673, "type": "code", "mnemonic": "sty", "operand": "zp_temp_10", "target": 16, "target_label": "zp_temp_10"}, {"addr": 58, "bytes": [44, 224, 254], "binary_addr": 37675, "labels": ["tube_main_loop"], "comments_before": ["&932b referenced 7 times by &0048[1], &05ae[3], &05d5[3], &0623[4], &0638[4], &06a0[4], &06cd[4]"], "references": [1493, 72, 1592, 1454, 1571, 1696, 1741], "type": "code", "mnemonic": "bit", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 61, "bytes": [16, 6], "binary_addr": 37678, "type": "code", "mnemonic": "bpl", "operand": "tube_poll_r2", "target": 69, "target_label": "tube_poll_r2"}, {"addr": 63, "bytes": [173, 225, 254], "binary_addr": 37680, "labels": ["tube_handle_wrch"], "comments_before": ["&9330 referenced 1 time by &004d[1]"], "references": [77], "type": "code", "mnemonic": "lda", "operand": "tube_data_register_1", "target": 65249, "target_label": "tube_data_register_1"}, {"addr": 66, "bytes": [32, 203, 255], "binary_addr": 37683, "comment_inline": "Write character", "type": "code", "mnemonic": "jsr", "operand": "nvwrch", "target": 65483, "target_label": "nvwrch"}, {"addr": 69, "bytes": [44, 226, 254], "binary_addr": 37686, "labels": ["tube_poll_r2"], "comments_before": ["&9336 referenced 1 time by &003d[1]"], "references": [61], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 72, "bytes": [16, 240], "binary_addr": 37689, "type": "code", "mnemonic": "bpl", "operand": "tube_main_loop", "target": 58, "target_label": "tube_main_loop"}, {"addr": 74, "bytes": [44, 224, 254], "binary_addr": 37691, "type": "code", "mnemonic": "bit", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 77, "bytes": [48, 240], "binary_addr": 37694, "type": "code", "mnemonic": "bmi", "operand": "tube_handle_wrch", "target": 63, "target_label": "tube_handle_wrch"}, {"addr": 79, "bytes": [174, 227, 254], "binary_addr": 37696, "type": "code", "mnemonic": "ldx", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 82, "bytes": [134, 85], "binary_addr": 37699, "type": "code", "mnemonic": "stx", "operand": "l0055", "target": 85, "target_label": "l0055"}, {"addr": 84, "bytes": [108, 0, 5], "binary_addr": 37701, "labels": ["tube_dispatch_cmd"], "sub_labels": {"85": ["l0055"]}, "comments_before": ["&9346 referenced 1 time by &0052[1]"], "type": "code", "mnemonic": "jmp", "operand": "(tube_dispatch_table)", "target": 1280, "target_label": "tube_dispatch_table"}, {"addr": 87, "bytes": [0], "binary_addr": 37704, "labels": ["tube_transfer_addr"], "comments_before": ["&9348 referenced 2 times by &0478[2], &0493[2]"], "references": [1144, 1171], "type": "byte", "values": [0]}, {"addr": 88, "bytes": [128], "binary_addr": 37705, "labels": ["l0058"], "comments_before": ["&9349 referenced 2 times by &047c[2], &0498[2]"], "references": [1148, 1176], "type": "byte", "values": [128]}, {"addr": 89, "bytes": [0], "binary_addr": 37706, "labels": ["l0059"], "comments_before": ["&934a referenced 1 time by &04a2[2]"], "references": [1186], "type": "byte", "values": [0]}, {"addr": 90, "bytes": [0], "binary_addr": 37707, "labels": ["l005a"], "comments_before": ["&934b referenced 1 time by &04a0[2]"], "references": [1184], "type": "byte", "values": [0]}, {"addr": 1024, "bytes": [76, 115, 4], "binary_addr": 37708, "labels": ["tube_code_page4"], "comments_before": ["***************************************************************************************", "Tube host code page 4 \u2014 reference: NFS12 (BEGIN, ADRR, SENDW)\n\nCopied from ROM at &934C during init. The first 28 bytes (&0400-&041B)\noverlap with the end of the ZP block (the same ROM bytes serve both\nthe ZP copy at &005B-&0076 and this page at &0400-&041B). Contains:\n  &0400: JMP &0473 (BEGIN \u2014 CLI parser / startup entry)\n  &0403: JMP &06E2 (tube_escape_check)\n  &0406: tube_addr_claim \u2014 Tube address claim protocol (ADRR)\n  &0414: tube_post_init \u2014 called after ROM\u2192RAM copy\n  &0473: BEGIN \u2014 startup/CLI entry, break type check\n  &04E7: tube_rdch_handler \u2014 RDCHV target\n  &04EF: tube_restore_regs \u2014 restore X,Y, dispatch entry 6\n  &04F7: tube_read_r2 \u2014 poll R2 status, read data byte to A", "***************************************************************************************", "&934c referenced 1 time by &80fc"], "references": [33020], "type": "code", "mnemonic": "jmp", "operand": "c0473", "target": 1139, "target_label": "c0473"}, {"addr": 1027, "bytes": [76, 226, 6], "binary_addr": 37711, "labels": ["tube_escape_entry"], "type": "code", "mnemonic": "jmp", "operand": "tube_escape_check", "target": 1762, "target_label": "tube_escape_check"}, {"addr": 1030, "bytes": [201, 128], "binary_addr": 37714, "labels": ["tube_addr_claim"], "comments_before": ["&9352 referenced 10 times by &04bc[2], &04e4[2], &8b1d, &8b2f, &8b8c, &8da9, &99f0, &9a3d, &9f98, &9fa0"], "references": [1252, 39485, 35724, 36265, 1212, 39408, 35613, 35631, 40856, 40864], "type": "code", "mnemonic": "cmp", "operand": "#&80"}, {"addr": 1032, "bytes": [144, 28], "binary_addr": 37716, "type": "code", "mnemonic": "bcc", "operand": "c0426", "target": 1062, "target_label": "c0426"}, {"addr": 1034, "bytes": [201, 192], "binary_addr": 37718, "type": "code", "mnemonic": "cmp", "operand": "#&c0"}, {"addr": 1036, "bytes": [176, 11], "binary_addr": 37720, "type": "code", "mnemonic": "bcs", "operand": "c0419", "target": 1049, "target_label": "c0419"}, {"addr": 1038, "bytes": [9, 64], "binary_addr": 37722, "type": "code", "mnemonic": "ora", "operand": "#&40"}, {"addr": 1040, "bytes": [197, 21], "binary_addr": 37724, "type": "code", "mnemonic": "cmp", "operand": "l0015", "target": 21, "target_label": "l0015"}, {"addr": 1042, "bytes": [208, 17], "binary_addr": 37726, "type": "code", "mnemonic": "bne", "operand": "return_14", "target": 1061, "target_label": "return_14"}, {"addr": 1044, "bytes": [169, 128], "binary_addr": 37728, "labels": ["tube_post_init"], "comments_before": ["&9360 referenced 1 time by &810e"], "references": [33038], "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 1046, "bytes": [133, 20], "binary_addr": 37730, "type": "code", "mnemonic": "sta", "operand": "l0014", "target": 20, "target_label": "l0014"}, {"addr": 1048, "bytes": [96], "binary_addr": 37732, "type": "code", "mnemonic": "rts"}, {"addr": 1049, "bytes": [6, 20], "binary_addr": 37733, "labels": ["c0419"], "comments_before": ["&9365 referenced 1 time by &040c[2]"], "references": [1036], "type": "code", "mnemonic": "asl", "operand": "l0014", "target": 20, "target_label": "l0014"}, {"addr": 1051, "bytes": [176, 6], "binary_addr": 37735, "type": "code", "mnemonic": "bcs", "operand": "c0423", "target": 1059, "target_label": "c0423"}, {"addr": 1053, "bytes": [197, 21], "binary_addr": 37737, "type": "code", "mnemonic": "cmp", "operand": "l0015", "target": 21, "target_label": "l0015"}, {"addr": 1055, "bytes": [240, 4], "binary_addr": 37739, "type": "code", "mnemonic": "beq", "operand": "return_14", "target": 1061, "target_label": "return_14"}, {"addr": 1057, "bytes": [24], "binary_addr": 37741, "type": "code", "mnemonic": "clc"}, {"addr": 1058, "bytes": [96], "binary_addr": 37742, "type": "code", "mnemonic": "rts"}, {"addr": 1059, "bytes": [133, 21], "binary_addr": 37743, "labels": ["c0423"], "comments_before": ["&936f referenced 1 time by &041b[2]"], "references": [1051], "type": "code", "mnemonic": "sta", "operand": "l0015", "target": 21, "target_label": "l0015"}, {"addr": 1061, "bytes": [96], "binary_addr": 37745, "labels": ["return_14"], "comments_before": ["&9371 referenced 2 times by &0412[2], &041f[2]"], "references": [1042, 1055], "type": "code", "mnemonic": "rts"}, {"addr": 1062, "bytes": [132, 19], "binary_addr": 37746, "labels": ["c0426"], "comments_before": ["&9372 referenced 1 time by &0408[2]"], "references": [1032], "type": "code", "mnemonic": "sty", "operand": "l0013", "target": 19, "target_label": "l0013"}, {"addr": 1064, "bytes": [134, 18], "binary_addr": 37748, "type": "code", "mnemonic": "stx", "operand": "l0012", "target": 18, "target_label": "l0012"}, {"addr": 1066, "bytes": [32, 217, 6], "binary_addr": 37750, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r4", "target": 1753, "target_label": "tube_send_r4"}, {"addr": 1069, "bytes": [170], "binary_addr": 37753, "type": "code", "mnemonic": "tax"}, {"addr": 1070, "bytes": [160, 3], "binary_addr": 37754, "type": "code", "mnemonic": "ldy", "operand": "#3"}, {"addr": 1072, "bytes": [177, 18], "binary_addr": 37756, "labels": ["loop_c0430"], "comments_before": ["&937c referenced 1 time by &0436[2]"], "references": [1078], "type": "code", "mnemonic": "lda", "operand": "(l0012),y", "target": 18, "target_label": "l0012"}, {"addr": 1074, "bytes": [32, 217, 6], "binary_addr": 37758, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r4", "target": 1753, "target_label": "tube_send_r4"}, {"addr": 1077, "bytes": [136], "binary_addr": 37761, "type": "code", "mnemonic": "dey"}, {"addr": 1078, "bytes": [16, 248], "binary_addr": 37762, "type": "code", "mnemonic": "bpl", "operand": "loop_c0430", "target": 1072, "target_label": "loop_c0430"}, {"addr": 1080, "bytes": [160, 8], "binary_addr": 37764, "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 1082, "bytes": [140, 224, 254], "binary_addr": 37766, "type": "code", "mnemonic": "sty", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 1085, "bytes": [160, 16], "binary_addr": 37769, "type": "code", "mnemonic": "ldy", "operand": "#&10"}, {"addr": 1087, "bytes": [224, 2], "binary_addr": 37771, "type": "code", "mnemonic": "cpx", "operand": "#2"}, {"addr": 1089, "bytes": [144, 2], "binary_addr": 37773, "type": "code", "mnemonic": "bcc", "operand": "c0445", "target": 1093, "target_label": "c0445"}, {"addr": 1091, "bytes": [160, 144], "binary_addr": 37775, "type": "code", "mnemonic": "ldy", "operand": "#&90"}, {"addr": 1093, "bytes": [140, 224, 254], "binary_addr": 37777, "labels": ["c0445"], "comments_before": ["&9391 referenced 1 time by &0441[2]"], "references": [1089], "type": "code", "mnemonic": "sty", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 1096, "bytes": [32, 217, 6], "binary_addr": 37780, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r4", "target": 1753, "target_label": "tube_send_r4"}, {"addr": 1099, "bytes": [160, 136], "binary_addr": 37783, "type": "code", "mnemonic": "ldy", "operand": "#&88"}, {"addr": 1101, "bytes": [138], "binary_addr": 37785, "type": "code", "mnemonic": "txa"}, {"addr": 1102, "bytes": [240, 20], "binary_addr": 37786, "type": "code", "mnemonic": "beq", "operand": "c0464", "target": 1124, "target_label": "c0464"}, {"addr": 1104, "bytes": [201, 2], "binary_addr": 37788, "type": "code", "mnemonic": "cmp", "operand": "#2"}, {"addr": 1106, "bytes": [240, 16], "binary_addr": 37790, "type": "code", "mnemonic": "beq", "operand": "c0464", "target": 1124, "target_label": "c0464"}, {"addr": 1108, "bytes": [140, 224, 254], "binary_addr": 37792, "type": "code", "mnemonic": "sty", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 1111, "bytes": [201, 4], "binary_addr": 37795, "type": "code", "mnemonic": "cmp", "operand": "#4"}, {"addr": 1113, "bytes": [208, 23], "binary_addr": 37797, "type": "code", "mnemonic": "bne", "operand": "return_15", "target": 1138, "target_label": "return_15"}, {"addr": 1115, "bytes": [104], "binary_addr": 37799, "type": "code", "mnemonic": "pla"}, {"addr": 1116, "bytes": [104], "binary_addr": 37800, "type": "code", "mnemonic": "pla"}, {"addr": 1117, "bytes": [169, 128], "binary_addr": 37801, "labels": ["c045d"], "comments_before": ["&93a9 referenced 1 time by &04b8[2]"], "references": [1208], "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 1119, "bytes": [133, 20], "binary_addr": 37803, "type": "code", "mnemonic": "sta", "operand": "l0014", "target": 20, "target_label": "l0014"}, {"addr": 1121, "bytes": [76, 205, 5], "binary_addr": 37805, "type": "code", "mnemonic": "jmp", "operand": "tube_reply_byte", "target": 1485, "target_label": "tube_reply_byte"}, {"addr": 1124, "bytes": [44, 230, 254], "binary_addr": 37808, "labels": ["c0464"], "comments_before": ["&93b0 referenced 3 times by &044e[2], &0452[2], &0467[2]"], "references": [1102, 1106, 1127], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_4_and_cpu_control", "target": 65254, "target_label": "tube_status_register_4_and_cpu_control"}, {"addr": 1127, "bytes": [80, 251], "binary_addr": 37811, "type": "code", "mnemonic": "bvc", "operand": "c0464", "target": 1124, "target_label": "c0464"}, {"addr": 1129, "bytes": [44, 229, 254], "binary_addr": 37813, "type": "code", "mnemonic": "bit", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 1132, "bytes": [44, 229, 254], "binary_addr": 37816, "type": "code", "mnemonic": "bit", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 1135, "bytes": [140, 224, 254], "binary_addr": 37819, "type": "code", "mnemonic": "sty", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 1138, "bytes": [96], "binary_addr": 37822, "labels": ["return_15"], "comments_before": ["&93be referenced 1 time by &0459[2]"], "references": [1113], "type": "code", "mnemonic": "rts"}, {"addr": 1139, "bytes": [88], "binary_addr": 37823, "labels": ["c0473"], "comments_before": ["&93bf referenced 1 time by &0400[2]"], "references": [1024], "type": "code", "mnemonic": "cli"}, {"addr": 1140, "bytes": [8], "binary_addr": 37824, "type": "code", "mnemonic": "php"}, {"addr": 1141, "bytes": [72], "binary_addr": 37825, "type": "code", "mnemonic": "pha"}, {"addr": 1142, "bytes": [160, 0], "binary_addr": 37826, "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 1144, "bytes": [132, 87], "binary_addr": 37828, "type": "code", "mnemonic": "sty", "operand": "tube_transfer_addr", "target": 87, "target_label": "tube_transfer_addr"}, {"addr": 1146, "bytes": [169, 128], "binary_addr": 37830, "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 1148, "bytes": [133, 88], "binary_addr": 37832, "type": "code", "mnemonic": "sta", "operand": "l0058", "target": 88, "target_label": "l0058"}, {"addr": 1150, "bytes": [133, 1], "binary_addr": 37834, "type": "code", "mnemonic": "sta", "operand": "l0001", "target": 1, "target_label": "l0001"}, {"addr": 1152, "bytes": [169, 32], "binary_addr": 37836, "type": "code", "mnemonic": "lda", "operand": "#&20"}, {"addr": 1154, "bytes": [45, 6, 128], "binary_addr": 37838, "type": "code", "mnemonic": "and", "operand": "rom_type", "target": 32774, "target_label": "rom_type"}, {"addr": 1157, "bytes": [240, 25], "binary_addr": 37841, "type": "code", "mnemonic": "beq", "operand": "c04a0", "target": 1184, "target_label": "c04a0"}, {"addr": 1159, "bytes": [174, 7, 128], "binary_addr": 37843, "type": "code", "mnemonic": "ldx", "operand": "copyright_offset", "target": 32775, "target_label": "copyright_offset"}, {"addr": 1162, "bytes": [232], "binary_addr": 37846, "labels": ["loop_c048a"], "comments_before": ["&93d6 referenced 1 time by &048e[2]"], "references": [1166], "type": "code", "mnemonic": "inx"}, {"addr": 1163, "bytes": [189, 0, 128], "binary_addr": 37847, "type": "code", "mnemonic": "lda", "operand": "rom_header,x", "target": 32768, "target_label": "rom_header"}, {"addr": 1166, "bytes": [208, 250], "binary_addr": 37850, "type": "code", "mnemonic": "bne", "operand": "loop_c048a", "target": 1162, "target_label": "loop_c048a"}, {"addr": 1168, "bytes": [189, 1, 128], "binary_addr": 37852, "type": "code", "mnemonic": "lda", "operand": "l8001,x", "target": 32769, "target_label": "l8001"}, {"addr": 1171, "bytes": [133, 87], "binary_addr": 37855, "type": "code", "mnemonic": "sta", "operand": "tube_transfer_addr", "target": 87, "target_label": "tube_transfer_addr"}, {"addr": 1173, "bytes": [189, 2, 128], "binary_addr": 37857, "type": "code", "mnemonic": "lda", "operand": "l8002,x", "target": 32770, "target_label": "l8002"}, {"addr": 1176, "bytes": [133, 88], "binary_addr": 37860, "type": "code", "mnemonic": "sta", "operand": "l0058", "target": 88, "target_label": "l0058"}, {"addr": 1178, "bytes": [188, 3, 128], "binary_addr": 37862, "type": "code", "mnemonic": "ldy", "operand": "service_entry,x", "target": 32771, "target_label": "service_entry"}, {"addr": 1181, "bytes": [189, 4, 128], "binary_addr": 37865, "type": "code", "mnemonic": "lda", "operand": "l8004,x", "target": 32772, "target_label": "l8004"}, {"addr": 1184, "bytes": [133, 90], "binary_addr": 37868, "labels": ["c04a0"], "comments_before": ["&93ec referenced 1 time by &0485[2]"], "references": [1157], "type": "code", "mnemonic": "sta", "operand": "l005a", "target": 90, "target_label": "l005a"}, {"addr": 1186, "bytes": [132, 89], "binary_addr": 37870, "type": "code", "mnemonic": "sty", "operand": "l0059", "target": 89, "target_label": "l0059"}, {"addr": 1188, "bytes": [104], "binary_addr": 37872, "type": "code", "mnemonic": "pla"}, {"addr": 1189, "bytes": [40], "binary_addr": 37873, "type": "code", "mnemonic": "plp"}, {"addr": 1190, "bytes": [176, 18], "binary_addr": 37874, "type": "code", "mnemonic": "bcs", "operand": "beginr", "target": 1210, "target_label": "beginr"}, {"addr": 1192, "bytes": [170], "binary_addr": 37876, "type": "code", "mnemonic": "tax"}, {"addr": 1193, "bytes": [208, 3], "binary_addr": 37877, "type": "code", "mnemonic": "bne", "operand": "begink", "target": 1198, "target_label": "begink"}, {"addr": 1195, "bytes": [76, 203, 5], "binary_addr": 37879, "type": "code", "mnemonic": "jmp", "operand": "tube_reply_ack", "target": 1483, "target_label": "tube_reply_ack"}, {"addr": 1198, "bytes": [162, 0], "binary_addr": 37882, "labels": ["begink"], "comments_before": ["&93fa referenced 1 time by &04a9[2]"], "references": [1193], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 1200, "bytes": [160, 255], "binary_addr": 37884, "type": "code", "mnemonic": "ldy", "operand": "#&ff"}, {"addr": 1202, "bytes": [169, 253], "binary_addr": 37886, "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_write_last_break_type"}, {"addr": 1204, "bytes": [32, 244, 255], "binary_addr": 37888, "comment_inline": "Read type of last reset", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 1207, "bytes": [138], "binary_addr": 37891, "comment_inline": "X=value of type of last reset", "type": "code", "mnemonic": "txa"}, {"addr": 1208, "bytes": [240, 163], "binary_addr": 37892, "type": "code", "mnemonic": "beq", "operand": "c045d", "target": 1117, "target_label": "c045d"}, {"addr": 1210, "bytes": [169, 255], "binary_addr": 37894, "labels": ["beginr"], "comments_before": ["&9406 referenced 2 times by &04a6[2], &04bf[2]"], "references": [1190, 1215], "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 1212, "bytes": [32, 6, 4], "binary_addr": 37896, "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 1215, "bytes": [144, 249], "binary_addr": 37899, "type": "code", "mnemonic": "bcc", "operand": "beginr", "target": 1210, "target_label": "beginr"}, {"addr": 1217, "bytes": [169, 1], "binary_addr": 37901, "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 1219, "bytes": [32, 224, 4], "binary_addr": 37903, "type": "code", "mnemonic": "jsr", "operand": "tube_setup_transfer", "target": 1248, "target_label": "tube_setup_transfer"}, {"addr": 1222, "bytes": [160, 0], "binary_addr": 37906, "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 1224, "bytes": [132, 0], "binary_addr": 37908, "type": "code", "mnemonic": "sty", "operand": "l0000", "target": 0, "target_label": "l0000"}, {"addr": 1226, "bytes": [162, 64], "binary_addr": 37910, "type": "code", "mnemonic": "ldx", "operand": "#&40"}, {"addr": 1228, "bytes": [177, 0], "binary_addr": 37912, "labels": ["c04cc"], "comments_before": ["&9418 referenced 2 times by &04d7[2], &04dc[2]"], "references": [1239, 1244], "type": "code", "mnemonic": "lda", "operand": "(l0000),y", "target": 0, "target_label": "l0000"}, {"addr": 1230, "bytes": [141, 229, 254], "binary_addr": 37914, "type": "code", "mnemonic": "sta", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 1233, "bytes": [44, 228, 254], "binary_addr": 37917, "labels": ["loop_c04d1"], "comments_before": ["&941d referenced 1 time by &04d4[2]"], "references": [1236], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_3", "target": 65252, "target_label": "tube_status_register_3"}, {"addr": 1236, "bytes": [80, 251], "binary_addr": 37920, "type": "code", "mnemonic": "bvc", "operand": "loop_c04d1", "target": 1233, "target_label": "loop_c04d1"}, {"addr": 1238, "bytes": [200], "binary_addr": 37922, "type": "code", "mnemonic": "iny"}, {"addr": 1239, "bytes": [208, 243], "binary_addr": 37923, "type": "code", "mnemonic": "bne", "operand": "c04cc", "target": 1228, "target_label": "c04cc"}, {"addr": 1241, "bytes": [230, 1], "binary_addr": 37925, "type": "code", "mnemonic": "inc", "operand": "l0001", "target": 1, "target_label": "l0001"}, {"addr": 1243, "bytes": [202], "binary_addr": 37927, "type": "code", "mnemonic": "dex"}, {"addr": 1244, "bytes": [208, 238], "binary_addr": 37928, "type": "code", "mnemonic": "bne", "operand": "c04cc", "target": 1228, "target_label": "c04cc"}, {"addr": 1246, "bytes": [169, 4], "binary_addr": 37930, "type": "code", "mnemonic": "lda", "operand": "#4"}, {"addr": 1248, "bytes": [160, 0], "binary_addr": 37932, "labels": ["tube_setup_transfer"], "comments_before": ["&942c referenced 1 time by &04c3[2]"], "references": [1219], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 1250, "bytes": [162, 87], "binary_addr": 37934, "type": "code", "mnemonic": "ldx", "operand": "#&57"}, {"addr": 1252, "bytes": [76, 6, 4], "binary_addr": 37936, "type": "code", "mnemonic": "jmp", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 1255, "bytes": [169, 1], "binary_addr": 37939, "labels": ["tube_rdch_handler"], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 1257, "bytes": [32, 208, 6], "binary_addr": 37941, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1260, "bytes": [76, 54, 0], "binary_addr": 37944, "type": "code", "mnemonic": "jmp", "operand": "c0036", "target": 54, "target_label": "c0036"}, {"addr": 1263, "bytes": [164, 16], "binary_addr": 37947, "labels": ["tube_restore_regs"], "type": "code", "mnemonic": "ldy", "operand": "zp_temp_10", "target": 16, "target_label": "zp_temp_10"}, {"addr": 1265, "bytes": [166, 17], "binary_addr": 37949, "type": "code", "mnemonic": "ldx", "operand": "zp_temp_11", "target": 17, "target_label": "zp_temp_11"}, {"addr": 1267, "bytes": [32, 247, 4], "binary_addr": 37951, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1270, "bytes": [10], "binary_addr": 37954, "type": "code", "mnemonic": "asl"}, {"addr": 1271, "bytes": [44, 226, 254], "binary_addr": 37955, "labels": ["tube_read_r2"], "comments_before": ["&9443 referenced 22 times by &04f3[2], &04fa[2], &0543[3], &0547[3], &0550[3], &0569[3], &0580[3], &058c[3], &0592[3], &059b[3], &05b5[3], &05da[3], &05eb[3], &0604[4], &060c[4], &0626[4], &062a[4], &063b[4], &063f[4], &0643[4], &065d[4], &06a5[4]"], "references": [1574, 1595, 1629, 1420, 1360, 1347, 1385, 1274, 1701, 1498, 1540, 1267, 1578, 1599, 1351, 1408, 1461, 1426, 1603, 1548, 1435, 1515], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1274, "bytes": [16, 251], "binary_addr": 37958, "type": "code", "mnemonic": "bpl", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1276, "bytes": [173, 227, 254], "binary_addr": 37960, "type": "code", "mnemonic": "lda", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1279, "bytes": [96], "binary_addr": 37963, "type": "code", "mnemonic": "rts"}, {"addr": 1280, "bytes": [91, 5, 197, 5, 38, 6, 59, 6, 93, 6, 163, 6, 239, 4, 61, 5, 140, 5, 80, 5, 67, 5, 105, 5, 216, 5, 2, 6], "binary_addr": 37964, "labels": ["tube_dispatch_table"], "comments_before": ["***************************************************************************************", "Tube host code page 5 \u2014 reference: NFS13 (TASKS, BPUT-FILE)\n\nCopied from ROM at &944C during init. Contains:\n  &0500: tube_dispatch_table \u2014 14-entry handler address table\n  &051C: tube_wrch_handler \u2014 WRCHV target\n  &051F: tube_send_and_poll \u2014 send byte via R2, poll for reply\n  &0527: tube_poll_r1_wrch \u2014 service R1 WRCH while waiting for R2\n  &053D: tube_release_return \u2014 restore regs and RTS\n  &0543: tube_osbput \u2014 write byte to file\n  &0550: tube_osbget \u2014 read byte from file\n  &055B: tube_osrdch \u2014 read character\n  &0569: tube_osfind \u2014 open file\n  &0580: tube_osfind_close \u2014 close file (A=0)\n  &058C: tube_osargs \u2014 file argument read/write\n  &05B1: tube_read_string \u2014 read CR-terminated string into &0700\n  &05C5: tube_oscli \u2014 execute * command\n  &05CB: tube_reply_ack \u2014 send &7F acknowledge\n  &05CD: tube_reply_byte \u2014 send byte and return to main loop\n  &05D8: tube_osfile \u2014 whole file operation", "***************************************************************************************", "&944c referenced 2 times by &0054[1], &8102"], "references": [84, 33026], "type": "byte", "values": [91, 5, 197, 5, 38, 6, 59, 6, 93, 6, 163, 6, 239, 4, 61, 5, 140, 5, 80, 5, 67, 5, 105, 5, 216, 5, 2, 6]}, {"addr": 1308, "bytes": [72], "binary_addr": 37992, "labels": ["tube_wrch_handler"], "type": "code", "mnemonic": "pha"}, {"addr": 1309, "bytes": [169, 0], "binary_addr": 37993, "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 1311, "bytes": [32, 208, 6], "binary_addr": 37995, "labels": ["tube_send_and_poll"], "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1314, "bytes": [44, 226, 254], "binary_addr": 37998, "labels": ["c0522"], "comments_before": ["&946e referenced 2 times by &052a[3], &0532[3]"], "references": [1322, 1330], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1317, "bytes": [112, 14], "binary_addr": 38001, "type": "code", "mnemonic": "bvs", "operand": "c0535", "target": 1333, "target_label": "c0535"}, {"addr": 1319, "bytes": [44, 224, 254], "binary_addr": 38003, "labels": ["tube_poll_r1_wrch"], "type": "code", "mnemonic": "bit", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 1322, "bytes": [16, 246], "binary_addr": 38006, "type": "code", "mnemonic": "bpl", "operand": "c0522", "target": 1314, "target_label": "c0522"}, {"addr": 1324, "bytes": [173, 225, 254], "binary_addr": 38008, "type": "code", "mnemonic": "lda", "operand": "tube_data_register_1", "target": 65249, "target_label": "tube_data_register_1"}, {"addr": 1327, "bytes": [32, 203, 255], "binary_addr": 38011, "comment_inline": "Write character", "type": "code", "mnemonic": "jsr", "operand": "nvwrch", "target": 65483, "target_label": "nvwrch"}, {"addr": 1330, "bytes": [76, 34, 5], "binary_addr": 38014, "labels": ["tube_resume_poll"], "type": "code", "mnemonic": "jmp", "operand": "c0522", "target": 1314, "target_label": "c0522"}, {"addr": 1333, "bytes": [104], "binary_addr": 38017, "labels": ["c0535"], "comments_before": ["&9481 referenced 1 time by &0525[3]"], "references": [1317], "type": "code", "mnemonic": "pla"}, {"addr": 1334, "bytes": [141, 227, 254], "binary_addr": 38018, "type": "code", "mnemonic": "sta", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1337, "bytes": [72], "binary_addr": 38021, "type": "code", "mnemonic": "pha"}, {"addr": 1338, "bytes": [76, 54, 0], "binary_addr": 38022, "type": "code", "mnemonic": "jmp", "operand": "c0036", "target": 54, "target_label": "c0036"}, {"addr": 1341, "bytes": [166, 17], "binary_addr": 38025, "labels": ["tube_release_return"], "type": "code", "mnemonic": "ldx", "operand": "zp_temp_11", "target": 17, "target_label": "zp_temp_11"}, {"addr": 1343, "bytes": [164, 16], "binary_addr": 38027, "type": "code", "mnemonic": "ldy", "operand": "zp_temp_10", "target": 16, "target_label": "zp_temp_10"}, {"addr": 1345, "bytes": [104], "binary_addr": 38029, "type": "code", "mnemonic": "pla"}, {"addr": 1346, "bytes": [96], "binary_addr": 38030, "type": "code", "mnemonic": "rts"}, {"addr": 1347, "bytes": [32, 247, 4], "binary_addr": 38031, "labels": ["tube_osbput"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1350, "bytes": [168], "binary_addr": 38034, "type": "code", "mnemonic": "tay"}, {"addr": 1351, "bytes": [32, 247, 4], "binary_addr": 38035, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1354, "bytes": [32, 212, 255], "binary_addr": 38038, "comment_inline": "Write a single byte A to an open file Y", "type": "code", "mnemonic": "jsr", "operand": "osbput", "target": 65492, "target_label": "osbput"}, {"addr": 1357, "bytes": [76, 203, 5], "binary_addr": 38041, "type": "code", "mnemonic": "jmp", "operand": "tube_reply_ack", "target": 1483, "target_label": "tube_reply_ack"}, {"addr": 1360, "bytes": [32, 247, 4], "binary_addr": 38044, "labels": ["tube_osbget"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1363, "bytes": [168], "binary_addr": 38047, "comment_inline": "Y=file handle", "type": "code", "mnemonic": "tay"}, {"addr": 1364, "bytes": [32, 215, 255], "binary_addr": 38048, "comment_inline": "Read a single byte from an open file Y", "type": "code", "mnemonic": "jsr", "operand": "osbget", "target": 65495, "target_label": "osbget"}, {"addr": 1367, "bytes": [72], "binary_addr": 38051, "type": "code", "mnemonic": "pha"}, {"addr": 1368, "bytes": [76, 95, 5], "binary_addr": 38052, "type": "code", "mnemonic": "jmp", "operand": "c055f", "target": 1375, "target_label": "c055f"}, {"addr": 1371, "bytes": [32, 200, 255], "binary_addr": 38055, "labels": ["tube_osrdch"], "comment_inline": "Read a character from the current input stream", "type": "code", "mnemonic": "jsr", "operand": "nvrdch", "target": 65480, "target_label": "nvrdch"}, {"addr": 1374, "bytes": [72], "binary_addr": 38058, "comment_inline": "A=character read", "type": "code", "mnemonic": "pha"}, {"addr": 1375, "bytes": [9, 128], "binary_addr": 38059, "labels": ["c055f"], "comments_before": ["&94ab referenced 1 time by &0558[3]"], "references": [1368], "type": "code", "mnemonic": "ora", "operand": "#&80"}, {"addr": 1377, "bytes": [106], "binary_addr": 38061, "labels": ["tube_rdch_reply"], "type": "code", "mnemonic": "ror"}, {"addr": 1378, "bytes": [32, 208, 6], "binary_addr": 38062, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1381, "bytes": [104], "binary_addr": 38065, "type": "code", "mnemonic": "pla"}, {"addr": 1382, "bytes": [76, 205, 5], "binary_addr": 38066, "type": "code", "mnemonic": "jmp", "operand": "tube_reply_byte", "target": 1485, "target_label": "tube_reply_byte"}, {"addr": 1385, "bytes": [32, 247, 4], "binary_addr": 38069, "labels": ["tube_osfind"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1388, "bytes": [240, 18], "binary_addr": 38072, "type": "code", "mnemonic": "beq", "operand": "tube_osfind_close", "target": 1408, "target_label": "tube_osfind_close"}, {"addr": 1390, "bytes": [72], "binary_addr": 38074, "type": "code", "mnemonic": "pha"}, {"addr": 1391, "bytes": [32, 177, 5], "binary_addr": 38075, "type": "code", "mnemonic": "jsr", "operand": "tube_read_string", "target": 1457, "target_label": "tube_read_string"}, {"addr": 1394, "bytes": [104], "binary_addr": 38078, "type": "code", "mnemonic": "pla"}, {"addr": 1395, "bytes": [32, 206, 255], "binary_addr": 38079, "comment_inline": "Open or close file(s)", "type": "code", "mnemonic": "jsr", "operand": "osfind", "target": 65486, "target_label": "osfind"}, {"addr": 1398, "bytes": [72], "binary_addr": 38082, "type": "code", "mnemonic": "pha"}, {"addr": 1399, "bytes": [169, 255], "binary_addr": 38083, "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 1401, "bytes": [32, 208, 6], "binary_addr": 38085, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1404, "bytes": [104], "binary_addr": 38088, "type": "code", "mnemonic": "pla"}, {"addr": 1405, "bytes": [76, 205, 5], "binary_addr": 38089, "type": "code", "mnemonic": "jmp", "operand": "tube_reply_byte", "target": 1485, "target_label": "tube_reply_byte"}, {"addr": 1408, "bytes": [32, 247, 4], "binary_addr": 38092, "labels": ["tube_osfind_close"], "comments_before": ["&94cc referenced 1 time by &056c[3]"], "references": [1388], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1411, "bytes": [168], "binary_addr": 38095, "type": "code", "mnemonic": "tay"}, {"addr": 1412, "bytes": [169, 0], "binary_addr": 38096, "type": "code", "mnemonic": "lda", "operand": "#osfind_close"}, {"addr": 1414, "bytes": [32, 206, 255], "binary_addr": 38098, "comment_inline": "Close one or all files", "type": "code", "mnemonic": "jsr", "operand": "osfind", "target": 65486, "target_label": "osfind"}, {"addr": 1417, "bytes": [76, 203, 5], "binary_addr": 38101, "type": "code", "mnemonic": "jmp", "operand": "tube_reply_ack", "target": 1483, "target_label": "tube_reply_ack"}, {"addr": 1420, "bytes": [32, 247, 4], "binary_addr": 38104, "labels": ["tube_osargs"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1423, "bytes": [168], "binary_addr": 38107, "type": "code", "mnemonic": "tay"}, {"addr": 1424, "bytes": [162, 3], "binary_addr": 38108, "labels": ["tube_read_params"], "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 1426, "bytes": [32, 247, 4], "binary_addr": 38110, "labels": ["loop_c0592"], "comments_before": ["&94de referenced 1 time by &0598[3]"], "references": [1432], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1429, "bytes": [149, 0], "binary_addr": 38113, "type": "code", "mnemonic": "sta", "operand": "l0000,x", "target": 0, "target_label": "l0000"}, {"addr": 1431, "bytes": [202], "binary_addr": 38115, "type": "code", "mnemonic": "dex"}, {"addr": 1432, "bytes": [16, 248], "binary_addr": 38116, "type": "code", "mnemonic": "bpl", "operand": "loop_c0592", "target": 1426, "target_label": "loop_c0592"}, {"addr": 1434, "bytes": [232], "binary_addr": 38118, "type": "code", "mnemonic": "inx"}, {"addr": 1435, "bytes": [32, 247, 4], "binary_addr": 38119, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1438, "bytes": [32, 218, 255], "binary_addr": 38122, "comment_inline": "Read or write a file's attributes", "type": "code", "mnemonic": "jsr", "operand": "osargs", "target": 65498, "target_label": "osargs"}, {"addr": 1441, "bytes": [32, 208, 6], "binary_addr": 38125, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1444, "bytes": [162, 3], "binary_addr": 38128, "type": "code", "mnemonic": "ldx", "operand": "#3"}, {"addr": 1446, "bytes": [181, 0], "binary_addr": 38130, "labels": ["loop_c05a6"], "comments_before": ["&94f2 referenced 1 time by &05ac[3]"], "references": [1452], "type": "code", "mnemonic": "lda", "operand": "l0000,x", "target": 0, "target_label": "l0000"}, {"addr": 1448, "bytes": [32, 208, 6], "binary_addr": 38132, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1451, "bytes": [202], "binary_addr": 38135, "type": "code", "mnemonic": "dex"}, {"addr": 1452, "bytes": [16, 248], "binary_addr": 38136, "type": "code", "mnemonic": "bpl", "operand": "loop_c05a6", "target": 1446, "target_label": "loop_c05a6"}, {"addr": 1454, "bytes": [76, 58, 0], "binary_addr": 38138, "type": "code", "mnemonic": "jmp", "operand": "tube_main_loop", "target": 58, "target_label": "tube_main_loop"}, {"addr": 1457, "bytes": [162, 0], "binary_addr": 38141, "labels": ["tube_read_string"], "comments_before": ["&94fd referenced 3 times by &056f[3], &05c5[3], &05e2[3]"], "references": [1477, 1391, 1506], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 1459, "bytes": [160, 0], "binary_addr": 38143, "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 1461, "bytes": [32, 247, 4], "binary_addr": 38145, "labels": ["strnh"], "comments_before": ["&9501 referenced 1 time by &05c0[3]"], "references": [1472], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1464, "bytes": [153, 0, 7], "binary_addr": 38148, "type": "code", "mnemonic": "sta", "operand": "l0700,y", "target": 1792, "target_label": "l0700"}, {"addr": 1467, "bytes": [200], "binary_addr": 38151, "type": "code", "mnemonic": "iny"}, {"addr": 1468, "bytes": [240, 4], "binary_addr": 38152, "type": "code", "mnemonic": "beq", "operand": "c05c2", "target": 1474, "target_label": "c05c2"}, {"addr": 1470, "bytes": [201, 13], "binary_addr": 38154, "type": "code", "mnemonic": "cmp", "operand": "#&0d"}, {"addr": 1472, "bytes": [208, 243], "binary_addr": 38156, "type": "code", "mnemonic": "bne", "operand": "strnh", "target": 1461, "target_label": "strnh"}, {"addr": 1474, "bytes": [160, 7], "binary_addr": 38158, "labels": ["c05c2"], "comments_before": ["&950e referenced 1 time by &05bc[3]"], "references": [1468], "type": "code", "mnemonic": "ldy", "operand": "#7"}, {"addr": 1476, "bytes": [96], "binary_addr": 38160, "type": "code", "mnemonic": "rts"}, {"addr": 1477, "bytes": [32, 177, 5], "binary_addr": 38161, "labels": ["tube_oscli"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_string", "target": 1457, "target_label": "tube_read_string"}, {"addr": 1480, "bytes": [32, 247, 255], "binary_addr": 38164, "type": "code", "mnemonic": "jsr", "operand": "oscli", "target": 65527, "target_label": "oscli"}, {"addr": 1483, "bytes": [169, 127], "binary_addr": 38167, "labels": ["tube_reply_ack"], "comments_before": ["&9517 referenced 3 times by &04ab[2], &054d[3], &0589[3]"], "references": [1357, 1417, 1195], "type": "code", "mnemonic": "lda", "operand": "#&7f"}, {"addr": 1485, "bytes": [44, 226, 254], "binary_addr": 38169, "labels": ["tube_reply_byte"], "comments_before": ["&9519 referenced 5 times by &0461[2], &0566[3], &057d[3], &05d0[3], &06b8[4]"], "references": [1488, 1382, 1405, 1720, 1121], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1488, "bytes": [80, 251], "binary_addr": 38172, "type": "code", "mnemonic": "bvc", "operand": "tube_reply_byte", "target": 1485, "target_label": "tube_reply_byte"}, {"addr": 1490, "bytes": [141, 227, 254], "binary_addr": 38174, "type": "code", "mnemonic": "sta", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1493, "bytes": [76, 58, 0], "binary_addr": 38177, "labels": ["mj"], "comments_before": ["&9521 referenced 1 time by &0600[4]"], "references": [1536], "type": "code", "mnemonic": "jmp", "operand": "tube_main_loop", "target": 58, "target_label": "tube_main_loop"}, {"addr": 1496, "bytes": [162, 16], "binary_addr": 38180, "labels": ["tube_osfile"], "type": "code", "mnemonic": "ldx", "operand": "#&10"}, {"addr": 1498, "bytes": [32, 247, 4], "binary_addr": 38182, "labels": ["argsw"], "comments_before": ["&9526 referenced 1 time by &05e0[3]"], "references": [1504], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1501, "bytes": [149, 1], "binary_addr": 38185, "type": "code", "mnemonic": "sta", "operand": "l0001,x", "target": 1, "target_label": "l0001"}, {"addr": 1503, "bytes": [202], "binary_addr": 38187, "type": "code", "mnemonic": "dex"}, {"addr": 1504, "bytes": [208, 248], "binary_addr": 38188, "type": "code", "mnemonic": "bne", "operand": "argsw", "target": 1498, "target_label": "argsw"}, {"addr": 1506, "bytes": [32, 177, 5], "binary_addr": 38190, "type": "code", "mnemonic": "jsr", "operand": "tube_read_string", "target": 1457, "target_label": "tube_read_string"}, {"addr": 1509, "bytes": [134, 0], "binary_addr": 38193, "type": "code", "mnemonic": "stx", "operand": "l0000", "target": 0, "target_label": "l0000"}, {"addr": 1511, "bytes": [132, 1], "binary_addr": 38195, "type": "code", "mnemonic": "sty", "operand": "l0001", "target": 1, "target_label": "l0001"}, {"addr": 1513, "bytes": [160, 0], "binary_addr": 38197, "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 1515, "bytes": [32, 247, 4], "binary_addr": 38199, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1518, "bytes": [32, 221, 255], "binary_addr": 38202, "type": "code", "mnemonic": "jsr", "operand": "osfile", "target": 65501, "target_label": "osfile"}, {"addr": 1521, "bytes": [9, 128], "binary_addr": 38205, "type": "code", "mnemonic": "ora", "operand": "#&80"}, {"addr": 1523, "bytes": [32, 208, 6], "binary_addr": 38207, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1526, "bytes": [162, 16], "binary_addr": 38210, "type": "code", "mnemonic": "ldx", "operand": "#&10"}, {"addr": 1528, "bytes": [181, 1], "binary_addr": 38212, "labels": ["loop_c05f8"], "comments_before": ["&9544 referenced 1 time by &05fe[3]"], "references": [1534], "type": "code", "mnemonic": "lda", "operand": "l0001,x", "target": 1, "target_label": "l0001"}, {"addr": 1530, "bytes": [32, 208, 6], "binary_addr": 38214, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1533, "bytes": [202], "binary_addr": 38217, "type": "code", "mnemonic": "dex"}, {"addr": 1534, "bytes": [208, 248], "binary_addr": 38218, "type": "code", "mnemonic": "bne", "operand": "loop_c05f8", "target": 1528, "target_label": "loop_c05f8"}, {"addr": 1536, "bytes": [240, 211], "binary_addr": 38220, "labels": ["tube_code_page6"], "comments_before": ["***************************************************************************************", "Tube host code page 6 \u2014 reference: NFS13 (GBPB-ESCA)\n\nCopied from ROM at &954C during init. &0600-&0601 is the tail\nof tube_osfile (BEQ to tube_reply_byte when done). Contains:\n  &0602: tube_osgbpb \u2014 multi-byte file I/O\n  &0626: tube_osbyte_short \u2014 2-param OSBYTE (returns X)\n  &063B: tube_osbyte_long \u2014 3-param OSBYTE (returns carry+Y+X)\n  &065D: tube_osword \u2014 variable-length OSWORD (buffer at &0130)\n  &06A3: tube_osword_rdln \u2014 OSWORD 0 (read line, 5-byte params)\n  &06BB: tube_rdln_send_line \u2014 send input line from &0700\n  &06D0: tube_send_r2 \u2014 poll R2 status, write A to R2 data\n  &06D9: tube_send_r4 \u2014 poll R4 status, write A to R4 data\n  &06E2: tube_escape_check \u2014 check &FF, forward escape to R1\n  &06E8: tube_event_handler \u2014 EVNTV: forward event (A,X,Y) via R1\n  &06F7: tube_send_r1 \u2014 poll R1 status, write A to R1 data", "***************************************************************************************", "&954c referenced 1 time by &8108"], "references": [33032], "type": "code", "mnemonic": "beq", "operand": "mj", "target": 1493, "target_label": "mj"}, {"addr": 1538, "bytes": [162, 12], "binary_addr": 38222, "labels": ["tube_osgbpb"], "type": "code", "mnemonic": "ldx", "operand": "#&0c"}, {"addr": 1540, "bytes": [32, 247, 4], "binary_addr": 38224, "labels": ["loop_c0604"], "comments_before": ["&9550 referenced 1 time by &060a[4]"], "references": [1546], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1543, "bytes": [149, 0], "binary_addr": 38227, "type": "code", "mnemonic": "sta", "operand": "l0000,x", "target": 0, "target_label": "l0000"}, {"addr": 1545, "bytes": [202], "binary_addr": 38229, "type": "code", "mnemonic": "dex"}, {"addr": 1546, "bytes": [16, 248], "binary_addr": 38230, "type": "code", "mnemonic": "bpl", "operand": "loop_c0604", "target": 1540, "target_label": "loop_c0604"}, {"addr": 1548, "bytes": [32, 247, 4], "binary_addr": 38232, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1551, "bytes": [232], "binary_addr": 38235, "type": "code", "mnemonic": "inx"}, {"addr": 1552, "bytes": [160, 0], "binary_addr": 38236, "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 1554, "bytes": [32, 209, 255], "binary_addr": 38238, "comment_inline": "Read or write multiple bytes to an open file", "type": "code", "mnemonic": "jsr", "operand": "osgbpb", "target": 65489, "target_label": "osgbpb"}, {"addr": 1557, "bytes": [106], "binary_addr": 38241, "type": "code", "mnemonic": "ror"}, {"addr": 1558, "bytes": [32, 208, 6], "binary_addr": 38242, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1561, "bytes": [162, 12], "binary_addr": 38245, "type": "code", "mnemonic": "ldx", "operand": "#&0c"}, {"addr": 1563, "bytes": [181, 0], "binary_addr": 38247, "labels": ["loop_c061b"], "comments_before": ["&9567 referenced 1 time by &0621[4]"], "references": [1569], "type": "code", "mnemonic": "lda", "operand": "l0000,x", "target": 0, "target_label": "l0000"}, {"addr": 1565, "bytes": [32, 208, 6], "binary_addr": 38249, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1568, "bytes": [202], "binary_addr": 38252, "type": "code", "mnemonic": "dex"}, {"addr": 1569, "bytes": [16, 248], "binary_addr": 38253, "type": "code", "mnemonic": "bpl", "operand": "loop_c061b", "target": 1563, "target_label": "loop_c061b"}, {"addr": 1571, "bytes": [76, 58, 0], "binary_addr": 38255, "type": "code", "mnemonic": "jmp", "operand": "tube_main_loop", "target": 58, "target_label": "tube_main_loop"}, {"addr": 1574, "bytes": [32, 247, 4], "binary_addr": 38258, "labels": ["tube_osbyte_short"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1577, "bytes": [170], "binary_addr": 38261, "type": "code", "mnemonic": "tax"}, {"addr": 1578, "bytes": [32, 247, 4], "binary_addr": 38262, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1581, "bytes": [32, 244, 255], "binary_addr": 38265, "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 1584, "bytes": [44, 226, 254], "binary_addr": 38268, "labels": ["tube_osbyte_send_x"], "comments_before": ["&957c referenced 2 times by &0633[4], &065b[4]"], "references": [1587, 1627], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1587, "bytes": [80, 251], "binary_addr": 38271, "type": "code", "mnemonic": "bvc", "operand": "tube_osbyte_send_x", "target": 1584, "target_label": "tube_osbyte_send_x"}, {"addr": 1589, "bytes": [142, 227, 254], "binary_addr": 38273, "type": "code", "mnemonic": "stx", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1592, "bytes": [76, 58, 0], "binary_addr": 38276, "labels": ["bytex"], "comments_before": ["&9584 referenced 1 time by &064b[4]"], "references": [1611], "type": "code", "mnemonic": "jmp", "operand": "tube_main_loop", "target": 58, "target_label": "tube_main_loop"}, {"addr": 1595, "bytes": [32, 247, 4], "binary_addr": 38279, "labels": ["tube_osbyte_long"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1598, "bytes": [170], "binary_addr": 38282, "type": "code", "mnemonic": "tax"}, {"addr": 1599, "bytes": [32, 247, 4], "binary_addr": 38283, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1602, "bytes": [168], "binary_addr": 38286, "type": "code", "mnemonic": "tay"}, {"addr": 1603, "bytes": [32, 247, 4], "binary_addr": 38287, "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1606, "bytes": [32, 244, 255], "binary_addr": 38290, "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 1609, "bytes": [73, 157], "binary_addr": 38293, "type": "code", "mnemonic": "eor", "operand": "#&9d"}, {"addr": 1611, "bytes": [240, 235], "binary_addr": 38295, "type": "code", "mnemonic": "beq", "operand": "bytex", "target": 1592, "target_label": "bytex"}, {"addr": 1613, "bytes": [169, 64], "binary_addr": 38297, "type": "code", "mnemonic": "lda", "operand": "#&40"}, {"addr": 1615, "bytes": [106], "binary_addr": 38299, "type": "code", "mnemonic": "ror"}, {"addr": 1616, "bytes": [32, 208, 6], "binary_addr": 38300, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1619, "bytes": [44, 226, 254], "binary_addr": 38303, "labels": ["tube_osbyte_send_y"], "comments_before": ["&959f referenced 1 time by &0656[4]"], "references": [1622], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1622, "bytes": [80, 251], "binary_addr": 38306, "type": "code", "mnemonic": "bvc", "operand": "tube_osbyte_send_y", "target": 1619, "target_label": "tube_osbyte_send_y"}, {"addr": 1624, "bytes": [140, 227, 254], "binary_addr": 38308, "type": "code", "mnemonic": "sty", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1627, "bytes": [112, 211], "binary_addr": 38311, "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bvs", "operand": "tube_osbyte_send_x", "target": 1584, "target_label": "tube_osbyte_send_x"}, {"addr": 1629, "bytes": [32, 247, 4], "binary_addr": 38313, "labels": ["tube_osword"], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1632, "bytes": [168], "binary_addr": 38316, "type": "code", "mnemonic": "tay"}, {"addr": 1633, "bytes": [44, 226, 254], "binary_addr": 38317, "labels": ["tube_osword_read"], "comments_before": ["&95ad referenced 1 time by &0664[4]"], "references": [1636], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1636, "bytes": [16, 251], "binary_addr": 38320, "type": "code", "mnemonic": "bpl", "operand": "tube_osword_read", "target": 1633, "target_label": "tube_osword_read"}, {"addr": 1638, "bytes": [174, 227, 254], "binary_addr": 38322, "type": "code", "mnemonic": "ldx", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1641, "bytes": [202], "binary_addr": 38325, "type": "code", "mnemonic": "dex"}, {"addr": 1642, "bytes": [48, 15], "binary_addr": 38326, "type": "code", "mnemonic": "bmi", "operand": "c067b", "target": 1659, "target_label": "c067b"}, {"addr": 1644, "bytes": [44, 226, 254], "binary_addr": 38328, "labels": ["tube_osword_read_lp"], "comments_before": ["&95b8 referenced 2 times by &066f[4], &0678[4]"], "references": [1647, 1656], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1647, "bytes": [16, 251], "binary_addr": 38331, "type": "code", "mnemonic": "bpl", "operand": "tube_osword_read_lp", "target": 1644, "target_label": "tube_osword_read_lp"}, {"addr": 1649, "bytes": [173, 227, 254], "binary_addr": 38333, "type": "code", "mnemonic": "lda", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1652, "bytes": [157, 48, 1], "binary_addr": 38336, "type": "code", "mnemonic": "sta", "operand": "l0130,x", "target": 304, "target_label": "l0130"}, {"addr": 1655, "bytes": [202], "binary_addr": 38339, "type": "code", "mnemonic": "dex"}, {"addr": 1656, "bytes": [16, 242], "binary_addr": 38340, "type": "code", "mnemonic": "bpl", "operand": "tube_osword_read_lp", "target": 1644, "target_label": "tube_osword_read_lp"}, {"addr": 1658, "bytes": [152], "binary_addr": 38342, "type": "code", "mnemonic": "tya"}, {"addr": 1659, "bytes": [162, 48], "binary_addr": 38343, "labels": ["c067b"], "comments_before": ["&95c7 referenced 1 time by &066a[4]"], "references": [1642], "type": "code", "mnemonic": "ldx", "operand": "#<(l0130)"}, {"addr": 1661, "bytes": [160, 1], "binary_addr": 38345, "type": "code", "mnemonic": "ldy", "operand": "#>(l0130)"}, {"addr": 1663, "bytes": [32, 241, 255], "binary_addr": 38347, "type": "code", "mnemonic": "jsr", "operand": "osword", "target": 65521, "target_label": "osword"}, {"addr": 1666, "bytes": [169, 255], "binary_addr": 38350, "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 1668, "bytes": [32, 208, 6], "binary_addr": 38352, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1671, "bytes": [44, 226, 254], "binary_addr": 38355, "labels": ["loop_c0687"], "comments_before": ["&95d3 referenced 1 time by &068a[4]"], "references": [1674], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1674, "bytes": [16, 251], "binary_addr": 38358, "type": "code", "mnemonic": "bpl", "operand": "loop_c0687", "target": 1671, "target_label": "loop_c0687"}, {"addr": 1676, "bytes": [174, 227, 254], "binary_addr": 38360, "type": "code", "mnemonic": "ldx", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1679, "bytes": [202], "binary_addr": 38363, "type": "code", "mnemonic": "dex"}, {"addr": 1680, "bytes": [48, 14], "binary_addr": 38364, "type": "code", "mnemonic": "bmi", "operand": "tube_return_main", "target": 1696, "target_label": "tube_return_main"}, {"addr": 1682, "bytes": [188, 48, 1], "binary_addr": 38366, "labels": ["tube_osword_write"], "comments_before": ["&95de referenced 1 time by &069e[4]"], "references": [1694], "type": "code", "mnemonic": "ldy", "operand": "l0130,x", "target": 304, "target_label": "l0130"}, {"addr": 1685, "bytes": [44, 226, 254], "binary_addr": 38369, "labels": ["tube_osword_write_lp"], "comments_before": ["&95e1 referenced 1 time by &0698[4]"], "references": [1688], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1688, "bytes": [80, 251], "binary_addr": 38372, "type": "code", "mnemonic": "bvc", "operand": "tube_osword_write_lp", "target": 1685, "target_label": "tube_osword_write_lp"}, {"addr": 1690, "bytes": [140, 227, 254], "binary_addr": 38374, "type": "code", "mnemonic": "sty", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1693, "bytes": [202], "binary_addr": 38377, "type": "code", "mnemonic": "dex"}, {"addr": 1694, "bytes": [16, 242], "binary_addr": 38378, "type": "code", "mnemonic": "bpl", "operand": "tube_osword_write", "target": 1682, "target_label": "tube_osword_write"}, {"addr": 1696, "bytes": [76, 58, 0], "binary_addr": 38380, "labels": ["tube_return_main"], "comments_before": ["&95ec referenced 1 time by &0690[4]"], "references": [1680], "type": "code", "mnemonic": "jmp", "operand": "tube_main_loop", "target": 58, "target_label": "tube_main_loop"}, {"addr": 1699, "bytes": [162, 4], "binary_addr": 38383, "labels": ["tube_osword_rdln"], "type": "code", "mnemonic": "ldx", "operand": "#4"}, {"addr": 1701, "bytes": [32, 247, 4], "binary_addr": 38385, "labels": ["loop_c06a5"], "comments_before": ["&95f1 referenced 1 time by &06ab[4]"], "references": [1707], "type": "code", "mnemonic": "jsr", "operand": "tube_read_r2", "target": 1271, "target_label": "tube_read_r2"}, {"addr": 1704, "bytes": [149, 0], "binary_addr": 38388, "type": "code", "mnemonic": "sta", "operand": "l0000,x", "target": 0, "target_label": "l0000"}, {"addr": 1706, "bytes": [202], "binary_addr": 38390, "type": "code", "mnemonic": "dex"}, {"addr": 1707, "bytes": [16, 248], "binary_addr": 38391, "type": "code", "mnemonic": "bpl", "operand": "loop_c06a5", "target": 1701, "target_label": "loop_c06a5"}, {"addr": 1709, "bytes": [232], "binary_addr": 38393, "type": "code", "mnemonic": "inx"}, {"addr": 1710, "bytes": [160, 0], "binary_addr": 38394, "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 1712, "bytes": [138], "binary_addr": 38396, "type": "code", "mnemonic": "txa"}, {"addr": 1713, "bytes": [32, 241, 255], "binary_addr": 38397, "type": "code", "mnemonic": "jsr", "operand": "osword", "target": 65521, "target_label": "osword"}, {"addr": 1716, "bytes": [144, 5], "binary_addr": 38400, "type": "code", "mnemonic": "bcc", "operand": "tube_rdln_send_line", "target": 1723, "target_label": "tube_rdln_send_line"}, {"addr": 1718, "bytes": [169, 255], "binary_addr": 38402, "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 1720, "bytes": [76, 205, 5], "binary_addr": 38404, "type": "code", "mnemonic": "jmp", "operand": "tube_reply_byte", "target": 1485, "target_label": "tube_reply_byte"}, {"addr": 1723, "bytes": [162, 0], "binary_addr": 38407, "labels": ["tube_rdln_send_line"], "comments_before": ["&9607 referenced 1 time by &06b4[4]"], "references": [1716], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 1725, "bytes": [169, 127], "binary_addr": 38409, "type": "code", "mnemonic": "lda", "operand": "#&7f"}, {"addr": 1727, "bytes": [32, 208, 6], "binary_addr": 38411, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1730, "bytes": [189, 0, 7], "binary_addr": 38414, "labels": ["tube_rdln_send_loop"], "comments_before": ["&960e referenced 1 time by &06cb[4]"], "references": [1739], "type": "code", "mnemonic": "lda", "operand": "l0700,x", "target": 1792, "target_label": "l0700"}, {"addr": 1733, "bytes": [32, 208, 6], "binary_addr": 38417, "labels": ["tube_rdln_send_byte"], "type": "code", "mnemonic": "jsr", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1736, "bytes": [232], "binary_addr": 38420, "type": "code", "mnemonic": "inx"}, {"addr": 1737, "bytes": [201, 13], "binary_addr": 38421, "type": "code", "mnemonic": "cmp", "operand": "#&0d"}, {"addr": 1739, "bytes": [208, 245], "binary_addr": 38423, "type": "code", "mnemonic": "bne", "operand": "tube_rdln_send_loop", "target": 1730, "target_label": "tube_rdln_send_loop"}, {"addr": 1741, "bytes": [76, 58, 0], "binary_addr": 38425, "type": "code", "mnemonic": "jmp", "operand": "tube_main_loop", "target": 58, "target_label": "tube_main_loop"}, {"addr": 1744, "bytes": [44, 226, 254], "binary_addr": 38428, "labels": ["tube_send_r2"], "comments_before": ["&961c referenced 18 times by &0020[1], &0026[1], &002c[1], &04e9[2], &051f[3], &0562[3], &0579[3], &05a1[3], &05a8[3], &05f3[3], &05fa[3], &0616[4], &061d[4], &0650[4], &0684[4], &06bf[4], &06c5[4], &06d3[4]"], "references": [1257, 1311, 1747, 32, 1378, 38, 1401, 44, 1616, 1441, 1558, 1668, 1727, 1523, 1448, 1565, 1733, 1530], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_2", "target": 65250, "target_label": "tube_status_register_2"}, {"addr": 1747, "bytes": [80, 251], "binary_addr": 38431, "type": "code", "mnemonic": "bvc", "operand": "tube_send_r2", "target": 1744, "target_label": "tube_send_r2"}, {"addr": 1749, "bytes": [141, 227, 254], "binary_addr": 38433, "type": "code", "mnemonic": "sta", "operand": "tube_data_register_2", "target": 65251, "target_label": "tube_data_register_2"}, {"addr": 1752, "bytes": [96], "binary_addr": 38436, "type": "code", "mnemonic": "rts"}, {"addr": 1753, "bytes": [44, 230, 254], "binary_addr": 38437, "labels": ["tube_send_r4"], "comments_before": ["&9625 referenced 5 times by &0018[1], &042a[2], &0432[2], &0448[2], &06dc[4]"], "references": [24, 1756, 1066, 1074, 1096], "type": "code", "mnemonic": "bit", "operand": "tube_status_register_4_and_cpu_control", "target": 65254, "target_label": "tube_status_register_4_and_cpu_control"}, {"addr": 1756, "bytes": [80, 251], "binary_addr": 38440, "type": "code", "mnemonic": "bvc", "operand": "tube_send_r4", "target": 1753, "target_label": "tube_send_r4"}, {"addr": 1758, "bytes": [141, 231, 254], "binary_addr": 38442, "type": "code", "mnemonic": "sta", "operand": "tube_data_register_4", "target": 65255, "target_label": "tube_data_register_4"}, {"addr": 1761, "bytes": [96], "binary_addr": 38445, "type": "code", "mnemonic": "rts"}, {"addr": 1762, "bytes": [165, 255], "binary_addr": 38446, "labels": ["tube_escape_check"], "comments_before": ["&962e referenced 1 time by &0403[2]"], "references": [1027], "type": "code", "mnemonic": "lda", "operand": "l00ff", "target": 255, "target_label": "l00ff"}, {"addr": 1764, "bytes": [56], "binary_addr": 38448, "type": "code", "mnemonic": "sec"}, {"addr": 1765, "bytes": [106], "binary_addr": 38449, "type": "code", "mnemonic": "ror"}, {"addr": 1766, "bytes": [48, 15], "binary_addr": 38450, "type": "code", "mnemonic": "bmi", "operand": "tube_send_r1", "target": 1783, "target_label": "tube_send_r1"}, {"addr": 1768, "bytes": [72], "binary_addr": 38452, "labels": ["tube_event_handler"], "type": "code", "mnemonic": "pha"}, {"addr": 1769, "bytes": [169, 0], "binary_addr": 38453, "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 1771, "bytes": [32, 247, 6], "binary_addr": 38455, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r1", "target": 1783, "target_label": "tube_send_r1"}, {"addr": 1774, "bytes": [152], "binary_addr": 38458, "type": "code", "mnemonic": "tya"}, {"addr": 1775, "bytes": [32, 247, 6], "binary_addr": 38459, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r1", "target": 1783, "target_label": "tube_send_r1"}, {"addr": 1778, "bytes": [138], "binary_addr": 38462, "type": "code", "mnemonic": "txa"}, {"addr": 1779, "bytes": [32, 247, 6], "binary_addr": 38463, "type": "code", "mnemonic": "jsr", "operand": "tube_send_r1", "target": 1783, "target_label": "tube_send_r1"}, {"addr": 1782, "bytes": [104], "binary_addr": 38466, "type": "code", "mnemonic": "pla"}, {"addr": 1783, "bytes": [44, 224, 254], "binary_addr": 38467, "labels": ["tube_send_r1"], "comments_before": ["&9643 referenced 5 times by &06e6[4], &06eb[4], &06ef[4], &06f3[4], &06fa[4]"], "references": [1786, 1771, 1766, 1775, 1779], "type": "code", "mnemonic": "bit", "operand": "tube_status_1_and_tube_control", "target": 65248, "target_label": "tube_status_1_and_tube_control"}, {"addr": 1786, "bytes": [80, 251], "binary_addr": 38470, "type": "code", "mnemonic": "bvc", "operand": "tube_send_r1", "target": 1783, "target_label": "tube_send_r1"}, {"addr": 1788, "bytes": [141, 225, 254], "binary_addr": 38472, "type": "code", "mnemonic": "sta", "operand": "tube_data_register_1", "target": 65249, "target_label": "tube_data_register_1"}, {"addr": 1791, "bytes": [96], "binary_addr": 38475, "type": "code", "mnemonic": "rts"}, {"addr": 38476, "bytes": [96, 255, 66, 255, 0, 255, 119, 255, 255, 255, 223, 255, 0, 255, 0, 255, 0, 255, 4, 255], "type": "byte", "values": [96, 255, 66, 255, 0, 255, 119, 255, 255, 255, 223, 255, 0, 255, 0, 255, 0, 255, 4, 255]}, {"addr": 38496, "bytes": [76, 228, 155], "labels": ["trampoline_tx_setup"], "comments_before": ["&9660 referenced 2 times by &8667, &8e49"], "references": [36425, 34407], "type": "code", "mnemonic": "jmp", "operand": "c9be4", "target": 39908, "target_label": "c9be4"}, {"addr": 38499, "bytes": [76, 111, 150], "labels": ["trampoline_adlc_init"], "comments_before": ["&9663 referenced 1 time by &82c9"], "references": [33481], "type": "code", "mnemonic": "jmp", "operand": "adlc_init", "target": 38511, "target_label": "adlc_init"}, {"addr": 38502, "bytes": [76, 157, 150], "labels": ["svc_nmi_release"], "type": "code", "mnemonic": "jmp", "operand": "save_econet_state", "target": 38557, "target_label": "save_econet_state"}, {"addr": 38505, "bytes": [76, 180, 150], "labels": ["svc_nmi_claim"], "type": "code", "mnemonic": "jmp", "operand": "restore_econet_state", "target": 38580, "target_label": "restore_econet_state"}, {"addr": 38508, "bytes": [76, 82, 155], "labels": ["svc_unknown_irq"], "type": "code", "mnemonic": "jmp", "operand": "c9b52", "target": 39762, "target_label": "c9b52"}, {"addr": 38511, "bytes": [44, 24, 254], "labels": ["adlc_init"], "comments_before": ["***************************************************************************************", "ADLC initialisation\n\nReads station ID (INTOFF side effect), performs full ADLC reset,\nchecks for Tube presence (OSBYTE &EA), then falls through to\nadlc_init_workspace.", "***************************************************************************************", "&966f referenced 1 time by &9663"], "references": [38499], "type": "code", "mnemonic": "bit", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 38514, "bytes": [32, 220, 150], "type": "code", "mnemonic": "jsr", "operand": "adlc_full_reset", "target": 38620, "target_label": "adlc_full_reset"}, {"addr": 38517, "bytes": [169, 234], "type": "code", "mnemonic": "lda", "operand": "#osbyte_read_tube_presence"}, {"addr": 38519, "bytes": [162, 0], "type": "code", "mnemonic": "ldx", "operand": "#0"}, {"addr": 38521, "bytes": [160, 255], "type": "code", "mnemonic": "ldy", "operand": "#&ff"}, {"addr": 38523, "bytes": [32, 244, 255], "comment_inline": "Read Tube present flag", "type": "code", "mnemonic": "jsr", "operand": "osbyte", "target": 65524, "target_label": "osbyte"}, {"addr": 38526, "bytes": [142, 82, 13], "comment_inline": "X=value of Tube present flag", "type": "code", "mnemonic": "stx", "operand": "tx_in_progress", "target": 3410, "target_label": "tx_in_progress"}, {"addr": 38529, "bytes": [32, 205, 150], "labels": ["adlc_init_workspace"], "comments_before": ["***************************************************************************************", "Initialise NMI workspace\n\nCopies NMI shim from ROM to &0D00, stores current ROM bank number\ninto shim self-modifying code, sets TX status to &80 (idle/complete),\nsaves station ID from &FE18 into TX scout buffer, re-enables NMIs\nby reading &FE20.", "***************************************************************************************", "&9681 referenced 1 time by &96ca"], "references": [38602], "type": "code", "mnemonic": "jsr", "operand": "install_nmi_shim", "target": 38605, "target_label": "install_nmi_shim"}, {"addr": 38532, "bytes": [165, 244], "type": "code", "mnemonic": "lda", "operand": "romsel_copy", "target": 244, "target_label": "romsel_copy"}, {"addr": 38534, "bytes": [141, 7, 13], "type": "code", "mnemonic": "sta", "operand": "nmi_shim_07", "target": 3335, "target_label": "nmi_shim_07"}, {"addr": 38537, "bytes": [169, 128], "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 38539, "bytes": [141, 58, 13], "type": "code", "mnemonic": "sta", "operand": "tx_ctrl_status", "target": 3386, "target_label": "tx_ctrl_status"}, {"addr": 38542, "bytes": [173, 24, 254], "type": "code", "mnemonic": "lda", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 38545, "bytes": [141, 34, 13], "type": "code", "mnemonic": "sta", "operand": "tx_src_stn", "target": 3362, "target_label": "tx_src_stn"}, {"addr": 38548, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 38550, "bytes": [141, 35, 13], "type": "code", "mnemonic": "sta", "operand": "tx_src_net", "target": 3363, "target_label": "tx_src_net"}, {"addr": 38553, "bytes": [44, 32, 254], "type": "code", "mnemonic": "bit", "operand": "video_ula_control", "target": 65056, "target_label": "video_ula_control"}, {"addr": 38556, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 38557, "bytes": [44, 24, 254], "labels": ["save_econet_state"], "comments_before": ["***************************************************************************************", "Save Econet state to RX control block\n\nStores rx_status_flags, protection_mask, and tx_in_progress\nto (net_rx_ptr) at offsets 8-10. INTOFF side effect on entry.", "***************************************************************************************", "&969d referenced 1 time by &9666"], "references": [38502], "type": "code", "mnemonic": "bit", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 38560, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 38562, "bytes": [173, 56, 13], "type": "code", "mnemonic": "lda", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 38565, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 38567, "bytes": [200], "comment_inline": "Y=&09", "type": "code", "mnemonic": "iny"}, {"addr": 38568, "bytes": [173, 99, 13], "type": "code", "mnemonic": "lda", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 38571, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 38573, "bytes": [200], "comment_inline": "Y=&0a", "type": "code", "mnemonic": "iny"}, {"addr": 38574, "bytes": [173, 82, 13], "type": "code", "mnemonic": "lda", "operand": "tx_in_progress", "target": 3410, "target_label": "tx_in_progress"}, {"addr": 38577, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 38579, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 38580, "bytes": [44, 24, 254], "labels": ["restore_econet_state"], "comments_before": ["***************************************************************************************", "Restore Econet state from RX control block\n\nLoads rx_status_flags, protection_mask, and tx_in_progress\nfrom (net_rx_ptr) at offsets 8-10, then reinitialises via\nadlc_init_workspace.", "***************************************************************************************", "&96b4 referenced 1 time by &9669"], "references": [38505], "type": "code", "mnemonic": "bit", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 38583, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 38585, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 38587, "bytes": [141, 56, 13], "type": "code", "mnemonic": "sta", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 38590, "bytes": [200], "comment_inline": "Y=&09", "type": "code", "mnemonic": "iny"}, {"addr": 38591, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 38593, "bytes": [141, 99, 13], "type": "code", "mnemonic": "sta", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 38596, "bytes": [200], "comment_inline": "Y=&0a", "type": "code", "mnemonic": "iny"}, {"addr": 38597, "bytes": [177, 156], "type": "code", "mnemonic": "lda", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 38599, "bytes": [141, 82, 13], "type": "code", "mnemonic": "sta", "operand": "tx_in_progress", "target": 3410, "target_label": "tx_in_progress"}, {"addr": 38602, "bytes": [76, 129, 150], "type": "code", "mnemonic": "jmp", "operand": "adlc_init_workspace", "target": 38529, "target_label": "adlc_init_workspace"}, {"addr": 38605, "bytes": [8], "labels": ["install_nmi_shim"], "comments_before": ["***************************************************************************************", "Copy NMI shim from ROM (&9FCA) to RAM (&0D00)\n\nCopies 32 bytes. Interrupts are enabled during the copy.", "***************************************************************************************", "&96cd referenced 1 time by &9681"], "references": [38529], "type": "code", "mnemonic": "php"}, {"addr": 38606, "bytes": [88], "type": "code", "mnemonic": "cli"}, {"addr": 38607, "bytes": [160, 32], "type": "code", "mnemonic": "ldy", "operand": "#&20"}, {"addr": 38609, "bytes": [185, 202, 159], "labels": ["loop_c96d1"], "comments_before": ["&96d1 referenced 1 time by &96d8"], "references": [38616], "type": "code", "mnemonic": "lda", "operand": "nmi_shim_rom_src,y", "target": 40906, "target_label": "nmi_shim_rom_src"}, {"addr": 38612, "bytes": [153, 255, 12], "type": "code", "mnemonic": "sta", "operand": "l0cff,y", "target": 3327, "target_label": "l0cff"}, {"addr": 38615, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 38616, "bytes": [208, 247], "type": "code", "mnemonic": "bne", "operand": "loop_c96d1", "target": 38609, "target_label": "loop_c96d1"}, {"addr": 38618, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 38619, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 38620, "bytes": [169, 193], "labels": ["adlc_full_reset"], "comments_before": ["***************************************************************************************", "ADLC full reset\n\nAborts all activity and returns to idle RX listen mode.", "***************************************************************************************", "&96dc referenced 3 times by &9672, &973e, &9894"], "comment_inline": "CR1=&C1: TX_RESET | RX_RESET | AC (both sections in reset, address control set)", "references": [38514, 38718, 39060], "type": "code", "mnemonic": "lda", "operand": "#&c1"}, {"addr": 38622, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 38625, "bytes": [169, 30], "comment_inline": "CR4=&1E (via AC=1): 8-bit RX word length, abort extend enabled, NRZ encoding", "type": "code", "mnemonic": "lda", "operand": "#&1e"}, {"addr": 38627, "bytes": [141, 163, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_terminate_frame", "target": 65187, "target_label": "econet_data_terminate_frame"}, {"addr": 38630, "bytes": [169, 0], "comment_inline": "CR3=&00 (via AC=1): no loop-back, no AEX, NRZ, no DTR", "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 38632, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38635, "bytes": [169, 130], "labels": ["adlc_rx_listen"], "comments_before": ["***************************************************************************************", "Enter RX listen mode\n\nTX held in reset, RX active with interrupts. Clears all status.", "***************************************************************************************", "&96eb referenced 1 time by &9a40"], "comment_inline": "CR1=&82: TX_RESET | RIE (TX in reset, RX interrupts enabled)", "references": [39488], "type": "code", "mnemonic": "lda", "operand": "#&82"}, {"addr": 38637, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 38640, "bytes": [169, 103], "comment_inline": "CR2=&67: CLR_TX_ST | CLR_RX_ST | FC_TDRA | 2_1_BYTE | PSE", "type": "code", "mnemonic": "lda", "operand": "#&67"}, {"addr": 38642, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38645, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 38646, "bytes": [169, 1], "labels": ["nmi_rx_scout"], "comments_before": ["***************************************************************************************", "NMI RX scout handler (initial byte)\n\nDefault NMI handler for incoming scout frames. Checks if the frame\nis addressed to us or is a broadcast. Installed as the NMI target\nduring idle RX listen mode.\nTests SR2 bit0 (AP = Address Present) to detect incoming data.\nReads the first byte (destination station) from the RX FIFO and\ncompares against our station ID. Reading &FE18 also disables NMIs\n(INTOFF side effect).", "***************************************************************************************", "&96f6 referenced 1 time by &9fd6"], "comment_inline": "A=&01: mask for SR2 bit0 (AP = Address Present)", "references": [40918], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 38648, "bytes": [44, 161, 254], "comment_inline": "BIT SR2: Z = A AND SR2 -- tests if AP is set", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38651, "bytes": [240, 58], "comment_inline": "AP not set, no incoming data -- check for errors", "type": "code", "mnemonic": "beq", "operand": "scout_error", "target": 38711, "target_label": "scout_error"}, {"addr": 38653, "bytes": [173, 162, 254], "comment_inline": "Read first RX byte (destination station address)", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 38656, "bytes": [205, 24, 254], "comment_inline": "Compare to our station ID (&FE18 read = INTOFF, disables NMIs)", "type": "code", "mnemonic": "cmp", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 38659, "bytes": [240, 9], "comment_inline": "Match -- accept frame", "type": "code", "mnemonic": "beq", "operand": "c970e", "target": 38670, "target_label": "c970e"}, {"addr": 38661, "bytes": [201, 255], "comment_inline": "Check for broadcast address (&FF)", "type": "code", "mnemonic": "cmp", "operand": "#&ff"}, {"addr": 38663, "bytes": [208, 26], "comment_inline": "Neither our address nor broadcast -- reject frame", "type": "code", "mnemonic": "bne", "operand": "scout_reject", "target": 38691, "target_label": "scout_reject"}, {"addr": 38665, "bytes": [169, 64], "comment_inline": "Flag &40 = broadcast frame", "type": "code", "mnemonic": "lda", "operand": "#&40"}, {"addr": 38667, "bytes": [141, 74, 13], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 38670, "bytes": [169, 21], "labels": ["c970e"], "comments_before": ["&970e referenced 1 time by &9703"], "comment_inline": "Install next NMI handler at &9715 (RX scout second byte)", "references": [38659], "type": "code", "mnemonic": "lda", "operand": "#&15"}, {"addr": 38672, "bytes": [160, 151], "type": "code", "mnemonic": "ldy", "operand": "#&97"}, {"addr": 38674, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 38677, "bytes": [44, 161, 254], "labels": ["nmi_rx_scout_net"], "comments_before": ["***************************************************************************************", "RX scout second byte handler\n\nReads the second byte of an incoming scout (destination network).\nChecks for network match: 0 = local network (accept), &FF = broadcast\n(accept and flag), anything else = reject.\nInstalls the scout data reading loop handler at &9747.", "***************************************************************************************"], "comment_inline": "BIT SR2: test for RDA (bit7 = data available)", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38680, "bytes": [16, 29], "comment_inline": "No RDA -- check errors", "type": "code", "mnemonic": "bpl", "operand": "scout_error", "target": 38711, "target_label": "scout_error"}, {"addr": 38682, "bytes": [173, 162, 254], "comment_inline": "Read destination network byte", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 38685, "bytes": [240, 12], "comment_inline": "Network = 0 -- local network, accept", "type": "code", "mnemonic": "beq", "operand": "c972b", "target": 38699, "target_label": "c972b"}, {"addr": 38687, "bytes": [73, 255], "comment_inline": "EOR &FF: test if network = &FF (broadcast)", "type": "code", "mnemonic": "eor", "operand": "#&ff"}, {"addr": 38689, "bytes": [240, 11], "comment_inline": "Broadcast network -- accept", "type": "code", "mnemonic": "beq", "operand": "c972e", "target": 38702, "target_label": "c972e"}, {"addr": 38691, "bytes": [169, 162], "labels": ["scout_reject"], "comments_before": ["&9723 referenced 1 time by &9707"], "comment_inline": "Reject: wrong network. CR1=&A2: RIE|RX_DISCONTINUE", "references": [38663], "type": "code", "mnemonic": "lda", "operand": "#&a2"}, {"addr": 38693, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 38696, "bytes": [76, 67, 154], "type": "code", "mnemonic": "jmp", "operand": "discard_after_reset", "target": 39491, "target_label": "discard_after_reset"}, {"addr": 38699, "bytes": [141, 74, 13], "labels": ["c972b"], "comments_before": ["&972b referenced 1 time by &971d"], "comment_inline": "Network = &FF broadcast: clear &0D4A", "references": [38685], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 38702, "bytes": [133, 162], "labels": ["c972e"], "comments_before": ["&972e referenced 1 time by &9721"], "comment_inline": "Store Y offset for scout data buffer", "references": [38689], "type": "code", "mnemonic": "sta", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 38704, "bytes": [169, 71], "comment_inline": "Install scout data reading loop at &9747", "type": "code", "mnemonic": "lda", "operand": "#&47"}, {"addr": 38706, "bytes": [160, 151], "type": "code", "mnemonic": "ldy", "operand": "#&97"}, {"addr": 38708, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 38711, "bytes": [173, 161, 254], "labels": ["scout_error"], "comments_before": ["***************************************************************************************", "Scout error/discard handler\n\nReached when the scout data loop sees no RDA (BPL at &974C) or\nwhen scout completion finds unexpected SR2 state.\nIf SR2 & &81 is non-zero (AP or RDA still active), performs full\nADLC reset and discards. If zero (clean end), discards via &9A40.\nThis path is a common landing for any unexpected ADLC state during\nscout reception.", "***************************************************************************************", "&9737 referenced 5 times by &96fb, &9718, &974c, &9780, &9782"], "comment_inline": "Read SR2", "references": [38680, 38651, 38732, 38784, 38786], "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38714, "bytes": [41, 129], "comment_inline": "Test AP (b0) | RDA (b7)", "type": "code", "mnemonic": "and", "operand": "#&81"}, {"addr": 38716, "bytes": [240, 6], "comment_inline": "Neither set -- clean end, discard via &9A40", "type": "code", "mnemonic": "beq", "operand": "scout_discard", "target": 38724, "target_label": "scout_discard"}, {"addr": 38718, "bytes": [32, 220, 150], "comment_inline": "Unexpected data/status: full ADLC reset", "type": "code", "mnemonic": "jsr", "operand": "adlc_full_reset", "target": 38620, "target_label": "adlc_full_reset"}, {"addr": 38721, "bytes": [76, 67, 154], "comment_inline": "Discard and return to idle", "type": "code", "mnemonic": "jmp", "operand": "discard_after_reset", "target": 39491, "target_label": "discard_after_reset"}, {"addr": 38724, "bytes": [76, 64, 154], "labels": ["scout_discard"], "comments_before": ["&9744 referenced 1 time by &973c"], "references": [38716], "type": "code", "mnemonic": "jmp", "operand": "discard_listen", "target": 39488, "target_label": "discard_listen"}, {"addr": 38727, "bytes": [164, 162], "comments_before": ["***************************************************************************************", "Scout data reading loop\n\nReads the body of a scout frame, two bytes per iteration. Stores\nbytes at &0D3D+Y (scout buffer: src_stn, src_net, ctrl, port, ...).\nBetween each pair it checks SR2:\n  - SR2 & &81 tested at entry (&974A): AP|RDA bits\n    - Neither set (BEQ) -> discard (&9744 -> &9A40)\n    - AP without RDA (BPL) -> error (&9737)\n    - RDA set (BMI) -> read byte\n  - After first byte (&9755): full SR2 tested\n    - SR2 non-zero (BNE) -> scout completion (&9771)\n      This is the FV detection point: when FV is set (by inline refill\n      of the last byte during the preceding RX FIFO read), SR2 is\n      non-zero and the branch is taken.\n    - SR2 = 0 -> read second byte and loop\n  - After second byte (&9769): re-test SR2 & &81 for next pair\n    - RDA set (BMI) -> loop back to &974E\n    - Neither set -> RTI, wait for next NMI\nThe loop ends at Y=&0C (12 bytes max in scout buffer).", "***************************************************************************************"], "comment_inline": "Y = buffer offset", "type": "code", "mnemonic": "ldy", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 38729, "bytes": [173, 161, 254], "comment_inline": "Read SR2", "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38732, "bytes": [16, 233], "labels": ["scout_loop_rda"], "comments_before": ["&974c referenced 1 time by &976c"], "comment_inline": "No RDA -- error handler &9737", "references": [38764], "type": "code", "mnemonic": "bpl", "operand": "scout_error", "target": 38711, "target_label": "scout_error"}, {"addr": 38734, "bytes": [173, 162, 254], "comment_inline": "Read data byte from RX FIFO", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 38737, "bytes": [153, 61, 13], "comment_inline": "Store at &0D3D+Y (scout buffer)", "type": "code", "mnemonic": "sta", "operand": "rx_src_stn,y", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 38740, "bytes": [200], "comment_inline": "Advance buffer index", "type": "code", "mnemonic": "iny"}, {"addr": 38741, "bytes": [173, 161, 254], "comment_inline": "Read SR2 again (FV detection point)", "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38744, "bytes": [48, 2], "comment_inline": "RDA set -- more data, read second byte", "type": "code", "mnemonic": "bmi", "operand": "scout_loop_second", "target": 38748, "target_label": "scout_loop_second"}, {"addr": 38746, "bytes": [208, 21], "comment_inline": "SR2 non-zero (FV or other) -- scout completion", "type": "code", "mnemonic": "bne", "operand": "scout_complete", "target": 38769, "target_label": "scout_complete"}, {"addr": 38748, "bytes": [173, 162, 254], "labels": ["scout_loop_second"], "comments_before": ["&975c referenced 1 time by &9758"], "comment_inline": "Read second byte of pair", "references": [38744], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 38751, "bytes": [153, 61, 13], "comment_inline": "Store at &0D3D+Y", "type": "code", "mnemonic": "sta", "operand": "rx_src_stn,y", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 38754, "bytes": [200], "comment_inline": "Advance and check buffer limit", "type": "code", "mnemonic": "iny"}, {"addr": 38755, "bytes": [192, 12], "type": "code", "mnemonic": "cpy", "operand": "#&0c"}, {"addr": 38757, "bytes": [240, 10], "comment_inline": "Buffer full (Y=12) -- force completion", "type": "code", "mnemonic": "beq", "operand": "scout_complete", "target": 38769, "target_label": "scout_complete"}, {"addr": 38759, "bytes": [132, 162], "comment_inline": "Save Y for next iteration", "type": "code", "mnemonic": "sty", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 38761, "bytes": [173, 161, 254], "comment_inline": "Read SR2 for next pair", "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38764, "bytes": [208, 222], "comment_inline": "SR2 non-zero -- loop back for more bytes", "type": "code", "mnemonic": "bne", "operand": "scout_loop_rda", "target": 38732, "target_label": "scout_loop_rda"}, {"addr": 38766, "bytes": [76, 20, 13], "comment_inline": "SR2 = 0 -- RTI, wait for next NMI", "type": "code", "mnemonic": "jmp", "operand": "nmi_rti", "target": 3348, "target_label": "nmi_rti"}, {"addr": 38769, "bytes": [169, 0], "labels": ["scout_complete"], "comments_before": ["***************************************************************************************", "Scout completion handler\n\nReached from the scout data loop when SR2 is non-zero (FV detected).\nDisables PSE to allow individual SR2 bit testing:\n  CR1=&00 (clear all enables)\n  CR2=&84 (RDA_SUPPRESS_FV | FC_TDRA) -- no PSE, no CLR bits\nThen checks FV (bit1) and RDA (bit7):\n  - No FV (BEQ) -> error &9737 (not a valid frame end)\n  - FV set, no RDA (BPL) -> error &9737 (missing last byte)\n  - FV set, RDA set -> read last byte, process scout\nAfter reading the last byte, the complete scout buffer (&0D3D-&0D48)\ncontains: src_stn, src_net, ctrl, port [, extra_data...].\nThe port byte at &0D40 determines further processing:\n  - Port = 0 -> immediate operation (&9A59)\n  - Port non-zero -> check if it matches an open receive block", "***************************************************************************************", "&9771 referenced 2 times by &975a, &9765"], "comment_inline": "CR1=&00: disable all interrupts", "references": [38746, 38757], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 38771, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 38774, "bytes": [169, 132], "comment_inline": "CR2=&84: disable PSE, enable RDA_SUPPRESS_FV", "type": "code", "mnemonic": "lda", "operand": "#&84"}, {"addr": 38776, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38779, "bytes": [169, 2], "comment_inline": "A=&02: FV mask for SR2 bit1", "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 38781, "bytes": [44, 161, 254], "comment_inline": "BIT SR2: test FV (Z) and RDA (N)", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38784, "bytes": [240, 181], "comment_inline": "No FV -- not a valid frame end, error", "type": "code", "mnemonic": "beq", "operand": "scout_error", "target": 38711, "target_label": "scout_error"}, {"addr": 38786, "bytes": [16, 179], "comment_inline": "FV set but no RDA -- missing last byte, error", "type": "code", "mnemonic": "bpl", "operand": "scout_error", "target": 38711, "target_label": "scout_error"}, {"addr": 38788, "bytes": [173, 162, 254], "comment_inline": "Read last byte from RX FIFO", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 38791, "bytes": [153, 61, 13], "comment_inline": "Store last byte at &0D3D+Y", "type": "code", "mnemonic": "sta", "operand": "rx_src_stn,y", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 38794, "bytes": [169, 68], "comment_inline": "CR1=&44: RX_RESET | TIE (switch to TX for ACK)", "type": "code", "mnemonic": "lda", "operand": "#&44"}, {"addr": 38796, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 38799, "bytes": [173, 64, 13], "comment_inline": "Check port byte: 0 = immediate op, non-zero = data transfer", "type": "code", "mnemonic": "lda", "operand": "rx_port", "target": 3392, "target_label": "rx_port"}, {"addr": 38802, "bytes": [208, 6], "comment_inline": "Port non-zero -- look for matching receive block", "type": "code", "mnemonic": "bne", "operand": "scout_match_port", "target": 38810, "target_label": "scout_match_port"}, {"addr": 38804, "bytes": [76, 89, 154], "comment_inline": "Port = 0 -- immediate operation handler", "type": "code", "mnemonic": "jmp", "operand": "immediate_op", "target": 39513, "target_label": "immediate_op"}, {"addr": 38807, "bytes": [76, 138, 152], "labels": ["scout_no_match"], "comments_before": ["&9797 referenced 3 times by &97e2, &97e7, &9819"], "references": [38887, 38882, 38937], "type": "code", "mnemonic": "jmp", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 38810, "bytes": [44, 74, 13], "labels": ["scout_match_port"], "comments_before": ["&979a referenced 1 time by &9792"], "references": [38802], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 38813, "bytes": [80, 5], "type": "code", "mnemonic": "bvc", "operand": "c97a4", "target": 38820, "target_label": "c97a4"}, {"addr": 38815, "bytes": [169, 7], "type": "code", "mnemonic": "lda", "operand": "#7"}, {"addr": 38817, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38820, "bytes": [44, 56, 13], "labels": ["c97a4"], "comments_before": ["&97a4 referenced 1 time by &979d"], "references": [38813], "type": "code", "mnemonic": "bit", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 38823, "bytes": [16, 59], "type": "code", "mnemonic": "bpl", "operand": "c97e4", "target": 38884, "target_label": "c97e4"}, {"addr": 38825, "bytes": [169, 192], "type": "code", "mnemonic": "lda", "operand": "#&c0"}, {"addr": 38827, "bytes": [133, 166], "type": "code", "mnemonic": "sta", "operand": "port_ws_offset", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38829, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 38831, "bytes": [133, 167], "type": "code", "mnemonic": "sta", "operand": "rx_buf_offset", "target": 167, "target_label": "rx_buf_offset"}, {"addr": 38833, "bytes": [160, 0], "labels": ["c97b1"], "comments_before": ["&97b1 referenced 1 time by &97de"], "references": [38878], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 38835, "bytes": [177, 166], "labels": ["c97b3"], "comments_before": ["&97b3 referenced 1 time by &97f1"], "references": [38897], "type": "code", "mnemonic": "lda", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38837, "bytes": [240, 41], "type": "code", "mnemonic": "beq", "operand": "c97e0", "target": 38880, "target_label": "c97e0"}, {"addr": 38839, "bytes": [201, 127], "type": "code", "mnemonic": "cmp", "operand": "#&7f"}, {"addr": 38841, "bytes": [208, 28], "type": "code", "mnemonic": "bne", "operand": "c97d7", "target": 38871, "target_label": "c97d7"}, {"addr": 38843, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 38844, "bytes": [177, 166], "type": "code", "mnemonic": "lda", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38846, "bytes": [240, 5], "type": "code", "mnemonic": "beq", "operand": "c97c5", "target": 38853, "target_label": "c97c5"}, {"addr": 38848, "bytes": [205, 64, 13], "type": "code", "mnemonic": "cmp", "operand": "rx_port", "target": 3392, "target_label": "rx_port"}, {"addr": 38851, "bytes": [208, 18], "type": "code", "mnemonic": "bne", "operand": "c97d7", "target": 38871, "target_label": "c97d7"}, {"addr": 38853, "bytes": [200], "labels": ["c97c5"], "comments_before": ["&97c5 referenced 1 time by &97be"], "references": [38846], "type": "code", "mnemonic": "iny"}, {"addr": 38854, "bytes": [177, 166], "type": "code", "mnemonic": "lda", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38856, "bytes": [240, 5], "type": "code", "mnemonic": "beq", "operand": "c97cf", "target": 38863, "target_label": "c97cf"}, {"addr": 38858, "bytes": [205, 61, 13], "type": "code", "mnemonic": "cmp", "operand": "rx_src_stn", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 38861, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "c97d7", "target": 38871, "target_label": "c97d7"}, {"addr": 38863, "bytes": [200], "labels": ["c97cf"], "comments_before": ["&97cf referenced 1 time by &97c8"], "references": [38856], "type": "code", "mnemonic": "iny"}, {"addr": 38864, "bytes": [177, 166], "type": "code", "mnemonic": "lda", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38866, "bytes": [205, 62, 13], "type": "code", "mnemonic": "cmp", "operand": "rx_src_net", "target": 3390, "target_label": "rx_src_net"}, {"addr": 38869, "bytes": [240, 28], "type": "code", "mnemonic": "beq", "operand": "c97f3", "target": 38899, "target_label": "c97f3"}, {"addr": 38871, "bytes": [165, 166], "labels": ["c97d7"], "comments_before": ["&97d7 referenced 3 times by &97b9, &97c3, &97cd"], "references": [38841, 38851, 38861], "type": "code", "mnemonic": "lda", "operand": "port_ws_offset", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38873, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 38874, "bytes": [105, 12], "type": "code", "mnemonic": "adc", "operand": "#&0c"}, {"addr": 38876, "bytes": [133, 166], "type": "code", "mnemonic": "sta", "operand": "port_ws_offset", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38878, "bytes": [144, 209], "type": "code", "mnemonic": "bcc", "operand": "c97b1", "target": 38833, "target_label": "c97b1"}, {"addr": 38880, "bytes": [165, 167], "labels": ["c97e0"], "comments_before": ["&97e0 referenced 1 time by &97b5"], "references": [38837], "type": "code", "mnemonic": "lda", "operand": "rx_buf_offset", "target": 167, "target_label": "rx_buf_offset"}, {"addr": 38882, "bytes": [208, 179], "type": "code", "mnemonic": "bne", "operand": "scout_no_match", "target": 38807, "target_label": "scout_no_match"}, {"addr": 38884, "bytes": [44, 56, 13], "labels": ["c97e4"], "comments_before": ["&97e4 referenced 1 time by &97a7"], "references": [38823], "type": "code", "mnemonic": "bit", "operand": "rx_status_flags", "target": 3384, "target_label": "rx_status_flags"}, {"addr": 38887, "bytes": [80, 174], "type": "code", "mnemonic": "bvc", "operand": "scout_no_match", "target": 38807, "target_label": "scout_no_match"}, {"addr": 38889, "bytes": [165, 159], "type": "code", "mnemonic": "lda", "operand": "nfs_workspace_hi", "target": 159, "target_label": "nfs_workspace_hi"}, {"addr": 38891, "bytes": [133, 167], "type": "code", "mnemonic": "sta", "operand": "rx_buf_offset", "target": 167, "target_label": "rx_buf_offset"}, {"addr": 38893, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 38895, "bytes": [132, 166], "type": "code", "mnemonic": "sty", "operand": "port_ws_offset", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38897, "bytes": [240, 192], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "c97b3", "target": 38835, "target_label": "c97b3"}, {"addr": 38899, "bytes": [44, 74, 13], "labels": ["c97f3"], "comments_before": ["&97f3 referenced 1 time by &97d5"], "references": [38869], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 38902, "bytes": [80, 3], "type": "code", "mnemonic": "bvc", "operand": "c97fb", "target": 38907, "target_label": "c97fb"}, {"addr": 38904, "bytes": [76, 74, 154], "type": "code", "mnemonic": "jmp", "operand": "c9a4a", "target": 39498, "target_label": "c9a4a"}, {"addr": 38907, "bytes": [169, 3], "labels": ["c97fb"], "comments_before": ["&97fb referenced 1 time by &97f6"], "references": [38902], "type": "code", "mnemonic": "lda", "operand": "#3"}, {"addr": 38909, "bytes": [141, 92, 13], "type": "code", "mnemonic": "sta", "operand": "scout_status", "target": 3420, "target_label": "scout_status"}, {"addr": 38912, "bytes": [165, 160], "type": "code", "mnemonic": "lda", "operand": "nmi_tx_block", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 38914, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 38915, "bytes": [165, 161], "type": "code", "mnemonic": "lda", "operand": "nmi_tx_block_hi", "target": 161, "target_label": "nmi_tx_block_hi"}, {"addr": 38917, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 38918, "bytes": [165, 166], "type": "code", "mnemonic": "lda", "operand": "port_ws_offset", "target": 166, "target_label": "port_ws_offset"}, {"addr": 38920, "bytes": [133, 160], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 38922, "bytes": [165, 167], "type": "code", "mnemonic": "lda", "operand": "rx_buf_offset", "target": 167, "target_label": "rx_buf_offset"}, {"addr": 38924, "bytes": [133, 161], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block_hi", "target": 161, "target_label": "nmi_tx_block_hi"}, {"addr": 38926, "bytes": [32, 91, 159], "type": "code", "mnemonic": "jsr", "operand": "tx_calc_transfer", "target": 40795, "target_label": "tx_calc_transfer"}, {"addr": 38929, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 38930, "bytes": [133, 161], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block_hi", "target": 161, "target_label": "nmi_tx_block_hi"}, {"addr": 38932, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 38933, "bytes": [133, 160], "type": "code", "mnemonic": "sta", "operand": "nmi_tx_block", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 38935, "bytes": [176, 3], "type": "code", "mnemonic": "bcs", "operand": "c981c", "target": 38940, "target_label": "c981c"}, {"addr": 38937, "bytes": [76, 151, 151], "type": "code", "mnemonic": "jmp", "operand": "scout_no_match", "target": 38807, "target_label": "scout_no_match"}, {"addr": 38940, "bytes": [169, 68], "labels": ["c981c"], "comments_before": ["&981c referenced 1 time by &9817"], "references": [38935], "type": "code", "mnemonic": "lda", "operand": "#&44"}, {"addr": 38942, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 38945, "bytes": [169, 167], "type": "code", "mnemonic": "lda", "operand": "#&a7"}, {"addr": 38947, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38950, "bytes": [169, 45], "type": "code", "mnemonic": "lda", "operand": "#&2d"}, {"addr": 38952, "bytes": [160, 152], "type": "code", "mnemonic": "ldy", "operand": "#&98"}, {"addr": 38954, "bytes": [76, 116, 153], "type": "code", "mnemonic": "jmp", "operand": "ack_tx_write_dest", "target": 39284, "target_label": "ack_tx_write_dest"}, {"addr": 38957, "bytes": [169, 130], "labels": ["data_rx_setup"], "comment_inline": "CR1=&82: TX_RESET | RIE (switch to RX for data frame)", "type": "code", "mnemonic": "lda", "operand": "#&82"}, {"addr": 38959, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 38962, "bytes": [169, 57], "type": "code", "mnemonic": "lda", "operand": "#&39"}, {"addr": 38964, "bytes": [160, 152], "type": "code", "mnemonic": "ldy", "operand": "#&98"}, {"addr": 38966, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 38969, "bytes": [169, 1], "labels": ["nmi_data_rx"], "comments_before": ["***************************************************************************************", "Data frame RX handler (four-way handshake)\n\nReceives the data frame after the scout ACK has been sent.\nFirst checks AP (Address Present) for the start of the data frame.\nReads and validates the first two address bytes (dest_stn, dest_net)\nagainst our station address, then installs continuation handlers\nto read the remaining data payload into the open port buffer.\n\nHandler chain: &9839 (AP+addr check) -> &984F (net=0 check) ->\n&9865 (skip ctrl+port) -> &989A (bulk data read) -> &98CE (completion)", "***************************************************************************************"], "comment_inline": "Read SR2 for AP check", "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 38971, "bytes": [44, 161, 254], "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38974, "bytes": [240, 74], "type": "code", "mnemonic": "beq", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 38976, "bytes": [173, 162, 254], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 38979, "bytes": [205, 24, 254], "type": "code", "mnemonic": "cmp", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 38982, "bytes": [208, 66], "type": "code", "mnemonic": "bne", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 38984, "bytes": [169, 79], "type": "code", "mnemonic": "lda", "operand": "#&4f"}, {"addr": 38986, "bytes": [160, 152], "type": "code", "mnemonic": "ldy", "operand": "#&98"}, {"addr": 38988, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 38991, "bytes": [44, 161, 254], "labels": ["nmi_data_rx_net"], "comment_inline": "Validate source network = 0", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 38994, "bytes": [16, 54], "type": "code", "mnemonic": "bpl", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 38996, "bytes": [173, 162, 254], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 38999, "bytes": [208, 49], "type": "code", "mnemonic": "bne", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39001, "bytes": [169, 101], "type": "code", "mnemonic": "lda", "operand": "#&65"}, {"addr": 39003, "bytes": [160, 152], "type": "code", "mnemonic": "ldy", "operand": "#&98"}, {"addr": 39005, "bytes": [44, 160, 254], "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 39008, "bytes": [48, 3], "type": "code", "mnemonic": "bmi", "operand": "nmi_data_rx_skip", "target": 39013, "target_label": "nmi_data_rx_skip"}, {"addr": 39010, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 39013, "bytes": [44, 161, 254], "labels": ["nmi_data_rx_skip"], "comments_before": ["&9865 referenced 1 time by &9860"], "comment_inline": "Skip control and port bytes (already known from scout)", "references": [39008], "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39016, "bytes": [16, 32], "type": "code", "mnemonic": "bpl", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39018, "bytes": [173, 162, 254], "comment_inline": "Discard control byte", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39021, "bytes": [173, 162, 254], "comment_inline": "Discard port byte", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39024, "bytes": [169, 2], "labels": ["c9870"], "comments_before": ["&9870 referenced 1 time by &9f2f"], "references": [40751], "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 39026, "bytes": [44, 74, 13], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39029, "bytes": [208, 12], "type": "code", "mnemonic": "bne", "operand": "c9883", "target": 39043, "target_label": "c9883"}, {"addr": 39031, "bytes": [169, 154], "type": "code", "mnemonic": "lda", "operand": "#&9a"}, {"addr": 39033, "bytes": [160, 152], "type": "code", "mnemonic": "ldy", "operand": "#&98"}, {"addr": 39035, "bytes": [44, 160, 254], "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 39038, "bytes": [48, 26], "type": "code", "mnemonic": "bmi", "operand": "nmi_data_rx_bulk", "target": 39066, "target_label": "nmi_data_rx_bulk"}, {"addr": 39040, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 39043, "bytes": [169, 247], "labels": ["c9883"], "comments_before": ["&9883 referenced 1 time by &9875"], "references": [39029], "type": "code", "mnemonic": "lda", "operand": "#&f7"}, {"addr": 39045, "bytes": [160, 152], "type": "code", "mnemonic": "ldy", "operand": "#&98"}, {"addr": 39047, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 39050, "bytes": [173, 74, 13], "labels": ["rx_error"], "comments_before": ["&988a referenced 12 times by &9797, &983e, &9846, &9852, &9857, &9868, &98ad, &98df, &98e5, &9930, &99b8, &9a8c"], "references": [38994, 39016, 38974, 38999, 39352, 39564, 38982, 39135, 39085, 39216, 39141, 38807], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39053, "bytes": [16, 5], "type": "code", "mnemonic": "bpl", "operand": "rx_error_reset", "target": 39060, "target_label": "rx_error_reset"}, {"addr": 39055, "bytes": [169, 65], "type": "code", "mnemonic": "lda", "operand": "#&41"}, {"addr": 39057, "bytes": [76, 63, 159], "type": "code", "mnemonic": "jmp", "operand": "tx_store_result", "target": 40767, "target_label": "tx_store_result"}, {"addr": 39060, "bytes": [32, 220, 150], "labels": ["rx_error_reset"], "comments_before": ["&9894 referenced 1 time by &988d"], "references": [39053], "type": "code", "mnemonic": "jsr", "operand": "adlc_full_reset", "target": 38620, "target_label": "adlc_full_reset"}, {"addr": 39063, "bytes": [76, 52, 154], "type": "code", "mnemonic": "jmp", "operand": "discard_reset_listen", "target": 39476, "target_label": "discard_reset_listen"}, {"addr": 39066, "bytes": [164, 162], "labels": ["nmi_data_rx_bulk"], "comments_before": ["***************************************************************************************", "Data frame bulk read loop\n\nReads data payload bytes from the RX FIFO and stores them into\nthe open port buffer at (open_port_buf),Y. Reads bytes in pairs\n(like the scout data loop), checking SR2 between each pair.\nSR2 non-zero (FV or other) -> frame completion at &98CE.\nSR2 = 0 -> RTI, wait for next NMI to continue.", "***************************************************************************************", "&989a referenced 1 time by &987e"], "comment_inline": "Y = buffer offset, resume from last position", "references": [39038], "type": "code", "mnemonic": "ldy", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39068, "bytes": [173, 161, 254], "comment_inline": "Read SR2 for next pair", "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39071, "bytes": [16, 45], "labels": ["c989f"], "comments_before": ["&989f referenced 1 time by &98c9"], "references": [39113], "type": "code", "mnemonic": "bpl", "operand": "data_rx_complete", "target": 39118, "target_label": "data_rx_complete"}, {"addr": 39073, "bytes": [173, 162, 254], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39076, "bytes": [145, 164], "type": "code", "mnemonic": "sta", "operand": "(open_port_buf),y", "target": 164, "target_label": "open_port_buf"}, {"addr": 39078, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39079, "bytes": [208, 6], "type": "code", "mnemonic": "bne", "operand": "c98af", "target": 39087, "target_label": "c98af"}, {"addr": 39081, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39083, "bytes": [198, 163], "type": "code", "mnemonic": "dec", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 39085, "bytes": [240, 219], "type": "code", "mnemonic": "beq", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39087, "bytes": [173, 161, 254], "labels": ["c98af"], "comments_before": ["&98af referenced 1 time by &98a7"], "references": [39079], "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39090, "bytes": [48, 2], "type": "code", "mnemonic": "bmi", "operand": "c98b6", "target": 39094, "target_label": "c98b6"}, {"addr": 39092, "bytes": [208, 24], "type": "code", "mnemonic": "bne", "operand": "data_rx_complete", "target": 39118, "target_label": "data_rx_complete"}, {"addr": 39094, "bytes": [173, 162, 254], "labels": ["c98b6"], "comments_before": ["&98b6 referenced 1 time by &98b2"], "references": [39090], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39097, "bytes": [145, 164], "type": "code", "mnemonic": "sta", "operand": "(open_port_buf),y", "target": 164, "target_label": "open_port_buf"}, {"addr": 39099, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39100, "bytes": [132, 162], "type": "code", "mnemonic": "sty", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39102, "bytes": [208, 6], "type": "code", "mnemonic": "bne", "operand": "c98c6", "target": 39110, "target_label": "c98c6"}, {"addr": 39104, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39106, "bytes": [198, 163], "type": "code", "mnemonic": "dec", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 39108, "bytes": [240, 8], "type": "code", "mnemonic": "beq", "operand": "data_rx_complete", "target": 39118, "target_label": "data_rx_complete"}, {"addr": 39110, "bytes": [173, 161, 254], "labels": ["c98c6"], "comments_before": ["&98c6 referenced 1 time by &98be"], "references": [39102], "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39113, "bytes": [208, 212], "type": "code", "mnemonic": "bne", "operand": "c989f", "target": 39071, "target_label": "c989f"}, {"addr": 39115, "bytes": [76, 20, 13], "type": "code", "mnemonic": "jmp", "operand": "nmi_rti", "target": 3348, "target_label": "nmi_rti"}, {"addr": 39118, "bytes": [169, 0], "labels": ["data_rx_complete"], "comments_before": ["***************************************************************************************", "Data frame completion\n\nReached when SR2 non-zero during data RX (FV detected).\nSame pattern as scout completion (&9771): disables PSE (CR1=&00,\nCR2=&84), then tests FV and RDA. If FV+RDA, reads the last byte.\nIf extra data available and buffer space remains, stores it.\nProceeds to send the final ACK via &995E.", "***************************************************************************************", "&98ce referenced 3 times by &989f, &98b4, &98c4"], "comment_inline": "CR1=&00: disable all interrupts", "references": [39071, 39092, 39108], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 39120, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 39123, "bytes": [169, 132], "comment_inline": "CR2=&84: disable PSE for individual bit testing", "type": "code", "mnemonic": "lda", "operand": "#&84"}, {"addr": 39125, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39128, "bytes": [132, 162], "type": "code", "mnemonic": "sty", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39130, "bytes": [169, 2], "comment_inline": "A=&02: FV mask", "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 39132, "bytes": [44, 161, 254], "comment_inline": "BIT SR2: test FV (Z) and RDA (N)", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39135, "bytes": [240, 169], "comment_inline": "No FV -- error", "type": "code", "mnemonic": "beq", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39137, "bytes": [16, 17], "comment_inline": "FV set, no RDA -- proceed to ACK", "type": "code", "mnemonic": "bpl", "operand": "c98f4", "target": 39156, "target_label": "c98f4"}, {"addr": 39139, "bytes": [165, 163], "type": "code", "mnemonic": "lda", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 39141, "bytes": [240, 163], "type": "code", "mnemonic": "beq", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39143, "bytes": [173, 162, 254], "comment_inline": "FV+RDA: read and store last data byte", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39146, "bytes": [164, 162], "type": "code", "mnemonic": "ldy", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39148, "bytes": [145, 164], "type": "code", "mnemonic": "sta", "operand": "(open_port_buf),y", "target": 164, "target_label": "open_port_buf"}, {"addr": 39150, "bytes": [230, 162], "type": "code", "mnemonic": "inc", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39152, "bytes": [208, 2], "type": "code", "mnemonic": "bne", "operand": "c98f4", "target": 39156, "target_label": "c98f4"}, {"addr": 39154, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39156, "bytes": [76, 94, 153], "labels": ["c98f4"], "comments_before": ["&98f4 referenced 2 times by &98e1, &98f0"], "references": [39137, 39152], "type": "code", "mnemonic": "jmp", "operand": "ack_tx", "target": 39262, "target_label": "ack_tx"}, {"addr": 39159, "bytes": [173, 161, 254], "labels": ["nmi_data_rx_tube"], "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39162, "bytes": [16, 55], "labels": ["c98fa"], "comments_before": ["&98fa referenced 1 time by &992b"], "references": [39211], "type": "code", "mnemonic": "bpl", "operand": "data_rx_tube_complete", "target": 39219, "target_label": "data_rx_tube_complete"}, {"addr": 39164, "bytes": [173, 162, 254], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39167, "bytes": [230, 162], "type": "code", "mnemonic": "inc", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39169, "bytes": [141, 229, 254], "type": "code", "mnemonic": "sta", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 39172, "bytes": [208, 12], "type": "code", "mnemonic": "bne", "operand": "c9912", "target": 39186, "target_label": "c9912"}, {"addr": 39174, "bytes": [230, 163], "type": "code", "mnemonic": "inc", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 39176, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "c9912", "target": 39186, "target_label": "c9912"}, {"addr": 39178, "bytes": [230, 164], "type": "code", "mnemonic": "inc", "operand": "open_port_buf", "target": 164, "target_label": "open_port_buf"}, {"addr": 39180, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "c9912", "target": 39186, "target_label": "c9912"}, {"addr": 39182, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39184, "bytes": [240, 30], "type": "code", "mnemonic": "beq", "operand": "data_rx_tube_error", "target": 39216, "target_label": "data_rx_tube_error"}, {"addr": 39186, "bytes": [173, 162, 254], "labels": ["c9912"], "comments_before": ["&9912 referenced 3 times by &9904, &9908, &990c"], "references": [39172, 39176, 39180], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39189, "bytes": [141, 229, 254], "type": "code", "mnemonic": "sta", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 39192, "bytes": [230, 162], "type": "code", "mnemonic": "inc", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39194, "bytes": [208, 12], "type": "code", "mnemonic": "bne", "operand": "c9928", "target": 39208, "target_label": "c9928"}, {"addr": 39196, "bytes": [230, 163], "type": "code", "mnemonic": "inc", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 39198, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "c9928", "target": 39208, "target_label": "c9928"}, {"addr": 39200, "bytes": [230, 164], "type": "code", "mnemonic": "inc", "operand": "open_port_buf", "target": 164, "target_label": "open_port_buf"}, {"addr": 39202, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "c9928", "target": 39208, "target_label": "c9928"}, {"addr": 39204, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39206, "bytes": [240, 11], "type": "code", "mnemonic": "beq", "operand": "data_rx_tube_complete", "target": 39219, "target_label": "data_rx_tube_complete"}, {"addr": 39208, "bytes": [173, 161, 254], "labels": ["c9928"], "comments_before": ["&9928 referenced 3 times by &991a, &991e, &9922"], "references": [39194, 39198, 39202], "type": "code", "mnemonic": "lda", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39211, "bytes": [208, 205], "type": "code", "mnemonic": "bne", "operand": "c98fa", "target": 39162, "target_label": "c98fa"}, {"addr": 39213, "bytes": [76, 20, 13], "type": "code", "mnemonic": "jmp", "operand": "nmi_rti", "target": 3348, "target_label": "nmi_rti"}, {"addr": 39216, "bytes": [76, 138, 152], "labels": ["data_rx_tube_error"], "comments_before": ["&9930 referenced 3 times by &9910, &9942, &994e"], "references": [39234, 39184, 39246], "type": "code", "mnemonic": "jmp", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39219, "bytes": [169, 0], "labels": ["data_rx_tube_complete"], "comments_before": ["&9933 referenced 2 times by &98fa, &9926"], "references": [39162, 39206], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 39221, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 39224, "bytes": [169, 132], "type": "code", "mnemonic": "lda", "operand": "#&84"}, {"addr": 39226, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39229, "bytes": [169, 2], "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 39231, "bytes": [44, 161, 254], "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39234, "bytes": [240, 236], "type": "code", "mnemonic": "beq", "operand": "data_rx_tube_error", "target": 39216, "target_label": "data_rx_tube_error"}, {"addr": 39236, "bytes": [16, 24], "type": "code", "mnemonic": "bpl", "operand": "ack_tx", "target": 39262, "target_label": "ack_tx"}, {"addr": 39238, "bytes": [165, 162], "type": "code", "mnemonic": "lda", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39240, "bytes": [5, 163], "type": "code", "mnemonic": "ora", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 39242, "bytes": [5, 164], "type": "code", "mnemonic": "ora", "operand": "open_port_buf", "target": 164, "target_label": "open_port_buf"}, {"addr": 39244, "bytes": [5, 165], "type": "code", "mnemonic": "ora", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39246, "bytes": [240, 224], "type": "code", "mnemonic": "beq", "operand": "data_rx_tube_error", "target": 39216, "target_label": "data_rx_tube_error"}, {"addr": 39248, "bytes": [173, 162, 254], "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39251, "bytes": [141, 93, 13], "type": "code", "mnemonic": "sta", "operand": "rx_extra_byte", "target": 3421, "target_label": "rx_extra_byte"}, {"addr": 39254, "bytes": [169, 32], "type": "code", "mnemonic": "lda", "operand": "#&20"}, {"addr": 39256, "bytes": [13, 74, 13], "type": "code", "mnemonic": "ora", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39259, "bytes": [141, 74, 13], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39262, "bytes": [173, 74, 13], "labels": ["ack_tx"], "comments_before": ["***************************************************************************************", "ACK transmission\n\nSends a scout ACK or final ACK frame as part of the four-way handshake.\nIf bit7 of &0D4A is set, this is a final ACK -> completion (&9F39).\nOtherwise, configures for TX (CR1=&44, CR2=&A7) and sends the ACK\nframe (dst_stn, dst_net from &0D3D, src_stn from &FE18, src_net=0).\nThe ACK frame has no data payload -- just address bytes.\n\nAfter writing the address bytes to the TX FIFO, installs the next\nNMI handler from &0D4B/&0D4C (saved by the scout/data RX handler)\nand sends TX_LAST_DATA (CR2=&3F) to close the frame.", "***************************************************************************************", "&995e referenced 2 times by &98f4, &9944"], "references": [39236, 39156], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39265, "bytes": [16, 3], "type": "code", "mnemonic": "bpl", "operand": "ack_tx_configure", "target": 39270, "target_label": "ack_tx_configure"}, {"addr": 39267, "bytes": [76, 57, 159], "type": "code", "mnemonic": "jmp", "operand": "tx_result_ok", "target": 40761, "target_label": "tx_result_ok"}, {"addr": 39270, "bytes": [169, 68], "labels": ["ack_tx_configure"], "comments_before": ["&9966 referenced 1 time by &9961"], "comment_inline": "CR1=&44: RX_RESET | TIE (switch to TX mode)", "references": [39265], "type": "code", "mnemonic": "lda", "operand": "#&44"}, {"addr": 39272, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 39275, "bytes": [169, 167], "comment_inline": "CR2=&A7: RTS|CLR_TX_ST|FC_TDRA|2_1_BYTE|PSE", "type": "code", "mnemonic": "lda", "operand": "#&a7"}, {"addr": 39277, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39280, "bytes": [169, 187], "comment_inline": "Install saved next handler (&99BB for scout ACK)", "type": "code", "mnemonic": "lda", "operand": "#&bb"}, {"addr": 39282, "bytes": [160, 153], "type": "code", "mnemonic": "ldy", "operand": "#&99"}, {"addr": 39284, "bytes": [141, 75, 13], "labels": ["ack_tx_write_dest"], "comments_before": ["&9974 referenced 1 time by &982a"], "references": [38954], "type": "code", "mnemonic": "sta", "operand": "nmi_next_lo", "target": 3403, "target_label": "nmi_next_lo"}, {"addr": 39287, "bytes": [140, 76, 13], "type": "code", "mnemonic": "sty", "operand": "nmi_next_hi", "target": 3404, "target_label": "nmi_next_hi"}, {"addr": 39290, "bytes": [173, 61, 13], "comment_inline": "Load dest station from RX scout buffer", "type": "code", "mnemonic": "lda", "operand": "rx_src_stn", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 39293, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: test TDRA (V=bit6)", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 39296, "bytes": [80, 54], "comment_inline": "TDRA not ready -- error", "type": "code", "mnemonic": "bvc", "operand": "c99b8", "target": 39352, "target_label": "c99b8"}, {"addr": 39298, "bytes": [141, 162, 254], "comment_inline": "Write dest station to TX FIFO", "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39301, "bytes": [173, 62, 13], "comment_inline": "Write dest network to TX FIFO", "type": "code", "mnemonic": "lda", "operand": "rx_src_net", "target": 3390, "target_label": "rx_src_net"}, {"addr": 39304, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39307, "bytes": [169, 146], "comment_inline": "Install handler at &9992 (write src addr)", "type": "code", "mnemonic": "lda", "operand": "#&92"}, {"addr": 39309, "bytes": [160, 153], "type": "code", "mnemonic": "ldy", "operand": "#&99"}, {"addr": 39311, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 39314, "bytes": [173, 24, 254], "labels": ["nmi_ack_tx_src"], "comments_before": ["***************************************************************************************", "ACK TX continuation\n\nWrites source station and network to TX FIFO, completing the 4-byte\nACK frame. Then sends TX_LAST_DATA (CR2=&3F) to close the frame.", "***************************************************************************************"], "comment_inline": "Load our station ID (also INTOFF)", "type": "code", "mnemonic": "lda", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 39317, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: test TDRA", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 39320, "bytes": [80, 30], "comment_inline": "TDRA not ready -- error", "type": "code", "mnemonic": "bvc", "operand": "c99b8", "target": 39352, "target_label": "c99b8"}, {"addr": 39322, "bytes": [141, 162, 254], "comment_inline": "Write our station to TX FIFO", "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39325, "bytes": [169, 0], "comment_inline": "Write network=0 to TX FIFO", "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 39327, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 39330, "bytes": [173, 74, 13], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39333, "bytes": [48, 14], "type": "code", "mnemonic": "bmi", "operand": "c99b5", "target": 39349, "target_label": "c99b5"}, {"addr": 39335, "bytes": [169, 63], "comment_inline": "CR2=&3F: TX_LAST_DATA | CLR_RX_ST | FLAG_IDLE | FC_TDRA | 2_1_BYTE | PSE", "type": "code", "mnemonic": "lda", "operand": "#&3f"}, {"addr": 39337, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39340, "bytes": [173, 75, 13], "comment_inline": "Install saved handler from &0D4B/&0D4C", "type": "code", "mnemonic": "lda", "operand": "nmi_next_lo", "target": 3403, "target_label": "nmi_next_lo"}, {"addr": 39343, "bytes": [172, 76, 13], "type": "code", "mnemonic": "ldy", "operand": "nmi_next_hi", "target": 3404, "target_label": "nmi_next_hi"}, {"addr": 39346, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 39349, "bytes": [76, 59, 158], "labels": ["c99b5"], "comments_before": ["&99b5 referenced 1 time by &99a5"], "references": [39333], "type": "code", "mnemonic": "jmp", "operand": "data_tx_begin", "target": 40507, "target_label": "data_tx_begin"}, {"addr": 39352, "bytes": [76, 138, 152], "labels": ["c99b8"], "comments_before": ["&99b8 referenced 2 times by &9980, &9998"], "references": [39320, 39296], "type": "code", "mnemonic": "jmp", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39355, "bytes": [173, 64, 13], "labels": ["post_ack_scout"], "comments_before": ["***************************************************************************************", "Post-ACK scout processing\n\nCalled after the scout ACK has been transmitted. Processes the\nreceived scout data stored in the buffer at &0D3D-&0D48.\nChecks the port byte (&0D40) against open receive blocks to\nfind a matching listener. If a match is found, sets up the\ndata RX handler chain for the four-way handshake data phase.\nIf no match, discards the frame.", "***************************************************************************************"], "type": "code", "mnemonic": "lda", "operand": "rx_port", "target": 3392, "target_label": "rx_port"}, {"addr": 39358, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "c99c3", "target": 39363, "target_label": "c99c3"}, {"addr": 39360, "bytes": [76, 18, 155], "type": "code", "mnemonic": "jmp", "operand": "c9b12", "target": 39698, "target_label": "c9b12"}, {"addr": 39363, "bytes": [169, 2], "labels": ["c99c3"], "comments_before": ["&99c3 referenced 1 time by &99be"], "references": [39358], "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 39365, "bytes": [44, 74, 13], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39368, "bytes": [240, 61], "type": "code", "mnemonic": "beq", "operand": "c9a07", "target": 39431, "target_label": "c9a07"}, {"addr": 39370, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 39371, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 39372, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 39374, "bytes": [177, 166], "labels": ["loop_c99ce"], "comments_before": ["&99ce referenced 1 time by &99da"], "references": [39386], "type": "code", "mnemonic": "lda", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39376, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 39377, "bytes": [121, 154, 0], "type": "code", "mnemonic": "adc", "operand": "net_tx_ptr,y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 39380, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39382, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39383, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 39384, "bytes": [192, 12], "type": "code", "mnemonic": "cpy", "operand": "#&0c"}, {"addr": 39386, "bytes": [144, 242], "type": "code", "mnemonic": "bcc", "operand": "loop_c99ce", "target": 39374, "target_label": "loop_c99ce"}, {"addr": 39388, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 39389, "bytes": [169, 32], "type": "code", "mnemonic": "lda", "operand": "#&20"}, {"addr": 39391, "bytes": [44, 74, 13], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39394, "bytes": [240, 32], "type": "code", "mnemonic": "beq", "operand": "c9a04", "target": 39428, "target_label": "c9a04"}, {"addr": 39396, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 39397, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39398, "bytes": [169, 8], "type": "code", "mnemonic": "lda", "operand": "#8"}, {"addr": 39400, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 39401, "bytes": [101, 166], "type": "code", "mnemonic": "adc", "operand": "port_ws_offset", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39403, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 39404, "bytes": [164, 167], "type": "code", "mnemonic": "ldy", "operand": "rx_buf_offset", "target": 167, "target_label": "rx_buf_offset"}, {"addr": 39406, "bytes": [169, 1], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 39408, "bytes": [32, 6, 4], "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 39411, "bytes": [173, 93, 13], "type": "code", "mnemonic": "lda", "operand": "rx_extra_byte", "target": 3421, "target_label": "rx_extra_byte"}, {"addr": 39414, "bytes": [141, 229, 254], "type": "code", "mnemonic": "sta", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 39417, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 39418, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 39419, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 39421, "bytes": [177, 166], "type": "code", "mnemonic": "lda", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39423, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 39424, "bytes": [105, 0], "type": "code", "mnemonic": "adc", "operand": "#0"}, {"addr": 39426, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39428, "bytes": [76, 25, 154], "labels": ["c9a04"], "comments_before": ["&9a04 referenced 1 time by &99e2"], "references": [39394], "type": "code", "mnemonic": "jmp", "operand": "c9a19", "target": 39449, "target_label": "c9a19"}, {"addr": 39431, "bytes": [165, 162], "labels": ["c9a07"], "comments_before": ["&9a07 referenced 1 time by &99c8"], "references": [39368], "type": "code", "mnemonic": "lda", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39433, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 39434, "bytes": [101, 164], "type": "code", "mnemonic": "adc", "operand": "open_port_buf", "target": 164, "target_label": "open_port_buf"}, {"addr": 39436, "bytes": [144, 2], "type": "code", "mnemonic": "bcc", "operand": "c9a10", "target": 39440, "target_label": "c9a10"}, {"addr": 39438, "bytes": [230, 165], "labels": ["c9a0e"], "comments_before": ["&9a0e referenced 1 time by &9a87"], "references": [39559], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39440, "bytes": [160, 8], "labels": ["c9a10"], "comments_before": ["&9a10 referenced 1 time by &9a0c"], "references": [39436], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 39442, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39444, "bytes": [200], "comment_inline": "Y=&09", "type": "code", "mnemonic": "iny"}, {"addr": 39445, "bytes": [165, 165], "labels": ["sub_c9a15"], "sub_labels": {"39446": ["l9a16"]}, "comments_before": ["&9a16 referenced 1 time by &9a83"], "type": "code", "mnemonic": "lda", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 39447, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39449, "bytes": [173, 62, 13], "labels": ["c9a19"], "comments_before": ["&9a19 referenced 2 times by &9a04, &9a56"], "references": [39428, 39510], "type": "code", "mnemonic": "lda", "operand": "rx_src_net", "target": 3390, "target_label": "rx_src_net"}, {"addr": 39452, "bytes": [160, 3], "type": "code", "mnemonic": "ldy", "operand": "#3"}, {"addr": 39454, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39456, "bytes": [136], "comment_inline": "Y=&02", "type": "code", "mnemonic": "dey"}, {"addr": 39457, "bytes": [173, 61, 13], "type": "code", "mnemonic": "lda", "operand": "rx_src_stn", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 39460, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39462, "bytes": [136], "comment_inline": "Y=&01", "type": "code", "mnemonic": "dey"}, {"addr": 39463, "bytes": [173, 64, 13], "type": "code", "mnemonic": "lda", "operand": "rx_port", "target": 3392, "target_label": "rx_port"}, {"addr": 39466, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39468, "bytes": [136], "comment_inline": "Y=&00", "type": "code", "mnemonic": "dey"}, {"addr": 39469, "bytes": [173, 63, 13], "type": "code", "mnemonic": "lda", "operand": "rx_ctrl", "target": 3391, "target_label": "rx_ctrl"}, {"addr": 39472, "bytes": [9, 128], "type": "code", "mnemonic": "ora", "operand": "#&80"}, {"addr": 39474, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39476, "bytes": [169, 2], "labels": ["discard_reset_listen"], "comments_before": ["***************************************************************************************", "Discard with full ADLC reset\n\nPerforms adlc_full_reset (CR1=&C1, reset both TX and RX sections),\nthen falls through to discard_after_reset. Used when the ADLC is\nin an unexpected state and needs a hard reset before returning\nto idle listen mode. 5 references \u2014 the main error recovery path.", "***************************************************************************************", "&9a34 referenced 4 times by &9897, &9b4f, &9e93, &9f48"], "references": [40776, 40595, 39063, 39759], "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 39478, "bytes": [44, 74, 13], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 39481, "bytes": [240, 5], "type": "code", "mnemonic": "beq", "operand": "discard_listen", "target": 39488, "target_label": "discard_listen"}, {"addr": 39483, "bytes": [169, 130], "type": "code", "mnemonic": "lda", "operand": "#&82"}, {"addr": 39485, "bytes": [32, 6, 4], "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 39488, "bytes": [32, 235, 150], "labels": ["discard_listen"], "comments_before": ["***************************************************************************************", "Discard frame (gentle)\n\nSends RX_DISCONTINUE (CR1=&A2: RIE|RX_DISCONTINUE) to abort the\ncurrent frame reception without a full reset, then falls through\nto discard_after_reset. Used for clean rejection of frames that\nare correctly formatted but not for us (wrong station/network).", "***************************************************************************************", "&9a40 referenced 2 times by &9744, &9a39"], "references": [39481, 38724], "type": "code", "mnemonic": "jsr", "operand": "adlc_rx_listen", "target": 38635, "target_label": "adlc_rx_listen"}, {"addr": 39491, "bytes": [169, 246], "labels": ["discard_after_reset"], "comments_before": ["***************************************************************************************", "Return to idle listen after reset/discard\n\nJust calls adlc_rx_listen (CR1=&82, CR2=&67) to re-enter idle\nRX mode, then RTI. The simplest of the three discard paths \u2014\nused as the tail of both discard_reset_listen and discard_listen.", "***************************************************************************************", "&9a43 referenced 2 times by &9728, &9741"], "references": [38721, 38696], "type": "code", "mnemonic": "lda", "operand": "#&f6"}, {"addr": 39493, "bytes": [160, 150], "type": "code", "mnemonic": "ldy", "operand": "#&96"}, {"addr": 39495, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 39498, "bytes": [160, 4], "labels": ["c9a4a"], "comments_before": ["&9a4a referenced 1 time by &97f8"], "references": [38904], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 39500, "bytes": [185, 61, 13], "labels": ["loop_c9a4c"], "comments_before": ["&9a4c referenced 1 time by &9a54"], "references": [39508], "type": "code", "mnemonic": "lda", "operand": "rx_src_stn,y", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 39503, "bytes": [145, 166], "type": "code", "mnemonic": "sta", "operand": "(port_ws_offset),y", "target": 166, "target_label": "port_ws_offset"}, {"addr": 39505, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39506, "bytes": [192, 12], "type": "code", "mnemonic": "cpy", "operand": "#&0c"}, {"addr": 39508, "bytes": [208, 246], "type": "code", "mnemonic": "bne", "operand": "loop_c9a4c", "target": 39500, "target_label": "loop_c9a4c"}, {"addr": 39510, "bytes": [76, 25, 154], "type": "code", "mnemonic": "jmp", "operand": "c9a19", "target": 39449, "target_label": "c9a19"}, {"addr": 39513, "bytes": [172, 63, 13], "labels": ["immediate_op"], "comments_before": ["***************************************************************************************", "Immediate operation handler (port = 0)\n\nHandles immediate (non-data-transfer) operations received via\nscout frames with port byte = 0. The control byte (&0D3F)\ndetermines the operation type:\n  &81 = PEEK (read memory)\n  &82 = POKE (write memory)\n  &83 = JSR (remote procedure call)\n  &84 = user procedure\n  &85 = OS procedure\n  &86 = HALT\n  &87 = CONTINUE\nThe protection mask (LSTAT at &D63) controls which operations\nare permitted \u2014 each bit enables or disables an operation type.\nIf the operation is not permitted by the mask, it is silently\nignored. LSTAT can be read/set via OSWORD &12 sub-functions 4/5.", "***************************************************************************************", "&9a59 referenced 1 time by &9794"], "references": [38804], "type": "code", "mnemonic": "ldy", "operand": "rx_ctrl", "target": 3391, "target_label": "rx_ctrl"}, {"addr": 39516, "bytes": [192, 129], "type": "code", "mnemonic": "cpy", "operand": "#&81"}, {"addr": 39518, "bytes": [144, 44], "type": "code", "mnemonic": "bcc", "operand": "c9a8c", "target": 39564, "target_label": "c9a8c"}, {"addr": 39520, "bytes": [192, 137], "type": "code", "mnemonic": "cpy", "operand": "#&89"}, {"addr": 39522, "bytes": [176, 40], "type": "code", "mnemonic": "bcs", "operand": "c9a8c", "target": 39564, "target_label": "c9a8c"}, {"addr": 39524, "bytes": [192, 135], "type": "code", "mnemonic": "cpy", "operand": "#&87"}, {"addr": 39526, "bytes": [176, 24], "type": "code", "mnemonic": "bcs", "operand": "c9a80", "target": 39552, "target_label": "c9a80"}, {"addr": 39528, "bytes": [173, 61, 13], "type": "code", "mnemonic": "lda", "operand": "rx_src_stn", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 39531, "bytes": [201, 240], "type": "code", "mnemonic": "cmp", "operand": "#&f0"}, {"addr": 39533, "bytes": [176, 17], "type": "code", "mnemonic": "bcs", "operand": "c9a80", "target": 39552, "target_label": "c9a80"}, {"addr": 39535, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 39536, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 39537, "bytes": [233, 129], "type": "code", "mnemonic": "sbc", "operand": "#&81"}, {"addr": 39539, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 39540, "bytes": [173, 99, 13], "type": "code", "mnemonic": "lda", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 39543, "bytes": [106], "labels": ["loop_c9a77"], "comments_before": ["&9a77 referenced 1 time by &9a79"], "references": [39545], "type": "code", "mnemonic": "ror"}, {"addr": 39544, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 39545, "bytes": [16, 252], "type": "code", "mnemonic": "bpl", "operand": "loop_c9a77", "target": 39543, "target_label": "loop_c9a77"}, {"addr": 39547, "bytes": [144, 3], "type": "code", "mnemonic": "bcc", "operand": "c9a80", "target": 39552, "target_label": "c9a80"}, {"addr": 39549, "bytes": [76, 79, 155], "type": "code", "mnemonic": "jmp", "operand": "c9b4f", "target": 39759, "target_label": "c9b4f"}, {"addr": 39552, "bytes": [172, 63, 13], "labels": ["c9a80"], "comments_before": ["&9a80 referenced 3 times by &9a66, &9a6d, &9a7b"], "references": [39526, 39533, 39547], "type": "code", "mnemonic": "ldy", "operand": "rx_ctrl", "target": 3391, "target_label": "rx_ctrl"}, {"addr": 39555, "bytes": [185, 22, 154], "type": "code", "mnemonic": "lda", "operand": "l9a16,y", "target": 39446, "target_label": "l9a16"}, {"addr": 39558, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39559, "bytes": [185, 14, 154], "type": "code", "mnemonic": "lda", "operand": "c9a0e,y", "target": 39438, "target_label": "c9a0e"}, {"addr": 39562, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39563, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 39564, "bytes": [76, 138, 152], "labels": ["c9a8c"], "comments_before": ["&9a8c referenced 2 times by &9a5e, &9a62"], "references": [39518, 39522], "type": "code", "mnemonic": "jmp", "operand": "rx_error", "target": 39050, "target_label": "rx_error"}, {"addr": 39567, "bytes": [218, 188, 158, 158, 158, 0, 0, 199, 154, 154, 154, 154, 154, 155, 155, 154, 169, 0, 133, 164, 169, 130, 133, 162, 169, 1, 133, 163, 165, 157, 133, 165, 160, 3, 185, 65, 13, 153, 88, 13, 136, 16, 247, 76, 28, 152, 169, 61, 133, 166, 169, 13, 133, 167, 76, 251, 151, 169, 1, 133, 163, 169, 252, 133, 162, 169, 33, 133, 164, 169, 127, 133, 165, 76, 249, 154, 165, 160, 72, 165, 161, 72, 169, 61, 133, 160, 169, 13, 133, 161, 169, 2, 141, 92, 13, 32, 91, 159, 104, 133, 161, 104, 133, 160, 144, 86, 173, 74, 13, 9, 128, 141, 74, 13, 169, 68, 141, 160, 254, 169, 167, 141, 161, 254, 169, 47, 160], "type": "byte", "values": [218, 188, 158, 158, 158, 0, 0, 199, 154, 154, 154, 154, 154, 155, 155, 154, 169, 0, 133, 164, 169, 130, 133, 162, 169, 1, 133, 163, 165, 157, 133, 165, 160, 3, 185, 65, 13, 153, 88, 13, 136, 16, 247, 76, 28, 152, 169, 61, 133, 166, 169, 13, 133, 167, 76, 251, 151, 169, 1, 133, 163, 169, 252, 133, 162, 169, 33, 133, 164, 169, 127, 133, 165, 76, 249, 154, 165, 160, 72, 165, 161, 72, 169, 61, 133, 160, 169, 13, 133, 161, 169, 2, 141, 92, 13, 32, 91, 159, 104, 133, 161, 104, 133, 160, 144, 86, 173, 74, 13, 9, 128, 141, 74, 13, 169, 68, 141, 160, 254, 169, 167, 141, 161, 254, 169, 47, 160]}, {"addr": 39694, "bytes": [155, 76, 116, 153], "labels": ["l9b0e"], "comments_before": ["&9b0e referenced 1 time by &9b8c"], "references": [39820], "type": "byte", "values": [155, 76, 116, 153]}, {"addr": 39698, "bytes": [172, 63, 13], "labels": ["c9b12"], "sub_labels": {"39699": ["l9b13"]}, "comments_before": ["&9b12 referenced 1 time by &99c0", "&9b13 referenced 1 time by &9b88"], "references": [39360], "type": "code", "mnemonic": "ldy", "operand": "rx_ctrl", "target": 3391, "target_label": "rx_ctrl"}, {"addr": 39701, "bytes": [192, 130], "type": "code", "mnemonic": "cpy", "operand": "#&82"}, {"addr": 39703, "bytes": [240, 54], "type": "code", "mnemonic": "beq", "operand": "c9b4f", "target": 39759, "target_label": "c9b4f"}, {"addr": 39705, "bytes": [165, 162], "type": "code", "mnemonic": "lda", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 39707, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 39708, "bytes": [105, 128], "type": "code", "mnemonic": "adc", "operand": "#&80"}, {"addr": 39710, "bytes": [160, 127], "type": "code", "mnemonic": "ldy", "operand": "#&7f"}, {"addr": 39712, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 39714, "bytes": [160, 128], "type": "code", "mnemonic": "ldy", "operand": "#&80"}, {"addr": 39716, "bytes": [173, 61, 13], "type": "code", "mnemonic": "lda", "operand": "rx_src_stn", "target": 3389, "target_label": "rx_src_stn"}, {"addr": 39719, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 39721, "bytes": [200], "comment_inline": "Y=&81", "type": "code", "mnemonic": "iny"}, {"addr": 39722, "bytes": [173, 62, 13], "type": "code", "mnemonic": "lda", "operand": "rx_src_net", "target": 3390, "target_label": "rx_src_net"}, {"addr": 39725, "bytes": [145, 156], "type": "code", "mnemonic": "sta", "operand": "(net_rx_ptr),y", "target": 156, "target_label": "net_rx_ptr"}, {"addr": 39727, "bytes": [173, 63, 13], "type": "code", "mnemonic": "lda", "operand": "rx_ctrl", "target": 3391, "target_label": "rx_ctrl"}, {"addr": 39730, "bytes": [141, 87, 13], "type": "code", "mnemonic": "sta", "operand": "tx_work_57", "target": 3415, "target_label": "tx_work_57"}, {"addr": 39733, "bytes": [169, 132], "type": "code", "mnemonic": "lda", "operand": "#&84"}, {"addr": 39735, "bytes": [141, 78, 254], "type": "code", "mnemonic": "sta", "operand": "system_via_ier", "target": 65102, "target_label": "system_via_ier"}, {"addr": 39738, "bytes": [173, 75, 254], "type": "code", "mnemonic": "lda", "operand": "system_via_acr", "target": 65099, "target_label": "system_via_acr"}, {"addr": 39741, "bytes": [41, 28], "type": "code", "mnemonic": "and", "operand": "#&1c"}, {"addr": 39743, "bytes": [141, 81, 13], "type": "code", "mnemonic": "sta", "operand": "tx_work_51", "target": 3409, "target_label": "tx_work_51"}, {"addr": 39746, "bytes": [173, 75, 254], "type": "code", "mnemonic": "lda", "operand": "system_via_acr", "target": 65099, "target_label": "system_via_acr"}, {"addr": 39749, "bytes": [41, 227], "type": "code", "mnemonic": "and", "operand": "#&e3"}, {"addr": 39751, "bytes": [9, 8], "type": "code", "mnemonic": "ora", "operand": "#8"}, {"addr": 39753, "bytes": [141, 75, 254], "type": "code", "mnemonic": "sta", "operand": "system_via_acr", "target": 65099, "target_label": "system_via_acr"}, {"addr": 39756, "bytes": [44, 74, 254], "type": "code", "mnemonic": "bit", "operand": "system_via_sr", "target": 65098, "target_label": "system_via_sr"}, {"addr": 39759, "bytes": [76, 52, 154], "labels": ["c9b4f"], "comments_before": ["&9b4f referenced 2 times by &9a7d, &9b17"], "references": [39703, 39549], "type": "code", "mnemonic": "jmp", "operand": "discard_reset_listen", "target": 39476, "target_label": "discard_reset_listen"}, {"addr": 39762, "bytes": [169, 4], "labels": ["c9b52"], "comments_before": ["&9b52 referenced 1 time by &966c"], "references": [38508], "type": "code", "mnemonic": "lda", "operand": "#4"}, {"addr": 39764, "bytes": [44, 77, 254], "type": "code", "mnemonic": "bit", "operand": "system_via_ifr", "target": 65101, "target_label": "system_via_ifr"}, {"addr": 39767, "bytes": [208, 3], "type": "code", "mnemonic": "bne", "operand": "c9b5c", "target": 39772, "target_label": "c9b5c"}, {"addr": 39769, "bytes": [169, 5], "type": "code", "mnemonic": "lda", "operand": "#5"}, {"addr": 39771, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 39772, "bytes": [138], "labels": ["c9b5c"], "comments_before": ["&9b5c referenced 1 time by &9b57"], "references": [39767], "type": "code", "mnemonic": "txa"}, {"addr": 39773, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39774, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 39775, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39776, "bytes": [173, 75, 254], "type": "code", "mnemonic": "lda", "operand": "system_via_acr", "target": 65099, "target_label": "system_via_acr"}, {"addr": 39779, "bytes": [41, 227], "type": "code", "mnemonic": "and", "operand": "#&e3"}, {"addr": 39781, "bytes": [13, 81, 13], "type": "code", "mnemonic": "ora", "operand": "tx_work_51", "target": 3409, "target_label": "tx_work_51"}, {"addr": 39784, "bytes": [141, 75, 254], "type": "code", "mnemonic": "sta", "operand": "system_via_acr", "target": 65099, "target_label": "system_via_acr"}, {"addr": 39787, "bytes": [173, 74, 254], "type": "code", "mnemonic": "lda", "operand": "system_via_sr", "target": 65098, "target_label": "system_via_sr"}, {"addr": 39790, "bytes": [169, 4], "type": "code", "mnemonic": "lda", "operand": "#4"}, {"addr": 39792, "bytes": [141, 77, 254], "type": "code", "mnemonic": "sta", "operand": "system_via_ifr", "target": 65101, "target_label": "system_via_ifr"}, {"addr": 39795, "bytes": [141, 78, 254], "type": "code", "mnemonic": "sta", "operand": "system_via_ier", "target": 65102, "target_label": "system_via_ier"}, {"addr": 39798, "bytes": [172, 87, 13], "type": "code", "mnemonic": "ldy", "operand": "tx_work_57", "target": 3415, "target_label": "tx_work_57"}, {"addr": 39801, "bytes": [192, 134], "type": "code", "mnemonic": "cpy", "operand": "#&86"}, {"addr": 39803, "bytes": [176, 11], "type": "code", "mnemonic": "bcs", "operand": "c9b88", "target": 39816, "target_label": "c9b88"}, {"addr": 39805, "bytes": [173, 99, 13], "type": "code", "mnemonic": "lda", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 39808, "bytes": [141, 59, 13], "type": "code", "mnemonic": "sta", "operand": "rx_ctrl_copy", "target": 3387, "target_label": "rx_ctrl_copy"}, {"addr": 39811, "bytes": [9, 28], "type": "code", "mnemonic": "ora", "operand": "#&1c"}, {"addr": 39813, "bytes": [141, 99, 13], "type": "code", "mnemonic": "sta", "operand": "prot_status", "target": 3427, "target_label": "prot_status"}, {"addr": 39816, "bytes": [185, 19, 155], "labels": ["c9b88"], "comments_before": ["&9b88 referenced 1 time by &9b7b"], "references": [39803], "type": "code", "mnemonic": "lda", "operand": "l9b13,y", "target": 39699, "target_label": "l9b13"}, {"addr": 39819, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39820, "bytes": [185, 14, 155], "type": "code", "mnemonic": "lda", "operand": "l9b0e,y", "target": 39694, "target_label": "l9b0e"}, {"addr": 39823, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39824, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 39825, "bytes": [154, 163, 177, 189, 212, 155, 155, 155, 155, 155, 169, 155, 72, 169, 220], "type": "byte", "values": [154, 163, 177, 189, 212, 155, 155, 155, 155, 155, 169, 155, 72, 169, 220]}, {"addr": 39840, "bytes": [72, 108, 88], "type": "string", "string": "HlX"}, {"addr": 39843, "bytes": [13, 160, 8, 174, 88, 13, 173, 89, 13, 32, 191, 255, 76, 221, 155, 174, 88, 13, 172, 89, 13, 32, 0, 128, 76, 221, 155, 169, 4, 44, 56, 13, 208, 24, 13, 56, 13, 141, 56, 13, 169, 4], "type": "byte", "values": [13, 160, 8, 174, 88, 13, 173, 89, 13, 32, 191, 255, 76, 221, 155, 174, 88, 13, 172, 89, 13, 32, 0, 128, 76, 221, 155, 169, 4, 44, 56, 13, 208, 24, 13, 56, 13, 141, 56, 13, 169, 4]}, {"addr": 39885, "bytes": [88, 44, 56], "type": "string", "string": "X,8"}, {"addr": 39888, "bytes": [13, 208, 251, 240, 8, 173, 56, 13, 41, 251, 141, 56, 13, 104, 168, 104, 170, 169, 0, 96], "type": "byte", "values": [13, 208, 251, 240, 8, 173, 56, 13, 41, 251, 141, 56, 13, 104, 168, 104, 170, 169, 0, 96]}, {"addr": 39908, "bytes": [138], "labels": ["c9be4"], "comments_before": ["&9be4 referenced 1 time by &9660"], "references": [38496], "type": "code", "mnemonic": "txa"}, {"addr": 39909, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 39910, "bytes": [160, 2], "type": "code", "mnemonic": "ldy", "operand": "#2"}, {"addr": 39912, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 39914, "bytes": [141, 32, 13], "type": "code", "mnemonic": "sta", "operand": "tx_dst_stn", "target": 3360, "target_label": "tx_dst_stn"}, {"addr": 39917, "bytes": [200], "comment_inline": "Y=&03", "type": "code", "mnemonic": "iny"}, {"addr": 39918, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 39920, "bytes": [141, 33, 13], "type": "code", "mnemonic": "sta", "operand": "tx_dst_net", "target": 3361, "target_label": "tx_dst_net"}, {"addr": 39923, "bytes": [160, 0], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 39925, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 39927, "bytes": [48, 3], "type": "code", "mnemonic": "bmi", "operand": "c9bfc", "target": 39932, "target_label": "c9bfc"}, {"addr": 39929, "bytes": [76, 132, 156], "type": "code", "mnemonic": "jmp", "operand": "tx_active_start", "target": 40068, "target_label": "tx_active_start"}, {"addr": 39932, "bytes": [141, 36, 13], "labels": ["c9bfc"], "comments_before": ["&9bfc referenced 1 time by &9bf7"], "references": [39927], "type": "code", "mnemonic": "sta", "operand": "tx_ctrl_byte", "target": 3364, "target_label": "tx_ctrl_byte"}, {"addr": 39935, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 39936, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39937, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 39939, "bytes": [141, 37, 13], "type": "code", "mnemonic": "sta", "operand": "tx_port", "target": 3365, "target_label": "tx_port"}, {"addr": 39942, "bytes": [208, 47], "type": "code", "mnemonic": "bne", "operand": "c9c37", "target": 39991, "target_label": "c9c37"}, {"addr": 39944, "bytes": [224, 131], "type": "code", "mnemonic": "cpx", "operand": "#&83"}, {"addr": 39946, "bytes": [176, 27], "type": "code", "mnemonic": "bcs", "operand": "c9c27", "target": 39975, "target_label": "c9c27"}, {"addr": 39948, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 39949, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 39950, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 39952, "bytes": [177, 160], "labels": ["loop_c9c10"], "comments_before": ["&9c10 referenced 1 time by &9c24"], "references": [39972], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 39954, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 39955, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 39956, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 39957, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 39958, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 39959, "bytes": [241, 160], "type": "code", "mnemonic": "sbc", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 39961, "bytes": [153, 38, 13], "type": "code", "mnemonic": "sta", "operand": "tx_data_start,y", "target": 3366, "target_label": "tx_data_start"}, {"addr": 39964, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39965, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39966, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39967, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39968, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39969, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 39970, "bytes": [192, 12], "type": "code", "mnemonic": "cpy", "operand": "#&0c"}, {"addr": 39972, "bytes": [144, 234], "type": "code", "mnemonic": "bcc", "operand": "loop_c9c10", "target": 39952, "target_label": "loop_c9c10"}, {"addr": 39974, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 39975, "bytes": [224, 137], "labels": ["c9c27"], "comments_before": ["&9c27 referenced 1 time by &9c0a"], "references": [39946], "type": "code", "mnemonic": "cpx", "operand": "#&89"}, {"addr": 39977, "bytes": [176, 89], "type": "code", "mnemonic": "bcs", "operand": "tx_active_start", "target": 40068, "target_label": "tx_active_start"}, {"addr": 39979, "bytes": [160, 12], "type": "code", "mnemonic": "ldy", "operand": "#&0c"}, {"addr": 39981, "bytes": [177, 160], "labels": ["loop_c9c2d"], "comments_before": ["&9c2d referenced 1 time by &9c35"], "references": [39989], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 39983, "bytes": [153, 26, 13], "type": "code", "mnemonic": "sta", "operand": "nmi_shim_1a,y", "target": 3354, "target_label": "nmi_shim_1a"}, {"addr": 39986, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 39987, "bytes": [192, 16], "type": "code", "mnemonic": "cpy", "operand": "#&10"}, {"addr": 39989, "bytes": [144, 246], "type": "code", "mnemonic": "bcc", "operand": "loop_c9c2d", "target": 39981, "target_label": "loop_c9c2d"}, {"addr": 39991, "bytes": [169, 32], "labels": ["c9c37"], "comments_before": ["&9c37 referenced 1 time by &9c06"], "references": [39942], "type": "code", "mnemonic": "lda", "operand": "#&20"}, {"addr": 39993, "bytes": [44, 161, 254], "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 39996, "bytes": [208, 86], "type": "code", "mnemonic": "bne", "operand": "c9c94", "target": 40084, "target_label": "c9c94"}, {"addr": 39998, "bytes": [169, 253], "type": "code", "mnemonic": "lda", "operand": "#&fd"}, {"addr": 40000, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40001, "bytes": [169, 6], "type": "code", "mnemonic": "lda", "operand": "#6"}, {"addr": 40003, "bytes": [141, 80, 13], "type": "code", "mnemonic": "sta", "operand": "tx_length", "target": 3408, "target_label": "tx_length"}, {"addr": 40006, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 40008, "bytes": [141, 79, 13], "labels": ["inactive_poll"], "comments_before": ["***************************************************************************************", "INACTIVE polling loop\n\nPolls SR2 for INACTIVE (bit2) to confirm the network line is idle before\nattempting transmission. Uses a 3-byte timeout counter on the stack.\nThe timeout (~256^3 iterations) generates \"Line Jammed\" if INACTIVE\nnever appears.\nThe CTS check at &9C66-&9C6B works because CR2=&67 has RTS=0, so\ncts_input_ is always true, and SR1_CTS reflects presence of clock hardware.", "***************************************************************************************"], "type": "code", "mnemonic": "sta", "operand": "tx_index", "target": 3407, "target_label": "tx_index"}, {"addr": 40011, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40012, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40013, "bytes": [160, 231], "comment_inline": "Y=&E7: CR2 value for TX prep (RTS|CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)", "type": "code", "mnemonic": "ldy", "operand": "#&e7"}, {"addr": 40015, "bytes": [169, 4], "labels": ["c9c4f"], "comments_before": ["&9c4f referenced 3 times by &9c75, &9c7a, &9c7f"], "comment_inline": "A=&04: INACTIVE mask for SR2 bit2", "references": [40053, 40058, 40063], "type": "code", "mnemonic": "lda", "operand": "#4"}, {"addr": 40017, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 40018, "bytes": [120], "type": "code", "mnemonic": "sei"}, {"addr": 40019, "bytes": [44, 24, 254], "labels": ["c9c53"], "comments_before": ["&9c53 referenced 1 time by &9ccf"], "comment_inline": "INTOFF -- disable NMIs", "references": [40143], "type": "code", "mnemonic": "bit", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 40022, "bytes": [44, 24, 254], "comment_inline": "INTOFF again (belt-and-braces)", "type": "code", "mnemonic": "bit", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 40025, "bytes": [44, 161, 254], "labels": ["sub_c9c59"], "sub_labels": {"40027": ["l9c5b"]}, "comments_before": ["&9c5b referenced 1 time by &9ccb"], "comment_inline": "BIT SR2: Z = &04 AND SR2 -- tests INACTIVE", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40028, "bytes": [240, 15], "comment_inline": "INACTIVE not set -- re-enable NMIs and loop", "type": "code", "mnemonic": "beq", "operand": "c9c6d", "target": 40045, "target_label": "c9c6d"}, {"addr": 40030, "bytes": [173, 160, 254], "comment_inline": "Read SR1 (acknowledge pending interrupt)", "type": "code", "mnemonic": "lda", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40033, "bytes": [169, 103], "comment_inline": "CR2=&67: CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE", "type": "code", "mnemonic": "lda", "operand": "#&67"}, {"addr": 40035, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40038, "bytes": [169, 16], "comment_inline": "A=&10: CTS mask for SR1 bit4", "type": "code", "mnemonic": "lda", "operand": "#&10"}, {"addr": 40040, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: tests CTS present", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40043, "bytes": [208, 53], "comment_inline": "CTS set -- clock hardware detected, start TX", "type": "code", "mnemonic": "bne", "operand": "tx_prepare", "target": 40098, "target_label": "tx_prepare"}, {"addr": 40045, "bytes": [44, 32, 254], "labels": ["c9c6d"], "comments_before": ["&9c6d referenced 1 time by &9c5c"], "comment_inline": "INTON -- re-enable NMIs (&FE20 read)", "references": [40028], "type": "code", "mnemonic": "bit", "operand": "video_ula_control", "target": 65056, "target_label": "video_ula_control"}, {"addr": 40048, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 40049, "bytes": [186], "comment_inline": "3-byte timeout counter on stack", "type": "code", "mnemonic": "tsx"}, {"addr": 40050, "bytes": [254, 1, 1], "type": "code", "mnemonic": "inc", "operand": "l0101,x", "target": 257, "target_label": "l0101"}, {"addr": 40053, "bytes": [208, 216], "type": "code", "mnemonic": "bne", "operand": "c9c4f", "target": 40015, "target_label": "c9c4f"}, {"addr": 40055, "bytes": [254, 2, 1], "type": "code", "mnemonic": "inc", "operand": "l0102,x", "target": 258, "target_label": "l0102"}, {"addr": 40058, "bytes": [208, 211], "type": "code", "mnemonic": "bne", "operand": "c9c4f", "target": 40015, "target_label": "c9c4f"}, {"addr": 40060, "bytes": [254, 3, 1], "type": "code", "mnemonic": "inc", "operand": "l0103,x", "target": 259, "target_label": "l0103"}, {"addr": 40063, "bytes": [208, 206], "type": "code", "mnemonic": "bne", "operand": "c9c4f", "target": 40015, "target_label": "c9c4f"}, {"addr": 40065, "bytes": [76, 136, 156], "type": "code", "mnemonic": "jmp", "operand": "tx_line_jammed", "target": 40072, "target_label": "tx_line_jammed"}, {"addr": 40068, "bytes": [169, 68], "labels": ["tx_active_start"], "comments_before": ["TX_ACTIVE branch (A=&44 = CR1 value for TX active)", "&9c84 referenced 2 times by &9bf9, &9c29"], "references": [39929, 39977], "type": "code", "mnemonic": "lda", "operand": "#&44"}, {"addr": 40070, "bytes": [208, 14], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c9c96", "target": 40086, "target_label": "c9c96"}, {"addr": 40072, "bytes": [169, 7], "labels": ["tx_line_jammed"], "comments_before": ["***************************************************************************************", "Timeout error: writes CR2=&07 to abort, cleans stack,\n\nreturns error &40 (\"Line Jammed\").", "***************************************************************************************", "&9c88 referenced 1 time by &9c81"], "comment_inline": "CR2=&07: FC_TDRA | 2_1_BYTE | PSE (abort TX)", "references": [40065], "type": "code", "mnemonic": "lda", "operand": "#7"}, {"addr": 40074, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40077, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40078, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40079, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40080, "bytes": [169, 64], "comment_inline": "Error &40 = 'Line Jammed'", "type": "code", "mnemonic": "lda", "operand": "#&40"}, {"addr": 40082, "bytes": [208, 2], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c9c96", "target": 40086, "target_label": "c9c96"}, {"addr": 40084, "bytes": [169, 67], "labels": ["c9c94"], "comments_before": ["&9c94 referenced 1 time by &9c3c"], "references": [39996], "type": "code", "mnemonic": "lda", "operand": "#&43"}, {"addr": 40086, "bytes": [160, 0], "labels": ["c9c96"], "comments_before": ["&9c96 referenced 2 times by &9c86, &9c92"], "references": [40082, 40070], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 40088, "bytes": [145, 160], "type": "code", "mnemonic": "sta", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40090, "bytes": [169, 128], "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 40092, "bytes": [141, 58, 13], "type": "code", "mnemonic": "sta", "operand": "tx_ctrl_status", "target": 3386, "target_label": "tx_ctrl_status"}, {"addr": 40095, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40096, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 40097, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 40098, "bytes": [140, 161, 254], "labels": ["tx_prepare"], "comments_before": ["***************************************************************************************", "TX preparation\n\nConfigures ADLC for transmission: asserts RTS via CR2, enables TIE via CR1,\ninstalls NMI TX handler at &9D4C, and re-enables NMIs.", "***************************************************************************************", "&9ca2 referenced 1 time by &9c6b"], "comment_inline": "Write CR2 = Y (&E7: RTS|CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)", "references": [40043], "type": "code", "mnemonic": "sty", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40101, "bytes": [162, 68], "comment_inline": "CR1=&44: RX_RESET | TIE (TX active, TX interrupts enabled)", "type": "code", "mnemonic": "ldx", "operand": "#&44"}, {"addr": 40103, "bytes": [142, 160, 254], "type": "code", "mnemonic": "stx", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40106, "bytes": [162, 76], "comment_inline": "Install NMI handler at &9D4C (TX data handler)", "type": "code", "mnemonic": "ldx", "operand": "#&4c"}, {"addr": 40108, "bytes": [160, 157], "type": "code", "mnemonic": "ldy", "operand": "#&9d"}, {"addr": 40110, "bytes": [142, 12, 13], "type": "code", "mnemonic": "stx", "operand": "nmi_jmp_lo", "target": 3340, "target_label": "nmi_jmp_lo"}, {"addr": 40113, "bytes": [140, 13, 13], "type": "code", "mnemonic": "sty", "operand": "nmi_jmp_hi", "target": 3341, "target_label": "nmi_jmp_hi"}, {"addr": 40116, "bytes": [44, 32, 254], "comment_inline": "INTON -- NMIs now fire for TDRA (&FE20 read)", "type": "code", "mnemonic": "bit", "operand": "video_ula_control", "target": 65056, "target_label": "video_ula_control"}, {"addr": 40119, "bytes": [173, 37, 13], "type": "code", "mnemonic": "lda", "operand": "tx_port", "target": 3365, "target_label": "tx_port"}, {"addr": 40122, "bytes": [208, 90], "type": "code", "mnemonic": "bne", "operand": "c9d16", "target": 40214, "target_label": "c9d16"}, {"addr": 40124, "bytes": [172, 36, 13], "type": "code", "mnemonic": "ldy", "operand": "tx_ctrl_byte", "target": 3364, "target_label": "tx_ctrl_byte"}, {"addr": 40127, "bytes": [185, 210, 158], "type": "code", "mnemonic": "lda", "operand": "l9ed2,y", "target": 40658, "target_label": "l9ed2"}, {"addr": 40130, "bytes": [141, 74, 13], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40133, "bytes": [185, 202, 158], "type": "code", "mnemonic": "lda", "operand": "l9eca,y", "target": 40650, "target_label": "l9eca"}, {"addr": 40136, "bytes": [141, 80, 13], "type": "code", "mnemonic": "sta", "operand": "tx_length", "target": 3408, "target_label": "tx_length"}, {"addr": 40139, "bytes": [185, 91, 156], "type": "code", "mnemonic": "lda", "operand": "l9c5b,y", "target": 40027, "target_label": "l9c5b"}, {"addr": 40142, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40143, "bytes": [185, 83, 156], "type": "code", "mnemonic": "lda", "operand": "c9c53,y", "target": 40019, "target_label": "c9c53"}, {"addr": 40146, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40147, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 40148, "bytes": [231, 235, 10, 10, 10, 68, 68, 227, 156, 156, 157, 157, 157, 157, 157, 156, 169, 3, 208, 37, 169, 3, 208, 2, 169, 2, 141, 92, 13, 24, 8, 160, 12, 185, 30, 13, 40, 113, 160, 153, 30, 13, 200, 8, 192, 16, 144, 241], "type": "byte", "values": [231, 235, 10, 10, 10, 68, 68, 227, 156, 156, 157, 157, 157, 157, 157, 156, 169, 3, 208, 37, 169, 3, 208, 2, 169, 2, 141, 92, 13, 24, 8, 160, 12, 185, 30, 13, 40, 113, 160, 153, 30, 13, 200, 8, 192, 16, 144, 241]}, {"addr": 40196, "bytes": [40, 32, 91], "type": "string", "string": "( ["}, {"addr": 40199, "bytes": [159, 76, 69, 157, 169, 2, 141, 92, 13, 32, 91, 159, 76, 69, 157], "type": "byte", "values": [159, 76, 69, 157, 169, 2, 141, 92, 13, 32, 91, 159, 76, 69, 157]}, {"addr": 40214, "bytes": [173, 32, 13], "labels": ["c9d16"], "comments_before": ["&9d16 referenced 1 time by &9cba"], "references": [40122], "type": "code", "mnemonic": "lda", "operand": "tx_dst_stn", "target": 3360, "target_label": "tx_dst_stn"}, {"addr": 40217, "bytes": [45, 33, 13], "type": "code", "mnemonic": "and", "operand": "tx_dst_net", "target": 3361, "target_label": "tx_dst_net"}, {"addr": 40220, "bytes": [201, 255], "type": "code", "mnemonic": "cmp", "operand": "#&ff"}, {"addr": 40222, "bytes": [208, 24], "type": "code", "mnemonic": "bne", "operand": "c9d38", "target": 40248, "target_label": "c9d38"}, {"addr": 40224, "bytes": [169, 14], "type": "code", "mnemonic": "lda", "operand": "#&0e"}, {"addr": 40226, "bytes": [141, 80, 13], "type": "code", "mnemonic": "sta", "operand": "tx_length", "target": 3408, "target_label": "tx_length"}, {"addr": 40229, "bytes": [169, 64], "type": "code", "mnemonic": "lda", "operand": "#&40"}, {"addr": 40231, "bytes": [141, 74, 13], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40234, "bytes": [160, 4], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 40236, "bytes": [177, 160], "labels": ["loop_c9d2c"], "comments_before": ["&9d2c referenced 1 time by &9d34"], "references": [40244], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40238, "bytes": [153, 34, 13], "type": "code", "mnemonic": "sta", "operand": "tx_src_stn,y", "target": 3362, "target_label": "tx_src_stn"}, {"addr": 40241, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40242, "bytes": [192, 12], "type": "code", "mnemonic": "cpy", "operand": "#&0c"}, {"addr": 40244, "bytes": [144, 246], "type": "code", "mnemonic": "bcc", "operand": "loop_c9d2c", "target": 40236, "target_label": "loop_c9d2c"}, {"addr": 40246, "bytes": [176, 13], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bcs", "operand": "c9d45", "target": 40261, "target_label": "c9d45"}, {"addr": 40248, "bytes": [169, 0], "labels": ["c9d38"], "comments_before": ["&9d38 referenced 1 time by &9d1e"], "references": [40222], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 40250, "bytes": [141, 74, 13], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40253, "bytes": [169, 2], "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 40255, "bytes": [141, 92, 13], "type": "code", "mnemonic": "sta", "operand": "scout_status", "target": 3420, "target_label": "scout_status"}, {"addr": 40258, "bytes": [32, 91, 159], "type": "code", "mnemonic": "jsr", "operand": "tx_calc_transfer", "target": 40795, "target_label": "tx_calc_transfer"}, {"addr": 40261, "bytes": [40], "labels": ["c9d45"], "comments_before": ["&9d45 referenced 1 time by &9d36"], "references": [40246], "type": "code", "mnemonic": "plp"}, {"addr": 40262, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40263, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40264, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40265, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40266, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 40267, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 40268, "bytes": [172, 79, 13], "labels": ["nmi_tx_data"], "comments_before": ["***************************************************************************************", "NMI TX data handler\n\nWrites 2 bytes per NMI invocation to the TX FIFO at &FEA2. Uses the\nBIT instruction on SR1 to test TDRA (V flag = bit6) and IRQ (N flag = bit7).\nAfter writing 2 bytes, checks if the frame is complete. If more data,\ntests SR1 bit7 (IRQ) via BMI -- if IRQ still asserted, writes 2 more bytes\nwithout returning from NMI (tight loop). Otherwise returns via RTI.", "***************************************************************************************"], "comment_inline": "Load TX buffer index", "type": "code", "mnemonic": "ldy", "operand": "tx_index", "target": 3407, "target_label": "tx_index"}, {"addr": 40271, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: V=bit6(TDRA), N=bit7(IRQ)", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40274, "bytes": [80, 34], "labels": ["loop_c9d52"], "comments_before": ["&9d52 referenced 1 time by &9d6d"], "comment_inline": "TDRA not set -- TX error", "references": [40301], "type": "code", "mnemonic": "bvc", "operand": "c9d76", "target": 40310, "target_label": "c9d76"}, {"addr": 40276, "bytes": [185, 32, 13], "comment_inline": "Load byte from TX buffer", "type": "code", "mnemonic": "lda", "operand": "tx_dst_stn,y", "target": 3360, "target_label": "tx_dst_stn"}, {"addr": 40279, "bytes": [141, 162, 254], "comment_inline": "Write to TX_DATA (continue frame)", "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40282, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40283, "bytes": [185, 32, 13], "type": "code", "mnemonic": "lda", "operand": "tx_dst_stn,y", "target": 3360, "target_label": "tx_dst_stn"}, {"addr": 40286, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40287, "bytes": [140, 79, 13], "type": "code", "mnemonic": "sty", "operand": "tx_index", "target": 3407, "target_label": "tx_index"}, {"addr": 40290, "bytes": [141, 162, 254], "comment_inline": "Write second byte to TX_DATA", "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40293, "bytes": [204, 80, 13], "comment_inline": "Compare index to TX length", "type": "code", "mnemonic": "cpy", "operand": "tx_length", "target": 3408, "target_label": "tx_length"}, {"addr": 40296, "bytes": [176, 30], "comment_inline": "Frame complete -- go to TX_LAST_DATA", "type": "code", "mnemonic": "bcs", "operand": "tx_last_data", "target": 40328, "target_label": "tx_last_data"}, {"addr": 40298, "bytes": [44, 160, 254], "comment_inline": "Check if we can send another pair", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40301, "bytes": [48, 227], "comment_inline": "IRQ set -- send 2 more bytes (tight loop)", "type": "code", "mnemonic": "bmi", "operand": "loop_c9d52", "target": 40274, "target_label": "loop_c9d52"}, {"addr": 40303, "bytes": [76, 20, 13], "comment_inline": "RTI -- wait for next NMI", "type": "code", "mnemonic": "jmp", "operand": "nmi_rti", "target": 3348, "target_label": "nmi_rti"}, {"addr": 40306, "bytes": [169, 66], "labels": ["tx_error"], "comments_before": ["TX error path", "&9d72 referenced 1 time by &9db7"], "comment_inline": "Error &42", "references": [40375], "type": "code", "mnemonic": "lda", "operand": "#&42"}, {"addr": 40308, "bytes": [208, 7], "comment_inline": "ALWAYS branch", "type": "code", "mnemonic": "bne", "operand": "c9d7d", "target": 40317, "target_label": "c9d7d"}, {"addr": 40310, "bytes": [169, 103], "labels": ["c9d76"], "comments_before": ["&9d76 referenced 1 time by &9d52"], "comment_inline": "CR2=&67: clear status, return to listen", "references": [40274], "type": "code", "mnemonic": "lda", "operand": "#&67"}, {"addr": 40312, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40315, "bytes": [169, 65], "comment_inline": "Error &41 (TDRA not ready)", "type": "code", "mnemonic": "lda", "operand": "#&41"}, {"addr": 40317, "bytes": [172, 24, 254], "labels": ["c9d7d"], "comments_before": ["&9d7d referenced 1 time by &9d74"], "comment_inline": "INTOFF (also loads station ID)", "references": [40308], "type": "code", "mnemonic": "ldy", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 40320, "bytes": [72], "labels": ["loop_c9d80"], "comments_before": ["&9d80 referenced 1 time by &9d83"], "comment_inline": "PHA/PLA delay loop (256 iterations for NMI disable)", "references": [40323], "type": "code", "mnemonic": "pha"}, {"addr": 40321, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40322, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40323, "bytes": [208, 251], "type": "code", "mnemonic": "bne", "operand": "loop_c9d80", "target": 40320, "target_label": "loop_c9d80"}, {"addr": 40325, "bytes": [76, 63, 159], "comment_inline": "Jump to error handler", "type": "code", "mnemonic": "jmp", "operand": "tx_store_result", "target": 40767, "target_label": "tx_store_result"}, {"addr": 40328, "bytes": [169, 63], "labels": ["tx_last_data"], "comments_before": ["***************************************************************************************", "TX_LAST_DATA and frame completion\n\nSignals end of TX frame by writing CR2=&3F (TX_LAST_DATA). Then installs\nthe TX completion NMI handler at &9D94 which switches to RX mode.\nCR2=&3F = 0011_1111:\n  bit5: CLR_RX_ST -- clears fv_stored_ (prepares for RX of reply)\n  bit4: TX_LAST_DATA -- tells ADLC this is the final data byte\n  bit3: FLAG_IDLE -- send flags/idle after frame\n  bit2: FC_TDRA -- force clear TDRA\n  bit1: 2_1_BYTE -- two-byte transfer mode\n  bit0: PSE -- prioritised status enable\nNote: NO CLR_TX_ST (bit6=0), NO RTS (bit7=0 -- drops RTS after frame)", "***************************************************************************************", "&9d88 referenced 1 time by &9d68"], "comment_inline": "CR2=&3F: TX_LAST_DATA | CLR_RX_ST | FLAG_IDLE | FC_TDRA | 2_1_BYTE | PSE", "references": [40296], "type": "code", "mnemonic": "lda", "operand": "#&3f"}, {"addr": 40330, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40333, "bytes": [169, 148], "comment_inline": "Install NMI handler at &9D94 (TX completion)", "type": "code", "mnemonic": "lda", "operand": "#&94"}, {"addr": 40335, "bytes": [160, 157], "type": "code", "mnemonic": "ldy", "operand": "#&9d"}, {"addr": 40337, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40340, "bytes": [169, 130], "labels": ["nmi_tx_complete"], "comments_before": ["***************************************************************************************", "TX completion: switch to RX mode\n\nCalled via NMI after the frame (including CRC and closing flag) has been\nfully transmitted. Switches from TX mode to RX mode by writing CR1=&82.\nCR1=&82 = 1000_0010: TX_RESET | RIE (listen for reply).\nChecks workspace flags to decide next action:\n  - bit6 set at &0D4A -> completion at &9F39\n  - bit0 set at &0D4A -> four-way handshake data phase at &9EDD\n  - Otherwise -> install RX reply handler at &9DB2", "***************************************************************************************"], "comment_inline": "CR1=&82: TX_RESET | RIE (now in RX mode)", "type": "code", "mnemonic": "lda", "operand": "#&82"}, {"addr": 40342, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40345, "bytes": [44, 74, 13], "comment_inline": "Test workspace flags", "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40348, "bytes": [80, 3], "comment_inline": "bit6 not set -- check bit0", "type": "code", "mnemonic": "bvc", "operand": "c9da1", "target": 40353, "target_label": "c9da1"}, {"addr": 40350, "bytes": [76, 57, 159], "comment_inline": "bit6 set -- TX completion", "type": "code", "mnemonic": "jmp", "operand": "tx_result_ok", "target": 40761, "target_label": "tx_result_ok"}, {"addr": 40353, "bytes": [169, 1], "labels": ["c9da1"], "comments_before": ["&9da1 referenced 1 time by &9d9c"], "references": [40348], "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 40355, "bytes": [44, 74, 13], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40358, "bytes": [240, 3], "type": "code", "mnemonic": "beq", "operand": "c9dab", "target": 40363, "target_label": "c9dab"}, {"addr": 40360, "bytes": [76, 221, 158], "comment_inline": "bit0 set -- four-way handshake data phase", "type": "code", "mnemonic": "jmp", "operand": "handshake_await_ack", "target": 40669, "target_label": "handshake_await_ack"}, {"addr": 40363, "bytes": [169, 178], "labels": ["c9dab"], "comments_before": ["&9dab referenced 1 time by &9da6"], "comment_inline": "Install RX reply handler at &9DB2", "references": [40358], "type": "code", "mnemonic": "lda", "operand": "#&b2"}, {"addr": 40365, "bytes": [160, 157], "type": "code", "mnemonic": "ldy", "operand": "#&9d"}, {"addr": 40367, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40370, "bytes": [169, 1], "labels": ["nmi_reply_scout"], "comments_before": ["***************************************************************************************", "RX reply scout handler\n\nHandles reception of the reply scout frame after transmission.\nChecks SR2 bit0 (AP) for incoming data, reads the first byte\n(destination station) and compares to our station ID via &FE18\n(which also disables NMIs as a side effect).", "***************************************************************************************"], "comment_inline": "A=&01: AP mask for SR2", "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 40372, "bytes": [44, 161, 254], "comment_inline": "BIT SR2: test AP (Address Present)", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40375, "bytes": [240, 185], "comment_inline": "No AP -- error", "type": "code", "mnemonic": "beq", "operand": "tx_error", "target": 40306, "target_label": "tx_error"}, {"addr": 40377, "bytes": [173, 162, 254], "comment_inline": "Read RX byte (destination station)", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40380, "bytes": [205, 24, 254], "comment_inline": "Compare to our station ID (INTOFF side effect)", "type": "code", "mnemonic": "cmp", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 40383, "bytes": [208, 29], "comment_inline": "Not our station -- error/reject", "type": "code", "mnemonic": "bne", "operand": "reply_error", "target": 40414, "target_label": "reply_error"}, {"addr": 40385, "bytes": [169, 200], "comment_inline": "Install next handler at &9DC8 (reply continuation)", "type": "code", "mnemonic": "lda", "operand": "#&c8"}, {"addr": 40387, "bytes": [160, 157], "type": "code", "mnemonic": "ldy", "operand": "#&9d"}, {"addr": 40389, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40392, "bytes": [44, 161, 254], "labels": ["nmi_reply_cont"], "comments_before": ["***************************************************************************************", "RX reply continuation handler\n\nReads the second byte of the reply scout (destination network) and\nvalidates it is zero (local network). Installs &9DE3 for the\nremaining two bytes (source station and network).\nOptimisation: checks SR1 bit7 (IRQ still asserted) via BMI at &9DD9.\nIf IRQ is still set, falls through directly to &9DE3 without an RTI,\navoiding NMI re-entry overhead for short frames where all bytes arrive\nin quick succession.", "***************************************************************************************"], "comment_inline": "BIT SR2: test for RDA (bit7 = data available)", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40395, "bytes": [16, 17], "comment_inline": "No RDA -- error", "type": "code", "mnemonic": "bpl", "operand": "reply_error", "target": 40414, "target_label": "reply_error"}, {"addr": 40397, "bytes": [173, 162, 254], "comment_inline": "Read destination network byte", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40400, "bytes": [208, 12], "comment_inline": "Non-zero -- network mismatch, error", "type": "code", "mnemonic": "bne", "operand": "reply_error", "target": 40414, "target_label": "reply_error"}, {"addr": 40402, "bytes": [169, 227], "comment_inline": "Install next handler at &9DE3 (reply validation)", "type": "code", "mnemonic": "lda", "operand": "#&e3"}, {"addr": 40404, "bytes": [160, 157], "type": "code", "mnemonic": "ldy", "operand": "#&9d"}, {"addr": 40406, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: test IRQ (N=bit7) -- more data ready?", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40409, "bytes": [48, 8], "comment_inline": "IRQ set -- fall through to &9DE3 without RTI", "type": "code", "mnemonic": "bmi", "operand": "nmi_reply_validate", "target": 40419, "target_label": "nmi_reply_validate"}, {"addr": 40411, "bytes": [76, 14, 13], "comment_inline": "IRQ not set -- install handler and RTI", "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40414, "bytes": [169, 65], "labels": ["reply_error"], "comments_before": ["&9dde referenced 7 times by &9dbf, &9dcb, &9dd0, &9de6, &9dee, &9df6, &9dfd"], "references": [40395, 40422, 40400, 40430, 40383, 40438, 40445], "type": "code", "mnemonic": "lda", "operand": "#&41"}, {"addr": 40416, "bytes": [76, 63, 159], "type": "code", "mnemonic": "jmp", "operand": "tx_store_result", "target": 40767, "target_label": "tx_store_result"}, {"addr": 40419, "bytes": [44, 161, 254], "labels": ["nmi_reply_validate"], "comments_before": ["***************************************************************************************", "RX reply validation (Path 2 for FV/PSE interaction)\n\nReads the source station and source network from the reply scout and\nvalidates them against the original TX destination (&0D20/&0D21).\nSequence:\n  1. Check SR2 bit7 (RDA) at &9DE3 -- must see data available\n  2. Read source station at &9DE8, compare to &0D20 (tx_dst_stn)\n  3. Read source network at &9DF0, compare to &0D21 (tx_dst_net)\n  4. Check SR2 bit1 (FV) at &9DFA -- must see frame complete\nIf all checks pass, the reply scout is valid and the ROM proceeds\nto send the scout ACK (CR2=&A7 for RTS, CR1=&44 for TX mode).", "***************************************************************************************", "&9de3 referenced 1 time by &9dd9"], "comment_inline": "BIT SR2: test RDA (bit7). Must be set for valid reply.", "references": [40409], "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40422, "bytes": [16, 246], "comment_inline": "No RDA -- error (FV masking RDA via PSE would cause this)", "type": "code", "mnemonic": "bpl", "operand": "reply_error", "target": 40414, "target_label": "reply_error"}, {"addr": 40424, "bytes": [173, 162, 254], "comment_inline": "Read source station", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40427, "bytes": [205, 32, 13], "comment_inline": "Compare to original TX destination station (&0D20)", "type": "code", "mnemonic": "cmp", "operand": "tx_dst_stn", "target": 3360, "target_label": "tx_dst_stn"}, {"addr": 40430, "bytes": [208, 238], "comment_inline": "Mismatch -- not the expected reply, error", "type": "code", "mnemonic": "bne", "operand": "reply_error", "target": 40414, "target_label": "reply_error"}, {"addr": 40432, "bytes": [173, 162, 254], "comment_inline": "Read source network", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40435, "bytes": [205, 33, 13], "comment_inline": "Compare to original TX destination network (&0D21)", "type": "code", "mnemonic": "cmp", "operand": "tx_dst_net", "target": 3361, "target_label": "tx_dst_net"}, {"addr": 40438, "bytes": [208, 230], "comment_inline": "Mismatch -- error", "type": "code", "mnemonic": "bne", "operand": "reply_error", "target": 40414, "target_label": "reply_error"}, {"addr": 40440, "bytes": [169, 2], "comment_inline": "A=&02: FV mask for SR2 bit1", "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 40442, "bytes": [44, 161, 254], "comment_inline": "BIT SR2: test FV -- frame must be complete", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40445, "bytes": [240, 223], "comment_inline": "No FV -- incomplete frame, error", "type": "code", "mnemonic": "beq", "operand": "reply_error", "target": 40414, "target_label": "reply_error"}, {"addr": 40447, "bytes": [169, 167], "comment_inline": "CR2=&A7: RTS|CLR_TX_ST|FC_TDRA|2_1_BYTE|PSE (TX in handshake)", "type": "code", "mnemonic": "lda", "operand": "#&a7"}, {"addr": 40449, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40452, "bytes": [169, 68], "comment_inline": "CR1=&44: RX_RESET | TIE (TX active for scout ACK)", "type": "code", "mnemonic": "lda", "operand": "#&44"}, {"addr": 40454, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40457, "bytes": [169, 221], "comment_inline": "Install next handler at &9EDD (four-way data phase) into &0D4B/&0D4C", "type": "code", "mnemonic": "lda", "operand": "#&dd"}, {"addr": 40459, "bytes": [160, 158], "type": "code", "mnemonic": "ldy", "operand": "#&9e"}, {"addr": 40461, "bytes": [141, 75, 13], "type": "code", "mnemonic": "sta", "operand": "nmi_next_lo", "target": 3403, "target_label": "nmi_next_lo"}, {"addr": 40464, "bytes": [140, 76, 13], "type": "code", "mnemonic": "sty", "operand": "nmi_next_hi", "target": 3404, "target_label": "nmi_next_hi"}, {"addr": 40467, "bytes": [173, 32, 13], "comment_inline": "Load dest station for scout ACK TX", "type": "code", "mnemonic": "lda", "operand": "tx_dst_stn", "target": 3360, "target_label": "tx_dst_stn"}, {"addr": 40470, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: test TDRA (V=bit6)", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40473, "bytes": [80, 115], "comment_inline": "TDRA not ready -- error", "type": "code", "mnemonic": "bvc", "operand": "data_tx_error", "target": 40590, "target_label": "data_tx_error"}, {"addr": 40475, "bytes": [141, 162, 254], "comment_inline": "Write dest station to TX FIFO", "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40478, "bytes": [173, 33, 13], "comment_inline": "Write dest network to TX FIFO", "type": "code", "mnemonic": "lda", "operand": "tx_dst_net", "target": 3361, "target_label": "tx_dst_net"}, {"addr": 40481, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40484, "bytes": [169, 43], "comment_inline": "Install handler at &9E2B (write src addr for scout ACK)", "type": "code", "mnemonic": "lda", "operand": "#&2b"}, {"addr": 40486, "bytes": [160, 158], "type": "code", "mnemonic": "ldy", "operand": "#&9e"}, {"addr": 40488, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40491, "bytes": [173, 24, 254], "labels": ["nmi_scout_ack_src"], "comments_before": ["***************************************************************************************", "TX scout ACK: write source address\n\nWrites our station ID and network=0 to TX FIFO, completing the\n4-byte scout ACK frame. Then proceeds to send the data frame.", "***************************************************************************************"], "comment_inline": "Load our station ID (also INTOFF)", "type": "code", "mnemonic": "lda", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 40494, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: test TDRA", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40497, "bytes": [80, 91], "comment_inline": "TDRA not ready -- error", "type": "code", "mnemonic": "bvc", "operand": "data_tx_error", "target": 40590, "target_label": "data_tx_error"}, {"addr": 40499, "bytes": [141, 162, 254], "comment_inline": "Write our station to TX FIFO", "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40502, "bytes": [169, 0], "comment_inline": "Write network=0 to TX FIFO", "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 40504, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40507, "bytes": [169, 2], "labels": ["data_tx_begin"], "comments_before": ["&9e3b referenced 1 time by &99b5"], "references": [39349], "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 40509, "bytes": [44, 74, 13], "type": "code", "mnemonic": "bit", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40512, "bytes": [208, 7], "type": "code", "mnemonic": "bne", "operand": "c9e49", "target": 40521, "target_label": "c9e49"}, {"addr": 40514, "bytes": [169, 80], "type": "code", "mnemonic": "lda", "operand": "#&50"}, {"addr": 40516, "bytes": [160, 158], "type": "code", "mnemonic": "ldy", "operand": "#&9e"}, {"addr": 40518, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40521, "bytes": [169, 164], "labels": ["c9e49"], "comments_before": ["&9e49 referenced 1 time by &9e40"], "references": [40512], "type": "code", "mnemonic": "lda", "operand": "#&a4"}, {"addr": 40523, "bytes": [160, 158], "type": "code", "mnemonic": "ldy", "operand": "#&9e"}, {"addr": 40525, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40528, "bytes": [164, 162], "labels": ["nmi_data_tx"], "comments_before": ["***************************************************************************************", "TX data phase: send payload\n\nSends the data frame payload from (open_port_buf),Y in pairs per NMI.\nSame pattern as the NMI TX handler at &9D4C but reads from the port\nbuffer instead of the TX workspace. Writes two bytes per iteration,\nchecking SR1 IRQ between pairs for tight looping.", "***************************************************************************************"], "comment_inline": "Y = buffer offset, resume from last position", "type": "code", "mnemonic": "ldy", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 40530, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: test TDRA (V=bit6)", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40533, "bytes": [80, 55], "labels": ["c9e55"], "comments_before": ["&9e55 referenced 1 time by &9e78"], "comment_inline": "TDRA not ready -- error", "references": [40568], "type": "code", "mnemonic": "bvc", "operand": "data_tx_error", "target": 40590, "target_label": "data_tx_error"}, {"addr": 40535, "bytes": [177, 164], "comment_inline": "Write data byte to TX FIFO", "type": "code", "mnemonic": "lda", "operand": "(open_port_buf),y", "target": 164, "target_label": "open_port_buf"}, {"addr": 40537, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40540, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40541, "bytes": [208, 6], "type": "code", "mnemonic": "bne", "operand": "c9e65", "target": 40549, "target_label": "c9e65"}, {"addr": 40543, "bytes": [198, 163], "type": "code", "mnemonic": "dec", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 40545, "bytes": [240, 26], "type": "code", "mnemonic": "beq", "operand": "data_tx_last", "target": 40573, "target_label": "data_tx_last"}, {"addr": 40547, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 40549, "bytes": [177, 164], "labels": ["c9e65"], "comments_before": ["&9e65 referenced 1 time by &9e5d"], "references": [40541], "type": "code", "mnemonic": "lda", "operand": "(open_port_buf),y", "target": 164, "target_label": "open_port_buf"}, {"addr": 40551, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40554, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40555, "bytes": [132, 162], "type": "code", "mnemonic": "sty", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 40557, "bytes": [208, 6], "type": "code", "mnemonic": "bne", "operand": "c9e75", "target": 40565, "target_label": "c9e75"}, {"addr": 40559, "bytes": [198, 163], "type": "code", "mnemonic": "dec", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 40561, "bytes": [240, 10], "type": "code", "mnemonic": "beq", "operand": "data_tx_last", "target": 40573, "target_label": "data_tx_last"}, {"addr": 40563, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 40565, "bytes": [44, 160, 254], "labels": ["c9e75"], "comments_before": ["&9e75 referenced 1 time by &9e6d"], "references": [40557], "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40568, "bytes": [48, 219], "type": "code", "mnemonic": "bmi", "operand": "c9e55", "target": 40533, "target_label": "c9e55"}, {"addr": 40570, "bytes": [76, 20, 13], "type": "code", "mnemonic": "jmp", "operand": "nmi_rti", "target": 3348, "target_label": "nmi_rti"}, {"addr": 40573, "bytes": [169, 63], "labels": ["data_tx_last"], "comments_before": ["&9e7d referenced 4 times by &9e61, &9e71, &9ebd, &9ed3"], "comment_inline": "CR2=&3F: TX_LAST_DATA (close data frame)", "references": [40545, 40637, 40561, 40659], "type": "code", "mnemonic": "lda", "operand": "#&3f"}, {"addr": 40575, "bytes": [141, 161, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40578, "bytes": [173, 74, 13], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40581, "bytes": [16, 20], "type": "code", "mnemonic": "bpl", "operand": "install_saved_handler", "target": 40603, "target_label": "install_saved_handler"}, {"addr": 40583, "bytes": [169, 52], "type": "code", "mnemonic": "lda", "operand": "#&34"}, {"addr": 40585, "bytes": [160, 154], "type": "code", "mnemonic": "ldy", "operand": "#&9a"}, {"addr": 40587, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40590, "bytes": [173, 74, 13], "labels": ["data_tx_error"], "comments_before": ["&9e8e referenced 4 times by &9e19, &9e31, &9e55, &9ea7"], "references": [40615, 40497, 40533, 40473], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40593, "bytes": [16, 3], "type": "code", "mnemonic": "bpl", "operand": "c9e96", "target": 40598, "target_label": "c9e96"}, {"addr": 40595, "bytes": [76, 52, 154], "type": "code", "mnemonic": "jmp", "operand": "discard_reset_listen", "target": 39476, "target_label": "discard_reset_listen"}, {"addr": 40598, "bytes": [169, 65], "labels": ["c9e96"], "comments_before": ["&9e96 referenced 1 time by &9e91"], "references": [40593], "type": "code", "mnemonic": "lda", "operand": "#&41"}, {"addr": 40600, "bytes": [76, 63, 159], "type": "code", "mnemonic": "jmp", "operand": "tx_store_result", "target": 40767, "target_label": "tx_store_result"}, {"addr": 40603, "bytes": [173, 75, 13], "labels": ["install_saved_handler"], "comments_before": ["&9e9b referenced 1 time by &9e85"], "references": [40581], "type": "code", "mnemonic": "lda", "operand": "nmi_next_lo", "target": 3403, "target_label": "nmi_next_lo"}, {"addr": 40606, "bytes": [172, 76, 13], "type": "code", "mnemonic": "ldy", "operand": "nmi_next_hi", "target": 3404, "target_label": "nmi_next_hi"}, {"addr": 40609, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40612, "bytes": [44, 160, 254], "labels": ["nmi_data_tx_tube"], "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40615, "bytes": [80, 229], "labels": ["c9ea7"], "comments_before": ["&9ea7 referenced 1 time by &9ed8"], "references": [40664], "type": "code", "mnemonic": "bvc", "operand": "data_tx_error", "target": 40590, "target_label": "data_tx_error"}, {"addr": 40617, "bytes": [173, 229, 254], "type": "code", "mnemonic": "lda", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 40620, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40623, "bytes": [230, 162], "type": "code", "mnemonic": "inc", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 40625, "bytes": [208, 12], "type": "code", "mnemonic": "bne", "operand": "c9ebf", "target": 40639, "target_label": "c9ebf"}, {"addr": 40627, "bytes": [230, 163], "type": "code", "mnemonic": "inc", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 40629, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "c9ebf", "target": 40639, "target_label": "c9ebf"}, {"addr": 40631, "bytes": [230, 164], "type": "code", "mnemonic": "inc", "operand": "open_port_buf", "target": 164, "target_label": "open_port_buf"}, {"addr": 40633, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "c9ebf", "target": 40639, "target_label": "c9ebf"}, {"addr": 40635, "bytes": [230, 165], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 40637, "bytes": [240, 190], "type": "code", "mnemonic": "beq", "operand": "data_tx_last", "target": 40573, "target_label": "data_tx_last"}, {"addr": 40639, "bytes": [173, 229, 254], "labels": ["c9ebf"], "comments_before": ["&9ebf referenced 3 times by &9eb1, &9eb5, &9eb9"], "references": [40625, 40629, 40633], "type": "code", "mnemonic": "lda", "operand": "tube_data_register_3", "target": 65253, "target_label": "tube_data_register_3"}, {"addr": 40642, "bytes": [141, 162, 254], "type": "code", "mnemonic": "sta", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40645, "bytes": [230, 162], "type": "code", "mnemonic": "inc", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 40647, "bytes": [208, 12], "type": "code", "mnemonic": "bne", "operand": "c9ed5", "target": 40661, "target_label": "c9ed5"}, {"addr": 40649, "bytes": [230, 163], "labels": ["sub_c9ec9"], "sub_labels": {"40650": ["l9eca"]}, "comments_before": ["&9eca referenced 1 time by &9cc5"], "type": "code", "mnemonic": "inc", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 40651, "bytes": [208, 8], "type": "code", "mnemonic": "bne", "operand": "c9ed5", "target": 40661, "target_label": "c9ed5"}, {"addr": 40653, "bytes": [230, 164], "type": "code", "mnemonic": "inc", "operand": "open_port_buf", "target": 164, "target_label": "open_port_buf"}, {"addr": 40655, "bytes": [208, 4], "type": "code", "mnemonic": "bne", "operand": "c9ed5", "target": 40661, "target_label": "c9ed5"}, {"addr": 40657, "bytes": [230, 165], "labels": ["sub_c9ed1"], "sub_labels": {"40658": ["l9ed2"]}, "comments_before": ["&9ed2 referenced 1 time by &9cbf"], "type": "code", "mnemonic": "inc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 40659, "bytes": [240, 168], "type": "code", "mnemonic": "beq", "operand": "data_tx_last", "target": 40573, "target_label": "data_tx_last"}, {"addr": 40661, "bytes": [44, 160, 254], "labels": ["c9ed5"], "comments_before": ["&9ed5 referenced 3 times by &9ec7, &9ecb, &9ecf"], "references": [40647, 40651, 40655], "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40664, "bytes": [48, 205], "type": "code", "mnemonic": "bmi", "operand": "c9ea7", "target": 40615, "target_label": "c9ea7"}, {"addr": 40666, "bytes": [76, 20, 13], "type": "code", "mnemonic": "jmp", "operand": "nmi_rti", "target": 3348, "target_label": "nmi_rti"}, {"addr": 40669, "bytes": [169, 130], "labels": ["handshake_await_ack"], "comments_before": ["***************************************************************************************", "Four-way handshake: switch to RX for final ACK\n\nAfter the data frame TX completes, switches to RX mode (CR1=&82)\nand installs &9EE9 to receive the final ACK from the remote station.", "***************************************************************************************", "&9edd referenced 1 time by &9da8"], "comment_inline": "CR1=&82: TX_RESET | RIE (switch to RX for final ACK)", "references": [40360], "type": "code", "mnemonic": "lda", "operand": "#&82"}, {"addr": 40671, "bytes": [141, 160, 254], "type": "code", "mnemonic": "sta", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40674, "bytes": [169, 233], "comment_inline": "Install handler at &9EE9 (RX final ACK)", "type": "code", "mnemonic": "lda", "operand": "#&e9"}, {"addr": 40676, "bytes": [160, 158], "type": "code", "mnemonic": "ldy", "operand": "#&9e"}, {"addr": 40678, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40681, "bytes": [169, 1], "labels": ["nmi_final_ack"], "comments_before": ["***************************************************************************************", "RX final ACK handler\n\nReceives the final ACK in a four-way handshake. Same validation\npattern as the reply scout handler (&9DB2-&9DE3):\n  &9EE9: Check AP, read dest_stn, compare to our station\n  &9EFF: Check RDA, read dest_net, validate = 0\n  &9F15: Check RDA, read src_stn/net, compare to TX dest\n  &9F32: Check FV for frame completion\nOn success, stores result=0 at &9F39. On any failure, error &41.", "***************************************************************************************"], "comment_inline": "A=&01: AP mask", "type": "code", "mnemonic": "lda", "operand": "#1"}, {"addr": 40683, "bytes": [44, 161, 254], "comment_inline": "BIT SR2: test AP", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40686, "bytes": [240, 77], "comment_inline": "No AP -- error", "type": "code", "mnemonic": "beq", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40688, "bytes": [173, 162, 254], "comment_inline": "Read dest station", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40691, "bytes": [205, 24, 254], "comment_inline": "Compare to our station (INTOFF side effect)", "type": "code", "mnemonic": "cmp", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 40694, "bytes": [208, 69], "comment_inline": "Not our station -- error", "type": "code", "mnemonic": "bne", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40696, "bytes": [169, 255], "comment_inline": "Install handler at &9EFF (final ACK continuation)", "type": "code", "mnemonic": "lda", "operand": "#&ff"}, {"addr": 40698, "bytes": [160, 158], "type": "code", "mnemonic": "ldy", "operand": "#&9e"}, {"addr": 40700, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40703, "bytes": [44, 161, 254], "labels": ["nmi_final_ack_net"], "comment_inline": "BIT SR2: test RDA", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40706, "bytes": [16, 57], "comment_inline": "No RDA -- error", "type": "code", "mnemonic": "bpl", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40708, "bytes": [173, 162, 254], "comment_inline": "Read dest network", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40711, "bytes": [208, 52], "comment_inline": "Non-zero -- network mismatch, error", "type": "code", "mnemonic": "bne", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40713, "bytes": [169, 21], "comment_inline": "Install handler at &9F15 (final ACK validation)", "type": "code", "mnemonic": "lda", "operand": "#&15"}, {"addr": 40715, "bytes": [160, 159], "type": "code", "mnemonic": "ldy", "operand": "#&9f"}, {"addr": 40717, "bytes": [44, 160, 254], "comment_inline": "BIT SR1: test IRQ -- more data ready?", "type": "code", "mnemonic": "bit", "operand": "econet_control1_or_status1", "target": 65184, "target_label": "econet_control1_or_status1"}, {"addr": 40720, "bytes": [48, 3], "comment_inline": "IRQ set -- fall through to &9F15 without RTI", "type": "code", "mnemonic": "bmi", "operand": "nmi_final_ack_validate", "target": 40725, "target_label": "nmi_final_ack_validate"}, {"addr": 40722, "bytes": [76, 14, 13], "type": "code", "mnemonic": "jmp", "operand": "set_nmi_vector", "target": 3342, "target_label": "set_nmi_vector"}, {"addr": 40725, "bytes": [44, 161, 254], "labels": ["nmi_final_ack_validate"], "comments_before": ["***************************************************************************************", "Final ACK validation\n\nReads and validates src_stn and src_net against original TX dest.\nThen checks FV for frame completion.", "***************************************************************************************", "&9f15 referenced 1 time by &9f10"], "comment_inline": "BIT SR2: test RDA", "references": [40720], "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40728, "bytes": [16, 35], "comment_inline": "No RDA -- error", "type": "code", "mnemonic": "bpl", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40730, "bytes": [173, 162, 254], "comment_inline": "Read source station", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40733, "bytes": [205, 32, 13], "comment_inline": "Compare to TX dest station (&0D20)", "type": "code", "mnemonic": "cmp", "operand": "tx_dst_stn", "target": 3360, "target_label": "tx_dst_stn"}, {"addr": 40736, "bytes": [208, 27], "comment_inline": "Mismatch -- error", "type": "code", "mnemonic": "bne", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40738, "bytes": [173, 162, 254], "comment_inline": "Read source network", "type": "code", "mnemonic": "lda", "operand": "econet_data_continue_frame", "target": 65186, "target_label": "econet_data_continue_frame"}, {"addr": 40741, "bytes": [205, 33, 13], "comment_inline": "Compare to TX dest network (&0D21)", "type": "code", "mnemonic": "cmp", "operand": "tx_dst_net", "target": 3361, "target_label": "tx_dst_net"}, {"addr": 40744, "bytes": [208, 19], "comment_inline": "Mismatch -- error", "type": "code", "mnemonic": "bne", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40746, "bytes": [173, 74, 13], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40749, "bytes": [16, 3], "type": "code", "mnemonic": "bpl", "operand": "c9f32", "target": 40754, "target_label": "c9f32"}, {"addr": 40751, "bytes": [76, 112, 152], "type": "code", "mnemonic": "jmp", "operand": "c9870", "target": 39024, "target_label": "c9870"}, {"addr": 40754, "bytes": [169, 2], "labels": ["c9f32"], "comments_before": ["&9f32 referenced 1 time by &9f2d"], "comment_inline": "A=&02: FV mask for SR2 bit1", "references": [40749], "type": "code", "mnemonic": "lda", "operand": "#2"}, {"addr": 40756, "bytes": [44, 161, 254], "comment_inline": "BIT SR2: test FV -- frame must be complete", "type": "code", "mnemonic": "bit", "operand": "econet_control23_or_status2", "target": 65185, "target_label": "econet_control23_or_status2"}, {"addr": 40759, "bytes": [240, 4], "comment_inline": "No FV -- error", "type": "code", "mnemonic": "beq", "operand": "tx_result_fail", "target": 40765, "target_label": "tx_result_fail"}, {"addr": 40761, "bytes": [169, 0], "labels": ["tx_result_ok"], "comments_before": ["***************************************************************************************", "TX completion handler\n\nStores result code 0 (success) into the first byte of the TX control\nblock (nmi_tx_block),Y=0. Then sets &0D3A bit7 to signal completion\nand calls full ADLC reset + idle listen via &9A34.", "***************************************************************************************", "&9f39 referenced 2 times by &9963, &9d9e"], "comment_inline": "A=0: success result code", "references": [39267, 40350], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 40763, "bytes": [240, 2], "comment_inline": "BEQ: always taken (A=0) ALWAYS branch", "type": "code", "mnemonic": "beq", "operand": "tx_store_result", "target": 40767, "target_label": "tx_store_result"}, {"addr": 40765, "bytes": [169, 65], "labels": ["tx_result_fail"], "comments_before": ["&9f3d referenced 8 times by &9eee, &9ef6, &9f02, &9f07, &9f18, &9f20, &9f28, &9f37"], "references": [40706, 40728, 40686, 40711, 40736, 40694, 40744, 40759], "type": "code", "mnemonic": "lda", "operand": "#&41"}, {"addr": 40767, "bytes": [160, 0], "labels": ["tx_store_result"], "comments_before": ["***************************************************************************************", "TX error handler\n\nStores error code (A) into the TX control block, sets &0D3A bit7\nfor completion, and returns to idle via &9A34.\nError codes: &00=success, &40=line jammed, &41=not listening,\n&42=net error.", "***************************************************************************************", "&9f3f referenced 5 times by &9891, &9d85, &9de0, &9e98, &9f3b"], "comment_inline": "Y=0: index into TX control block", "references": [40763, 40416, 39057, 40600, 40325], "type": "code", "mnemonic": "ldy", "operand": "#0"}, {"addr": 40769, "bytes": [145, 160], "comment_inline": "Store result/error code at (nmi_tx_block),0", "type": "code", "mnemonic": "sta", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40771, "bytes": [169, 128], "comment_inline": "&80: completion flag for &0D3A", "type": "code", "mnemonic": "lda", "operand": "#&80"}, {"addr": 40773, "bytes": [141, 58, 13], "comment_inline": "Signal TX complete", "type": "code", "mnemonic": "sta", "operand": "tx_ctrl_status", "target": 3386, "target_label": "tx_ctrl_status"}, {"addr": 40776, "bytes": [76, 52, 154], "comment_inline": "Full ADLC reset and return to idle listen", "type": "code", "mnemonic": "jmp", "operand": "discard_reset_listen", "target": 39476, "target_label": "discard_reset_listen"}, {"addr": 40779, "bytes": [14, 14, 10, 10, 10, 6, 6, 10, 129, 0, 0, 0, 0, 1, 1, 129], "type": "byte", "values": [14, 14, 10, 10, 10, 6, 6, 10, 129, 0, 0, 0, 0, 1, 1, 129]}, {"addr": 40795, "bytes": [160, 6], "labels": ["tx_calc_transfer"], "comments_before": ["***************************************************************************************", "Calculate transfer size\n\nComputes the number of bytes actually transferred during a data\nframe reception. Subtracts the low pointer (LPTR, offset 4 in\nthe RXCB) from the current buffer position to get the byte count,\nand stores it back into the RXCB's high pointer field (HPTR,\noffset 8). This tells the caller how much data was received.", "***************************************************************************************", "&9f5b referenced 2 times by &980e, &9d42"], "references": [40258, 38926], "type": "code", "mnemonic": "ldy", "operand": "#6"}, {"addr": 40797, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40799, "bytes": [200], "comment_inline": "Y=&07", "type": "code", "mnemonic": "iny"}, {"addr": 40800, "bytes": [49, 160], "type": "code", "mnemonic": "and", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40802, "bytes": [201, 255], "type": "code", "mnemonic": "cmp", "operand": "#&ff"}, {"addr": 40804, "bytes": [240, 65], "type": "code", "mnemonic": "beq", "operand": "c9fa7", "target": 40871, "target_label": "c9fa7"}, {"addr": 40806, "bytes": [173, 82, 13], "type": "code", "mnemonic": "lda", "operand": "tx_in_progress", "target": 3410, "target_label": "tx_in_progress"}, {"addr": 40809, "bytes": [240, 60], "type": "code", "mnemonic": "beq", "operand": "c9fa7", "target": 40871, "target_label": "c9fa7"}, {"addr": 40811, "bytes": [173, 74, 13], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40814, "bytes": [9, 2], "type": "code", "mnemonic": "ora", "operand": "#2"}, {"addr": 40816, "bytes": [141, 74, 13], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40819, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 40820, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 40821, "bytes": [160, 4], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 40823, "bytes": [177, 160], "labels": ["loop_c9f77"], "comments_before": ["&9f77 referenced 1 time by &9f89"], "references": [40841], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40825, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40826, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40827, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40828, "bytes": [200], "type": "code", "mnemonic": "iny"}, {"addr": 40829, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 40830, "bytes": [241, 160], "type": "code", "mnemonic": "sbc", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40832, "bytes": [153, 154, 0], "type": "code", "mnemonic": "sta", "operand": "net_tx_ptr,y", "target": 154, "target_label": "net_tx_ptr"}, {"addr": 40835, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 40836, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 40837, "bytes": [136], "type": "code", "mnemonic": "dey"}, {"addr": 40838, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 40839, "bytes": [192, 8], "type": "code", "mnemonic": "cpy", "operand": "#8"}, {"addr": 40841, "bytes": [144, 236], "type": "code", "mnemonic": "bcc", "operand": "loop_c9f77", "target": 40823, "target_label": "loop_c9f77"}, {"addr": 40843, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 40844, "bytes": [138], "type": "code", "mnemonic": "txa"}, {"addr": 40845, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40846, "bytes": [169, 4], "type": "code", "mnemonic": "lda", "operand": "#4"}, {"addr": 40848, "bytes": [24], "type": "code", "mnemonic": "clc"}, {"addr": 40849, "bytes": [101, 160], "type": "code", "mnemonic": "adc", "operand": "nmi_tx_block", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40851, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 40852, "bytes": [164, 161], "type": "code", "mnemonic": "ldy", "operand": "nmi_tx_block_hi", "target": 161, "target_label": "nmi_tx_block_hi"}, {"addr": 40854, "bytes": [169, 194], "type": "code", "mnemonic": "lda", "operand": "#&c2"}, {"addr": 40856, "bytes": [32, 6, 4], "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 40859, "bytes": [144, 7], "type": "code", "mnemonic": "bcc", "operand": "c9fa4", "target": 40868, "target_label": "c9fa4"}, {"addr": 40861, "bytes": [173, 92, 13], "type": "code", "mnemonic": "lda", "operand": "scout_status", "target": 3420, "target_label": "scout_status"}, {"addr": 40864, "bytes": [32, 6, 4], "type": "code", "mnemonic": "jsr", "operand": "tube_addr_claim", "target": 1030, "target_label": "tube_addr_claim"}, {"addr": 40867, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 40868, "bytes": [104], "labels": ["c9fa4"], "comments_before": ["&9fa4 referenced 1 time by &9f9b"], "references": [40859], "type": "code", "mnemonic": "pla"}, {"addr": 40869, "bytes": [170], "type": "code", "mnemonic": "tax"}, {"addr": 40870, "bytes": [96], "type": "code", "mnemonic": "rts"}, {"addr": 40871, "bytes": [160, 4], "labels": ["c9fa7"], "comments_before": ["&9fa7 referenced 2 times by &9f64, &9f69"], "references": [40804, 40809], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 40873, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40875, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 40877, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 40878, "bytes": [241, 160], "type": "code", "mnemonic": "sbc", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40880, "bytes": [133, 162], "type": "code", "mnemonic": "sta", "operand": "port_buf_len", "target": 162, "target_label": "port_buf_len"}, {"addr": 40882, "bytes": [160, 5], "type": "code", "mnemonic": "ldy", "operand": "#5"}, {"addr": 40884, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40886, "bytes": [233, 0], "type": "code", "mnemonic": "sbc", "operand": "#0"}, {"addr": 40888, "bytes": [133, 165], "type": "code", "mnemonic": "sta", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 40890, "bytes": [160, 8], "type": "code", "mnemonic": "ldy", "operand": "#8"}, {"addr": 40892, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40894, "bytes": [133, 164], "type": "code", "mnemonic": "sta", "operand": "open_port_buf", "target": 164, "target_label": "open_port_buf"}, {"addr": 40896, "bytes": [160, 9], "type": "code", "mnemonic": "ldy", "operand": "#9"}, {"addr": 40898, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40900, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 40901, "bytes": [229, 165], "type": "code", "mnemonic": "sbc", "operand": "open_port_buf_hi", "target": 165, "target_label": "open_port_buf_hi"}, {"addr": 40903, "bytes": [133, 163], "type": "code", "mnemonic": "sta", "operand": "port_buf_len_hi", "target": 163, "target_label": "port_buf_len_hi"}, {"addr": 40905, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 40906, "bytes": [96], "labels": ["nmi_shim_rom_src"], "comments_before": ["&9fca referenced 1 time by &96d1"], "references": [38609], "type": "code", "mnemonic": "rts"}, {"addr": 40907, "bytes": [44, 24, 254], "labels": ["nmi_bootstrap_entry"], "comments_before": ["***************************************************************************************", "Bootstrap NMI entry point (in ROM)\n\nAn alternate NMI handler that lives in the ROM itself rather than\nin the RAM workspace at &0D00. Unlike the RAM shim (which uses a\nself-modifying JMP to dispatch to different handlers), this one\nhardcodes JMP nmi_rx_scout (&96F6). Used as the initial NMI handler\nbefore the workspace has been properly set up during initialisation.\nSame sequence as the RAM shim: BIT &FE18 (INTOFF), PHA, TYA, PHA,\nLDA romsel, STA &FE30, JMP &96F6.", "***************************************************************************************"], "type": "code", "mnemonic": "bit", "operand": "station_id_disable_net_nmis", "target": 65048, "target_label": "station_id_disable_net_nmis"}, {"addr": 40910, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40911, "bytes": [152], "type": "code", "mnemonic": "tya"}, {"addr": 40912, "bytes": [72], "type": "code", "mnemonic": "pha"}, {"addr": 40913, "bytes": [169, 0], "type": "code", "mnemonic": "lda", "operand": "#0"}, {"addr": 40915, "bytes": [141, 48, 254], "type": "code", "mnemonic": "sta", "operand": "romsel", "target": 65072, "target_label": "romsel"}, {"addr": 40918, "bytes": [76, 246, 150], "type": "code", "mnemonic": "jmp", "operand": "nmi_rx_scout", "target": 38646, "target_label": "nmi_rx_scout"}, {"addr": 40921, "bytes": [140, 13, 13], "labels": ["rom_set_nmi_vector"], "comments_before": ["***************************************************************************************", "ROM copy of set_nmi_vector + nmi_rti\n\nA version of the NMI vector-setting subroutine and RTI sequence\nthat lives in ROM. The RAM workspace copy at &0D0E/&0D14 is the\none normally used at runtime; this ROM copy is used during early\ninitialisation before the RAM workspace has been set up, and as\nthe source for the initial copy to RAM.", "***************************************************************************************"], "type": "code", "mnemonic": "sty", "operand": "nmi_jmp_hi", "target": 3341, "target_label": "nmi_jmp_hi"}, {"addr": 40924, "bytes": [141, 12, 13], "type": "code", "mnemonic": "sta", "operand": "nmi_jmp_lo", "target": 3340, "target_label": "nmi_jmp_lo"}, {"addr": 40927, "bytes": [165, 244], "type": "code", "mnemonic": "lda", "operand": "romsel_copy", "target": 244, "target_label": "romsel_copy"}, {"addr": 40929, "bytes": [141, 48, 254], "type": "code", "mnemonic": "sta", "operand": "romsel", "target": 65072, "target_label": "romsel"}, {"addr": 40932, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40933, "bytes": [168], "type": "code", "mnemonic": "tay"}, {"addr": 40934, "bytes": [104], "type": "code", "mnemonic": "pla"}, {"addr": 40935, "bytes": [44, 32, 254], "type": "code", "mnemonic": "bit", "operand": "video_ula_control", "target": 65056, "target_label": "video_ula_control"}, {"addr": 40938, "bytes": [64], "type": "code", "mnemonic": "rti"}, {"addr": 40939, "bytes": [173, 74, 13], "labels": ["rom_nmi_tail"], "type": "code", "mnemonic": "lda", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40942, "bytes": [9, 2], "type": "code", "mnemonic": "ora", "operand": "#2"}, {"addr": 40944, "bytes": [141, 74, 13], "type": "code", "mnemonic": "sta", "operand": "tx_flags", "target": 3402, "target_label": "tx_flags"}, {"addr": 40947, "bytes": [56], "type": "code", "mnemonic": "sec"}, {"addr": 40948, "bytes": [8], "type": "code", "mnemonic": "php"}, {"addr": 40949, "bytes": [160, 4], "type": "code", "mnemonic": "ldy", "operand": "#4"}, {"addr": 40951, "bytes": [177, 160], "type": "code", "mnemonic": "lda", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}, {"addr": 40953, "bytes": [200], "comment_inline": "Y=&05", "type": "code", "mnemonic": "iny"}, {"addr": 40954, "bytes": [200], "comment_inline": "Y=&06", "type": "code", "mnemonic": "iny"}, {"addr": 40955, "bytes": [200], "comment_inline": "Y=&07", "type": "code", "mnemonic": "iny"}, {"addr": 40956, "bytes": [200], "comment_inline": "Y=&08", "type": "code", "mnemonic": "iny"}, {"addr": 40957, "bytes": [40], "type": "code", "mnemonic": "plp"}, {"addr": 40958, "bytes": [241, 160], "type": "code", "mnemonic": "sbc", "operand": "(nmi_tx_block),y", "target": 160, "target_label": "nmi_tx_block"}]}