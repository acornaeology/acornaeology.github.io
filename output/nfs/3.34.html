<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Acorn NFS 3.34 — acornaeology</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body class="page-disassembly">
    <header class="site-header">
        <div class="container">
            <a href="../" class="site-title">acornaeology</a>
            <nav class="site-nav">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
            </nav>
        </div>
    </header>

    <main class="container">
        
<h1>Acorn NFS 3.34</h1>
<p>Network Filing System for the BBC Micro Econet interface.</p>

<div class="disassembly-layout">

<nav class="subroutine-nav">
    <h2>Subroutines</h2>
    <ul>
    
    
    <li>
        <a href="#addr-FFB9">osrdsc</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFBC">vduchr</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFBF">oseven</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFCE">osfind</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFC8">nvrdch</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFCB">nvwrch</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFD1">osgbpb</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFD4">osbput</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFD7">osbget</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFDA">osargs</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFE0">osrdch</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFE3">osasci</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFE7">osnewl</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFEC">oswrcr</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFEE">oswrch</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFF4">osbyte</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFF1">osword</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFDD">osfile</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-FFF7">oscli</a>
        
    </li>
    
    
    
    <li>
        <a href="#addr-8560">parse_decimal</a>
        <span class="sub-title">Parse decimal number from (fs_options),Y (DECIN)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-858A">handle_to_mask</a>
        <span class="sub-title">Convert file handle to bitmask (Y2FS)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-85A5">mask_to_handle</a>
        <span class="sub-title">Convert bitmask to handle number (FS2A)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-85CE">compare_addresses</a>
        <span class="sub-title">Compare two 4-byte addresses</span>
    </li>
    
    
    
    <li>
        <a href="#addr-8650">tx_poll_core</a>
        <span class="sub-title">Core transmit and poll routine (XMIT)</span>
    </li>
    
    
    
    
    
    <li>
        <a href="#addr-8350">prepare_fs_cmd</a>
        <span class="sub-title">Prepare FS command buffer (12 references)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-836A">build_send_fs_cmd</a>
        <span class="sub-title">Build and send FS command (DOFSOP)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-83A3">handle_bput_bget</a>
        <span class="sub-title">Handle BPUT/BGET file byte I/O</span>
    </li>
    
    
    
    <li>
        <a href="#addr-808C">fscv_handler</a>
        <span class="sub-title">FSCV dispatch entry</span>
    </li>
    
    
    
    <li>
        <a href="#addr-8694">filev_handler</a>
        <span class="sub-title">FILEV handler (OSFILE entry point)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-88E1">argsv_handler</a>
        <span class="sub-title">ARGSV handler (OSARGS entry point)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-8949">findv_handler</a>
        <span class="sub-title">FINDV handler (OSFIND entry point)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-89EA">gbpbv_handler</a>
        <span class="sub-title">GBPBV handler (OSGBPB entry point)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-9007">osword_dispatch</a>
        <span class="sub-title">NETVEC dispatch handler (ENTRY)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-903D">net_write_char</a>
        <span class="sub-title">Fn 4: net write character (NWRCH)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-8E33">osword_0f_handler</a>
        <span class="sub-title">OSWORD $0F handler: initiate transmit (CALLTX)</span>
    </li>
    
    
    
    <li>
        <a href="#addr-8EF0">osword_10_handler</a>
        <span class="sub-title">OSWORD $10 handler: open/read RX control block (OPENRX)</span>
    </li>
    
    
    </ul>
</nav>


<div class="listing">
<table>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sideways ROM header</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NFS ROM 3.34 disassembly (Acorn Econet filing system)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NMI handler architecture</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ========================</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The NFS ROM uses self-modifying code to implement a state machine for</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ADLC communication. An NMI workspace shim is copied to $0D00 at init.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NMI entry ($0D00):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   BIT $FE18       ; INTOFF -- immediately disable further NMIs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   PHA / TYA / PHA ; save A, Y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   LDA #$nn        ; page in NFS ROM bank (self-modified at init)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   STA $FE30</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   JMP $xxxx       ; self-modifying target at $0D0C/$0D0D</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; set_nmi_vector ($0D0E): stores A-&gt;$0D0C (low), Y-&gt;$0D0D (high)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Falls through to nmi_rti.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; nmi_rti ($0D14):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   LDA $F4         ; restore original ROM bank</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   STA $FE30</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   PLA / TAY / PLA ; restore Y, A</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   BIT $FE20       ; INTON -- re-enable NMIs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   RTI</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NMI handler chain for outbound transmission (four-way handshake):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $96F6: RX scout (idle listen, default handler)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9C48: INACTIVE polling (pre-TX, waits for idle line)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9D4C: TX data (2 bytes per NMI, tight loop if IRQ persists)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9D88: TX_LAST_DATA (close frame)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9D94: TX completion (switch to RX: CR1=$82)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9DB2: RX reply scout (check AP, read dest_stn)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9DC8: RX reply continuation (read dest_net, validate)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9DE3: RX reply validation (read src_stn/net, check FV)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9E24: TX scout ACK (write dest/src addr, TX_LAST_DATA)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9EDD: Four-way handshake data phase</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NMI handler chain for inbound reception (scout -&gt; data):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $96F6: RX scout (idle listen)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9715: RX scout second byte (dest_net, install $9747)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9747: Scout data loop (read body in pairs, detect FV)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9771: Scout completion (disable PSE, read last byte)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $995E: TX scout ACK</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9839: RX data frame (AP check, validate dest_stn/net)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $984F: RX data frame (validate src_net=0)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9865: RX data frame (skip ctrl/port bytes)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $989A: RX data bulk read (read payload into buffer)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $98CE: RX data completion (disable PSE, check FV, read last)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $995E: TX final ACK</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Key ADLC register values:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR1=$C1: full reset (TX_RESET|RX_RESET|AC)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR1=$82: RX listen (TX_RESET|RIE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR1=$44: TX active (RX_RESET|TIE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR2=$67: clear all status (CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR2=$E7: TX prepare (RTS|CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR2=$3F: TX last data (CLR_RX_ST|TX_LAST_DATA|FLAG_IDLE|FC_TDRA|2_1_BYTE|PSE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR2=$A7: TX in handshake (RTS|CLR_TX_ST|FC_TDRA|2_1_BYTE|PSE)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8000">
<td class="addr"><a href="#addr-8000">8000</a></td>
<td><span class="label">.rom_header</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="label">.language_entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="label">.pydis_start</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8099">language_handler</a></span></td>
<td class="hex">4C 99 80</td>
</tr>

<tr id="addr-8003">
<td class="addr"><a href="#addr-8003">8003</a></td>
<td><span class="label">.service_entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-80AF">service_handler</a></span></td>
<td class="hex">4C AF 80</td>
</tr>

<tr id="addr-8006">
<td class="addr"><a href="#addr-8006">8006</a></td>
<td><span class="label">.rom_type</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;82</td>
<td class="hex">82</td>
</tr>

<tr id="addr-8007">
<td class="addr"><a href="#addr-8007">8007</a></td>
<td><span class="label">.copyright_offset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;0C</td>
<td class="hex">0C</td>
</tr>

<tr id="addr-8008">
<td class="addr"><a href="#addr-8008">8008</a></td>
<td><span class="label">.binary_version</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;03</td>
<td class="hex">03</td>
</tr>

<tr id="addr-8009">
<td class="addr"><a href="#addr-8009">8009</a></td>
<td><span class="label">.title</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;NET&quot;</span></td>
<td class="hex">4E 45 54</td>
</tr>

<tr id="addr-800C">
<td class="addr"><a href="#addr-800C">800C</a></td>
<td><span class="label">.copyright</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr id="addr-800D">
<td class="addr"><a href="#addr-800D">800D</a></td>
<td><span class="label">.l800d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;(C)ROFF.&quot;</span></td>
<td class="hex">28 43 29 52 4F 46 46 00</td>
</tr>

<tr id="addr-8015">
<td class="addr"><a href="#addr-8015">8015</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D, &amp;18</td>
<td class="hex">0D 18</td>
</tr>

<tr id="addr-8017">
<td class="addr"><a href="#addr-8017">8017</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;&#39;1;;CO&quot;</span></td>
<td class="hex">27 31 3B 3B 43 4F</td>
</tr>

<tr id="addr-801D">
<td class="addr"><a href="#addr-801D">801D</a></td>
<td>    <span class="directive">EQUB</span> &amp;01, &amp;00, &amp;34</td>
<td class="hex">01 00 34</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatch table: low bytes of (handler_address - 1)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Each entry stores the low byte of a handler address minus 1,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; for use with the PHA/PHA/RTS dispatch trick at $809F.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; See dispatch_hi ($8044) for the corresponding high bytes.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Indexed by service number (1-13), language reason (14-18),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; or *NET command (33-36), with a base offset added by the caller.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8020">
<td class="addr"><a href="#addr-8020">8020</a></td>
<td><span class="label">.dispatch_lo</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;03</td>
<td class="hex">03</td>
</tr>

<tr id="addr-8021">
<td class="addr"><a href="#addr-8021">8021</a></td>
<td>    <span class="directive">EQUB</span> &amp;44</td>
<td class="hex">44</td>
</tr>

<tr id="addr-8022">
<td class="addr"><a href="#addr-8022">8022</a></td>
<td>    <span class="directive">EQUB</span> &amp;6E</td>
<td class="hex">6E</td>
</tr>

<tr id="addr-8023">
<td class="addr"><a href="#addr-8023">8023</a></td>
<td>    <span class="directive">EQUB</span> &amp;77</td>
<td class="hex">77</td>
</tr>

<tr id="addr-8024">
<td class="addr"><a href="#addr-8024">8024</a></td>
<td>    <span class="directive">EQUB</span> &amp;D0</td>
<td class="hex">D0</td>
</tr>

<tr id="addr-8025">
<td class="addr"><a href="#addr-8025">8025</a></td>
<td>    <span class="directive">EQUB</span> &amp;71</td>
<td class="hex">71</td>
</tr>

<tr id="addr-8026">
<td class="addr"><a href="#addr-8026">8026</a></td>
<td>    <span class="directive">EQUB</span> &amp;6B</td>
<td class="hex">6B</td>
</tr>

<tr id="addr-8027">
<td class="addr"><a href="#addr-8027">8027</a></td>
<td>    <span class="directive">EQUB</span> &amp;44</td>
<td class="hex">44</td>
</tr>

<tr id="addr-8028">
<td class="addr"><a href="#addr-8028">8028</a></td>
<td>    <span class="directive">EQUB</span> &amp;68</td>
<td class="hex">68</td>
</tr>

<tr id="addr-8029">
<td class="addr"><a href="#addr-8029">8029</a></td>
<td>    <span class="directive">EQUB</span> &amp;F6</td>
<td class="hex">F6</td>
</tr>

<tr id="addr-802A">
<td class="addr"><a href="#addr-802A">802A</a></td>
<td>    <span class="directive">EQUB</span> &amp;BB</td>
<td class="hex">BB</td>
</tr>

<tr id="addr-802B">
<td class="addr"><a href="#addr-802B">802B</a></td>
<td>    <span class="directive">EQUB</span> &amp;44</td>
<td class="hex">44</td>
</tr>

<tr id="addr-802C">
<td class="addr"><a href="#addr-802C">802C</a></td>
<td>    <span class="directive">EQUB</span> &amp;68</td>
<td class="hex">68</td>
</tr>

<tr id="addr-802D">
<td class="addr"><a href="#addr-802D">802D</a></td>
<td>    <span class="directive">EQUB</span> &amp;65</td>
<td class="hex">65</td>
</tr>

<tr id="addr-802E">
<td class="addr"><a href="#addr-802E">802E</a></td>
<td>    <span class="directive">EQUB</span> &amp;49</td>
<td class="hex">49</td>
</tr>

<tr id="addr-802F">
<td class="addr"><a href="#addr-802F">802F</a></td>
<td>    <span class="directive">EQUB</span> &amp;FB</td>
<td class="hex">FB</td>
</tr>

<tr id="addr-8030">
<td class="addr"><a href="#addr-8030">8030</a></td>
<td>    <span class="directive">EQUB</span> &amp;90</td>
<td class="hex">90</td>
</tr>

<tr id="addr-8031">
<td class="addr"><a href="#addr-8031">8031</a></td>
<td>    <span class="directive">EQUB</span> &amp;29</td>
<td class="hex">29</td>
</tr>

<tr id="addr-8032">
<td class="addr"><a href="#addr-8032">8032</a></td>
<td>    <span class="directive">EQUB</span> &amp;39</td>
<td class="hex">39</td>
</tr>

<tr id="addr-8033">
<td class="addr"><a href="#addr-8033">8033</a></td>
<td>    <span class="directive">EQUB</span> &amp;A0</td>
<td class="hex">A0</td>
</tr>

<tr id="addr-8034">
<td class="addr"><a href="#addr-8034">8034</a></td>
<td>    <span class="directive">EQUB</span> &amp;1E</td>
<td class="hex">1E</td>
</tr>

<tr id="addr-8035">
<td class="addr"><a href="#addr-8035">8035</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-8036">
<td class="addr"><a href="#addr-8036">8036</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-8037">
<td class="addr"><a href="#addr-8037">8037</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-8038">
<td class="addr"><a href="#addr-8038">8038</a></td>
<td>    <span class="directive">EQUB</span> &amp;FC</td>
<td class="hex">FC</td>
</tr>

<tr id="addr-8039">
<td class="addr"><a href="#addr-8039">8039</a></td>
<td>    <span class="directive">EQUB</span> &amp;FC</td>
<td class="hex">FC</td>
</tr>

<tr id="addr-803A">
<td class="addr"><a href="#addr-803A">803A</a></td>
<td>    <span class="directive">EQUB</span> &amp;D9</td>
<td class="hex">D9</td>
</tr>

<tr id="addr-803B">
<td class="addr"><a href="#addr-803B">803B</a></td>
<td>    <span class="directive">EQUB</span> &amp;72</td>
<td class="hex">72</td>
</tr>

<tr id="addr-803C">
<td class="addr"><a href="#addr-803C">803C</a></td>
<td>    <span class="directive">EQUB</span> &amp;1E</td>
<td class="hex">1E</td>
</tr>

<tr id="addr-803D">
<td class="addr"><a href="#addr-803D">803D</a></td>
<td>    <span class="directive">EQUB</span> &amp;1F</td>
<td class="hex">1F</td>
</tr>

<tr id="addr-803E">
<td class="addr"><a href="#addr-803E">803E</a></td>
<td>    <span class="directive">EQUB</span> &amp;FB</td>
<td class="hex">FB</td>
</tr>

<tr id="addr-803F">
<td class="addr"><a href="#addr-803F">803F</a></td>
<td>    <span class="directive">EQUB</span> &amp;83</td>
<td class="hex">83</td>
</tr>

<tr id="addr-8040">
<td class="addr"><a href="#addr-8040">8040</a></td>
<td>    <span class="directive">EQUB</span> &amp;F6</td>
<td class="hex">F6</td>
</tr>

<tr id="addr-8041">
<td class="addr"><a href="#addr-8041">8041</a></td>
<td>    <span class="directive">EQUB</span> &amp;AE</td>
<td class="hex">AE</td>
</tr>

<tr id="addr-8042">
<td class="addr"><a href="#addr-8042">8042</a></td>
<td>    <span class="directive">EQUB</span> &amp;C8</td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8043">
<td class="addr"><a href="#addr-8043">8043</a></td>
<td>    <span class="directive">EQUB</span> &amp;DE</td>
<td class="hex">DE</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatch table: high bytes of (handler_address - 1)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Paired with dispatch_lo ($8020). Together they form a table of</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 37 handler addresses, used via the PHA/PHA/RTS trick at $809F.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8044">
<td class="addr"><a href="#addr-8044">8044</a></td>
<td><span class="label">.dispatch_hi</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;F1</td>
<td class="hex">F1</td>
</tr>

<tr id="addr-8045">
<td class="addr"><a href="#addr-8045">8045</a></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-8046">
<td class="addr"><a href="#addr-8046">8046</a></td>
<td>    <span class="directive">EQUB</span> &amp;82</td>
<td class="hex">82</td>
</tr>

<tr id="addr-8047">
<td class="addr"><a href="#addr-8047">8047</a></td>
<td>    <span class="directive">EQUB</span> &amp;82</td>
<td class="hex">82</td>
</tr>

<tr id="addr-8048">
<td class="addr"><a href="#addr-8048">8048</a></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-8049">
<td class="addr"><a href="#addr-8049">8049</a></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-804A">
<td class="addr"><a href="#addr-804A">804A</a></td>
<td>    <span class="directive">EQUB</span> &amp;96</td>
<td class="hex">96</td>
</tr>

<tr id="addr-804B">
<td class="addr"><a href="#addr-804B">804B</a></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-804C">
<td class="addr"><a href="#addr-804C">804C</a></td>
<td>    <span class="directive">EQUB</span> &amp;80</td>
<td class="hex">80</td>
</tr>

<tr id="addr-804D">
<td class="addr"><a href="#addr-804D">804D</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-804E">
<td class="addr"><a href="#addr-804E">804E</a></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-804F">
<td class="addr"><a href="#addr-804F">804F</a></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-8050">
<td class="addr"><a href="#addr-8050">8050</a></td>
<td>    <span class="directive">EQUB</span> &amp;96</td>
<td class="hex">96</td>
</tr>

<tr id="addr-8051">
<td class="addr"><a href="#addr-8051">8051</a></td>
<td>    <span class="directive">EQUB</span> &amp;96</td>
<td class="hex">96</td>
</tr>

<tr id="addr-8052">
<td class="addr"><a href="#addr-8052">8052</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-8053">
<td class="addr"><a href="#addr-8053">8053</a></td>
<td>    <span class="directive">EQUB</span> &amp;90</td>
<td class="hex">90</td>
</tr>

<tr id="addr-8054">
<td class="addr"><a href="#addr-8054">8054</a></td>
<td>    <span class="directive">EQUB</span> &amp;92</td>
<td class="hex">92</td>
</tr>

<tr id="addr-8055">
<td class="addr"><a href="#addr-8055">8055</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-8056">
<td class="addr"><a href="#addr-8056">8056</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-8057">
<td class="addr"><a href="#addr-8057">8057</a></td>
<td>    <span class="directive">EQUB</span> &amp;89</td>
<td class="hex">89</td>
</tr>

<tr id="addr-8058">
<td class="addr"><a href="#addr-8058">8058</a></td>
<td>    <span class="directive">EQUB</span> &amp;88</td>
<td class="hex">88</td>
</tr>

<tr id="addr-8059">
<td class="addr"><a href="#addr-8059">8059</a></td>
<td>    <span class="directive">EQUB</span> &amp;8B</td>
<td class="hex">8B</td>
</tr>

<tr id="addr-805A">
<td class="addr"><a href="#addr-805A">805A</a></td>
<td>    <span class="directive">EQUB</span> &amp;8B</td>
<td class="hex">8B</td>
</tr>

<tr id="addr-805B">
<td class="addr"><a href="#addr-805B">805B</a></td>
<td>    <span class="directive">EQUB</span> &amp;8B</td>
<td class="hex">8B</td>
</tr>

<tr id="addr-805C">
<td class="addr"><a href="#addr-805C">805C</a></td>
<td>    <span class="directive">EQUB</span> &amp;8B</td>
<td class="hex">8B</td>
</tr>

<tr id="addr-805D">
<td class="addr"><a href="#addr-805D">805D</a></td>
<td>    <span class="directive">EQUB</span> &amp;82</td>
<td class="hex">82</td>
</tr>

<tr id="addr-805E">
<td class="addr"><a href="#addr-805E">805E</a></td>
<td>    <span class="directive">EQUB</span> &amp;85</td>
<td class="hex">85</td>
</tr>

<tr id="addr-805F">
<td class="addr"><a href="#addr-805F">805F</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-8060">
<td class="addr"><a href="#addr-8060">8060</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-8061">
<td class="addr"><a href="#addr-8061">8061</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-8062">
<td class="addr"><a href="#addr-8062">8062</a></td>
<td>    <span class="directive">EQUB</span> &amp;8C</td>
<td class="hex">8C</td>
</tr>

<tr id="addr-8063">
<td class="addr"><a href="#addr-8063">8063</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-8064">
<td class="addr"><a href="#addr-8064">8064</a></td>
<td>    <span class="directive">EQUB</span> &amp;8C</td>
<td class="hex">8C</td>
</tr>

<tr id="addr-8065">
<td class="addr"><a href="#addr-8065">8065</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-8066">
<td class="addr"><a href="#addr-8066">8066</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-8067">
<td class="addr"><a href="#addr-8067">8067</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr id="addr-8068">
<td class="addr"><a href="#addr-8068">8068</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D</td>
<td class="hex">8D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *NET command dispatcher</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Parses the character after *NET as &#39;1&#39;-&#39;4&#39;, maps to table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; indices 33-36 via base offset Y=$20, and dispatches via $809F.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Characters outside &#39;1&#39;-&#39;4&#39; fall through to return_1 (RTS).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8069">
<td class="addr"><a href="#addr-8069">8069</a></td>
<td><span class="label">.dispatch_net_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00EF">l00ef</a></span>  <span class="comment">; Read command character following *NET</span></td>
<td class="hex">A5 EF</td>
</tr>

<tr id="addr-806B">
<td class="addr"><a href="#addr-806B">806B</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">#&amp;31</span>  <span class="comment">; Subtract ASCII &#39;1&#39; to get 0-based command index</span></td>
<td class="hex">E9 31</td>
</tr>

<tr id="addr-806D">
<td class="addr"><a href="#addr-806D">806D</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-80AE">return_1</a></span></td>
<td class="hex">30 3F</td>
</tr>

<tr id="addr-806F">
<td class="addr"><a href="#addr-806F">806F</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#4</span></td>
<td class="hex">C9 04</td>
</tr>

<tr id="addr-8071">
<td class="addr"><a href="#addr-8071">8071</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-80AE">return_1</a></span></td>
<td class="hex">B0 3B</td>
</tr>

<tr id="addr-8073">
<td class="addr"><a href="#addr-8073">8073</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8074">
<td class="addr"><a href="#addr-8074">8074</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8075">
<td class="addr"><a href="#addr-8075">8075</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;20</span>  <span class="comment">; Y=$20: base offset for *NET commands (index 33+)</span></td>
<td class="hex">A0 20</td>
</tr>

<tr id="addr-8077">
<td class="addr"><a href="#addr-8077">8077</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-809F">dispatch</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 26</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Forward unrecognised * command to fileserver (COMERR)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies command text from (fs_crc_lo) to $0F05+ via copy_filename,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; prepares an FS command with function code 0, and sends it to the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fileserver to request decoding. The server returns a command code</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; indicating what action to take (e.g. code 4=INFO, 7=DIR, 9=LIB,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 5=load-as-command). This mechanism allows the fileserver to extend</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the client&#39;s command set without ROM updates. Called from the &#34;I.&#34;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and catch-all entries in the command match table at $8BD6, and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; from FSCV 2/3/4 indirectly. If CSD handle is zero (not logged</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; in), returns without sending.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8079">
<td class="addr"><a href="#addr-8079">8079</a></td>
<td><span class="label">.forward_star_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D63">copy_filename</a></span></td>
<td class="hex">20 63 8D</td>
</tr>

<tr id="addr-807C">
<td class="addr"><a href="#addr-807C">807C</a></td>
<td>    <span class="opcode">TAY</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-807D">
<td class="addr"><a href="#addr-807D">807D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8080">
<td class="addr"><a href="#addr-8080">8080</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0F03">fs_cmd_csd</a></span>  <span class="comment">; X=depends on function</span></td>
<td class="hex">AE 03 0F</td>
</tr>

<tr id="addr-8083">
<td class="addr"><a href="#addr-8083">8083</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-80AE">return_1</a></span></td>
<td class="hex">F0 29</td>
</tr>

<tr id="addr-8085">
<td class="addr"><a href="#addr-8085">8085</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span>  <span class="comment">; A=function code (0-7)</span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-8088">
<td class="addr"><a href="#addr-8088">8088</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;16</span>  <span class="comment">; Y=depends on function</span></td>
<td class="hex">A0 16</td>
</tr>

<tr id="addr-808A">
<td class="addr"><a href="#addr-808A">808A</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-809F">dispatch</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 13</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FSCV dispatch entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Entered via the extended vector table when the MOS calls FSCV.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores A/X/Y via save_fscv_args, compares A (function code) against 8,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and dispatches codes 0-7 via the shared dispatch table at $8020</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; with base offset Y=$12 (table indices 19-26).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Function codes: 0=*OPT, 1=EOF, 2=*/, 3=unrecognised *,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 4=*RUN, 5=*CAT, 6=shutdown, 7=read handles.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: function code (0-7)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: depends on function</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: depends on function</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: depends on handler (preserved if A &gt;= 8)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: depends on handler (preserved if A &gt;= 8)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: depends on handler (preserved if A &gt;= 8)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-808C">
<td class="addr"><a href="#addr-808C">808C</a></td>
<td><span class="label">.fscv_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8508">save_fscv_args</a></span>  <span class="comment">; Store A/X/Y in FS workspace</span></td>
<td class="hex">20 08 85</td>
</tr>

<tr id="addr-808F">
<td class="addr"><a href="#addr-808F">808F</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#8</span>  <span class="comment">; Function code &gt;= 8? Return (unsupported)</span></td>
<td class="hex">C9 08</td>
</tr>

<tr id="addr-8091">
<td class="addr"><a href="#addr-8091">8091</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-80AE">return_1</a></span></td>
<td class="hex">B0 1B</td>
</tr>

<tr id="addr-8093">
<td class="addr"><a href="#addr-8093">8093</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8094">
<td class="addr"><a href="#addr-8094">8094</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8095">
<td class="addr"><a href="#addr-8095">8095</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;12</span>  <span class="comment">; Y=$12: base offset for FSCV dispatch (indices 19+)</span></td>
<td class="hex">A0 12</td>
</tr>

<tr id="addr-8097">
<td class="addr"><a href="#addr-8097">8097</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-809F">dispatch</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 06</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Language entry dispatcher</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called when the NFS ROM is entered as a language. X = reason code</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (0-4). Dispatches via table indices 14-18 (base offset Y=$0D).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8099">
<td class="addr"><a href="#addr-8099">8099</a></td>
<td><span class="label">.language_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#5</span></td>
<td class="hex">E0 05</td>
</tr>

<tr id="addr-809B">
<td class="addr"><a href="#addr-809B">809B</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-80AE">return_1</a></span></td>
<td class="hex">B0 11</td>
</tr>

<tr id="addr-809D">
<td class="addr"><a href="#addr-809D">809D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0d</span>  <span class="comment">; Y=$0D: base offset for language handlers (index 14+)</span></td>
<td class="hex">A0 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; PHA/PHA/RTS computed dispatch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; X = command index within caller&#39;s group (e.g. service number)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Y = base offset into dispatch table (0, $0D, $20, etc.)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The loop adds Y+1 to X, so final X = command index + base + 1.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Then high and low bytes of (handler-1) are pushed onto the stack,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and RTS pops them and jumps to handler_address.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; This is a standard 6502 trick: RTS increments the popped address</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; by 1 before jumping, so the table stores (address - 1) to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; compensate. Multiple callers share one table via different Y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; base offsets.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-809F">
<td class="addr"><a href="#addr-809F">809F</a></td>
<td><span class="label">.dispatch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INX</span>  <span class="comment">; Add base offset Y to index X (loop: X += Y+1)</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-80A0">
<td class="addr"><a href="#addr-80A0">80A0</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-80A1">
<td class="addr"><a href="#addr-80A1">80A1</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-809F">dispatch</a></span></td>
<td class="hex">10 FC</td>
</tr>

<tr id="addr-80A3">
<td class="addr"><a href="#addr-80A3">80A3</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-80A4">
<td class="addr"><a href="#addr-80A4">80A4</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8044">dispatch_hi</a>,x</span>  <span class="comment">; Load high byte of (handler - 1) from table</span></td>
<td class="hex">BD 44 80</td>
</tr>

<tr id="addr-80A7">
<td class="addr"><a href="#addr-80A7">80A7</a></td>
<td>    <span class="opcode">PHA</span>  <span class="comment">; Push high byte onto stack</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-80A8">
<td class="addr"><a href="#addr-80A8">80A8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8020">dispatch_lo</a>,x</span>  <span class="comment">; Load low byte of (handler - 1) from table</span></td>
<td class="hex">BD 20 80</td>
</tr>

<tr id="addr-80AB">
<td class="addr"><a href="#addr-80AB">80AB</a></td>
<td>    <span class="opcode">PHA</span>  <span class="comment">; Push low byte onto stack</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-80AC">
<td class="addr"><a href="#addr-80AC">80AC</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00BB">fs_options</a></span>  <span class="comment">; Restore X (fileserver options) for use by handler</span></td>
<td class="hex">A6 BB</td>
</tr>

<tr id="addr-80AE">
<td class="addr"><a href="#addr-80AE">80AE</a></td>
<td><span class="label">.return_1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span>  <span class="comment">; RTS pops address, adds 1, jumps to handler</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service handler entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Intercepts three special service calls before normal dispatch:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FE: Tube init — explode character definitions (OSBYTE $14, X=6)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FF: Full init — set up WRCHV/RDCHV/BRKV/EVNTV, copy NMI handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        code from ROM to RAM pages $04-$06, copy workspace init to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        $0016-$0076, then fall through to select NFS.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $12 with Y=5: Select NFS as active filing system.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; All other service calls dispatch via dispatch_service ($8127).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-80AF">
<td class="addr"><a href="#addr-80AF">80AF</a></td>
<td><span class="label">.service_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;fe</span></td>
<td class="hex">C9 FE</td>
</tr>

<tr id="addr-80B1">
<td class="addr"><a href="#addr-80B1">80B1</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-811F">c811f</a></span></td>
<td class="hex">90 6C</td>
</tr>

<tr id="addr-80B3">
<td class="addr"><a href="#addr-80B3">80B3</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-80C8">init_vectors_and_copy</a></span></td>
<td class="hex">D0 13</td>
</tr>

<tr id="addr-80B5">
<td class="addr"><a href="#addr-80B5">80B5</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#0</span></td>
<td class="hex">C0 00</td>
</tr>

<tr id="addr-80B7">
<td class="addr"><a href="#addr-80B7">80B7</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-80AE">return_1</a></span></td>
<td class="hex">F0 F5</td>
</tr>

<tr id="addr-80B9">
<td class="addr"><a href="#addr-80B9">80B9</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0011">zp_temp_11</a></span></td>
<td class="hex">86 11</td>
</tr>

<tr id="addr-80BB">
<td class="addr"><a href="#addr-80BB">80BB</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0010">zp_temp_10</a></span></td>
<td class="hex">84 10</td>
</tr>

<tr id="addr-80BD">
<td class="addr"><a href="#addr-80BD">80BD</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#6</span></td>
<td class="hex">A2 06</td>
</tr>

<tr id="addr-80BF">
<td class="addr"><a href="#addr-80BF">80BF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_explode_chars</span></td>
<td class="hex">A9 14</td>
</tr>

<tr id="addr-80C1">
<td class="addr"><a href="#addr-80C1">80C1</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Explode character definition RAM (six extra pages), can redefine all characters 32-255 (X=6)</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-80C4">
<td class="addr"><a href="#addr-80C4">80C4</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0011">zp_temp_11</a></span></td>
<td class="hex">A6 11</td>
</tr>

<tr id="addr-80C6">
<td class="addr"><a href="#addr-80C6">80C6</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-811B">c811b</a></span></td>
<td class="hex">D0 53</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NFS initialisation (service $FF: full reset)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets up OS vectors for Tube co-processor support:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   WRCHV = $051C (page 5 — WRCH handler)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   RDCHV = $04E7 (page 4 — RDCH handler)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   BRKV  = $0016 (workspace — BRK/error handler)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   EVNTV = $06E8 (page 6 — event handler)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Writes $8E to Tube control register ($FEE0).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Then copies 3 pages of Tube host code from ROM ($934C/$944C/$954C)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to RAM ($0400/$0500/$0600), calls tube_post_init ($0414), and copies</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 97 bytes of workspace init from ROM ($9307) to $0016-$0076.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-80C8">
<td class="addr"><a href="#addr-80C8">80C8</a></td>
<td><span class="label">.init_vectors_and_copy</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;1c</span>  <span class="comment">; Set WRCHV = $051C (Tube WRCH handler)</span></td>
<td class="hex">A9 1C</td>
</tr>

<tr id="addr-80CA">
<td class="addr"><a href="#addr-80CA">80CA</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-020E">wrchv</a></span></td>
<td class="hex">8D 0E 02</td>
</tr>

<tr id="addr-80CD">
<td class="addr"><a href="#addr-80CD">80CD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#5</span></td>
<td class="hex">A9 05</td>
</tr>

<tr id="addr-80CF">
<td class="addr"><a href="#addr-80CF">80CF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">wrchv+1</span></td>
<td class="hex">8D 0F 02</td>
</tr>

<tr id="addr-80D2">
<td class="addr"><a href="#addr-80D2">80D2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e7</span>  <span class="comment">; Set RDCHV = $04E7 (Tube RDCH handler)</span></td>
<td class="hex">A9 E7</td>
</tr>

<tr id="addr-80D4">
<td class="addr"><a href="#addr-80D4">80D4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0210">rdchv</a></span></td>
<td class="hex">8D 10 02</td>
</tr>

<tr id="addr-80D7">
<td class="addr"><a href="#addr-80D7">80D7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#4</span></td>
<td class="hex">A9 04</td>
</tr>

<tr id="addr-80D9">
<td class="addr"><a href="#addr-80D9">80D9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">rdchv+1</span></td>
<td class="hex">8D 11 02</td>
</tr>

<tr id="addr-80DC">
<td class="addr"><a href="#addr-80DC">80DC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;16</span>  <span class="comment">; Set BRKV = $0016 (BRK handler in workspace)</span></td>
<td class="hex">A9 16</td>
</tr>

<tr id="addr-80DE">
<td class="addr"><a href="#addr-80DE">80DE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0202">brkv</a></span></td>
<td class="hex">8D 02 02</td>
</tr>

<tr id="addr-80E1">
<td class="addr"><a href="#addr-80E1">80E1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-80E3">
<td class="addr"><a href="#addr-80E3">80E3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">brkv+1</span></td>
<td class="hex">8D 03 02</td>
</tr>

<tr id="addr-80E6">
<td class="addr"><a href="#addr-80E6">80E6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e8</span>  <span class="comment">; Set EVNTV = $06E8 (event handler in page 6)</span></td>
<td class="hex">A9 E8</td>
</tr>

<tr id="addr-80E8">
<td class="addr"><a href="#addr-80E8">80E8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0220">evntv</a></span></td>
<td class="hex">8D 20 02</td>
</tr>

<tr id="addr-80EB">
<td class="addr"><a href="#addr-80EB">80EB</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#6</span></td>
<td class="hex">A9 06</td>
</tr>

<tr id="addr-80ED">
<td class="addr"><a href="#addr-80ED">80ED</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">evntv+1</span></td>
<td class="hex">8D 21 02</td>
</tr>

<tr id="addr-80F0">
<td class="addr"><a href="#addr-80F0">80F0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;8e</span>  <span class="comment">; Write $8E to Tube control register</span></td>
<td class="hex">A9 8E</td>
</tr>

<tr id="addr-80F2">
<td class="addr"><a href="#addr-80F2">80F2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">8D E0 FE</td>
</tr>

<tr id="addr-80F5">
<td class="addr"><a href="#addr-80F5">80F5</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0010">zp_temp_10</a></span></td>
<td class="hex">84 10</td>
</tr>

<tr id="addr-80F7">
<td class="addr"><a href="#addr-80F7">80F7</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy NMI handler code from ROM to RAM pages $04-$06</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-80F9">
<td class="addr"><a href="#addr-80F9">80F9</a></td>
<td><span class="label">.loop_c80f9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-934C">c934c</a>,y</span></td>
<td class="hex">B9 4C 93</td>
</tr>

<tr id="addr-80FC">
<td class="addr"><a href="#addr-80FC">80FC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0400">tube_code_page4</a>,y</span></td>
<td class="hex">99 00 04</td>
</tr>

<tr id="addr-80FF">
<td class="addr"><a href="#addr-80FF">80FF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-944C">l944c</a>,y</span></td>
<td class="hex">B9 4C 94</td>
</tr>

<tr id="addr-8102">
<td class="addr"><a href="#addr-8102">8102</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0500">tube_dispatch_table</a>,y</span></td>
<td class="hex">99 00 05</td>
</tr>

<tr id="addr-8105">
<td class="addr"><a href="#addr-8105">8105</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-954C">c954c</a>,y</span></td>
<td class="hex">B9 4C 95</td>
</tr>

<tr id="addr-8108">
<td class="addr"><a href="#addr-8108">8108</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0600">tube_code_page6</a>,y</span></td>
<td class="hex">99 00 06</td>
</tr>

<tr id="addr-810B">
<td class="addr"><a href="#addr-810B">810B</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-810C">
<td class="addr"><a href="#addr-810C">810C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-80F9">loop_c80f9</a></span></td>
<td class="hex">D0 EB</td>
</tr>

<tr id="addr-810E">
<td class="addr"><a href="#addr-810E">810E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0414">tube_post_init</a></span></td>
<td class="hex">20 14 04</td>
</tr>

<tr id="addr-8111">
<td class="addr"><a href="#addr-8111">8111</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;60</span></td>
<td class="hex">A2 60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy NMI workspace initialiser from ROM to $0016-$0076</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8113">
<td class="addr"><a href="#addr-8113">8113</a></td>
<td><span class="label">.loop_c8113</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9307">c9307</a>,x</span></td>
<td class="hex">BD 07 93</td>
</tr>

<tr id="addr-8116">
<td class="addr"><a href="#addr-8116">8116</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0016">nmi_workspace_start</a>,x</span></td>
<td class="hex">95 16</td>
</tr>

<tr id="addr-8118">
<td class="addr"><a href="#addr-8118">8118</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8119">
<td class="addr"><a href="#addr-8119">8119</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8113">loop_c8113</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-811B">
<td class="addr"><a href="#addr-811B">811B</a></td>
<td><span class="label">.c811b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0010">zp_temp_10</a></span></td>
<td class="hex">A4 10</td>
</tr>

<tr id="addr-811D">
<td class="addr"><a href="#addr-811D">811D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-811F">
<td class="addr"><a href="#addr-811F">811F</a></td>
<td><span class="label">.c811f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;12</span></td>
<td class="hex">C9 12</td>
</tr>

<tr id="addr-8121">
<td class="addr"><a href="#addr-8121">8121</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8127">dispatch_service</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-8123">
<td class="addr"><a href="#addr-8123">8123</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#5</span></td>
<td class="hex">C0 05</td>
</tr>

<tr id="addr-8125">
<td class="addr"><a href="#addr-8125">8125</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8184">select_nfs</a></span></td>
<td class="hex">F0 5D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service call dispatcher</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatches MOS service calls 0-12 via the shared dispatch table.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Uses base offset Y=0, so table index = service number + 1.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service numbers &gt;= 13 are ignored (branch to return_2).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called via JSR $809F rather than fall-through, so it returns</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to $813C to restore saved registers.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8127">
<td class="addr"><a href="#addr-8127">8127</a></td>
<td><span class="label">.dispatch_service</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">C9 0D</td>
</tr>

<tr id="addr-8129">
<td class="addr"><a href="#addr-8129">8129</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8145">return_2</a></span></td>
<td class="hex">B0 1A</td>
</tr>

<tr id="addr-812B">
<td class="addr"><a href="#addr-812B">812B</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-812C">
<td class="addr"><a href="#addr-812C">812C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">A5 CE</td>
</tr>

<tr id="addr-812E">
<td class="addr"><a href="#addr-812E">812E</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-812F">
<td class="addr"><a href="#addr-812F">812F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">A5 CD</td>
</tr>

<tr id="addr-8131">
<td class="addr"><a href="#addr-8131">8131</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8132">
<td class="addr"><a href="#addr-8132">8132</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">86 CE</td>
</tr>

<tr id="addr-8134">
<td class="addr"><a href="#addr-8134">8134</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">84 CD</td>
</tr>

<tr id="addr-8136">
<td class="addr"><a href="#addr-8136">8136</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8137">
<td class="addr"><a href="#addr-8137">8137</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span>  <span class="comment">; Y=0: base offset for service calls (index 1+)</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8139">
<td class="addr"><a href="#addr-8139">8139</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-809F">dispatch</a></span>  <span class="comment">; JSR to dispatcher (returns here after handler completes)</span></td>
<td class="hex">20 9F 80</td>
</tr>

<tr id="addr-813C">
<td class="addr"><a href="#addr-813C">813C</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">A6 CE</td>
</tr>

<tr id="addr-813E">
<td class="addr"><a href="#addr-813E">813E</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-813F">
<td class="addr"><a href="#addr-813F">813F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">85 CD</td>
</tr>

<tr id="addr-8141">
<td class="addr"><a href="#addr-8141">8141</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8142">
<td class="addr"><a href="#addr-8142">8142</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">85 CE</td>
</tr>

<tr id="addr-8144">
<td class="addr"><a href="#addr-8144">8144</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8145">
<td class="addr"><a href="#addr-8145">8145</a></td>
<td><span class="label">.return_2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Resume after remote operation / *ROFF handler (NROFF)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks byte 4 of (net_rx_ptr): if non-zero, the keyboard was</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; disabled during a remote operation (peek/poke/boot). Clears</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the flag, re-enables the keyboard via OSBYTE $C9, and sends</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; function $0A to notify completion. Also handles *ROFF and the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; triple-plus escape sequence (+++), which resets system masks</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; via OSBYTE $CE and returns control to the MOS, providing an</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; escape route when a remote session becomes unresponsive.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8146">
<td class="addr"><a href="#addr-8146">8146</a></td>
<td><span class="label">.resume_after_remote</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-8148">
<td class="addr"><a href="#addr-8148">8148</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-814A">
<td class="addr"><a href="#addr-814A">814A</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8145">return_2</a></span></td>
<td class="hex">F0 F9</td>
</tr>

<tr id="addr-814C">
<td class="addr"><a href="#addr-814C">814C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-814E">
<td class="addr"><a href="#addr-814E">814E</a></td>
<td>    <span class="opcode">TAX</span>  <span class="comment">; X=&amp;00</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-814F">
<td class="addr"><a href="#addr-814F">814F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-8151">
<td class="addr"><a href="#addr-8151">8151</a></td>
<td>    <span class="opcode">TAY</span>  <span class="comment">; Y=&amp;00</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8152">
<td class="addr"><a href="#addr-8152">8152</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_write_econet_keyboard_disable</span></td>
<td class="hex">A9 C9</td>
</tr>

<tr id="addr-8154">
<td class="addr"><a href="#addr-8154">8154</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Enable keyboard (for Econet)</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-8157">
<td class="addr"><a href="#addr-8157">8157</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0a</span></td>
<td class="hex">A9 0A</td>
</tr>

<tr id="addr-8159">
<td class="addr"><a href="#addr-8159">8159</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-904B">setup_tx_and_send</a></span></td>
<td class="hex">20 4B 90</td>
</tr>

<tr id="addr-815C">
<td class="addr"><a href="#addr-815C">815C</a></td>
<td><span class="label">.clear_osbyte_ce_cf</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">86 9E</td>
</tr>

<tr id="addr-815E">
<td class="addr"><a href="#addr-815E">815E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ce</span></td>
<td class="hex">A9 CE</td>
</tr>

<tr id="addr-8160">
<td class="addr"><a href="#addr-8160">8160</a></td>
<td><span class="label">.loop_c8160</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">A6 9E</td>
</tr>

<tr id="addr-8162">
<td class="addr"><a href="#addr-8162">8162</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A0 7F</td>
</tr>

<tr id="addr-8164">
<td class="addr"><a href="#addr-8164">8164</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-8167">
<td class="addr"><a href="#addr-8167">8167</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#1</span></td>
<td class="hex">69 01</td>
</tr>

<tr id="addr-8169">
<td class="addr"><a href="#addr-8169">8169</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;d0</span></td>
<td class="hex">C9 D0</td>
</tr>

<tr id="addr-816B">
<td class="addr"><a href="#addr-816B">816B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8160">loop_c8160</a></span></td>
<td class="hex">F0 F3</td>
</tr>

<tr id="addr-816D">
<td class="addr"><a href="#addr-816D">816D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-816F">
<td class="addr"><a href="#addr-816F">816F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">85 9E</td>
</tr>

<tr id="addr-8171">
<td class="addr"><a href="#addr-8171">8171</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service 4: unrecognised * command</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Matches the command text against ROM string table entries:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   X=8: matches &#34;ROFF&#34; at $8010 (within copyright string) → *ROFF</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        (log off from fileserver) — jumps to resume_after_remote</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   X=1: matches &#34;NET&#34; at $8009 (ROM title) → *NET (select NFS)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        — falls through to select_nfs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If neither matches, returns with the service call unclaimed.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8172">
<td class="addr"><a href="#addr-8172">8172</a></td>
<td><span class="label">.svc_star_command</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#8</span></td>
<td class="hex">A2 08</td>
</tr>

<tr id="addr-8174">
<td class="addr"><a href="#addr-8174">8174</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-819B">match_rom_string</a></span></td>
<td class="hex">20 9B 81</td>
</tr>

<tr id="addr-8177">
<td class="addr"><a href="#addr-8177">8177</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-817D">c817d</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-8179">
<td class="addr"><a href="#addr-8179">8179</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">85 CE</td>
</tr>

<tr id="addr-817B">
<td class="addr"><a href="#addr-817B">817B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8146">resume_after_remote</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">F0 C9</td>
</tr>

<tr id="addr-817D">
<td class="addr"><a href="#addr-817D">817D</a></td>
<td><span class="label">.c817d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-817F">
<td class="addr"><a href="#addr-817F">817F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-819B">match_rom_string</a></span></td>
<td class="hex">20 9B 81</td>
</tr>

<tr id="addr-8182">
<td class="addr"><a href="#addr-8182">8182</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-81C9">c81c9</a></span></td>
<td class="hex">D0 45</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Select NFS as active filing system (INIT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reached from service $12 (select FS) with Y=5, or when *NET command</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; selects NFS. Notifies the current FS of shutdown via FSCV A=6 —</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; this triggers the outgoing FS to save its context back to its</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; workspace page, allowing restoration if re-selected later (the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FSDIE handoff mechanism). Then sets up the standard OS vector</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; indirections (FILEV through FSCV) to NFS entry points, claims the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; extended vector table entries, and issues service $0F (vectors</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; claimed) to notify other ROMs. If fs_temp_cd is zero (auto-boot</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; not inhibited), injects the synthetic command &#34;I .BOOT&#34; through</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the command decoder to trigger auto-boot login.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8184">
<td class="addr"><a href="#addr-8184">8184</a></td>
<td><span class="label">.select_nfs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-81CC">call_fscv_shutdown</a></span></td>
<td class="hex">20 CC 81</td>
</tr>

<tr id="addr-8187">
<td class="addr"><a href="#addr-8187">8187</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8188">
<td class="addr"><a href="#addr-8188">8188</a></td>
<td>    <span class="opcode">ROR</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">66 CD</td>
</tr>

<tr id="addr-818A">
<td class="addr"><a href="#addr-818A">818A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-822E">issue_vectors_claimed</a></span></td>
<td class="hex">20 2E 82</td>
</tr>

<tr id="addr-818D">
<td class="addr"><a href="#addr-818D">818D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;1d</span></td>
<td class="hex">A0 1D</td>
</tr>

<tr id="addr-818F">
<td class="addr"><a href="#addr-818F">818F</a></td>
<td><span class="label">.loop_c818f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-8191">
<td class="addr"><a href="#addr-8191">8191</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0DEB">fs_state_deb</a>,y</span></td>
<td class="hex">99 EB 0D</td>
</tr>

<tr id="addr-8194">
<td class="addr"><a href="#addr-8194">8194</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8195">
<td class="addr"><a href="#addr-8195">8195</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;14</span></td>
<td class="hex">C0 14</td>
</tr>

<tr id="addr-8197">
<td class="addr"><a href="#addr-8197">8197</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-818F">loop_c818f</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-8199">
<td class="addr"><a href="#addr-8199">8199</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8217">setup_fs_vectors</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">F0 7C</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Match command text against ROM string table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Compares characters from (os_text_ptr)+Y against bytes starting</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; at binary_version+X ($8008+X). Input is uppercased via AND $DF.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Returns with Z=1 if the ROM string&#39;s NUL terminator was reached</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (match), or Z=0 if a mismatch was found. On match, Y points</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; past the matched text; on return, skips trailing spaces.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-819B">
<td class="addr"><a href="#addr-819B">819B</a></td>
<td><span class="label">.match_rom_string</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">A4 CD</td>
</tr>

<tr id="addr-819D">
<td class="addr"><a href="#addr-819D">819D</a></td>
<td><span class="label">.loop_c819d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F2">os_text_ptr</a>),y</span></td>
<td class="hex">B1 F2</td>
</tr>

<tr id="addr-819F">
<td class="addr"><a href="#addr-819F">819F</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;df</span></td>
<td class="hex">29 DF</td>
</tr>

<tr id="addr-81A1">
<td class="addr"><a href="#addr-81A1">81A1</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-81AC">cmd_name_matched</a></span></td>
<td class="hex">F0 09</td>
</tr>

<tr id="addr-81A3">
<td class="addr"><a href="#addr-81A3">81A3</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-8008">binary_version</a>,x</span></td>
<td class="hex">DD 08 80</td>
</tr>

<tr id="addr-81A6">
<td class="addr"><a href="#addr-81A6">81A6</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-81AC">cmd_name_matched</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-81A8">
<td class="addr"><a href="#addr-81A8">81A8</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-81A9">
<td class="addr"><a href="#addr-81A9">81A9</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-81AA">
<td class="addr"><a href="#addr-81AA">81AA</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-819D">loop_c819d</a></span></td>
<td class="hex">D0 F1</td>
</tr>

<tr id="addr-81AC">
<td class="addr"><a href="#addr-81AC">81AC</a></td>
<td><span class="label">.cmd_name_matched</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8008">binary_version</a>,x</span></td>
<td class="hex">BD 08 80</td>
</tr>

<tr id="addr-81AF">
<td class="addr"><a href="#addr-81AF">81AF</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-81B3">skip_cmd_spaces</a></span></td>
<td class="hex">F0 02</td>
</tr>

<tr id="addr-81B1">
<td class="addr"><a href="#addr-81B1">81B1</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-81B2">
<td class="addr"><a href="#addr-81B2">81B2</a></td>
<td><span class="label">.loop_c81b2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-81B3">
<td class="addr"><a href="#addr-81B3">81B3</a></td>
<td><span class="label">.skip_cmd_spaces</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F2">os_text_ptr</a>),y</span></td>
<td class="hex">B1 F2</td>
</tr>

<tr id="addr-81B5">
<td class="addr"><a href="#addr-81B5">81B5</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;20</span></td>
<td class="hex">C9 20</td>
</tr>

<tr id="addr-81B7">
<td class="addr"><a href="#addr-81B7">81B7</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-81B2">loop_c81b2</a></span></td>
<td class="hex">F0 F9</td>
</tr>

<tr id="addr-81B9">
<td class="addr"><a href="#addr-81B9">81B9</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">49 0D</td>
</tr>

<tr id="addr-81BB">
<td class="addr"><a href="#addr-81BB">81BB</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service 9: *HELP</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Prints the ROM identification string using print_inline.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-81BC">
<td class="addr"><a href="#addr-81BC">81BC</a></td>
<td><span class="label">.svc_help</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-81BF">
<td class="addr"><a href="#addr-81BF">81BF</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;.NFS 3.34.&quot;</span></td>
<td class="hex">0D 4E 46 53 20 33 2E 33 34 0D</td>
</tr>

<tr id="addr-81C9">
<td class="addr"><a href="#addr-81C9">81C9</a></td>
<td><span class="label">.c81c9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">A4 CD</td>
</tr>

<tr id="addr-81CB">
<td class="addr"><a href="#addr-81CB">81CB</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Notify filing system of shutdown</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Loads A=6 (FS shutdown notification) and JMP (FSCV).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The FSCV handler&#39;s RTS returns to the caller of this routine</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (JSR/JMP trick saves one level of stack).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-81CC">
<td class="addr"><a href="#addr-81CC">81CC</a></td>
<td><span class="label">.call_fscv_shutdown</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#6</span></td>
<td class="hex">A9 06</td>
</tr>

<tr id="addr-81CE">
<td class="addr"><a href="#addr-81CE">81CE</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand">(<a href="#addr-021E">fscv</a>)</span></td>
<td class="hex">6C 1E 02</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service 3: auto-boot</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Notifies current FS of shutdown via FSCV A=6. Scans keyboard</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (OSBYTE $7A): if no key is pressed, auto-boot proceeds; if the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; &#39;N&#39; key is pressed (matrix address $55), the boot is declined</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and the key is forgotten via OSBYTE $78. Any other key also</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; declines. Prints &#34;Econet Station &lt;n&gt;&#34; and checks the ADLC SR2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; for the network clock signal — prints &#34;No Clock&#34; if absent (no</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; network communication possible without it). Then falls through</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to set up NFS vectors (selecting NFS as the filing system).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-81D1">
<td class="addr"><a href="#addr-81D1">81D1</a></td>
<td><span class="label">.svc_autoboot</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-81CC">call_fscv_shutdown</a></span></td>
<td class="hex">20 CC 81</td>
</tr>

<tr id="addr-81D4">
<td class="addr"><a href="#addr-81D4">81D4</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_scan_keyboard_from_16</span></td>
<td class="hex">A9 7A</td>
</tr>

<tr id="addr-81D6">
<td class="addr"><a href="#addr-81D6">81D6</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Keyboard scan starting from key 16</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-81D9">
<td class="addr"><a href="#addr-81D9">81D9</a></td>
<td>    <span class="opcode">TXA</span>  <span class="comment">; X is key number if key is pressed, or &amp;ff otherwise</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-81DA">
<td class="addr"><a href="#addr-81DA">81DA</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-81E6">c81e6</a></span></td>
<td class="hex">30 0A</td>
</tr>

<tr id="addr-81DC">
<td class="addr"><a href="#addr-81DC">81DC</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;55</span></td>
<td class="hex">49 55</td>
</tr>

<tr id="addr-81DE">
<td class="addr"><a href="#addr-81DE">81DE</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-81C9">c81c9</a></span></td>
<td class="hex">D0 E9</td>
</tr>

<tr id="addr-81E0">
<td class="addr"><a href="#addr-81E0">81E0</a></td>
<td>    <span class="opcode">TAY</span>  <span class="comment">; Y=key</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-81E1">
<td class="addr"><a href="#addr-81E1">81E1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_write_keys_pressed</span></td>
<td class="hex">A9 78</td>
</tr>

<tr id="addr-81E3">
<td class="addr"><a href="#addr-81E3">81E3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Write current keys pressed (X and Y)</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-81E6">
<td class="addr"><a href="#addr-81E6">81E6</a></td>
<td><span class="label">.c81e6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-81E9">
<td class="addr"><a href="#addr-81E9">81E9</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Econet Station &quot;</span></td>
<td class="hex">45 63 6F 6E 65 74 20 53 74 61 74 69 6F 6E 20</td>
</tr>

<tr id="addr-81F8">
<td class="addr"><a href="#addr-81F8">81F8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D62">tx_clear_flag</a></span></td>
<td class="hex">AD 62 0D</td>
</tr>

<tr id="addr-81FB">
<td class="addr"><a href="#addr-81FB">81FB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85AF">print_decimal</a></span></td>
<td class="hex">20 AF 85</td>
</tr>

<tr id="addr-81FE">
<td class="addr"><a href="#addr-81FE">81FE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A9 20</td>
</tr>

<tr id="addr-8200">
<td class="addr"><a href="#addr-8200">8200</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-8203">
<td class="addr"><a href="#addr-8203">8203</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8212">c8212</a></span></td>
<td class="hex">F0 0D</td>
</tr>

<tr id="addr-8205">
<td class="addr"><a href="#addr-8205">8205</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8208">
<td class="addr"><a href="#addr-8208">8208</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot; No Clock&quot;</span></td>
<td class="hex">20 4E 6F 20 43 6C 6F 63 6B</td>
</tr>

<tr id="addr-8211">
<td class="addr"><a href="#addr-8211">8211</a></td>
<td>    <span class="opcode">NOP</span></td>
<td class="hex">EA</td>
</tr>

<tr id="addr-8212">
<td class="addr"><a href="#addr-8212">8212</a></td>
<td><span class="label">.c8212</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8215">
<td class="addr"><a href="#addr-8215">8215</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;..&quot;</span></td>
<td class="hex">0D 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set up filing system vectors</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies 14 bytes from fs_vector_addrs ($824D) into FILEV-FSCV ($0212).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; These set all 7 filing system vectors to the standard extended vector</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; dispatch addresses ($FF1B, $FF1E, $FF21, $FF24, $FF27, $FF2A, $FF2D).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Then calls setup_rom_ptrs_netv to install the extended vector table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; entries with the actual NFS handler addresses, and issues service</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; requests to notify other ROMs.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8217">
<td class="addr"><a href="#addr-8217">8217</a></td>
<td><span class="label">.setup_fs_vectors</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0d</span>  <span class="comment">; Copy 14 bytes: FS vector addresses → FILEV-FSCV</span></td>
<td class="hex">A0 0D</td>
</tr>

<tr id="addr-8219">
<td class="addr"><a href="#addr-8219">8219</a></td>
<td><span class="label">.loop_c8219</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-824D">fs_vector_addrs</a>,y</span></td>
<td class="hex">B9 4D 82</td>
</tr>

<tr id="addr-821C">
<td class="addr"><a href="#addr-821C">821C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0212">filev</a>,y</span></td>
<td class="hex">99 12 02</td>
</tr>

<tr id="addr-821F">
<td class="addr"><a href="#addr-821F">821F</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8220">
<td class="addr"><a href="#addr-8220">8220</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8219">loop_c8219</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-8222">
<td class="addr"><a href="#addr-8222">8222</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-82D1">setup_rom_ptrs_netv</a></span></td>
<td class="hex">20 D1 82</td>
</tr>

<tr id="addr-8225">
<td class="addr"><a href="#addr-8225">8225</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;1b</span></td>
<td class="hex">A0 1B</td>
</tr>

<tr id="addr-8227">
<td class="addr"><a href="#addr-8227">8227</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#7</span></td>
<td class="hex">A2 07</td>
</tr>

<tr id="addr-8229">
<td class="addr"><a href="#addr-8229">8229</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-82E5">store_rom_ptr_pair</a></span></td>
<td class="hex">20 E5 82</td>
</tr>

<tr id="addr-822C">
<td class="addr"><a href="#addr-822C">822C</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">86 CE</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Issue &#39;vectors claimed&#39; service and optionally auto-boot</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Issues service $0F (vectors claimed) via OSBYTE $8F, then</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; service $0A. If fs_temp_cd is zero (auto-boot not inhibited),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; sets up the command string &#34;I .BOOT&#34; at $8245 and jumps to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the FSCV 3 unrecognised-command handler (which matches against</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the command table at $8BD6). The &#34;I.&#34; prefix triggers the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; catch-all entry which forwards the command to the fileserver.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-822E">
<td class="addr"><a href="#addr-822E">822E</a></td>
<td><span class="label">.issue_vectors_claimed</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_issue_service_request</span></td>
<td class="hex">A9 8F</td>
</tr>

<tr id="addr-8230">
<td class="addr"><a href="#addr-8230">8230</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0f</span></td>
<td class="hex">A2 0F</td>
</tr>

<tr id="addr-8232">
<td class="addr"><a href="#addr-8232">8232</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Issue paged ROM service call, Reason X=15 - Vectors claimed</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-8235">
<td class="addr"><a href="#addr-8235">8235</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0a</span></td>
<td class="hex">A2 0A</td>
</tr>

<tr id="addr-8237">
<td class="addr"><a href="#addr-8237">8237</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-823A">
<td class="addr"><a href="#addr-823A">823A</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">A6 CD</td>
</tr>

<tr id="addr-823C">
<td class="addr"><a href="#addr-823C">823C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8275">return_3</a></span></td>
<td class="hex">D0 37</td>
</tr>

<tr id="addr-823E">
<td class="addr"><a href="#addr-823E">823E</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;45</span></td>
<td class="hex">A2 45</td>
</tr>

<tr id="addr-8240">
<td class="addr"><a href="#addr-8240">8240</a></td>
<td><span class="label">.c8240</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;82</span></td>
<td class="hex">A0 82</td>
</tr>

<tr id="addr-8242">
<td class="addr"><a href="#addr-8242">8242</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8B92">fscv_star_handler</a></span></td>
<td class="hex">4C 92 8B</td>
</tr>

<tr id="addr-8245">
<td class="addr"><a href="#addr-8245">8245</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;I .BOOT&quot;</span></td>
<td class="hex">49 20 2E 42 4F 4F 54</td>
</tr>

<tr id="addr-824C">
<td class="addr"><a href="#addr-824C">824C</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D</td>
<td class="hex">0D</td>
</tr>

<tr id="addr-824D">
<td class="addr"><a href="#addr-824D">824D</a></td>
<td><span class="label">.fs_vector_addrs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;1B, &amp;FF, &amp;1E, &amp;FF, &amp;21, &amp;FF, &amp;24, &amp;FF, &amp;27, &amp;FF, &amp;2A, &amp;FF, &amp;2D, &amp;FF, &amp;94, &amp;86, &amp;00, &amp;E1, &amp;88, &amp;00, &amp;85, &amp;84, &amp;00, &amp;A2, &amp;83, &amp;00, &amp;EA, &amp;89, &amp;00, &amp;49, &amp;89, &amp;00, &amp;8C, &amp;80</td>
<td class="hex">1B FF 1E FF 21 FF 24 FF 27 FF 2A FF 2D FF 94 86 00 E1 88 00 85 84 00 A2 83 00 EA 89 00 49 89 00 8C 80</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service 1: claim absolute workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Claims pages up to $10 for NMI workspace ($0D), FS state ($0E),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and FS command buffer ($0F). If Y &gt;= $10, workspace already</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; allocated — returns unchanged.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-826F">
<td class="addr"><a href="#addr-826F">826F</a></td>
<td><span class="label">.svc_abs_workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;10</span></td>
<td class="hex">C0 10</td>
</tr>

<tr id="addr-8271">
<td class="addr"><a href="#addr-8271">8271</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8275">return_3</a></span></td>
<td class="hex">B0 02</td>
</tr>

<tr id="addr-8273">
<td class="addr"><a href="#addr-8273">8273</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;10</span></td>
<td class="hex">A0 10</td>
</tr>

<tr id="addr-8275">
<td class="addr"><a href="#addr-8275">8275</a></td>
<td><span class="label">.return_3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8276">
<td class="addr"><a href="#addr-8276">8276</a></td>
<td>    <span class="directive">EQUB</span> &amp;07, &amp;90</td>
<td class="hex">07 90</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Service 2: claim private workspace and initialise NFS</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Y = next available workspace page on entry.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets up net_rx_ptr (Y) and nfs_workspace (Y+1) page pointers.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On soft break (OSBYTE $FD returns 0): skips FS state init,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; preserving existing login state, file server selection, and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; control block configuration — this is why pressing BREAK</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; keeps the user logged in.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On power-up/CTRL-BREAK (result non-zero):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Sets FS server station to $FE (FS, the default; no server)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Sets printer server to $EB (PS, the default)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Clears FS handles, OPT byte, message flag, SEQNOS</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Initialises all RXCBs with $3F flag (available)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; In both cases: reads station ID from $FE18 (only valid during</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; reset), calls adlc_init, enables user-level RX (LFLAG=$40).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8278">
<td class="addr"><a href="#addr-8278">8278</a></td>
<td><span class="label">.svc_private_workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-009D">net_rx_ptr_hi</a></span></td>
<td class="hex">84 9D</td>
</tr>

<tr id="addr-827A">
<td class="addr"><a href="#addr-827A">827A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-827B">
<td class="addr"><a href="#addr-827B">827B</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">84 9F</td>
</tr>

<tr id="addr-827D">
<td class="addr"><a href="#addr-827D">827D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-827F">
<td class="addr"><a href="#addr-827F">827F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-8281">
<td class="addr"><a href="#addr-8281">8281</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-8283">
<td class="addr"><a href="#addr-8283">8283</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A0 FF</td>
</tr>

<tr id="addr-8285">
<td class="addr"><a href="#addr-8285">8285</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-009C">net_rx_ptr</a></span></td>
<td class="hex">85 9C</td>
</tr>

<tr id="addr-8287">
<td class="addr"><a href="#addr-8287">8287</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">85 9E</td>
</tr>

<tr id="addr-8289">
<td class="addr"><a href="#addr-8289">8289</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">85 CD</td>
</tr>

<tr id="addr-828B">
<td class="addr"><a href="#addr-828B">828B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3A">tx_ctrl_status</a></span></td>
<td class="hex">8D 3A 0D</td>
</tr>

<tr id="addr-828E">
<td class="addr"><a href="#addr-828E">828E</a></td>
<td>    <span class="opcode">TAX</span>  <span class="comment">; X=&amp;00</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-828F">
<td class="addr"><a href="#addr-828F">828F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_write_last_break_type</span>  <span class="comment">; OSBYTE $FD: read type of last reset</span></td>
<td class="hex">A9 FD</td>
</tr>

<tr id="addr-8291">
<td class="addr"><a href="#addr-8291">8291</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Read type of last reset</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-8294">
<td class="addr"><a href="#addr-8294">8294</a></td>
<td>    <span class="opcode">TXA</span>  <span class="comment">; X=value of type of last reset</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8295">
<td class="addr"><a href="#addr-8295">8295</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-82C3">c82c3</a></span>  <span class="comment">; Soft break (X=0): skip FS init</span></td>
<td class="hex">F0 2C</td>
</tr>

<tr id="addr-8297">
<td class="addr"><a href="#addr-8297">8297</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;15</span></td>
<td class="hex">A0 15</td>
</tr>

<tr id="addr-8299">
<td class="addr"><a href="#addr-8299">8299</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;fe</span></td>
<td class="hex">A9 FE</td>
</tr>

<tr id="addr-829B">
<td class="addr"><a href="#addr-829B">829B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E00">fs_server_stn</a></span>  <span class="comment">; Station $FE = no server selected</span></td>
<td class="hex">8D 00 0E</td>
</tr>

<tr id="addr-829E">
<td class="addr"><a href="#addr-829E">829E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-82A0">
<td class="addr"><a href="#addr-82A0">82A0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr id="addr-82A2">
<td class="addr"><a href="#addr-82A2">82A2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;eb</span></td>
<td class="hex">A9 EB</td>
</tr>

<tr id="addr-82A4">
<td class="addr"><a href="#addr-82A4">82A4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-82A6">
<td class="addr"><a href="#addr-82A6">82A6</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;03</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-82A7">
<td class="addr"><a href="#addr-82A7">82A7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-82A9">
<td class="addr"><a href="#addr-82A9">82A9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E01">fs_server_net</a></span></td>
<td class="hex">8D 01 0E</td>
</tr>

<tr id="addr-82AC">
<td class="addr"><a href="#addr-82AC">82AC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-82AE">
<td class="addr"><a href="#addr-82AE">82AE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">8D 63 0D</td>
</tr>

<tr id="addr-82B1">
<td class="addr"><a href="#addr-82B1">82B1</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E06">fs_messages_flag</a></span></td>
<td class="hex">8D 06 0E</td>
</tr>

<tr id="addr-82B4">
<td class="addr"><a href="#addr-82B4">82B4</a></td>
<td><span class="label">.loop_c82b4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">A5 CD</td>
</tr>

<tr id="addr-82B6">
<td class="addr"><a href="#addr-82B6">82B6</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8DB7">calc_handle_offset</a></span></td>
<td class="hex">20 B7 8D</td>
</tr>

<tr id="addr-82B9">
<td class="addr"><a href="#addr-82B9">82B9</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-82C3">c82c3</a></span></td>
<td class="hex">B0 08</td>
</tr>

<tr id="addr-82BB">
<td class="addr"><a href="#addr-82BB">82BB</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">A9 3F</td>
</tr>

<tr id="addr-82BD">
<td class="addr"><a href="#addr-82BD">82BD</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-82BF">
<td class="addr"><a href="#addr-82BF">82BF</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">E6 CD</td>
</tr>

<tr id="addr-82C1">
<td class="addr"><a href="#addr-82C1">82C1</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-82B4">loop_c82b4</a></span></td>
<td class="hex">D0 F1</td>
</tr>

<tr id="addr-82C3">
<td class="addr"><a href="#addr-82C3">82C3</a></td>
<td><span class="label">.c82c3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; Read station ID (also INTOFF)</span></td>
<td class="hex">AD 18 FE</td>
</tr>

<tr id="addr-82C6">
<td class="addr"><a href="#addr-82C6">82C6</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D62">tx_clear_flag</a></span></td>
<td class="hex">8D 62 0D</td>
</tr>

<tr id="addr-82C9">
<td class="addr"><a href="#addr-82C9">82C9</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9663">trampoline_adlc_init</a></span>  <span class="comment">; Initialise ADLC hardware</span></td>
<td class="hex">20 63 96</td>
</tr>

<tr id="addr-82CC">
<td class="addr"><a href="#addr-82CC">82CC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;40</span></td>
<td class="hex">A9 40</td>
</tr>

<tr id="addr-82CE">
<td class="addr"><a href="#addr-82CE">82CE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">8D 38 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set up ROM pointer table and NETV</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the ROM pointer table base address via OSBYTE $A8, stores</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; it in osrdsc_ptr ($F6). Sets NETV low byte to $36. Then copies</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; one 3-byte extended vector entry (addr=$9007, rom=current) into</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the ROM pointer table at offset $36, installing osword_dispatch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; as the NETV handler.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-82D1">
<td class="addr"><a href="#addr-82D1">82D1</a></td>
<td><span class="label">.setup_rom_ptrs_netv</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_rom_ptr_table_low</span></td>
<td class="hex">A9 A8</td>
</tr>

<tr id="addr-82D3">
<td class="addr"><a href="#addr-82D3">82D3</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-82D5">
<td class="addr"><a href="#addr-82D5">82D5</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A0 FF</td>
</tr>

<tr id="addr-82D7">
<td class="addr"><a href="#addr-82D7">82D7</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Read address of ROM pointer table</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-82DA">
<td class="addr"><a href="#addr-82DA">82DA</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00F6">osrdsc_ptr</a></span>  <span class="comment">; X=value of address of ROM pointer table (low byte)</span></td>
<td class="hex">86 F6</td>
</tr>

<tr id="addr-82DC">
<td class="addr"><a href="#addr-82DC">82DC</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00F7">l00f7</a></span>  <span class="comment">; Y=value of address of ROM pointer table (high byte)</span></td>
<td class="hex">84 F7</td>
</tr>

<tr id="addr-82DE">
<td class="addr"><a href="#addr-82DE">82DE</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;36</span></td>
<td class="hex">A0 36</td>
</tr>

<tr id="addr-82E0">
<td class="addr"><a href="#addr-82E0">82E0</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0224">netv</a></span></td>
<td class="hex">8C 24 02</td>
</tr>

<tr id="addr-82E3">
<td class="addr"><a href="#addr-82E3">82E3</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-82E5">
<td class="addr"><a href="#addr-82E5">82E5</a></td>
<td><span class="label">.store_rom_ptr_pair</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8240">c8240</a>,y</span></td>
<td class="hex">B9 40 82</td>
</tr>

<tr id="addr-82E8">
<td class="addr"><a href="#addr-82E8">82E8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F6">osrdsc_ptr</a>),y</span></td>
<td class="hex">91 F6</td>
</tr>

<tr id="addr-82EA">
<td class="addr"><a href="#addr-82EA">82EA</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-82EB">
<td class="addr"><a href="#addr-82EB">82EB</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8240">c8240</a>,y</span></td>
<td class="hex">B9 40 82</td>
</tr>

<tr id="addr-82EE">
<td class="addr"><a href="#addr-82EE">82EE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F6">osrdsc_ptr</a>),y</span></td>
<td class="hex">91 F6</td>
</tr>

<tr id="addr-82F0">
<td class="addr"><a href="#addr-82F0">82F0</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-82F1">
<td class="addr"><a href="#addr-82F1">82F1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00F4">romsel_copy</a></span></td>
<td class="hex">A5 F4</td>
</tr>

<tr id="addr-82F3">
<td class="addr"><a href="#addr-82F3">82F3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F6">osrdsc_ptr</a>),y</span></td>
<td class="hex">91 F6</td>
</tr>

<tr id="addr-82F5">
<td class="addr"><a href="#addr-82F5">82F5</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-82F6">
<td class="addr"><a href="#addr-82F6">82F6</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-82F7">
<td class="addr"><a href="#addr-82F7">82F7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-82E5">store_rom_ptr_pair</a></span></td>
<td class="hex">D0 EC</td>
</tr>

<tr id="addr-82F9">
<td class="addr"><a href="#addr-82F9">82F9</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A4 9F</td>
</tr>

<tr id="addr-82FB">
<td class="addr"><a href="#addr-82FB">82FB</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-82FC">
<td class="addr"><a href="#addr-82FC">82FC</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FSCV 6: Filing system shutdown / save state (FSDIE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called when another filing system (e.g. DFS) is selected. Saves</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the current NFS context (FSLOCN station number, URD/CSD/LIB</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; handles, OPT byte, etc.) from page $0E into the dynamic workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; backup area. This allows the state to be restored when *NET is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; re-issued later, without losing the login session. Finally calls</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSBYTE $77 (FXSPEX: close SPOOL and EXEC files) to avoid leaving</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; dangling file handles across the FS switch.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-82FD">
<td class="addr"><a href="#addr-82FD">82FD</a></td>
<td><span class="label">.fscv_shutdown</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;1d</span></td>
<td class="hex">A0 1D</td>
</tr>

<tr id="addr-82FF">
<td class="addr"><a href="#addr-82FF">82FF</a></td>
<td><span class="label">.loop_c82ff</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0DEB">fs_state_deb</a>,y</span></td>
<td class="hex">B9 EB 0D</td>
</tr>

<tr id="addr-8302">
<td class="addr"><a href="#addr-8302">8302</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-8304">
<td class="addr"><a href="#addr-8304">8304</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8305">
<td class="addr"><a href="#addr-8305">8305</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;14</span></td>
<td class="hex">C0 14</td>
</tr>

<tr id="addr-8307">
<td class="addr"><a href="#addr-8307">8307</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-82FF">loop_c82ff</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-8309">
<td class="addr"><a href="#addr-8309">8309</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_printer_driver_going_dormant</span></td>
<td class="hex">A9 7B</td>
</tr>

<tr id="addr-830B">
<td class="addr"><a href="#addr-830B">830B</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Printer driver going dormant</span></td>
<td class="hex">4C F4 FF</td>
</tr>

<tr id="addr-830E">
<td class="addr"><a href="#addr-830E">830E</a></td>
<td><span class="label">.init_tx_ctrl_data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;90</span></td>
<td class="hex">A9 90</td>
</tr>

<tr id="addr-8310">
<td class="addr"><a href="#addr-8310">8310</a></td>
<td><span class="label">.init_tx_ctrl_port</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-831C">init_tx_ctrl_block</a></span></td>
<td class="hex">20 1C 83</td>
</tr>

<tr id="addr-8313">
<td class="addr"><a href="#addr-8313">8313</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C1">l00c1</a></span></td>
<td class="hex">85 C1</td>
</tr>

<tr id="addr-8315">
<td class="addr"><a href="#addr-8315">8315</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#3</span></td>
<td class="hex">A9 03</td>
</tr>

<tr id="addr-8317">
<td class="addr"><a href="#addr-8317">8317</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C4">l00c4</a></span></td>
<td class="hex">85 C4</td>
</tr>

<tr id="addr-8319">
<td class="addr"><a href="#addr-8319">8319</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00C0">l00c0</a></span></td>
<td class="hex">C6 C0</td>
</tr>

<tr id="addr-831B">
<td class="addr"><a href="#addr-831B">831B</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Initialise TX control block at $00C0 from template</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies 12 bytes from tx_ctrl_template ($8334) to $00C0.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; For the first 2 bytes (Y=0,1), also copies the fileserver</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; station/network from $0E00/$0E01 to $00C2/$00C3.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The template sets up: control=$80, port=$99 (FS command port),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; command data length=$0F, plus padding bytes.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-831C">
<td class="addr"><a href="#addr-831C">831C</a></td>
<td><span class="label">.init_tx_ctrl_block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-831D">
<td class="addr"><a href="#addr-831D">831D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0b</span></td>
<td class="hex">A0 0B</td>
</tr>

<tr id="addr-831F">
<td class="addr"><a href="#addr-831F">831F</a></td>
<td><span class="label">.loop_c831f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8334">tx_ctrl_template</a>,y</span></td>
<td class="hex">B9 34 83</td>
</tr>

<tr id="addr-8322">
<td class="addr"><a href="#addr-8322">8322</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C0">l00c0</a>,y</span></td>
<td class="hex">99 C0 00</td>
</tr>

<tr id="addr-8325">
<td class="addr"><a href="#addr-8325">8325</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#2</span></td>
<td class="hex">C0 02</td>
</tr>

<tr id="addr-8327">
<td class="addr"><a href="#addr-8327">8327</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-832F">c832f</a></span></td>
<td class="hex">10 06</td>
</tr>

<tr id="addr-8329">
<td class="addr"><a href="#addr-8329">8329</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E00">fs_server_stn</a>,y</span></td>
<td class="hex">B9 00 0E</td>
</tr>

<tr id="addr-832C">
<td class="addr"><a href="#addr-832C">832C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C2">l00c2</a>,y</span></td>
<td class="hex">99 C2 00</td>
</tr>

<tr id="addr-832F">
<td class="addr"><a href="#addr-832F">832F</a></td>
<td><span class="label">.c832f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8330">
<td class="addr"><a href="#addr-8330">8330</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-831F">loop_c831f</a></span></td>
<td class="hex">10 ED</td>
</tr>

<tr id="addr-8332">
<td class="addr"><a href="#addr-8332">8332</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8333">
<td class="addr"><a href="#addr-8333">8333</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX control block template (TXTAB, 12 bytes)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $00C0: $80 (control flag)    $00C1: $99 (port — FS command port)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $00C2: server station        $00C3: server network</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $00C4: $00 (data low)        $00C5: $0F (data high — buffer page)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $00C6-$00CB: $FF (FILLER)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The $FF padding in the address fields is a recurring pattern:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Econet control blocks use 4-byte addresses but NFS only needs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 2-byte addresses, so the upper two bytes are filled with $FF.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8334">
<td class="addr"><a href="#addr-8334">8334</a></td>
<td><span class="label">.tx_ctrl_template</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;80, &amp;99, &amp;00, &amp;00, &amp;00, &amp;0F</td>
<td class="hex">80 99 00 00 00 0F</td>
</tr>

<tr id="addr-833A">
<td class="addr"><a href="#addr-833A">833A</a></td>
<td><span class="label">.l833a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;FF, &amp;FF, &amp;FF, &amp;0F, &amp;FF, &amp;FF</td>
<td class="hex">FF FF FF 0F FF FF</td>
</tr>

<tr id="addr-8340">
<td class="addr"><a href="#addr-8340">8340</a></td>
<td><span class="label">.prepare_cmd_with_flag</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8341">
<td class="addr"><a href="#addr-8341">8341</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">A9 2A</td>
</tr>

<tr id="addr-8343">
<td class="addr"><a href="#addr-8343">8343</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8344">
<td class="addr"><a href="#addr-8344">8344</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-835A">c835a</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">B0 14</td>
</tr>

<tr id="addr-8346">
<td class="addr"><a href="#addr-8346">8346</a></td>
<td><span class="label">.prepare_cmd_clv</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLV</span></td>
<td class="hex">B8</td>
</tr>

<tr id="addr-8347">
<td class="addr"><a href="#addr-8347">8347</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-8359">c8359</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">50 10</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *BYE handler (logoff)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Closes any open *SPOOL and *EXEC files via OSBYTE $77 (FXSPEX),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; then falls into prepare_fs_cmd with Y=$17 (FCBYE: logoff code).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatched from the command match table at $8BD6 for &#34;BYE&#34;.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8349">
<td class="addr"><a href="#addr-8349">8349</a></td>
<td><span class="label">.bye_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_close_spool_exec</span></td>
<td class="hex">A9 77</td>
</tr>

<tr id="addr-834B">
<td class="addr"><a href="#addr-834B">834B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Close any *SPOOL and *EXEC files</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-834E">
<td class="addr"><a href="#addr-834E">834E</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;17</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 17</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Builds the 5-byte FS protocol header at $0F00:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0F00 HDRREP = reply port (set downstream, typically $90/PREPLY)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0F01 HDRFN  = Y parameter (function code)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0F02 HDRURD = URD handle (from $0E02)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0F03 HDRCSD = CSD handle (from $0E03)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0F04 HDRLIB = LIB handle (from $0E04)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Command-specific data follows at $0F05 (TXBUF). Also clears V flag.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called before building specific FS commands for transmission.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: function code for HDRFN</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: preserved through header build</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: 0 on success (from build_send_fs_cmd)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: 0 on success, $D6 on not-found</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: 1 (offset past command code in reply)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8350">
<td class="addr"><a href="#addr-8350">8350</a></td>
<td><span class="label">.prepare_fs_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLV</span></td>
<td class="hex">B8</td>
</tr>

<tr id="addr-8351">
<td class="addr"><a href="#addr-8351">8351</a></td>
<td><span class="label">.prepare_fs_cmd_v</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E02">fs_urd_handle</a></span></td>
<td class="hex">AD 02 0E</td>
</tr>

<tr id="addr-8354">
<td class="addr"><a href="#addr-8354">8354</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F02">fs_cmd_urd</a></span></td>
<td class="hex">8D 02 0F</td>
</tr>

<tr id="addr-8357">
<td class="addr"><a href="#addr-8357">8357</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">A9 2A</td>
</tr>

<tr id="addr-8359">
<td class="addr"><a href="#addr-8359">8359</a></td>
<td><span class="label">.c8359</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-835A">
<td class="addr"><a href="#addr-835A">835A</a></td>
<td><span class="label">.c835a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F01">fs_cmd_y_param</a></span></td>
<td class="hex">8C 01 0F</td>
</tr>

<tr id="addr-835D">
<td class="addr"><a href="#addr-835D">835D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">85 B8</td>
</tr>

<tr id="addr-835F">
<td class="addr"><a href="#addr-835F">835F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8361">
<td class="addr"><a href="#addr-8361">8361</a></td>
<td><span class="label">.loop_c8361</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E03">fs_csd_handle</a>,y</span>  <span class="comment">; A=timeout period for FS reply</span></td>
<td class="hex">B9 03 0E</td>
</tr>

<tr id="addr-8364">
<td class="addr"><a href="#addr-8364">8364</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F03">fs_cmd_csd</a>,y</span></td>
<td class="hex">99 03 0F</td>
</tr>

<tr id="addr-8367">
<td class="addr"><a href="#addr-8367">8367</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=function code</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8368">
<td class="addr"><a href="#addr-8368">8368</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8361">loop_c8361</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Build and send FS command (DOFSOP)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets reply port to $90 (PREPLY) at $0F00, initialises the TX</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; control block, then adjusts TXCB&#39;s high pointer (HPTR) to X+5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; -- the 5-byte FS header (reply port, function code, URD, CSD,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; LIB) plus the command data -- so only meaningful bytes are</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; transmitted, conserving Econet bandwidth. If carry is set on</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; entry (DOFSBX byte-stream path), takes the alternate path</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; through econet_tx_retry for direct BSXMIT transmission.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Otherwise sets up the TX pointer via setup_tx_ptr_c0 and falls</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; through to send_fs_reply_cmd for reply handling. The carry flag</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; is the sole discriminator between byte-stream and standard FS</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; protocol paths -- set by SEC at the BPUTV/BGETV entry points.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On return from WAITFS/BSXMIT, Y=0; INY advances past the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; command code to read the return code. Error $D6 (&#34;not found&#34;)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; is detected via ADC #($100-$D6) with C=0 -- if the return code</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; was exactly $D6, the result wraps to zero (Z=1). This is a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; branchless comparison returning C=1, A=0 as a soft error that</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; callers can handle, vs hard errors which go through FSERR.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: buffer extent (command-specific data bytes)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: function code</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: timeout period for FS reply</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     C: 0 for standard FS path, 1 for byte-stream (BSXMIT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: 0 on success</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: 0 on success, $D6 on not-found</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: 1 (offset past command code in reply)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-836A">
<td class="addr"><a href="#addr-836A">836A</a></td>
<td><span class="label">.build_send_fs_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-836B">
<td class="addr"><a href="#addr-836B">836B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;90</span></td>
<td class="hex">A9 90</td>
</tr>

<tr id="addr-836D">
<td class="addr"><a href="#addr-836D">836D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F00">fs_cmd_type</a></span></td>
<td class="hex">8D 00 0F</td>
</tr>

<tr id="addr-8370">
<td class="addr"><a href="#addr-8370">8370</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-831C">init_tx_ctrl_block</a></span></td>
<td class="hex">20 1C 83</td>
</tr>

<tr id="addr-8373">
<td class="addr"><a href="#addr-8373">8373</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8374">
<td class="addr"><a href="#addr-8374">8374</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#5</span></td>
<td class="hex">69 05</td>
</tr>

<tr id="addr-8376">
<td class="addr"><a href="#addr-8376">8376</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C8">l00c8</a></span></td>
<td class="hex">85 C8</td>
</tr>

<tr id="addr-8378">
<td class="addr"><a href="#addr-8378">8378</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-8379">
<td class="addr"><a href="#addr-8379">8379</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8397">c8397</a></span></td>
<td class="hex">B0 1C</td>
</tr>

<tr id="addr-837B">
<td class="addr"><a href="#addr-837B">837B</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-837C">
<td class="addr"><a href="#addr-837C">837C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8644">setup_tx_ptr_c0</a></span></td>
<td class="hex">20 44 86</td>
</tr>

<tr id="addr-837F">
<td class="addr"><a href="#addr-837F">837F</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-8380">
<td class="addr"><a href="#addr-8380">8380</a></td>
<td><span class="label">.send_fs_reply_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-8381">
<td class="addr"><a href="#addr-8381">8381</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-830E">init_tx_ctrl_data</a></span></td>
<td class="hex">20 0E 83</td>
</tr>

<tr id="addr-8384">
<td class="addr"><a href="#addr-8384">8384</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">A5 B8</td>
</tr>

<tr id="addr-8386">
<td class="addr"><a href="#addr-8386">8386</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-844A">send_to_fs</a></span></td>
<td class="hex">20 4A 84</td>
</tr>

<tr id="addr-8389">
<td class="addr"><a href="#addr-8389">8389</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-838A">
<td class="addr"><a href="#addr-838A">838A</a></td>
<td><span class="label">.loop_c838a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-838B">
<td class="addr"><a href="#addr-838B">838B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00C4">l00c4</a>),y</span></td>
<td class="hex">B1 C4</td>
</tr>

<tr id="addr-838D">
<td class="addr"><a href="#addr-838D">838D</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-838E">
<td class="addr"><a href="#addr-838E">838E</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8396">return_1</a></span></td>
<td class="hex">F0 06</td>
</tr>

<tr id="addr-8390">
<td class="addr"><a href="#addr-8390">8390</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-8394">c8394</a></span></td>
<td class="hex">50 02</td>
</tr>

<tr id="addr-8392">
<td class="addr"><a href="#addr-8392">8392</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">69 2A</td>
</tr>

<tr id="addr-8394">
<td class="addr"><a href="#addr-8394">8394</a></td>
<td><span class="label">.c8394</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8402">store_fs_error</a></span></td>
<td class="hex">D0 6C</td>
</tr>

<tr id="addr-8396">
<td class="addr"><a href="#addr-8396">8396</a></td>
<td><span class="label">.return_1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8397">
<td class="addr"><a href="#addr-8397">8397</a></td>
<td><span class="label">.c8397</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8398">
<td class="addr"><a href="#addr-8398">8398</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;c0</span></td>
<td class="hex">A2 C0</td>
</tr>

<tr id="addr-839A">
<td class="addr"><a href="#addr-839A">839A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-839B">
<td class="addr"><a href="#addr-839B">839B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9248">econet_tx_retry</a></span></td>
<td class="hex">20 48 92</td>
</tr>

<tr id="addr-839E">
<td class="addr"><a href="#addr-839E">839E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B3">l00b3</a></span></td>
<td class="hex">85 B3</td>
</tr>

<tr id="addr-83A0">
<td class="addr"><a href="#addr-83A0">83A0</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-838A">loop_c838a</a></span></td>
<td class="hex">90 E8</td>
</tr>

<tr id="addr-83A2">
<td class="addr"><a href="#addr-83A2">83A2</a></td>
<td><span class="label">.bputv_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handle BPUT/BGET file byte I/O</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; BPUTV enters at $83A2 (CLC; fall through) and BGETV enters</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; at $8485 (SEC; JSR here). The carry flag is preserved via</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; PHP/PLP through the call chain and tested later (BCS) to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; select byte-stream transmission (BSXMIT) vs normal FS</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; transmission (FSXMIT) -- a control-flow encoding using</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; processor flags to avoid an extra flag variable.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; BSXMIT uses handle=0 for print stream transactions (which</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; sidestep the SEQNOS sequence number manipulation) and non-zero</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; handles for file operations. After transmission, the high</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; pointer bytes of the CB are reset to $FF -- &#34;The BGET/PUT byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fix&#34; which prevents stale buffer pointers corrupting subsequent</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; byte-level operations.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     C: 0 for BPUT (write byte), 1 for BGET (read byte)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: byte to write (BPUT only)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: file handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-83A3">
<td class="addr"><a href="#addr-83A3">83A3</a></td>
<td><span class="label">.handle_bput_bget</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-83A4">
<td class="addr"><a href="#addr-83A4">83A4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0FDF">l0fdf</a></span></td>
<td class="hex">8D DF 0F</td>
</tr>

<tr id="addr-83A7">
<td class="addr"><a href="#addr-83A7">83A7</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-83A8">
<td class="addr"><a href="#addr-83A8">83A8</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-83A9">
<td class="addr"><a href="#addr-83A9">83A9</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-83AA">
<td class="addr"><a href="#addr-83AA">83AA</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-83AB">
<td class="addr"><a href="#addr-83AB">83AB</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-83AC">
<td class="addr"><a href="#addr-83AC">83AC</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8589">handle_to_mask_clc</a></span></td>
<td class="hex">20 89 85</td>
</tr>

<tr id="addr-83AF">
<td class="addr"><a href="#addr-83AF">83AF</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0FDE">l0fde</a></span></td>
<td class="hex">8C DE 0F</td>
</tr>

<tr id="addr-83B2">
<td class="addr"><a href="#addr-83B2">83B2</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00CF">l00cf</a></span></td>
<td class="hex">84 CF</td>
</tr>

<tr id="addr-83B4">
<td class="addr"><a href="#addr-83B4">83B4</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;90</span></td>
<td class="hex">A0 90</td>
</tr>

<tr id="addr-83B6">
<td class="addr"><a href="#addr-83B6">83B6</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0FDC">fs_putb_buf</a></span></td>
<td class="hex">8C DC 0F</td>
</tr>

<tr id="addr-83B9">
<td class="addr"><a href="#addr-83B9">83B9</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-831C">init_tx_ctrl_block</a></span></td>
<td class="hex">20 1C 83</td>
</tr>

<tr id="addr-83BC">
<td class="addr"><a href="#addr-83BC">83BC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;dc</span></td>
<td class="hex">A9 DC</td>
</tr>

<tr id="addr-83BE">
<td class="addr"><a href="#addr-83BE">83BE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C4">l00c4</a></span></td>
<td class="hex">85 C4</td>
</tr>

<tr id="addr-83C0">
<td class="addr"><a href="#addr-83C0">83C0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e0</span></td>
<td class="hex">A9 E0</td>
</tr>

<tr id="addr-83C2">
<td class="addr"><a href="#addr-83C2">83C2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C8">l00c8</a></span></td>
<td class="hex">85 C8</td>
</tr>

<tr id="addr-83C4">
<td class="addr"><a href="#addr-83C4">83C4</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-83C5">
<td class="addr"><a href="#addr-83C5">83C5</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#9</span></td>
<td class="hex">A2 09</td>
</tr>

<tr id="addr-83C7">
<td class="addr"><a href="#addr-83C7">83C7</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-83C8">
<td class="addr"><a href="#addr-83C8">83C8</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-83CB">store_retry_count</a></span></td>
<td class="hex">90 01</td>
</tr>

<tr id="addr-83CA">
<td class="addr"><a href="#addr-83CA">83CA</a></td>
<td>    <span class="opcode">DEX</span>  <span class="comment">; X=&amp;08</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-83CB">
<td class="addr"><a href="#addr-83CB">83CB</a></td>
<td><span class="label">.store_retry_count</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0FDD">fs_getb_buf</a></span></td>
<td class="hex">8E DD 0F</td>
</tr>

<tr id="addr-83CE">
<td class="addr"><a href="#addr-83CE">83CE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0FDE">l0fde</a></span></td>
<td class="hex">AD DE 0F</td>
</tr>

<tr id="addr-83D1">
<td class="addr"><a href="#addr-83D1">83D1</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;c0</span></td>
<td class="hex">A2 C0</td>
</tr>

<tr id="addr-83D3">
<td class="addr"><a href="#addr-83D3">83D3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9248">econet_tx_retry</a></span></td>
<td class="hex">20 48 92</td>
</tr>

<tr id="addr-83D6">
<td class="addr"><a href="#addr-83D6">83D6</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0FDD">fs_getb_buf</a></span></td>
<td class="hex">AE DD 0F</td>
</tr>

<tr id="addr-83D9">
<td class="addr"><a href="#addr-83D9">83D9</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-841B">update_sequence_return</a></span></td>
<td class="hex">F0 40</td>
</tr>

<tr id="addr-83DB">
<td class="addr"><a href="#addr-83DB">83DB</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;1f</span></td>
<td class="hex">A0 1F</td>
</tr>

<tr id="addr-83DD">
<td class="addr"><a href="#addr-83DD">83DD</a></td>
<td><span class="label">.loop_c83dd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0FDC">fs_putb_buf</a>,y</span></td>
<td class="hex">B9 DC 0F</td>
</tr>

<tr id="addr-83E0">
<td class="addr"><a href="#addr-83E0">83E0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0FE0">l0fe0</a>,y</span></td>
<td class="hex">99 E0 0F</td>
</tr>

<tr id="addr-83E3">
<td class="addr"><a href="#addr-83E3">83E3</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-83E4">
<td class="addr"><a href="#addr-83E4">83E4</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-83DD">loop_c83dd</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-83E6">
<td class="addr"><a href="#addr-83E6">83E6</a></td>
<td>    <span class="opcode">TAX</span>  <span class="comment">; X=File handle</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-83E7">
<td class="addr"><a href="#addr-83E7">83E7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_write_spool_file_handle</span></td>
<td class="hex">A9 C7</td>
</tr>

<tr id="addr-83E9">
<td class="addr"><a href="#addr-83E9">83E9</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Read/Write *SPOOL file handle</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-83EC">
<td class="addr"><a href="#addr-83EC">83EC</a></td>
<td>    <span class="opcode">TXA</span>  <span class="comment">; X=value of *SPOOL file handle</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-83ED">
<td class="addr"><a href="#addr-83ED">83ED</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8588">handle_to_mask_a</a></span></td>
<td class="hex">20 88 85</td>
</tr>

<tr id="addr-83F0">
<td class="addr"><a href="#addr-83F0">83F0</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand"><a href="#addr-00CF">l00cf</a></span></td>
<td class="hex">C4 CF</td>
</tr>

<tr id="addr-83F2">
<td class="addr"><a href="#addr-83F2">83F2</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-83FB">c83fb</a></span></td>
<td class="hex">D0 07</td>
</tr>

<tr id="addr-83F4">
<td class="addr"><a href="#addr-83F4">83F4</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&lt;(l8444)</span></td>
<td class="hex">A2 44</td>
</tr>

<tr id="addr-83F6">
<td class="addr"><a href="#addr-83F6">83F6</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&gt;(l8444)</span></td>
<td class="hex">A0 84</td>
</tr>

<tr id="addr-83F8">
<td class="addr"><a href="#addr-83F8">83F8</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF7">oscli</a></span></td>
<td class="hex">20 F7 FF</td>
</tr>

<tr id="addr-83FB">
<td class="addr"><a href="#addr-83FB">83FB</a></td>
<td><span class="label">.c83fb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e0</span></td>
<td class="hex">A9 E0</td>
</tr>

<tr id="addr-83FD">
<td class="addr"><a href="#addr-83FD">83FD</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C4">l00c4</a></span></td>
<td class="hex">85 C4</td>
</tr>

<tr id="addr-83FF">
<td class="addr"><a href="#addr-83FF">83FF</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0FDD">fs_getb_buf</a></span></td>
<td class="hex">AE DD 0F</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handle fileserver error replies (FSERR)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The fileserver returns errors as: zero command code + error number +</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; CR-terminated message string. This routine converts the reply buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; in-place to a standard MOS BRK error packet by:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   1. Storing the error code at fs_last_error ($0E09)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   2. Normalizing error codes below $A8 to $A8 (the standard FS error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;      number), since the MOS error space below $A8 has other meanings</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   3. Scanning for the CR terminator and replacing it with $00</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   4. JMPing indirect through (l00c4) to execute the buffer as a BRK</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;      instruction — the zero command code serves as the BRK opcode</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; N.B. This relies on the fileserver always returning a zero command</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; code in position 0 of the reply buffer.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8402">
<td class="addr"><a href="#addr-8402">8402</a></td>
<td><span class="label">.store_fs_error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0E09">fs_last_error</a></span></td>
<td class="hex">8E 09 0E</td>
</tr>

<tr id="addr-8405">
<td class="addr"><a href="#addr-8405">8405</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8407">
<td class="addr"><a href="#addr-8407">8407</a></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#&amp;a8</span></td>
<td class="hex">E0 A8</td>
</tr>

<tr id="addr-8409">
<td class="addr"><a href="#addr-8409">8409</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-840F">c840f</a></span></td>
<td class="hex">B0 04</td>
</tr>

<tr id="addr-840B">
<td class="addr"><a href="#addr-840B">840B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;a8</span></td>
<td class="hex">A9 A8</td>
</tr>

<tr id="addr-840D">
<td class="addr"><a href="#addr-840D">840D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00C4">l00c4</a>),y</span></td>
<td class="hex">91 C4</td>
</tr>

<tr id="addr-840F">
<td class="addr"><a href="#addr-840F">840F</a></td>
<td><span class="label">.c840f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8410">
<td class="addr"><a href="#addr-8410">8410</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">A9 0D</td>
</tr>

<tr id="addr-8412">
<td class="addr"><a href="#addr-8412">8412</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">(<a href="#addr-00C4">l00c4</a>),y</span></td>
<td class="hex">51 C4</td>
</tr>

<tr id="addr-8414">
<td class="addr"><a href="#addr-8414">8414</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-840F">c840f</a></span></td>
<td class="hex">D0 F9</td>
</tr>

<tr id="addr-8416">
<td class="addr"><a href="#addr-8416">8416</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00C4">l00c4</a>),y</span></td>
<td class="hex">91 C4</td>
</tr>

<tr id="addr-8418">
<td class="addr"><a href="#addr-8418">8418</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand">(<a href="#addr-00C4">l00c4</a>)</span></td>
<td class="hex">6C C4 00</td>
</tr>

<tr id="addr-841B">
<td class="addr"><a href="#addr-841B">841B</a></td>
<td><span class="label">.update_sequence_return</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E08">fs_sequence_nos</a></span></td>
<td class="hex">8D 08 0E</td>
</tr>

<tr id="addr-841E">
<td class="addr"><a href="#addr-841E">841E</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-841F">
<td class="addr"><a href="#addr-841F">841F</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8420">
<td class="addr"><a href="#addr-8420">8420</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8421">
<td class="addr"><a href="#addr-8421">8421</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8422">
<td class="addr"><a href="#addr-8422">8422</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8423">
<td class="addr"><a href="#addr-8423">8423</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8424">
<td class="addr"><a href="#addr-8424">8424</a></td>
<td><span class="label">.c8424</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#8</span></td>
<td class="hex">A9 08</td>
</tr>

<tr id="addr-8426">
<td class="addr"><a href="#addr-8426">8426</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-842C">set_listen_offset</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-8428">
<td class="addr"><a href="#addr-8428">8428</a></td>
<td><span class="label">.c8428</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>,x)</span></td>
<td class="hex">A1 9A</td>
</tr>

<tr id="addr-842A">
<td class="addr"><a href="#addr-842A">842A</a></td>
<td><span class="label">.c842a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">AND</span> <span class="operand">#7</span></td>
<td class="hex">29 07</td>
</tr>

<tr id="addr-842C">
<td class="addr"><a href="#addr-842C">842C</a></td>
<td><span class="label">.set_listen_offset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-842D">
<td class="addr"><a href="#addr-842D">842D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-8014">l8014</a>,x</span></td>
<td class="hex">BC 14 80</td>
</tr>

<tr id="addr-8430">
<td class="addr"><a href="#addr-8430">8430</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-8432">
<td class="addr"><a href="#addr-8432">8432</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0100">l0100</a></span></td>
<td class="hex">8E 00 01</td>
</tr>

<tr id="addr-8435">
<td class="addr"><a href="#addr-8435">8435</a></td>
<td><span class="label">.loop_c8435</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-84AF">error_msg_table</a>,y</span></td>
<td class="hex">B9 AF 84</td>
</tr>

<tr id="addr-8438">
<td class="addr"><a href="#addr-8438">8438</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0101">l0101</a>,x</span></td>
<td class="hex">9D 01 01</td>
</tr>

<tr id="addr-843B">
<td class="addr"><a href="#addr-843B">843B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8441">c8441</a></span></td>
<td class="hex">F0 04</td>
</tr>

<tr id="addr-843D">
<td class="addr"><a href="#addr-843D">843D</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-843E">
<td class="addr"><a href="#addr-843E">843E</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-843F">
<td class="addr"><a href="#addr-843F">843F</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8435">loop_c8435</a></span></td>
<td class="hex">D0 F4</td>
</tr>

<tr id="addr-8441">
<td class="addr"><a href="#addr-8441">8441</a></td>
<td><span class="label">.c8441</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0100">l0100</a></span></td>
<td class="hex">4C 00 01</td>
</tr>

<tr id="addr-8444">
<td class="addr"><a href="#addr-8444">8444</a></td>
<td><span class="label">.l8444</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;SP.&quot;</span></td>
<td class="hex">53 50 2E</td>
</tr>

<tr id="addr-8447">
<td class="addr"><a href="#addr-8447">8447</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D</td>
<td class="hex">0D</td>
</tr>

<tr id="addr-8448">
<td class="addr"><a href="#addr-8448">8448</a></td>
<td><span class="label">.send_to_fs_star</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">A9 2A</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Send command to fileserver and handle reply (WAITFS)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Performs a complete FS transaction: transmit then wait for reply.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets bit 7 of rx_status_flags (mark FS transaction in progress),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; builds a TX frame from the data at (net_tx_ptr), and transmits</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; it. The system RX flag (LFLAG bit 7) is only set when receiving</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; into the page-zero control block — if RXCBP&#39;s high byte is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; non-zero, setting the system flag would interfere with other RX</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; operations. The timeout counter uses the stack (indexed via TSX)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; rather than memory to avoid bus conflicts with Econet hardware</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; during the tight polling loop. Handles multi-block replies and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; checks for escape conditions between blocks.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-844A">
<td class="addr"><a href="#addr-844A">844A</a></td>
<td><span class="label">.send_to_fs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-844B">
<td class="addr"><a href="#addr-844B">844B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">AD 38 0D</td>
</tr>

<tr id="addr-844E">
<td class="addr"><a href="#addr-844E">844E</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-844F">
<td class="addr"><a href="#addr-844F">844F</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">09 80</td>
</tr>

<tr id="addr-8451">
<td class="addr"><a href="#addr-8451">8451</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">8D 38 0D</td>
</tr>

<tr id="addr-8454">
<td class="addr"><a href="#addr-8454">8454</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-8456">
<td class="addr"><a href="#addr-8456">8456</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8457">
<td class="addr"><a href="#addr-8457">8457</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8458">
<td class="addr"><a href="#addr-8458">8458</a></td>
<td>    <span class="opcode">TAY</span>  <span class="comment">; Y=&amp;00</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8459">
<td class="addr"><a href="#addr-8459">8459</a></td>
<td>    <span class="opcode">TSX</span></td>
<td class="hex">BA</td>
</tr>

<tr id="addr-845A">
<td class="addr"><a href="#addr-845A">845A</a></td>
<td><span class="label">.c845a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">B1 9A</td>
</tr>

<tr id="addr-845C">
<td class="addr"><a href="#addr-845C">845C</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8470">fs_wait_cleanup</a></span></td>
<td class="hex">30 12</td>
</tr>

<tr id="addr-845E">
<td class="addr"><a href="#addr-845E">845E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-847A">check_escape</a></span></td>
<td class="hex">20 7A 84</td>
</tr>

<tr id="addr-8461">
<td class="addr"><a href="#addr-8461">8461</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-0101">l0101</a>,x</span></td>
<td class="hex">DE 01 01</td>
</tr>

<tr id="addr-8464">
<td class="addr"><a href="#addr-8464">8464</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-845A">c845a</a></span></td>
<td class="hex">D0 F4</td>
</tr>

<tr id="addr-8466">
<td class="addr"><a href="#addr-8466">8466</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-0102">l0102</a>,x</span></td>
<td class="hex">DE 02 01</td>
</tr>

<tr id="addr-8469">
<td class="addr"><a href="#addr-8469">8469</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-845A">c845a</a></span></td>
<td class="hex">D0 EF</td>
</tr>

<tr id="addr-846B">
<td class="addr"><a href="#addr-846B">846B</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-0104">l0104</a>,x</span></td>
<td class="hex">DE 04 01</td>
</tr>

<tr id="addr-846E">
<td class="addr"><a href="#addr-846E">846E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-845A">c845a</a></span></td>
<td class="hex">D0 EA</td>
</tr>

<tr id="addr-8470">
<td class="addr"><a href="#addr-8470">8470</a></td>
<td><span class="label">.fs_wait_cleanup</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8471">
<td class="addr"><a href="#addr-8471">8471</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8472">
<td class="addr"><a href="#addr-8472">8472</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8473">
<td class="addr"><a href="#addr-8473">8473</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">8D 38 0D</td>
</tr>

<tr id="addr-8476">
<td class="addr"><a href="#addr-8476">8476</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8477">
<td class="addr"><a href="#addr-8477">8477</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8424">c8424</a></span></td>
<td class="hex">F0 AB</td>
</tr>

<tr id="addr-8479">
<td class="addr"><a href="#addr-8479">8479</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Check and handle escape condition (ESC)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Two-level escape gating: the MOS escape flag ($FF bit 7) is ANDed</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; with the software enable flag ESCAP. Both must have bit 7 set for</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; escape to fire. ESCAP is set non-zero during data port operations</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (LOADOP stores the data port $90, serving double duty as both the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; port number and the escape-enable flag). ESCAP is disabled via LSR</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; in the ENTER routine, which clears bit 7 — PHP/PLP around the LSR</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; preserves the carry flag since ENTER is called from contexts where</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; carry has semantic meaning (e.g., PUTBYT vs BGET distinction).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; This architecture allows escape between retransmission attempts</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; but prevents interruption during critical FS transactions. If</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; escape fires: acknowledges via OSBYTE $7E, then checks whether</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the failing handle is the current SPOOL or EXEC handle (OSBYTE</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $C6/$C7); if so, issues &#34;*SP.&#34; or &#34;*E.&#34; via OSCLI to gracefully</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; close the channel before raising the error — preventing the system</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; from continuing to spool output to a broken file handle.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-847A">
<td class="addr"><a href="#addr-847A">847A</a></td>
<td><span class="label">.check_escape</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_acknowledge_escape</span></td>
<td class="hex">A9 7E</td>
</tr>

<tr id="addr-847C">
<td class="addr"><a href="#addr-847C">847C</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-00FF">l00ff</a></span></td>
<td class="hex">24 FF</td>
</tr>

<tr id="addr-847E">
<td class="addr"><a href="#addr-847E">847E</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-84A3">return_2</a></span></td>
<td class="hex">10 23</td>
</tr>

<tr id="addr-8480">
<td class="addr"><a href="#addr-8480">8480</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Clear escape condition and perform escape effects</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-8483">
<td class="addr"><a href="#addr-8483">8483</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-842A">c842a</a></span></td>
<td class="hex">D0 A5</td>
</tr>

<tr id="addr-8485">
<td class="addr"><a href="#addr-8485">8485</a></td>
<td><span class="label">.bgetv_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8486">
<td class="addr"><a href="#addr-8486">8486</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-83A3">handle_bput_bget</a></span>  <span class="comment">; Handle BPUT/BGET file byte I/O</span></td>
<td class="hex">20 A3 83</td>
</tr>

<tr id="addr-8489">
<td class="addr"><a href="#addr-8489">8489</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-848A">
<td class="addr"><a href="#addr-848A">848A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;fe</span></td>
<td class="hex">A9 FE</td>
</tr>

<tr id="addr-848C">
<td class="addr"><a href="#addr-848C">848C</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0FDF">l0fdf</a></span></td>
<td class="hex">2C DF 0F</td>
</tr>

<tr id="addr-848F">
<td class="addr"><a href="#addr-848F">848F</a></td>
<td>    <span class="opcode">BVS</span> <span class="operand"><a href="#addr-84A3">return_2</a></span></td>
<td class="hex">70 12</td>
</tr>

<tr id="addr-8491">
<td class="addr"><a href="#addr-8491">8491</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-8492">
<td class="addr"><a href="#addr-8492">8492</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-849B">c849b</a></span></td>
<td class="hex">30 07</td>
</tr>

<tr id="addr-8494">
<td class="addr"><a href="#addr-8494">8494</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00CF">l00cf</a></span></td>
<td class="hex">A5 CF</td>
</tr>

<tr id="addr-8496">
<td class="addr"><a href="#addr-8496">8496</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85DF">clear_fs_flag</a></span></td>
<td class="hex">20 DF 85</td>
</tr>

<tr id="addr-8499">
<td class="addr"><a href="#addr-8499">8499</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-84A0">c84a0</a></span></td>
<td class="hex">90 05</td>
</tr>

<tr id="addr-849B">
<td class="addr"><a href="#addr-849B">849B</a></td>
<td><span class="label">.c849b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00CF">l00cf</a></span></td>
<td class="hex">A5 CF</td>
</tr>

<tr id="addr-849D">
<td class="addr"><a href="#addr-849D">849D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85E4">set_fs_flag</a></span></td>
<td class="hex">20 E4 85</td>
</tr>

<tr id="addr-84A0">
<td class="addr"><a href="#addr-84A0">84A0</a></td>
<td><span class="label">.c84a0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0FDE">l0fde</a></span></td>
<td class="hex">AD DE 0F</td>
</tr>

<tr id="addr-84A3">
<td class="addr"><a href="#addr-84A3">84A3</a></td>
<td><span class="label">.return_2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-84A4">
<td class="addr"><a href="#addr-84A4">84A4</a></td>
<td><span class="label">.add_5_to_y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-84A5">
<td class="addr"><a href="#addr-84A5">84A5</a></td>
<td><span class="label">.add_4_to_y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-84A6">
<td class="addr"><a href="#addr-84A6">84A6</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-84A7">
<td class="addr"><a href="#addr-84A7">84A7</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-84A8">
<td class="addr"><a href="#addr-84A8">84A8</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-84A9">
<td class="addr"><a href="#addr-84A9">84A9</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-84AA">
<td class="addr"><a href="#addr-84AA">84AA</a></td>
<td><span class="label">.sub_4_from_y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-84AB">
<td class="addr"><a href="#addr-84AB">84AB</a></td>
<td><span class="label">.sub_3_from_y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-84AC">
<td class="addr"><a href="#addr-84AC">84AC</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-84AD">
<td class="addr"><a href="#addr-84AD">84AD</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-84AE">
<td class="addr"><a href="#addr-84AE">84AE</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Econet error message table (ERRTAB, 8 entries)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Each entry: error number byte followed by NUL-terminated string.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $A0: &#34;Line Jammed&#34;     $A1: &#34;Net Error&#34;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $A2: &#34;Not listening&#34;   $A3: &#34;No Clock&#34;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $A4: &#34;Bad Txcb&#34;        $11: &#34;Escape&#34;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $CB: &#34;Bad Option&#34;      $A5: &#34;No reply&#34;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Indexed by the low 3 bits of the TXCB flag byte (AND #$07),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; which encode the specific Econet failure reason. The NREPLY</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and NLISTN routines build a MOS BRK error block at $100 on the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; stack page: NREPLY fires when the fileserver does not respond</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; within the timeout period; NLISTN fires when the destination</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; station actively refused the connection.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Indexed via the error dispatch at c8424/c842c.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-84AF">
<td class="addr"><a href="#addr-84AF">84AF</a></td>
<td><span class="label">.error_msg_table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;A0</td>
<td class="hex">A0</td>
</tr>

<tr id="addr-84B0">
<td class="addr"><a href="#addr-84B0">84B0</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Line Jammed&quot;</span></td>
<td class="hex">4C 69 6E 65 20 4A 61 6D 6D 65 64</td>
</tr>

<tr id="addr-84BB">
<td class="addr"><a href="#addr-84BB">84BB</a></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;A1</td>
<td class="hex">00 A1</td>
</tr>

<tr id="addr-84BD">
<td class="addr"><a href="#addr-84BD">84BD</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Net Error&quot;</span></td>
<td class="hex">4E 65 74 20 45 72 72 6F 72</td>
</tr>

<tr id="addr-84C6">
<td class="addr"><a href="#addr-84C6">84C6</a></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;A2</td>
<td class="hex">00 A2</td>
</tr>

<tr id="addr-84C8">
<td class="addr"><a href="#addr-84C8">84C8</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Not listening&quot;</span></td>
<td class="hex">4E 6F 74 20 6C 69 73 74 65 6E 69 6E 67</td>
</tr>

<tr id="addr-84D5">
<td class="addr"><a href="#addr-84D5">84D5</a></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;A3</td>
<td class="hex">00 A3</td>
</tr>

<tr id="addr-84D7">
<td class="addr"><a href="#addr-84D7">84D7</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;No Clock&quot;</span></td>
<td class="hex">4E 6F 20 43 6C 6F 63 6B</td>
</tr>

<tr id="addr-84DF">
<td class="addr"><a href="#addr-84DF">84DF</a></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;A4</td>
<td class="hex">00 A4</td>
</tr>

<tr id="addr-84E1">
<td class="addr"><a href="#addr-84E1">84E1</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Bad Txcb&quot;</span></td>
<td class="hex">42 61 64 20 54 78 63 62</td>
</tr>

<tr id="addr-84E9">
<td class="addr"><a href="#addr-84E9">84E9</a></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;11</td>
<td class="hex">00 11</td>
</tr>

<tr id="addr-84EB">
<td class="addr"><a href="#addr-84EB">84EB</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Escape&quot;</span></td>
<td class="hex">45 73 63 61 70 65</td>
</tr>

<tr id="addr-84F1">
<td class="addr"><a href="#addr-84F1">84F1</a></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;CB</td>
<td class="hex">00 CB</td>
</tr>

<tr id="addr-84F3">
<td class="addr"><a href="#addr-84F3">84F3</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Bad Option&quot;</span></td>
<td class="hex">42 61 64 20 4F 70 74 69 6F 6E</td>
</tr>

<tr id="addr-84FD">
<td class="addr"><a href="#addr-84FD">84FD</a></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;A5</td>
<td class="hex">00 A5</td>
</tr>

<tr id="addr-84FF">
<td class="addr"><a href="#addr-84FF">84FF</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;No reply&quot;</span></td>
<td class="hex">4E 6F 20 72 65 70 6C 79</td>
</tr>

<tr id="addr-8507">
<td class="addr"><a href="#addr-8507">8507</a></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Save FSCV/vector arguments</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores A, X, Y into the filing system workspace. Called at the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; start of every FS vector handler (FILEV, ARGSV, BGETV, BPUTV,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; GBPBV, FINDV, FSCV). NFS repurposes CFS/RFS workspace locations:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $BD (fs_last_byte_flag) = A (function code / command)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $BB (fs_options)        = X (control block ptr low)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $BC (fs_block_offset)   = Y (control block ptr high)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $BE/$BF (fs_crc_lo/hi)  = X/Y (duplicate for indexed access)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8508">
<td class="addr"><a href="#addr-8508">8508</a></td>
<td><span class="label">.save_fscv_args</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a></span></td>
<td class="hex">85 BD</td>
</tr>

<tr id="addr-850A">
<td class="addr"><a href="#addr-850A">850A</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00BB">fs_options</a></span></td>
<td class="hex">86 BB</td>
</tr>

<tr id="addr-850C">
<td class="addr"><a href="#addr-850C">850C</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00BC">fs_block_offset</a></span></td>
<td class="hex">84 BC</td>
</tr>

<tr id="addr-850E">
<td class="addr"><a href="#addr-850E">850E</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">86 BE</td>
</tr>

<tr id="addr-8510">
<td class="addr"><a href="#addr-8510">8510</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00BF">fs_crc_hi</a></span></td>
<td class="hex">84 BF</td>
</tr>

<tr id="addr-8512">
<td class="addr"><a href="#addr-8512">8512</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Decode file attributes: FS → BBC format (FSBBC, 6-bit variant)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads attribute byte at offset $0E from the parameter block,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; masks to 6 bits, then falls through to the shared bitmask</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; builder. Converts fileserver protection format (5-6 bits) to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; BBC OSFILE attribute format (8 bits) via the lookup table at</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $8530. The two formats use different bit layouts for file</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; protection attributes.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8513">
<td class="addr"><a href="#addr-8513">8513</a></td>
<td><span class="label">.decode_attribs_6bit</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A0 0E</td>
</tr>

<tr id="addr-8515">
<td class="addr"><a href="#addr-8515">8515</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8517">
<td class="addr"><a href="#addr-8517">8517</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">29 3F</td>
</tr>

<tr id="addr-8519">
<td class="addr"><a href="#addr-8519">8519</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#4</span></td>
<td class="hex">A2 04</td>
</tr>

<tr id="addr-851B">
<td class="addr"><a href="#addr-851B">851B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8521">c8521</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 04</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Decode file attributes: BBC → FS format (BBCFS, 5-bit variant)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Masks A to 5 bits and builds an access bitmask via the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; lookup table at $8530. Each input bit position maps to a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; different output bit via the table. The conversion is done</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; by iterating through the source bits and OR-ing in the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; corresponding destination bits from the table, translating</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; between BBC (8-bit) and fileserver (5-bit) protection formats.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-851D">
<td class="addr"><a href="#addr-851D">851D</a></td>
<td><span class="label">.decode_attribs_5bit</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;1f</span></td>
<td class="hex">29 1F</td>
</tr>

<tr id="addr-851F">
<td class="addr"><a href="#addr-851F">851F</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A2 FF</td>
</tr>

<tr id="addr-8521">
<td class="addr"><a href="#addr-8521">8521</a></td>
<td><span class="label">.c8521</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">85 B8</td>
</tr>

<tr id="addr-8523">
<td class="addr"><a href="#addr-8523">8523</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-8525">
<td class="addr"><a href="#addr-8525">8525</a></td>
<td><span class="label">.loop_c8525</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8526">
<td class="addr"><a href="#addr-8526">8526</a></td>
<td>    <span class="opcode">LSR</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">46 B8</td>
</tr>

<tr id="addr-8528">
<td class="addr"><a href="#addr-8528">8528</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-852D">c852d</a></span></td>
<td class="hex">90 03</td>
</tr>

<tr id="addr-852A">
<td class="addr"><a href="#addr-852A">852A</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-8530">access_bit_table</a>,x</span></td>
<td class="hex">1D 30 85</td>
</tr>

<tr id="addr-852D">
<td class="addr"><a href="#addr-852D">852D</a></td>
<td><span class="label">.c852d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8525">loop_c8525</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-852F">
<td class="addr"><a href="#addr-852F">852F</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8530">
<td class="addr"><a href="#addr-8530">8530</a></td>
<td><span class="label">.access_bit_table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;50, &amp;20, &amp;05, &amp;02, &amp;88, &amp;04, &amp;08, &amp;80, &amp;10, &amp;01, &amp;02</td>
<td class="hex">50 20 05 02 88 04 08 80 10 01 02</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print inline string, high-bit terminated (VSTRNG)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Pops the return address from the stack, prints each byte via OSASCI</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; until a byte with bit 7 set is found, then jumps to that address.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The high-bit byte serves as both the string terminator and the opcode</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; of the first instruction after the string. N.B. Cannot be used for</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; BRK error messages -- the stack manipulation means a BRK in the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; inline data would corrupt the stack rather than invoke the error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; handler.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: terminator byte (bit 7 set, also next opcode)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: corrupted (by OSASCI)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: 0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-853B">
<td class="addr"><a href="#addr-853B">853B</a></td>
<td><span class="label">.print_inline</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span>  <span class="comment">; Pop return address (low) — points to last byte of JSR</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-853C">
<td class="addr"><a href="#addr-853C">853C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a></span></td>
<td class="hex">85 B0</td>
</tr>

<tr id="addr-853E">
<td class="addr"><a href="#addr-853E">853E</a></td>
<td>    <span class="opcode">PLA</span>  <span class="comment">; Pop return address (high)</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-853F">
<td class="addr"><a href="#addr-853F">853F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B1">fs_load_addr_hi</a></span></td>
<td class="hex">85 B1</td>
</tr>

<tr id="addr-8541">
<td class="addr"><a href="#addr-8541">8541</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8543">
<td class="addr"><a href="#addr-8543">8543</a></td>
<td><span class="label">.loop_c8543</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a></span>  <span class="comment">; Advance pointer past return address / to next char</span></td>
<td class="hex">E6 B0</td>
</tr>

<tr id="addr-8545">
<td class="addr"><a href="#addr-8545">8545</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8549">c8549</a></span></td>
<td class="hex">D0 02</td>
</tr>

<tr id="addr-8547">
<td class="addr"><a href="#addr-8547">8547</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00B1">fs_load_addr_hi</a></span></td>
<td class="hex">E6 B1</td>
</tr>

<tr id="addr-8549">
<td class="addr"><a href="#addr-8549">8549</a></td>
<td><span class="label">.c8549</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00B0">fs_load_addr</a>),y</span>  <span class="comment">; Load next byte from inline string</span></td>
<td class="hex">B1 B0</td>
</tr>

<tr id="addr-854B">
<td class="addr"><a href="#addr-854B">854B</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8552">c8552</a></span>  <span class="comment">; Bit 7 set? Done — this byte is the next opcode</span></td>
<td class="hex">30 05</td>
</tr>

<tr id="addr-854D">
<td class="addr"><a href="#addr-854D">854D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFE3">osasci</a></span>  <span class="comment">; Write character</span></td>
<td class="hex">20 E3 FF</td>
</tr>

<tr id="addr-8550">
<td class="addr"><a href="#addr-8550">8550</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8543">loop_c8543</a></span></td>
<td class="hex">D0 F1</td>
</tr>

<tr id="addr-8552">
<td class="addr"><a href="#addr-8552">8552</a></td>
<td><span class="label">.c8552</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand">(<a href="#addr-00B0">fs_load_addr</a>)</span>  <span class="comment">; Jump to address of high-bit byte (resumes code after string)</span></td>
<td class="hex">6C B0 00</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Skip leading spaces in parameter block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Advances Y past space characters in (fs_options),Y.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Returns with the first non-space character in A.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets carry if the character is &gt;= &#39;A&#39; (alphabetic).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8555">
<td class="addr"><a href="#addr-8555">8555</a></td>
<td><span class="label">.skip_spaces</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8557">
<td class="addr"><a href="#addr-8557">8557</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8558">
<td class="addr"><a href="#addr-8558">8558</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;20</span></td>
<td class="hex">C9 20</td>
</tr>

<tr id="addr-855A">
<td class="addr"><a href="#addr-855A">855A</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8555">skip_spaces</a></span></td>
<td class="hex">F0 F9</td>
</tr>

<tr id="addr-855C">
<td class="addr"><a href="#addr-855C">855C</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-855D">
<td class="addr"><a href="#addr-855D">855D</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;41</span></td>
<td class="hex">C9 41</td>
</tr>

<tr id="addr-855F">
<td class="addr"><a href="#addr-855F">855F</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Parse decimal number from (fs_options),Y (DECIN)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads ASCII digits and accumulates in $B2 (fs_load_addr_2).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Multiplication by 10 uses the identity: n*10 = n*8 + n*2,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; computed as ASL $B2 (x2), then A = $B2*4 via two ASLs,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; then ADC $B2 gives x10.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Terminates on &#34;.&#34; (pathname separator), control chars, or space.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The delimiter handling was revised to support dot-separated path</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; components (e.g. &#34;1.$.PROG&#34;) -- originally stopped on any char</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; &gt;= $40 (any letter), but the revision allows numbers followed</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; by dots.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: offset into (fs_options) buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: parsed value (accumulated in $B2)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: corrupted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: offset past last digit parsed</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8560">
<td class="addr"><a href="#addr-8560">8560</a></td>
<td><span class="label">.parse_decimal</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8561">
<td class="addr"><a href="#addr-8561">8561</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-8563">
<td class="addr"><a href="#addr-8563">8563</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">85 B2</td>
</tr>

<tr id="addr-8565">
<td class="addr"><a href="#addr-8565">8565</a></td>
<td><span class="label">.loop_c8565</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8567">
<td class="addr"><a href="#addr-8567">8567</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;40</span></td>
<td class="hex">C9 40</td>
</tr>

<tr id="addr-8569">
<td class="addr"><a href="#addr-8569">8569</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8584">c8584</a></span></td>
<td class="hex">B0 19</td>
</tr>

<tr id="addr-856B">
<td class="addr"><a href="#addr-856B">856B</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;2e</span></td>
<td class="hex">C9 2E</td>
</tr>

<tr id="addr-856D">
<td class="addr"><a href="#addr-856D">856D</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8585">c8585</a></span></td>
<td class="hex">F0 16</td>
</tr>

<tr id="addr-856F">
<td class="addr"><a href="#addr-856F">856F</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8584">c8584</a></span></td>
<td class="hex">30 13</td>
</tr>

<tr id="addr-8571">
<td class="addr"><a href="#addr-8571">8571</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;0f</span></td>
<td class="hex">29 0F</td>
</tr>

<tr id="addr-8573">
<td class="addr"><a href="#addr-8573">8573</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B3">l00b3</a></span></td>
<td class="hex">85 B3</td>
</tr>

<tr id="addr-8575">
<td class="addr"><a href="#addr-8575">8575</a></td>
<td>    <span class="opcode">ASL</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">06 B2</td>
</tr>

<tr id="addr-8577">
<td class="addr"><a href="#addr-8577">8577</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">A5 B2</td>
</tr>

<tr id="addr-8579">
<td class="addr"><a href="#addr-8579">8579</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-857A">
<td class="addr"><a href="#addr-857A">857A</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-857B">
<td class="addr"><a href="#addr-857B">857B</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">65 B2</td>
</tr>

<tr id="addr-857D">
<td class="addr"><a href="#addr-857D">857D</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00B3">l00b3</a></span></td>
<td class="hex">65 B3</td>
</tr>

<tr id="addr-857F">
<td class="addr"><a href="#addr-857F">857F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">85 B2</td>
</tr>

<tr id="addr-8581">
<td class="addr"><a href="#addr-8581">8581</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8582">
<td class="addr"><a href="#addr-8582">8582</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8565">loop_c8565</a></span></td>
<td class="hex">D0 E1</td>
</tr>

<tr id="addr-8584">
<td class="addr"><a href="#addr-8584">8584</a></td>
<td><span class="label">.c8584</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-8585">
<td class="addr"><a href="#addr-8585">8585</a></td>
<td><span class="label">.c8585</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">A5 B2</td>
</tr>

<tr id="addr-8587">
<td class="addr"><a href="#addr-8587">8587</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8588">
<td class="addr"><a href="#addr-8588">8588</a></td>
<td><span class="label">.handle_to_mask_a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8589">
<td class="addr"><a href="#addr-8589">8589</a></td>
<td><span class="label">.handle_to_mask_clc</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Convert file handle to bitmask (Y2FS)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Converts fileserver handles to single-bit masks segregated inside</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the BBC. NFS handles occupy the $20-$27 range (base HAND=$20),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; which cannot collide with local filing system or cassette handles</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; -- the MOS routes OSFIND/OSBGET/OSBPUT to the correct filing</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; system based on the handle value alone. The power-of-two encoding</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; allows the EOF hint byte to track up to 8 files simultaneously</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; with one bit per file, and enables fast set operations (ORA to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; add, EOR to toggle, AND to test) without loops. Handle 0 passes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; through unchanged (means &#34;no file&#34;). The bit-shift conversion loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; has a built-in validity check: if the handle is out of range, the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; repeated ASL shifts all bits out, leaving A=0, which is converted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to Y=$FF as a sentinel -- bad handles fail gracefully rather than</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; indexing into garbage.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Three entry points: $858A (direct), $8589 (CLC first), $8588 (TAY first).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: handle number</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     C: 0: convert, 1 with Y=0: skip, 1 with Y!=0: convert</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: bitmask (single bit set) or $FF if handle invalid</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-858A">
<td class="addr"><a href="#addr-858A">858A</a></td>
<td><span class="label">.handle_to_mask</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-858B">
<td class="addr"><a href="#addr-858B">858B</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-858C">
<td class="addr"><a href="#addr-858C">858C</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-858D">
<td class="addr"><a href="#addr-858D">858D</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-858E">
<td class="addr"><a href="#addr-858E">858E</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8592">c8592</a></span></td>
<td class="hex">90 02</td>
</tr>

<tr id="addr-8590">
<td class="addr"><a href="#addr-8590">8590</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-85A1">c85a1</a></span></td>
<td class="hex">F0 0F</td>
</tr>

<tr id="addr-8592">
<td class="addr"><a href="#addr-8592">8592</a></td>
<td><span class="label">.c8592</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8593">
<td class="addr"><a href="#addr-8593">8593</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">#&amp;1f</span></td>
<td class="hex">E9 1F</td>
</tr>

<tr id="addr-8595">
<td class="addr"><a href="#addr-8595">8595</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8596">
<td class="addr"><a href="#addr-8596">8596</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-8598">
<td class="addr"><a href="#addr-8598">8598</a></td>
<td><span class="label">.loop_c8598</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-8599">
<td class="addr"><a href="#addr-8599">8599</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-859A">
<td class="addr"><a href="#addr-859A">859A</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8598">loop_c8598</a></span></td>
<td class="hex">D0 FC</td>
</tr>

<tr id="addr-859C">
<td class="addr"><a href="#addr-859C">859C</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-859D">
<td class="addr"><a href="#addr-859D">859D</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-859E">
<td class="addr"><a href="#addr-859E">859E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-85A1">c85a1</a></span></td>
<td class="hex">D0 01</td>
</tr>

<tr id="addr-85A0">
<td class="addr"><a href="#addr-85A0">85A0</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-85A1">
<td class="addr"><a href="#addr-85A1">85A1</a></td>
<td><span class="label">.c85a1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-85A2">
<td class="addr"><a href="#addr-85A2">85A2</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-85A3">
<td class="addr"><a href="#addr-85A3">85A3</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-85A4">
<td class="addr"><a href="#addr-85A4">85A4</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Convert bitmask to handle number (FS2A)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Inverse of Y2FS. Converts from the power-of-two FS format</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; back to a sequential handle number by counting right shifts</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; until A=0. Adds $1E to convert the 1-based bit position to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; a handle number (handles start at $1F+1 = $20). Used when</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; receiving handle values from the fileserver in reply packets.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: single-bit bitmask</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: handle number ($20-$27)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: corrupted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-85A5">
<td class="addr"><a href="#addr-85A5">85A5</a></td>
<td><span class="label">.mask_to_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-85A7">
<td class="addr"><a href="#addr-85A7">85A7</a></td>
<td><span class="label">.loop_c85a7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-85A8">
<td class="addr"><a href="#addr-85A8">85A8</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-85A9">
<td class="addr"><a href="#addr-85A9">85A9</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-85A7">loop_c85a7</a></span></td>
<td class="hex">D0 FC</td>
</tr>

<tr id="addr-85AB">
<td class="addr"><a href="#addr-85AB">85AB</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-85AC">
<td class="addr"><a href="#addr-85AC">85AC</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#&amp;1e</span></td>
<td class="hex">69 1E</td>
</tr>

<tr id="addr-85AE">
<td class="addr"><a href="#addr-85AE">85AE</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print byte as 3-digit decimal number</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Prints A as a decimal number using repeated subtraction</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; for each digit position (100, 10, 1). Leading zeros are</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; printed (no suppression). Used to display station numbers.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-85AF">
<td class="addr"><a href="#addr-85AF">85AF</a></td>
<td><span class="label">.print_decimal</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-85B0">
<td class="addr"><a href="#addr-85B0">85B0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;64</span></td>
<td class="hex">A9 64</td>
</tr>

<tr id="addr-85B2">
<td class="addr"><a href="#addr-85B2">85B2</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85BC">print_decimal_digit</a></span></td>
<td class="hex">20 BC 85</td>
</tr>

<tr id="addr-85B5">
<td class="addr"><a href="#addr-85B5">85B5</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0a</span></td>
<td class="hex">A9 0A</td>
</tr>

<tr id="addr-85B7">
<td class="addr"><a href="#addr-85B7">85B7</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85BC">print_decimal_digit</a></span></td>
<td class="hex">20 BC 85</td>
</tr>

<tr id="addr-85BA">
<td class="addr"><a href="#addr-85BA">85BA</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print one decimal digit by repeated subtraction</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Divides Y by A using repeated subtraction. Prints the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; quotient as an ASCII digit (&#39;0&#39;-&#39;9&#39;). Returns with the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; remainder in Y. X starts at $2F (&#39;0&#39;-1) and increments</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; once per subtraction, giving the ASCII digit directly.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-85BC">
<td class="addr"><a href="#addr-85BC">85BC</a></td>
<td><span class="label">.print_decimal_digit</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">85 B8</td>
</tr>

<tr id="addr-85BE">
<td class="addr"><a href="#addr-85BE">85BE</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-85BF">
<td class="addr"><a href="#addr-85BF">85BF</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;2f</span></td>
<td class="hex">A2 2F</td>
</tr>

<tr id="addr-85C1">
<td class="addr"><a href="#addr-85C1">85C1</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-85C2">
<td class="addr"><a href="#addr-85C2">85C2</a></td>
<td><span class="label">.loop_c85c2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-85C3">
<td class="addr"><a href="#addr-85C3">85C3</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">E5 B8</td>
</tr>

<tr id="addr-85C5">
<td class="addr"><a href="#addr-85C5">85C5</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-85C2">loop_c85c2</a></span></td>
<td class="hex">B0 FB</td>
</tr>

<tr id="addr-85C7">
<td class="addr"><a href="#addr-85C7">85C7</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">65 B8</td>
</tr>

<tr id="addr-85C9">
<td class="addr"><a href="#addr-85C9">85C9</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-85CA">
<td class="addr"><a href="#addr-85CA">85CA</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-85CB">
<td class="addr"><a href="#addr-85CB">85CB</a></td>
<td><span class="label">.c85cb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-FFE3">osasci</a></span>  <span class="comment">; Write character</span></td>
<td class="hex">4C E3 FF</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Compare two 4-byte addresses</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Compares bytes at $B0-$B3 against $B4-$B7 using EOR.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Used by the OSFILE save handler to compare the current</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; transfer address ($C8-$CB, copied to $B0) against the end</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; address ($B4-$B7) during multi-block file data transfers.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: corrupted (EOR result)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: corrupted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-85CE">
<td class="addr"><a href="#addr-85CE">85CE</a></td>
<td><span class="label">.compare_addresses</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#4</span></td>
<td class="hex">A2 04</td>
</tr>

<tr id="addr-85D0">
<td class="addr"><a href="#addr-85D0">85D0</a></td>
<td><span class="label">.loop_c85d0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00AF">l00af</a>,x</span></td>
<td class="hex">B5 AF</td>
</tr>

<tr id="addr-85D2">
<td class="addr"><a href="#addr-85D2">85D2</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand"><a href="#addr-00B3">l00b3</a>,x</span></td>
<td class="hex">55 B3</td>
</tr>

<tr id="addr-85D4">
<td class="addr"><a href="#addr-85D4">85D4</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-85D9">return_3</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-85D6">
<td class="addr"><a href="#addr-85D6">85D6</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-85D7">
<td class="addr"><a href="#addr-85D7">85D7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-85D0">loop_c85d0</a></span></td>
<td class="hex">D0 F7</td>
</tr>

<tr id="addr-85D9">
<td class="addr"><a href="#addr-85D9">85D9</a></td>
<td><span class="label">.return_3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-85DA">
<td class="addr"><a href="#addr-85DA">85DA</a></td>
<td><span class="label">.fscv_read_handles</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A2 20</td>
</tr>

<tr id="addr-85DC">
<td class="addr"><a href="#addr-85DC">85DC</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;27</span></td>
<td class="hex">A0 27</td>
</tr>

<tr id="addr-85DE">
<td class="addr"><a href="#addr-85DE">85DE</a></td>
<td><span class="label">.return_4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Clear bit(s) in FS flags ($0E07)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Inverts A (EOR #$FF), then ANDs into fs_work_0e07 to clear</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the specified bits. Falls through to set_fs_flag to store.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-85DF">
<td class="addr"><a href="#addr-85DF">85DF</a></td>
<td><span class="label">.clear_fs_flag</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">49 FF</td>
</tr>

<tr id="addr-85E1">
<td class="addr"><a href="#addr-85E1">85E1</a></td>
<td>    <span class="opcode">AND</span> <span class="operand"><a href="#addr-0E07">fs_eof_flags</a></span></td>
<td class="hex">2D 07 0E</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set bit(s) in FS flags ($0E07)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ORs A into fs_work_0e07 (EOF hint byte). Each bit represents</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; one of up to 8 open file handles. When clear, the file is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; definitely NOT at EOF. When set, the fileserver must be queried</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to confirm EOF status. This negative-cache optimisation avoids</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; expensive network round-trips for the common case. The hint is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; cleared when the file pointer is updated (since seeking away</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; from EOF invalidates the hint) and set after BGET/OPEN/EOF</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; operations that might have reached the end.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-85E4">
<td class="addr"><a href="#addr-85E4">85E4</a></td>
<td><span class="label">.set_fs_flag</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-0E07">fs_eof_flags</a></span></td>
<td class="hex">0D 07 0E</td>
</tr>

<tr id="addr-85E7">
<td class="addr"><a href="#addr-85E7">85E7</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E07">fs_eof_flags</a></span></td>
<td class="hex">8D 07 0E</td>
</tr>

<tr id="addr-85EA">
<td class="addr"><a href="#addr-85EA">85EA</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print byte as two hex digits</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Prints the high nibble first (via 4× LSR), then the low</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; nibble. Each nibble is converted to ASCII &#39;0&#39;-&#39;9&#39; or &#39;A&#39;-&#39;F&#39;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and output via OSASCI.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-85EB">
<td class="addr"><a href="#addr-85EB">85EB</a></td>
<td><span class="label">.print_hex</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-85EC">
<td class="addr"><a href="#addr-85EC">85EC</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-85ED">
<td class="addr"><a href="#addr-85ED">85ED</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-85EE">
<td class="addr"><a href="#addr-85EE">85EE</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-85EF">
<td class="addr"><a href="#addr-85EF">85EF</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-85F0">
<td class="addr"><a href="#addr-85F0">85F0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85F6">print_hex_nibble</a></span></td>
<td class="hex">20 F6 85</td>
</tr>

<tr id="addr-85F3">
<td class="addr"><a href="#addr-85F3">85F3</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-85F4">
<td class="addr"><a href="#addr-85F4">85F4</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;0f</span></td>
<td class="hex">29 0F</td>
</tr>

<tr id="addr-85F6">
<td class="addr"><a href="#addr-85F6">85F6</a></td>
<td><span class="label">.print_hex_nibble</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;30</span></td>
<td class="hex">09 30</td>
</tr>

<tr id="addr-85F8">
<td class="addr"><a href="#addr-85F8">85F8</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;3a</span></td>
<td class="hex">C9 3A</td>
</tr>

<tr id="addr-85FA">
<td class="addr"><a href="#addr-85FA">85FA</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-85FE">c85fe</a></span></td>
<td class="hex">90 02</td>
</tr>

<tr id="addr-85FC">
<td class="addr"><a href="#addr-85FC">85FC</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#6</span></td>
<td class="hex">69 06</td>
</tr>

<tr id="addr-85FE">
<td class="addr"><a href="#addr-85FE">85FE</a></td>
<td><span class="label">.c85fe</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-85CB">c85cb</a></span></td>
<td class="hex">D0 CB</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print file catalogue line</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Displays a formatted catalogue entry: filename (padded to 12</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; chars with spaces), load address (4 hex bytes at offset 5-2),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; exec address (4 hex bytes at offset 9-6), and file length</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (3 hex bytes at offset $0C-$0A), followed by a newline.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Data is read from (fs_crc_lo) for the filename and from</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (fs_options) for the numeric fields. Returns immediately</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; if fs_work_0e06 is zero (no info available).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8600">
<td class="addr"><a href="#addr-8600">8600</a></td>
<td><span class="label">.print_file_info</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0E06">fs_messages_flag</a></span></td>
<td class="hex">AC 06 0E</td>
</tr>

<tr id="addr-8603">
<td class="addr"><a href="#addr-8603">8603</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-85DE">return_4</a></span></td>
<td class="hex">F0 D9</td>
</tr>

<tr id="addr-8605">
<td class="addr"><a href="#addr-8605">8605</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8607">
<td class="addr"><a href="#addr-8607">8607</a></td>
<td><span class="label">.loop_c8607</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">B1 BE</td>
</tr>

<tr id="addr-8609">
<td class="addr"><a href="#addr-8609">8609</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">C9 0D</td>
</tr>

<tr id="addr-860B">
<td class="addr"><a href="#addr-860B">860B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8617">pad_filename_spaces</a></span></td>
<td class="hex">F0 0A</td>
</tr>

<tr id="addr-860D">
<td class="addr"><a href="#addr-860D">860D</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;20</span></td>
<td class="hex">C9 20</td>
</tr>

<tr id="addr-860F">
<td class="addr"><a href="#addr-860F">860F</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8617">pad_filename_spaces</a></span></td>
<td class="hex">F0 06</td>
</tr>

<tr id="addr-8611">
<td class="addr"><a href="#addr-8611">8611</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFE3">osasci</a></span>  <span class="comment">; Write character</span></td>
<td class="hex">20 E3 FF</td>
</tr>

<tr id="addr-8614">
<td class="addr"><a href="#addr-8614">8614</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8615">
<td class="addr"><a href="#addr-8615">8615</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8607">loop_c8607</a></span></td>
<td class="hex">D0 F0</td>
</tr>

<tr id="addr-8617">
<td class="addr"><a href="#addr-8617">8617</a></td>
<td><span class="label">.pad_filename_spaces</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8640">print_space</a></span></td>
<td class="hex">20 40 86</td>
</tr>

<tr id="addr-861A">
<td class="addr"><a href="#addr-861A">861A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-861B">
<td class="addr"><a href="#addr-861B">861B</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">C0 0C</td>
</tr>

<tr id="addr-861D">
<td class="addr"><a href="#addr-861D">861D</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8617">pad_filename_spaces</a></span></td>
<td class="hex">90 F8</td>
</tr>

<tr id="addr-861F">
<td class="addr"><a href="#addr-861F">861F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#5</span></td>
<td class="hex">A0 05</td>
</tr>

<tr id="addr-8621">
<td class="addr"><a href="#addr-8621">8621</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8635">print_hex_bytes</a></span></td>
<td class="hex">20 35 86</td>
</tr>

<tr id="addr-8624">
<td class="addr"><a href="#addr-8624">8624</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-862A">print_exec_and_len</a></span></td>
<td class="hex">20 2A 86</td>
</tr>

<tr id="addr-8627">
<td class="addr"><a href="#addr-8627">8627</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-FFE7">osnewl</a></span>  <span class="comment">; Write newline (characters 10 and 13)</span></td>
<td class="hex">4C E7 FF</td>
</tr>

<tr id="addr-862A">
<td class="addr"><a href="#addr-862A">862A</a></td>
<td><span class="label">.print_exec_and_len</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#9</span></td>
<td class="hex">A0 09</td>
</tr>

<tr id="addr-862C">
<td class="addr"><a href="#addr-862C">862C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8635">print_hex_bytes</a></span></td>
<td class="hex">20 35 86</td>
</tr>

<tr id="addr-862F">
<td class="addr"><a href="#addr-862F">862F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">A0 0C</td>
</tr>

<tr id="addr-8631">
<td class="addr"><a href="#addr-8631">8631</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-8633">
<td class="addr"><a href="#addr-8633">8633</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8637">c8637</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 02</td>
</tr>

<tr id="addr-8635">
<td class="addr"><a href="#addr-8635">8635</a></td>
<td><span class="label">.print_hex_bytes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#4</span></td>
<td class="hex">A2 04</td>
</tr>

<tr id="addr-8637">
<td class="addr"><a href="#addr-8637">8637</a></td>
<td><span class="label">.c8637</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8639">
<td class="addr"><a href="#addr-8639">8639</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85EB">print_hex</a></span></td>
<td class="hex">20 EB 85</td>
</tr>

<tr id="addr-863C">
<td class="addr"><a href="#addr-863C">863C</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-863D">
<td class="addr"><a href="#addr-863D">863D</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-863E">
<td class="addr"><a href="#addr-863E">863E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8637">c8637</a></span></td>
<td class="hex">D0 F7</td>
</tr>

<tr id="addr-8640">
<td class="addr"><a href="#addr-8640">8640</a></td>
<td><span class="label">.print_space</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A9 20</td>
</tr>

<tr id="addr-8642">
<td class="addr"><a href="#addr-8642">8642</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-85FE">c85fe</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 BA</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set up TX pointer to control block at $00C0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Points net_tx_ptr to $00C0 where the TX control block has</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; been built by init_tx_ctrl_block. Falls through to tx_poll_ff</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to initiate transmission with full retry.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8644">
<td class="addr"><a href="#addr-8644">8644</a></td>
<td><span class="label">.setup_tx_ptr_c0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;c0</span></td>
<td class="hex">A2 C0</td>
</tr>

<tr id="addr-8646">
<td class="addr"><a href="#addr-8646">8646</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a></span></td>
<td class="hex">86 9A</td>
</tr>

<tr id="addr-8648">
<td class="addr"><a href="#addr-8648">8648</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-864A">
<td class="addr"><a href="#addr-864A">864A</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-009B">net_tx_ptr_hi</a></span></td>
<td class="hex">86 9B</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Transmit and poll for result (full retry)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets A=$FF (retry count) and Y=$60 (timeout parameter).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Falls through to tx_poll_core.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-864C">
<td class="addr"><a href="#addr-864C">864C</a></td>
<td><span class="label">.tx_poll_ff</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-864E">
<td class="addr"><a href="#addr-864E">864E</a></td>
<td><span class="label">.tx_poll_timeout</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;60</span>  <span class="comment">; Y=timeout parameter ($60 = standard)</span></td>
<td class="hex">A0 60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Core transmit and poll routine (XMIT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Claims the TX semaphore (tx_ctrl_status) via ASL -- a busy-wait</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; spinlock where carry=0 means the semaphore is held by another</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; operation. Only after claiming the semaphore is the TX pointer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; copied to nmi_tx_block, ensuring the low-level transmit code</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; sees a consistent pointer. Then calls the ADLC TX setup routine</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and polls the control byte for completion:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit 7 set = still busy (loop)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit 6 set = error (check escape or report)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit 6 clear = success (clean return)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On error, checks for escape condition and handles retries.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Two entry points: setup_tx_ptr_c0 ($8644) always uses the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; standard TXCB; tx_poll_core ($8650) is general-purpose.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: retry count ($FF = full retry)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: timeout parameter ($60 = standard)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: entry A (retry count, restored from stack)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: 0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: 0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8650">
<td class="addr"><a href="#addr-8650">8650</a></td>
<td><span class="label">.tx_poll_core</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8651">
<td class="addr"><a href="#addr-8651">8651</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8652">
<td class="addr"><a href="#addr-8652">8652</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8653">
<td class="addr"><a href="#addr-8653">8653</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-8655">
<td class="addr"><a href="#addr-8655">8655</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>,x)</span></td>
<td class="hex">A1 9A</td>
</tr>

<tr id="addr-8657">
<td class="addr"><a href="#addr-8657">8657</a></td>
<td><span class="label">.c8657</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>,x)</span></td>
<td class="hex">81 9A</td>
</tr>

<tr id="addr-8659">
<td class="addr"><a href="#addr-8659">8659</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-865A">
<td class="addr"><a href="#addr-865A">865A</a></td>
<td><span class="label">.loop_c865a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ASL</span> <span class="operand"><a href="#addr-0D3A">tx_ctrl_status</a></span></td>
<td class="hex">0E 3A 0D</td>
</tr>

<tr id="addr-865D">
<td class="addr"><a href="#addr-865D">865D</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-865A">loop_c865a</a></span></td>
<td class="hex">90 FB</td>
</tr>

<tr id="addr-865F">
<td class="addr"><a href="#addr-865F">865F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a></span></td>
<td class="hex">A5 9A</td>
</tr>

<tr id="addr-8661">
<td class="addr"><a href="#addr-8661">8661</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A0">nmi_tx_block</a></span></td>
<td class="hex">85 A0</td>
</tr>

<tr id="addr-8663">
<td class="addr"><a href="#addr-8663">8663</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009B">net_tx_ptr_hi</a></span></td>
<td class="hex">A5 9B</td>
</tr>

<tr id="addr-8665">
<td class="addr"><a href="#addr-8665">8665</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A1">nmi_tx_block_hi</a></span></td>
<td class="hex">85 A1</td>
</tr>

<tr id="addr-8667">
<td class="addr"><a href="#addr-8667">8667</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9660">trampoline_tx_setup</a></span></td>
<td class="hex">20 60 96</td>
</tr>

<tr id="addr-866A">
<td class="addr"><a href="#addr-866A">866A</a></td>
<td><span class="label">.loop_c866a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>,x)</span></td>
<td class="hex">A1 9A</td>
</tr>

<tr id="addr-866C">
<td class="addr"><a href="#addr-866C">866C</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-866A">loop_c866a</a></span></td>
<td class="hex">30 FC</td>
</tr>

<tr id="addr-866E">
<td class="addr"><a href="#addr-866E">866E</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-866F">
<td class="addr"><a href="#addr-866F">866F</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8690">c8690</a></span></td>
<td class="hex">10 1F</td>
</tr>

<tr id="addr-8671">
<td class="addr"><a href="#addr-8671">8671</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-8672">
<td class="addr"><a href="#addr-8672">8672</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-868C">c868c</a></span></td>
<td class="hex">F0 18</td>
</tr>

<tr id="addr-8674">
<td class="addr"><a href="#addr-8674">8674</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-847A">check_escape</a></span></td>
<td class="hex">20 7A 84</td>
</tr>

<tr id="addr-8677">
<td class="addr"><a href="#addr-8677">8677</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8678">
<td class="addr"><a href="#addr-8678">8678</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8679">
<td class="addr"><a href="#addr-8679">8679</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-867A">
<td class="addr"><a href="#addr-867A">867A</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-867B">
<td class="addr"><a href="#addr-867B">867B</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-867C">
<td class="addr"><a href="#addr-867C">867C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-868C">c868c</a></span></td>
<td class="hex">F0 0E</td>
</tr>

<tr id="addr-867E">
<td class="addr"><a href="#addr-867E">867E</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">#1</span></td>
<td class="hex">E9 01</td>
</tr>

<tr id="addr-8680">
<td class="addr"><a href="#addr-8680">8680</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8681">
<td class="addr"><a href="#addr-8681">8681</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8682">
<td class="addr"><a href="#addr-8682">8682</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8683">
<td class="addr"><a href="#addr-8683">8683</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8684">
<td class="addr"><a href="#addr-8684">8684</a></td>
<td><span class="label">.delay_1ms</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8685">
<td class="addr"><a href="#addr-8685">8685</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8684">delay_1ms</a></span></td>
<td class="hex">D0 FD</td>
</tr>

<tr id="addr-8687">
<td class="addr"><a href="#addr-8687">8687</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8688">
<td class="addr"><a href="#addr-8688">8688</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8684">delay_1ms</a></span></td>
<td class="hex">D0 FA</td>
</tr>

<tr id="addr-868A">
<td class="addr"><a href="#addr-868A">868A</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8657">c8657</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">F0 CB</td>
</tr>

<tr id="addr-868C">
<td class="addr"><a href="#addr-868C">868C</a></td>
<td><span class="label">.c868c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-868D">
<td class="addr"><a href="#addr-868D">868D</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8428">c8428</a></span></td>
<td class="hex">4C 28 84</td>
</tr>

<tr id="addr-8690">
<td class="addr"><a href="#addr-8690">8690</a></td>
<td><span class="label">.c8690</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8691">
<td class="addr"><a href="#addr-8691">8691</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8692">
<td class="addr"><a href="#addr-8692">8692</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8693">
<td class="addr"><a href="#addr-8693">8693</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FILEV handler (OSFILE entry point)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Saves A/X/Y, copies the filename pointer from the parameter block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to os_text_ptr, then uses GSINIT/GSREAD to parse the filename into</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $0FC5+. Sets fs_crc_lo/hi to point at the parsed filename buffer.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatches by function code A:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=$FF: load file (send_fs_examine at $86D0)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=$00: save file (filev_save at $8746)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=$01-$06: attribute operations (filev_attrib_dispatch at $8844)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Other: restore_args_return (unsupported, no-op)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: function code ($FF=load, $00=save, $01-$06=attrs)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: parameter block address low byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: parameter block address high byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8694">
<td class="addr"><a href="#addr-8694">8694</a></td>
<td><span class="label">.filev_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8508">save_fscv_args</a></span></td>
<td class="hex">20 08 85</td>
</tr>

<tr id="addr-8697">
<td class="addr"><a href="#addr-8697">8697</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8699">
<td class="addr"><a href="#addr-8699">8699</a></td>
<td><span class="label">.loop_c8699</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-869B">
<td class="addr"><a href="#addr-869B">869B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00F2">os_text_ptr</a>,y</span></td>
<td class="hex">99 F2 00</td>
</tr>

<tr id="addr-869E">
<td class="addr"><a href="#addr-869E">869E</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-869F">
<td class="addr"><a href="#addr-869F">869F</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8699">loop_c8699</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-86A1">
<td class="addr"><a href="#addr-86A1">86A1</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-86A2">
<td class="addr"><a href="#addr-86A2">86A2</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A2 FF</td>
</tr>

<tr id="addr-86A4">
<td class="addr"><a href="#addr-86A4">86A4</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-86A5">
<td class="addr"><a href="#addr-86A5">86A5</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFC2">gsinit</a></span></td>
<td class="hex">20 C2 FF</td>
</tr>

<tr id="addr-86A8">
<td class="addr"><a href="#addr-86A8">86A8</a></td>
<td><span class="label">.loop_c86a8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFC5">gsread</a></span></td>
<td class="hex">20 C5 FF</td>
</tr>

<tr id="addr-86AB">
<td class="addr"><a href="#addr-86AB">86AB</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-86B3">c86b3</a></span></td>
<td class="hex">B0 06</td>
</tr>

<tr id="addr-86AD">
<td class="addr"><a href="#addr-86AD">86AD</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-86AE">
<td class="addr"><a href="#addr-86AE">86AE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0FC5">l0fc5</a>,x</span></td>
<td class="hex">9D C5 0F</td>
</tr>

<tr id="addr-86B1">
<td class="addr"><a href="#addr-86B1">86B1</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-86A8">loop_c86a8</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">90 F5</td>
</tr>

<tr id="addr-86B3">
<td class="addr"><a href="#addr-86B3">86B3</a></td>
<td><span class="label">.c86b3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">A9 0D</td>
</tr>

<tr id="addr-86B5">
<td class="addr"><a href="#addr-86B5">86B5</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0FC6">l0fc6</a>,x</span></td>
<td class="hex">9D C6 0F</td>
</tr>

<tr id="addr-86B8">
<td class="addr"><a href="#addr-86B8">86B8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;c5</span></td>
<td class="hex">A9 C5</td>
</tr>

<tr id="addr-86BA">
<td class="addr"><a href="#addr-86BA">86BA</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">85 BE</td>
</tr>

<tr id="addr-86BC">
<td class="addr"><a href="#addr-86BC">86BC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0f</span></td>
<td class="hex">A9 0F</td>
</tr>

<tr id="addr-86BE">
<td class="addr"><a href="#addr-86BE">86BE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BF">fs_crc_hi</a></span></td>
<td class="hex">85 BF</td>
</tr>

<tr id="addr-86C0">
<td class="addr"><a href="#addr-86C0">86C0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a></span></td>
<td class="hex">A5 BD</td>
</tr>

<tr id="addr-86C2">
<td class="addr"><a href="#addr-86C2">86C2</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8741">c8741</a></span></td>
<td class="hex">10 7D</td>
</tr>

<tr id="addr-86C4">
<td class="addr"><a href="#addr-86C4">86C4</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">C9 FF</td>
</tr>

<tr id="addr-86C6">
<td class="addr"><a href="#addr-86C6">86C6</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-86CB">c86cb</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-86C8">
<td class="addr"><a href="#addr-86C8">86C8</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">4C 2C 89</td>
</tr>

<tr id="addr-86CB">
<td class="addr"><a href="#addr-86CB">86CB</a></td>
<td><span class="label">.c86cb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D63">copy_filename</a></span></td>
<td class="hex">20 63 8D</td>
</tr>

<tr id="addr-86CE">
<td class="addr"><a href="#addr-86CE">86CE</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Send FS examine command</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sends FS command $03 (FCEXAM: examine file) to the fileserver.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets $0F02=$03 and error pointer to &#39;*&#39;. Called for OSFILE $FF</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (load file) with the filename already in the command buffer.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The FS reply contains load/exec addresses and file length which</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; are used to set up the data transfer. The header URD field</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; is repurposed to carry the Econet data port number (PLDATA=$92)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; for the subsequent block data transfer.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-86D0">
<td class="addr"><a href="#addr-86D0">86D0</a></td>
<td><span class="label">.send_fs_examine</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;92</span></td>
<td class="hex">A9 92</td>
</tr>

<tr id="addr-86D2">
<td class="addr"><a href="#addr-86D2">86D2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F02">fs_cmd_urd</a></span></td>
<td class="hex">8D 02 0F</td>
</tr>

<tr id="addr-86D5">
<td class="addr"><a href="#addr-86D5">86D5</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">A9 2A</td>
</tr>

<tr id="addr-86D7">
<td class="addr"><a href="#addr-86D7">86D7</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8346">prepare_cmd_clv</a></span></td>
<td class="hex">20 46 83</td>
</tr>

<tr id="addr-86DA">
<td class="addr"><a href="#addr-86DA">86DA</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#6</span></td>
<td class="hex">A0 06</td>
</tr>

<tr id="addr-86DC">
<td class="addr"><a href="#addr-86DC">86DC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-86DE">
<td class="addr"><a href="#addr-86DE">86DE</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-86E8">c86e8</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-86E0">
<td class="addr"><a href="#addr-86E0">86E0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-87AD">copy_load_addr_from_params</a></span></td>
<td class="hex">20 AD 87</td>
</tr>

<tr id="addr-86E3">
<td class="addr"><a href="#addr-86E3">86E3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-87BA">copy_reply_to_params</a></span></td>
<td class="hex">20 BA 87</td>
</tr>

<tr id="addr-86E6">
<td class="addr"><a href="#addr-86E6">86E6</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-86EE">c86ee</a></span></td>
<td class="hex">90 06</td>
</tr>

<tr id="addr-86E8">
<td class="addr"><a href="#addr-86E8">86E8</a></td>
<td><span class="label">.c86e8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-87BA">copy_reply_to_params</a></span></td>
<td class="hex">20 BA 87</td>
</tr>

<tr id="addr-86EB">
<td class="addr"><a href="#addr-86EB">86EB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-87AD">copy_load_addr_from_params</a></span></td>
<td class="hex">20 AD 87</td>
</tr>

<tr id="addr-86EE">
<td class="addr"><a href="#addr-86EE">86EE</a></td>
<td><span class="label">.c86ee</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-86F0">
<td class="addr"><a href="#addr-86F0">86F0</a></td>
<td><span class="label">.loop_c86f0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a>,x</span></td>
<td class="hex">B5 B0</td>
</tr>

<tr id="addr-86F2">
<td class="addr"><a href="#addr-86F2">86F2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C8">l00c8</a>,x</span></td>
<td class="hex">95 C8</td>
</tr>

<tr id="addr-86F4">
<td class="addr"><a href="#addr-86F4">86F4</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-0F0D">l0f0d</a>,x</span></td>
<td class="hex">7D 0D 0F</td>
</tr>

<tr id="addr-86F7">
<td class="addr"><a href="#addr-86F7">86F7</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B4">l00b4</a>,x</span></td>
<td class="hex">95 B4</td>
</tr>

<tr id="addr-86F9">
<td class="addr"><a href="#addr-86F9">86F9</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-86FA">
<td class="addr"><a href="#addr-86FA">86FA</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-86FB">
<td class="addr"><a href="#addr-86FB">86FB</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-86F0">loop_c86f0</a></span></td>
<td class="hex">D0 F3</td>
</tr>

<tr id="addr-86FD">
<td class="addr"><a href="#addr-86FD">86FD</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-86FE">
<td class="addr"><a href="#addr-86FE">86FE</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand"><a href="#addr-0F10">l0f10</a></span></td>
<td class="hex">ED 10 0F</td>
</tr>

<tr id="addr-8701">
<td class="addr"><a href="#addr-8701">8701</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B7">l00b7</a></span></td>
<td class="hex">85 B7</td>
</tr>

<tr id="addr-8703">
<td class="addr"><a href="#addr-8703">8703</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8600">print_file_info</a></span></td>
<td class="hex">20 00 86</td>
</tr>

<tr id="addr-8706">
<td class="addr"><a href="#addr-8706">8706</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8716">send_data_blocks</a></span></td>
<td class="hex">20 16 87</td>
</tr>

<tr id="addr-8709">
<td class="addr"><a href="#addr-8709">8709</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-870B">
<td class="addr"><a href="#addr-870B">870B</a></td>
<td><span class="label">.loop_c870b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F10">l0f10</a>,x</span></td>
<td class="hex">BD 10 0F</td>
</tr>

<tr id="addr-870E">
<td class="addr"><a href="#addr-870E">870E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">9D 05 0F</td>
</tr>

<tr id="addr-8711">
<td class="addr"><a href="#addr-8711">8711</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8712">
<td class="addr"><a href="#addr-8712">8712</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-870B">loop_c870b</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-8714">
<td class="addr"><a href="#addr-8714">8714</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-878C">c878c</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">30 76</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Send file data in multi-block chunks</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Repeatedly sends $80-byte (128-byte) blocks of file data to the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fileserver using command $7F. Compares current address ($C8-$CB)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; against end address ($B4-$B7) via compare_addresses, and loops</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; until the entire file has been transferred. Each block is sent</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; via send_to_fs_star.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8716">
<td class="addr"><a href="#addr-8716">8716</a></td>
<td><span class="label">.send_data_blocks</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85CE">compare_addresses</a></span>  <span class="comment">; Compare two 4-byte addresses</span></td>
<td class="hex">20 CE 85</td>
</tr>

<tr id="addr-8719">
<td class="addr"><a href="#addr-8719">8719</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8740">return_5</a></span></td>
<td class="hex">F0 25</td>
</tr>

<tr id="addr-871B">
<td class="addr"><a href="#addr-871B">871B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;92</span></td>
<td class="hex">A9 92</td>
</tr>

<tr id="addr-871D">
<td class="addr"><a href="#addr-871D">871D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C1">l00c1</a></span></td>
<td class="hex">85 C1</td>
</tr>

<tr id="addr-871F">
<td class="addr"><a href="#addr-871F">871F</a></td>
<td><span class="label">.loop_c871f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-8721">
<td class="addr"><a href="#addr-8721">8721</a></td>
<td><span class="label">.loop_c8721</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00C8">l00c8</a>,x</span></td>
<td class="hex">B5 C8</td>
</tr>

<tr id="addr-8723">
<td class="addr"><a href="#addr-8723">8723</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C4">l00c4</a>,x</span></td>
<td class="hex">95 C4</td>
</tr>

<tr id="addr-8725">
<td class="addr"><a href="#addr-8725">8725</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B4">l00b4</a>,x</span></td>
<td class="hex">B5 B4</td>
</tr>

<tr id="addr-8727">
<td class="addr"><a href="#addr-8727">8727</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C8">l00c8</a>,x</span></td>
<td class="hex">95 C8</td>
</tr>

<tr id="addr-8729">
<td class="addr"><a href="#addr-8729">8729</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-872A">
<td class="addr"><a href="#addr-872A">872A</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8721">loop_c8721</a></span></td>
<td class="hex">10 F5</td>
</tr>

<tr id="addr-872C">
<td class="addr"><a href="#addr-872C">872C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A9 7F</td>
</tr>

<tr id="addr-872E">
<td class="addr"><a href="#addr-872E">872E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C0">l00c0</a></span></td>
<td class="hex">85 C0</td>
</tr>

<tr id="addr-8730">
<td class="addr"><a href="#addr-8730">8730</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8448">send_to_fs_star</a></span></td>
<td class="hex">20 48 84</td>
</tr>

<tr id="addr-8733">
<td class="addr"><a href="#addr-8733">8733</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#3</span></td>
<td class="hex">A0 03</td>
</tr>

<tr id="addr-8735">
<td class="addr"><a href="#addr-8735">8735</a></td>
<td><span class="label">.loop_c8735</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00C8">l00c8</a>,y</span></td>
<td class="hex">B9 C8 00</td>
</tr>

<tr id="addr-8738">
<td class="addr"><a href="#addr-8738">8738</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand"><a href="#addr-00B4">l00b4</a>,y</span></td>
<td class="hex">59 B4 00</td>
</tr>

<tr id="addr-873B">
<td class="addr"><a href="#addr-873B">873B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-871F">loop_c871f</a></span></td>
<td class="hex">D0 E2</td>
</tr>

<tr id="addr-873D">
<td class="addr"><a href="#addr-873D">873D</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-873E">
<td class="addr"><a href="#addr-873E">873E</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8735">loop_c8735</a></span></td>
<td class="hex">10 F5</td>
</tr>

<tr id="addr-8740">
<td class="addr"><a href="#addr-8740">8740</a></td>
<td><span class="label">.return_5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8741">
<td class="addr"><a href="#addr-8741">8741</a></td>
<td><span class="label">.c8741</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8746">filev_save</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-8743">
<td class="addr"><a href="#addr-8743">8743</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8844">filev_attrib_dispatch</a></span></td>
<td class="hex">4C 44 88</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSFILE save handler (A=$00)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies 4-byte load/exec/length addresses from the parameter block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to the FS command buffer, along with the filename. Sends FS</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; command $91 with function $14 to initiate the save, then</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; calls print_file_info to display the filename being saved.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handles both host and Tube-based data sources.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; When receiving the save acknowledgement, the RX low pointer is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; incremented by 1 to skip the command code (CC) byte, which</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; indicates the FS type and must be preserved. N.B. this assumes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the RX buffer does not cross a page boundary.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8746">
<td class="addr"><a href="#addr-8746">8746</a></td>
<td><span class="label">.filev_save</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#4</span></td>
<td class="hex">A2 04</td>
</tr>

<tr id="addr-8748">
<td class="addr"><a href="#addr-8748">8748</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A0 0E</td>
</tr>

<tr id="addr-874A">
<td class="addr"><a href="#addr-874A">874A</a></td>
<td><span class="label">.loop_c874a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-874C">
<td class="addr"><a href="#addr-874C">874C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a>,y</span></td>
<td class="hex">99 A6 00</td>
</tr>

<tr id="addr-874F">
<td class="addr"><a href="#addr-874F">874F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-84AA">sub_4_from_y</a></span></td>
<td class="hex">20 AA 84</td>
</tr>

<tr id="addr-8752">
<td class="addr"><a href="#addr-8752">8752</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">F1 BB</td>
</tr>

<tr id="addr-8754">
<td class="addr"><a href="#addr-8754">8754</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F03">fs_cmd_csd</a>,y</span></td>
<td class="hex">99 03 0F</td>
</tr>

<tr id="addr-8757">
<td class="addr"><a href="#addr-8757">8757</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8758">
<td class="addr"><a href="#addr-8758">8758</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-875A">
<td class="addr"><a href="#addr-875A">875A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a>,y</span></td>
<td class="hex">99 A6 00</td>
</tr>

<tr id="addr-875D">
<td class="addr"><a href="#addr-875D">875D</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-875E">
<td class="addr"><a href="#addr-875E">875E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-8760">
<td class="addr"><a href="#addr-8760">8760</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-84A4">add_5_to_y</a></span></td>
<td class="hex">20 A4 84</td>
</tr>

<tr id="addr-8763">
<td class="addr"><a href="#addr-8763">8763</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8764">
<td class="addr"><a href="#addr-8764">8764</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-874A">loop_c874a</a></span></td>
<td class="hex">D0 E4</td>
</tr>

<tr id="addr-8766">
<td class="addr"><a href="#addr-8766">8766</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#9</span></td>
<td class="hex">A0 09</td>
</tr>

<tr id="addr-8768">
<td class="addr"><a href="#addr-8768">8768</a></td>
<td><span class="label">.loop_c8768</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-876A">
<td class="addr"><a href="#addr-876A">876A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F03">fs_cmd_csd</a>,y</span></td>
<td class="hex">99 03 0F</td>
</tr>

<tr id="addr-876D">
<td class="addr"><a href="#addr-876D">876D</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-876E">
<td class="addr"><a href="#addr-876E">876E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8768">loop_c8768</a></span></td>
<td class="hex">D0 F8</td>
</tr>

<tr id="addr-8770">
<td class="addr"><a href="#addr-8770">8770</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;91</span></td>
<td class="hex">A9 91</td>
</tr>

<tr id="addr-8772">
<td class="addr"><a href="#addr-8772">8772</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F02">fs_cmd_urd</a></span></td>
<td class="hex">8D 02 0F</td>
</tr>

<tr id="addr-8775">
<td class="addr"><a href="#addr-8775">8775</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">85 B8</td>
</tr>

<tr id="addr-8777">
<td class="addr"><a href="#addr-8777">8777</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0b</span></td>
<td class="hex">A2 0B</td>
</tr>

<tr id="addr-8779">
<td class="addr"><a href="#addr-8779">8779</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D65">copy_string_to_cmd</a></span></td>
<td class="hex">20 65 8D</td>
</tr>

<tr id="addr-877C">
<td class="addr"><a href="#addr-877C">877C</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-877E">
<td class="addr"><a href="#addr-877E">877E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;14</span></td>
<td class="hex">A9 14</td>
</tr>

<tr id="addr-8780">
<td class="addr"><a href="#addr-8780">8780</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8346">prepare_cmd_clv</a></span></td>
<td class="hex">20 46 83</td>
</tr>

<tr id="addr-8783">
<td class="addr"><a href="#addr-8783">8783</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8600">print_file_info</a></span></td>
<td class="hex">20 00 86</td>
</tr>

<tr id="addr-8786">
<td class="addr"><a href="#addr-8786">8786</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-8789">
<td class="addr"><a href="#addr-8789">8789</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-87C8">transfer_file_blocks</a></span></td>
<td class="hex">20 C8 87</td>
</tr>

<tr id="addr-878C">
<td class="addr"><a href="#addr-878C">878C</a></td>
<td><span class="label">.c878c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">A9 2A</td>
</tr>

<tr id="addr-878E">
<td class="addr"><a href="#addr-878E">878E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">85 B8</td>
</tr>

<tr id="addr-8790">
<td class="addr"><a href="#addr-8790">8790</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8380">send_fs_reply_cmd</a></span></td>
<td class="hex">20 80 83</td>
</tr>

<tr id="addr-8793">
<td class="addr"><a href="#addr-8793">8793</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F08">l0f08</a></span></td>
<td class="hex">8E 08 0F</td>
</tr>

<tr id="addr-8796">
<td class="addr"><a href="#addr-8796">8796</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A0 0E</td>
</tr>

<tr id="addr-8798">
<td class="addr"><a href="#addr-8798">8798</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-879B">
<td class="addr"><a href="#addr-879B">879B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-851D">decode_attribs_5bit</a></span></td>
<td class="hex">20 1D 85</td>
</tr>

<tr id="addr-879E">
<td class="addr"><a href="#addr-879E">879E</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-87A3">c87a3</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-87A0">
<td class="addr"><a href="#addr-87A0">87A0</a></td>
<td><span class="label">.loop_c87a0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0EF7">l0ef7</a>,y</span></td>
<td class="hex">B9 F7 0E</td>
</tr>

<tr id="addr-87A3">
<td class="addr"><a href="#addr-87A3">87A3</a></td>
<td><span class="label">.c87a3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-87A5">
<td class="addr"><a href="#addr-87A5">87A5</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-87A6">
<td class="addr"><a href="#addr-87A6">87A6</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;12</span></td>
<td class="hex">C0 12</td>
</tr>

<tr id="addr-87A8">
<td class="addr"><a href="#addr-87A8">87A8</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-87A0">loop_c87a0</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-87AA">
<td class="addr"><a href="#addr-87AA">87AA</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">4C 2C 89</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy load address from parameter block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies 4 bytes from (fs_options)+2..5 (the load address in the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSFILE parameter block) to $AE-$B3 (local workspace).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-87AD">
<td class="addr"><a href="#addr-87AD">87AD</a></td>
<td><span class="label">.copy_load_addr_from_params</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#5</span></td>
<td class="hex">A0 05</td>
</tr>

<tr id="addr-87AF">
<td class="addr"><a href="#addr-87AF">87AF</a></td>
<td><span class="label">.loop_c87af</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-87B1">
<td class="addr"><a href="#addr-87B1">87B1</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00AE">l00ae</a>,y</span></td>
<td class="hex">99 AE 00</td>
</tr>

<tr id="addr-87B4">
<td class="addr"><a href="#addr-87B4">87B4</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-87B5">
<td class="addr"><a href="#addr-87B5">87B5</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#2</span></td>
<td class="hex">C0 02</td>
</tr>

<tr id="addr-87B7">
<td class="addr"><a href="#addr-87B7">87B7</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-87AF">loop_c87af</a></span></td>
<td class="hex">B0 F6</td>
</tr>

<tr id="addr-87B9">
<td class="addr"><a href="#addr-87B9">87B9</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy FS reply data to parameter block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies bytes from the FS command reply buffer ($0F02+) into the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; parameter block at (fs_options)+2..13. Used to fill in the OSFILE</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; parameter block with information returned by the fileserver.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-87BA">
<td class="addr"><a href="#addr-87BA">87BA</a></td>
<td><span class="label">.copy_reply_to_params</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">A0 0D</td>
</tr>

<tr id="addr-87BC">
<td class="addr"><a href="#addr-87BC">87BC</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-87BD">
<td class="addr"><a href="#addr-87BD">87BD</a></td>
<td><span class="label">.loop_c87bd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-87BF">
<td class="addr"><a href="#addr-87BF">87BF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F02">fs_cmd_urd</a>,y</span></td>
<td class="hex">B9 02 0F</td>
</tr>

<tr id="addr-87C2">
<td class="addr"><a href="#addr-87C2">87C2</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-87C3">
<td class="addr"><a href="#addr-87C3">87C3</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#2</span></td>
<td class="hex">C0 02</td>
</tr>

<tr id="addr-87C5">
<td class="addr"><a href="#addr-87C5">87C5</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-87BD">loop_c87bd</a></span></td>
<td class="hex">B0 F6</td>
</tr>

<tr id="addr-87C7">
<td class="addr"><a href="#addr-87C7">87C7</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Multi-block file data transfer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Manages the transfer of file data in chunks between the local</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; machine and the fileserver. Entry conditions: WORK ($B0-$B3) and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; WORK+4 ($B4-$B7) hold the low and high addresses of the data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; being sent/received. Sets up source ($C4-$C7) and destination</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ($C8-$CB) from the FS reply, sends $80-byte (128-byte) blocks</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; with command $91, and continues until all data has been</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; transferred. Handles address overflow and Tube co-processor</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; transfers. For SAVE, WORK+8 holds the port on which to receive</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; byte-level ACKs for each data block (flow control).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-87C8">
<td class="addr"><a href="#addr-87C8">87C8</a></td>
<td><span class="label">.transfer_file_blocks</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-87C9">
<td class="addr"><a href="#addr-87C9">87C9</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85CE">compare_addresses</a></span>  <span class="comment">; Compare two 4-byte addresses</span></td>
<td class="hex">20 CE 85</td>
</tr>

<tr id="addr-87CC">
<td class="addr"><a href="#addr-87CC">87CC</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8840">c8840</a></span></td>
<td class="hex">F0 72</td>
</tr>

<tr id="addr-87CE">
<td class="addr"><a href="#addr-87CE">87CE</a></td>
<td><span class="label">.c87ce</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-87D0">
<td class="addr"><a href="#addr-87D0">87D0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-87D2">
<td class="addr"><a href="#addr-87D2">87D2</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F08">l0f08</a></span></td>
<td class="hex">8E 08 0F</td>
</tr>

<tr id="addr-87D5">
<td class="addr"><a href="#addr-87D5">87D5</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F09">l0f09</a></span></td>
<td class="hex">8E 09 0F</td>
</tr>

<tr id="addr-87D8">
<td class="addr"><a href="#addr-87D8">87D8</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-87D9">
<td class="addr"><a href="#addr-87D9">87D9</a></td>
<td><span class="label">.loop_c87d9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a>,x</span></td>
<td class="hex">B5 B0</td>
</tr>

<tr id="addr-87DB">
<td class="addr"><a href="#addr-87DB">87DB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C4">l00c4</a>,x</span></td>
<td class="hex">95 C4</td>
</tr>

<tr id="addr-87DD">
<td class="addr"><a href="#addr-87DD">87DD</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-0F06">l0f06</a>,x</span></td>
<td class="hex">7D 06 0F</td>
</tr>

<tr id="addr-87E0">
<td class="addr"><a href="#addr-87E0">87E0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C8">l00c8</a>,x</span></td>
<td class="hex">95 C8</td>
</tr>

<tr id="addr-87E2">
<td class="addr"><a href="#addr-87E2">87E2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a>,x</span></td>
<td class="hex">95 B0</td>
</tr>

<tr id="addr-87E4">
<td class="addr"><a href="#addr-87E4">87E4</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-87E5">
<td class="addr"><a href="#addr-87E5">87E5</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-87E6">
<td class="addr"><a href="#addr-87E6">87E6</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-87D9">loop_c87d9</a></span></td>
<td class="hex">D0 F1</td>
</tr>

<tr id="addr-87E8">
<td class="addr"><a href="#addr-87E8">87E8</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-87F7">c87f7</a></span></td>
<td class="hex">B0 0D</td>
</tr>

<tr id="addr-87EA">
<td class="addr"><a href="#addr-87EA">87EA</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-87EB">
<td class="addr"><a href="#addr-87EB">87EB</a></td>
<td><span class="label">.loop_c87eb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a>,y</span></td>
<td class="hex">B9 B0 00</td>
</tr>

<tr id="addr-87EE">
<td class="addr"><a href="#addr-87EE">87EE</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand"><a href="#addr-00B4">l00b4</a>,y</span></td>
<td class="hex">F9 B4 00</td>
</tr>

<tr id="addr-87F1">
<td class="addr"><a href="#addr-87F1">87F1</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-87F2">
<td class="addr"><a href="#addr-87F2">87F2</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-87F3">
<td class="addr"><a href="#addr-87F3">87F3</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-87EB">loop_c87eb</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-87F5">
<td class="addr"><a href="#addr-87F5">87F5</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8800">c8800</a></span></td>
<td class="hex">90 09</td>
</tr>

<tr id="addr-87F7">
<td class="addr"><a href="#addr-87F7">87F7</a></td>
<td><span class="label">.c87f7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-87F9">
<td class="addr"><a href="#addr-87F9">87F9</a></td>
<td><span class="label">.loop_c87f9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B4">l00b4</a>,x</span></td>
<td class="hex">B5 B4</td>
</tr>

<tr id="addr-87FB">
<td class="addr"><a href="#addr-87FB">87FB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C8">l00c8</a>,x</span></td>
<td class="hex">95 C8</td>
</tr>

<tr id="addr-87FD">
<td class="addr"><a href="#addr-87FD">87FD</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-87FE">
<td class="addr"><a href="#addr-87FE">87FE</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-87F9">loop_c87f9</a></span></td>
<td class="hex">10 F9</td>
</tr>

<tr id="addr-8800">
<td class="addr"><a href="#addr-8800">8800</a></td>
<td><span class="label">.c8800</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8801">
<td class="addr"><a href="#addr-8801">8801</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8802">
<td class="addr"><a href="#addr-8802">8802</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-8803">
<td class="addr"><a href="#addr-8803">8803</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C1">l00c1</a></span></td>
<td class="hex">85 C1</td>
</tr>

<tr id="addr-8805">
<td class="addr"><a href="#addr-8805">8805</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-8807">
<td class="addr"><a href="#addr-8807">8807</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C0">l00c0</a></span></td>
<td class="hex">85 C0</td>
</tr>

<tr id="addr-8809">
<td class="addr"><a href="#addr-8809">8809</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8644">setup_tx_ptr_c0</a></span></td>
<td class="hex">20 44 86</td>
</tr>

<tr id="addr-880C">
<td class="addr"><a href="#addr-880C">880C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">A5 B8</td>
</tr>

<tr id="addr-880E">
<td class="addr"><a href="#addr-880E">880E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8310">init_tx_ctrl_port</a></span></td>
<td class="hex">20 10 83</td>
</tr>

<tr id="addr-8811">
<td class="addr"><a href="#addr-8811">8811</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-8812">
<td class="addr"><a href="#addr-8812">8812</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8840">c8840</a></span></td>
<td class="hex">B0 2C</td>
</tr>

<tr id="addr-8814">
<td class="addr"><a href="#addr-8814">8814</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;91</span></td>
<td class="hex">A9 91</td>
</tr>

<tr id="addr-8816">
<td class="addr"><a href="#addr-8816">8816</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C1">l00c1</a></span></td>
<td class="hex">85 C1</td>
</tr>

<tr id="addr-8818">
<td class="addr"><a href="#addr-8818">8818</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">A9 2A</td>
</tr>

<tr id="addr-881A">
<td class="addr"><a href="#addr-881A">881A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-844A">send_to_fs</a></span></td>
<td class="hex">20 4A 84</td>
</tr>

<tr id="addr-881D">
<td class="addr"><a href="#addr-881D">881D</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-87CE">c87ce</a></span></td>
<td class="hex">D0 AF</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FSCV 1: EOF handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks whether a file handle has reached end-of-file. Converts</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the handle via handle_to_mask_clc, tests the result against the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; EOF hint byte ($0E07). If the hint bit is clear, returns X=0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; immediately (definitely not at EOF — no network call needed).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If the hint bit is set, sends FS command $11 (FCEOF) to query</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the fileserver for definitive EOF status. Returns X=$FF if at</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; EOF, X=$00 if not. This two-level check avoids an expensive</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; network round-trip when the file is known to not be at EOF.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-881F">
<td class="addr"><a href="#addr-881F">881F</a></td>
<td><span class="label">.eof_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8820">
<td class="addr"><a href="#addr-8820">8820</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00BC">fs_block_offset</a></span></td>
<td class="hex">84 BC</td>
</tr>

<tr id="addr-8822">
<td class="addr"><a href="#addr-8822">8822</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8589">handle_to_mask_clc</a></span></td>
<td class="hex">20 89 85</td>
</tr>

<tr id="addr-8825">
<td class="addr"><a href="#addr-8825">8825</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8826">
<td class="addr"><a href="#addr-8826">8826</a></td>
<td>    <span class="opcode">AND</span> <span class="operand"><a href="#addr-0E07">fs_eof_flags</a></span></td>
<td class="hex">2D 07 0E</td>
</tr>

<tr id="addr-8829">
<td class="addr"><a href="#addr-8829">8829</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-882A">
<td class="addr"><a href="#addr-882A">882A</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8840">c8840</a></span></td>
<td class="hex">F0 14</td>
</tr>

<tr id="addr-882C">
<td class="addr"><a href="#addr-882C">882C</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-882D">
<td class="addr"><a href="#addr-882D">882D</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8C 05 0F</td>
</tr>

<tr id="addr-8830">
<td class="addr"><a href="#addr-8830">8830</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;11</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 11</td>
</tr>

<tr id="addr-8832">
<td class="addr"><a href="#addr-8832">8832</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span>  <span class="comment">; X=preserved through header build</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-8834">
<td class="addr"><a href="#addr-8834">8834</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8837">
<td class="addr"><a href="#addr-8837">8837</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8838">
<td class="addr"><a href="#addr-8838">8838</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AE 05 0F</td>
</tr>

<tr id="addr-883B">
<td class="addr"><a href="#addr-883B">883B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8840">c8840</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-883D">
<td class="addr"><a href="#addr-883D">883D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85DF">clear_fs_flag</a></span></td>
<td class="hex">20 DF 85</td>
</tr>

<tr id="addr-8840">
<td class="addr"><a href="#addr-8840">8840</a></td>
<td><span class="label">.c8840</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8841">
<td class="addr"><a href="#addr-8841">8841</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00BC">fs_block_offset</a></span></td>
<td class="hex">A4 BC</td>
</tr>

<tr id="addr-8843">
<td class="addr"><a href="#addr-8843">8843</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FILEV attribute dispatch (A=1-6)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatches OSFILE operations by function code:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=1: write catalogue info (load/exec/length/attrs) — FS $14</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=2: write load address only</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=3: write exec address only</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=4: write file attributes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=5: read catalogue info, returns type in A — FS $12</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=6: delete named object — FS $14 (FCDEL)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A&gt;=7: falls through to restore_args_return (no-op)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Each handler builds the appropriate FS command, sends it to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the fileserver, and copies the reply into the parameter block.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The control block layout uses dual-purpose fields: the &#39;data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; start&#39; field doubles as &#39;length&#39; and &#39;data end&#39; doubles as</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; &#39;protection&#39; depending on whether reading or writing attrs.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8844">
<td class="addr"><a href="#addr-8844">8844</a></td>
<td><span class="label">.filev_attrib_dispatch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8D 05 0F</td>
</tr>

<tr id="addr-8847">
<td class="addr"><a href="#addr-8847">8847</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#6</span></td>
<td class="hex">C9 06</td>
</tr>

<tr id="addr-8849">
<td class="addr"><a href="#addr-8849">8849</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-888A">c888a</a></span></td>
<td class="hex">F0 3F</td>
</tr>

<tr id="addr-884B">
<td class="addr"><a href="#addr-884B">884B</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8895">c8895</a></span></td>
<td class="hex">B0 48</td>
</tr>

<tr id="addr-884D">
<td class="addr"><a href="#addr-884D">884D</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#5</span></td>
<td class="hex">C9 05</td>
</tr>

<tr id="addr-884F">
<td class="addr"><a href="#addr-884F">884F</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-88A3">c88a3</a></span></td>
<td class="hex">F0 52</td>
</tr>

<tr id="addr-8851">
<td class="addr"><a href="#addr-8851">8851</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#4</span></td>
<td class="hex">C9 04</td>
</tr>

<tr id="addr-8853">
<td class="addr"><a href="#addr-8853">8853</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8899">c8899</a></span></td>
<td class="hex">F0 44</td>
</tr>

<tr id="addr-8855">
<td class="addr"><a href="#addr-8855">8855</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#1</span></td>
<td class="hex">C9 01</td>
</tr>

<tr id="addr-8857">
<td class="addr"><a href="#addr-8857">8857</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-886E">get_file_protection</a></span></td>
<td class="hex">F0 15</td>
</tr>

<tr id="addr-8859">
<td class="addr"><a href="#addr-8859">8859</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-885A">
<td class="addr"><a href="#addr-885A">885A</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-885B">
<td class="addr"><a href="#addr-885B">885B</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-885C">
<td class="addr"><a href="#addr-885C">885C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-84AB">sub_3_from_y</a></span></td>
<td class="hex">20 AB 84</td>
</tr>

<tr id="addr-885F">
<td class="addr"><a href="#addr-885F">885F</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-8861">
<td class="addr"><a href="#addr-8861">8861</a></td>
<td><span class="label">.loop_c8861</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8863">
<td class="addr"><a href="#addr-8863">8863</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a>,x</span></td>
<td class="hex">9D 06 0F</td>
</tr>

<tr id="addr-8866">
<td class="addr"><a href="#addr-8866">8866</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8867">
<td class="addr"><a href="#addr-8867">8867</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8868">
<td class="addr"><a href="#addr-8868">8868</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8861">loop_c8861</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-886A">
<td class="addr"><a href="#addr-886A">886A</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#5</span></td>
<td class="hex">A2 05</td>
</tr>

<tr id="addr-886C">
<td class="addr"><a href="#addr-886C">886C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8883">copy_filename_to_cmd</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 15</td>
</tr>

<tr id="addr-886E">
<td class="addr"><a href="#addr-886E">886E</a></td>
<td><span class="label">.get_file_protection</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8513">decode_attribs_6bit</a></span></td>
<td class="hex">20 13 85</td>
</tr>

<tr id="addr-8871">
<td class="addr"><a href="#addr-8871">8871</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F0E">l0f0e</a></span></td>
<td class="hex">8D 0E 0F</td>
</tr>

<tr id="addr-8874">
<td class="addr"><a href="#addr-8874">8874</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#9</span></td>
<td class="hex">A0 09</td>
</tr>

<tr id="addr-8876">
<td class="addr"><a href="#addr-8876">8876</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#8</span></td>
<td class="hex">A2 08</td>
</tr>

<tr id="addr-8878">
<td class="addr"><a href="#addr-8878">8878</a></td>
<td><span class="label">.loop_c8878</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-887A">
<td class="addr"><a href="#addr-887A">887A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">9D 05 0F</td>
</tr>

<tr id="addr-887D">
<td class="addr"><a href="#addr-887D">887D</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-887E">
<td class="addr"><a href="#addr-887E">887E</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-887F">
<td class="addr"><a href="#addr-887F">887F</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8878">loop_c8878</a></span></td>
<td class="hex">D0 F7</td>
</tr>

<tr id="addr-8881">
<td class="addr"><a href="#addr-8881">8881</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0a</span></td>
<td class="hex">A2 0A</td>
</tr>

<tr id="addr-8883">
<td class="addr"><a href="#addr-8883">8883</a></td>
<td><span class="label">.copy_filename_to_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D65">copy_string_to_cmd</a></span></td>
<td class="hex">20 65 8D</td>
</tr>

<tr id="addr-8886">
<td class="addr"><a href="#addr-8886">8886</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;13</span></td>
<td class="hex">A0 13</td>
</tr>

<tr id="addr-8888">
<td class="addr"><a href="#addr-8888">8888</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-888F">c888f</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 05</td>
</tr>

<tr id="addr-888A">
<td class="addr"><a href="#addr-888A">888A</a></td>
<td><span class="label">.c888a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D63">copy_filename</a></span></td>
<td class="hex">20 63 8D</td>
</tr>

<tr id="addr-888D">
<td class="addr"><a href="#addr-888D">888D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;14</span></td>
<td class="hex">A0 14</td>
</tr>

<tr id="addr-888F">
<td class="addr"><a href="#addr-888F">888F</a></td>
<td><span class="label">.c888f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-833A">l833a</a></span></td>
<td class="hex">2C 3A 83</td>
</tr>

<tr id="addr-8892">
<td class="addr"><a href="#addr-8892">8892</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8351">prepare_fs_cmd_v</a></span></td>
<td class="hex">20 51 83</td>
</tr>

<tr id="addr-8895">
<td class="addr"><a href="#addr-8895">8895</a></td>
<td><span class="label">.c8895</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-88DF">c88df</a></span></td>
<td class="hex">B0 48</td>
</tr>

<tr id="addr-8897">
<td class="addr"><a href="#addr-8897">8897</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8910">c8910</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">90 77</td>
</tr>

<tr id="addr-8899">
<td class="addr"><a href="#addr-8899">8899</a></td>
<td><span class="label">.c8899</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8513">decode_attribs_6bit</a></span></td>
<td class="hex">20 13 85</td>
</tr>

<tr id="addr-889C">
<td class="addr"><a href="#addr-889C">889C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-889F">
<td class="addr"><a href="#addr-889F">889F</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-88A1">
<td class="addr"><a href="#addr-88A1">88A1</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8883">copy_filename_to_cmd</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 E0</td>
</tr>

<tr id="addr-88A3">
<td class="addr"><a href="#addr-88A3">88A3</a></td>
<td><span class="label">.c88a3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-88A5">
<td class="addr"><a href="#addr-88A5">88A5</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D65">copy_string_to_cmd</a></span></td>
<td class="hex">20 65 8D</td>
</tr>

<tr id="addr-88A8">
<td class="addr"><a href="#addr-88A8">88A8</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;12</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 12</td>
</tr>

<tr id="addr-88AA">
<td class="addr"><a href="#addr-88AA">88AA</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-88AD">
<td class="addr"><a href="#addr-88AD">88AD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F11">l0f11</a></span></td>
<td class="hex">AD 11 0F</td>
</tr>

<tr id="addr-88B0">
<td class="addr"><a href="#addr-88B0">88B0</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F11">l0f11</a></span>  <span class="comment">; X=0 on success, $D6 on not-found</span></td>
<td class="hex">8E 11 0F</td>
</tr>

<tr id="addr-88B3">
<td class="addr"><a href="#addr-88B3">88B3</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F14">l0f14</a></span></td>
<td class="hex">8E 14 0F</td>
</tr>

<tr id="addr-88B6">
<td class="addr"><a href="#addr-88B6">88B6</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-851D">decode_attribs_5bit</a></span></td>
<td class="hex">20 1D 85</td>
</tr>

<tr id="addr-88B9">
<td class="addr"><a href="#addr-88B9">88B9</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AE 05 0F</td>
</tr>

<tr id="addr-88BC">
<td class="addr"><a href="#addr-88BC">88BC</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-88DE">c88de</a></span></td>
<td class="hex">F0 20</td>
</tr>

<tr id="addr-88BE">
<td class="addr"><a href="#addr-88BE">88BE</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A0 0E</td>
</tr>

<tr id="addr-88C0">
<td class="addr"><a href="#addr-88C0">88C0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-88C2">
<td class="addr"><a href="#addr-88C2">88C2</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;0d</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-88C3">
<td class="addr"><a href="#addr-88C3">88C3</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">A2 0C</td>
</tr>

<tr id="addr-88C5">
<td class="addr"><a href="#addr-88C5">88C5</a></td>
<td><span class="label">.copy_fs_reply_to_cb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">BD 05 0F</td>
</tr>

<tr id="addr-88C8">
<td class="addr"><a href="#addr-88C8">88C8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-88CA">
<td class="addr"><a href="#addr-88CA">88CA</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-88CB">
<td class="addr"><a href="#addr-88CB">88CB</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-88CC">
<td class="addr"><a href="#addr-88CC">88CC</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-88C5">copy_fs_reply_to_cb</a></span></td>
<td class="hex">D0 F7</td>
</tr>

<tr id="addr-88CE">
<td class="addr"><a href="#addr-88CE">88CE</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-88CF">
<td class="addr"><a href="#addr-88CF">88CF</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-88D0">
<td class="addr"><a href="#addr-88D0">88D0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;11</span></td>
<td class="hex">A0 11</td>
</tr>

<tr id="addr-88D2">
<td class="addr"><a href="#addr-88D2">88D2</a></td>
<td><span class="label">.loop_c88d2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F12">l0f12</a>,x</span></td>
<td class="hex">BD 12 0F</td>
</tr>

<tr id="addr-88D5">
<td class="addr"><a href="#addr-88D5">88D5</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-88D7">
<td class="addr"><a href="#addr-88D7">88D7</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-88D8">
<td class="addr"><a href="#addr-88D8">88D8</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-88D9">
<td class="addr"><a href="#addr-88D9">88D9</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-88D2">loop_c88d2</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-88DB">
<td class="addr"><a href="#addr-88DB">88DB</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AE 05 0F</td>
</tr>

<tr id="addr-88DE">
<td class="addr"><a href="#addr-88DE">88DE</a></td>
<td><span class="label">.c88de</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-88DF">
<td class="addr"><a href="#addr-88DF">88DF</a></td>
<td><span class="label">.c88df</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-892E">c892e</a></span></td>
<td class="hex">10 4D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ARGSV handler (OSARGS entry point)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=0, Y=0: return filing system number (10 = network FS)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=0, Y&gt;0: read file pointer via FS command $0A (FCRDSE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=1, Y&gt;0: write file pointer via FS command $14 (FCWRSE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A&gt;=3 (ensure): silently returns -- NFS has no local write buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;      to flush, since all data is sent to the fileserver immediately</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The handle in Y is converted via handle_to_mask_clc. For writes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (A=1), the carry flag from the mask conversion is used to branch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to save_args_handle, which records the handle for later use.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: function code (0=query, 1=write ptr, &gt;=3=ensure)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: file handle (0=FS-level query, &gt;0=per-file)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: filing system number if A=0/Y=0 query, else restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-88E1">
<td class="addr"><a href="#addr-88E1">88E1</a></td>
<td><span class="label">.argsv_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8508">save_fscv_args</a></span></td>
<td class="hex">20 08 85</td>
</tr>

<tr id="addr-88E4">
<td class="addr"><a href="#addr-88E4">88E4</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#3</span></td>
<td class="hex">C9 03</td>
</tr>

<tr id="addr-88E6">
<td class="addr"><a href="#addr-88E6">88E6</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">B0 44</td>
</tr>

<tr id="addr-88E8">
<td class="addr"><a href="#addr-88E8">88E8</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#0</span></td>
<td class="hex">C0 00</td>
</tr>

<tr id="addr-88EA">
<td class="addr"><a href="#addr-88EA">88EA</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8933">c8933</a></span></td>
<td class="hex">F0 47</td>
</tr>

<tr id="addr-88EC">
<td class="addr"><a href="#addr-88EC">88EC</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8589">handle_to_mask_clc</a></span></td>
<td class="hex">20 89 85</td>
</tr>

<tr id="addr-88EF">
<td class="addr"><a href="#addr-88EF">88EF</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8C 05 0F</td>
</tr>

<tr id="addr-88F2">
<td class="addr"><a href="#addr-88F2">88F2</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-88F3">
<td class="addr"><a href="#addr-88F3">88F3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-88F6">
<td class="addr"><a href="#addr-88F6">88F6</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8912">save_args_handle</a></span></td>
<td class="hex">B0 1A</td>
</tr>

<tr id="addr-88F8">
<td class="addr"><a href="#addr-88F8">88F8</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0c</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 0C</td>
</tr>

<tr id="addr-88FA">
<td class="addr"><a href="#addr-88FA">88FA</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span>  <span class="comment">; X=preserved through header build</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-88FC">
<td class="addr"><a href="#addr-88FC">88FC</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-88FF">
<td class="addr"><a href="#addr-88FF">88FF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a></span>  <span class="comment">; A=0 on success (from build_send_fs_cmd)</span></td>
<td class="hex">85 BD</td>
</tr>

<tr id="addr-8901">
<td class="addr"><a href="#addr-8901">8901</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00BB">fs_options</a></span></td>
<td class="hex">A6 BB</td>
</tr>

<tr id="addr-8903">
<td class="addr"><a href="#addr-8903">8903</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr id="addr-8905">
<td class="addr"><a href="#addr-8905">8905</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0003">l0003</a>,x</span></td>
<td class="hex">95 03</td>
</tr>

<tr id="addr-8907">
<td class="addr"><a href="#addr-8907">8907</a></td>
<td><span class="label">.loop_c8907</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,y</span></td>
<td class="hex">B9 05 0F</td>
</tr>

<tr id="addr-890A">
<td class="addr"><a href="#addr-890A">890A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0002">l0002</a>,x</span></td>
<td class="hex">95 02</td>
</tr>

<tr id="addr-890C">
<td class="addr"><a href="#addr-890C">890C</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-890D">
<td class="addr"><a href="#addr-890D">890D</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-890E">
<td class="addr"><a href="#addr-890E">890E</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8907">loop_c8907</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-8910">
<td class="addr"><a href="#addr-8910">8910</a></td>
<td><span class="label">.c8910</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">90 1A</td>
</tr>

<tr id="addr-8912">
<td class="addr"><a href="#addr-8912">8912</a></td>
<td><span class="label">.save_args_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8913">
<td class="addr"><a href="#addr-8913">8913</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8914">
<td class="addr"><a href="#addr-8914">8914</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#3</span></td>
<td class="hex">A0 03</td>
</tr>

<tr id="addr-8916">
<td class="addr"><a href="#addr-8916">8916</a></td>
<td><span class="label">.loop_c8916</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0003">l0003</a>,x</span></td>
<td class="hex">B5 03</td>
</tr>

<tr id="addr-8918">
<td class="addr"><a href="#addr-8918">8918</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F07">l0f07</a>,y</span></td>
<td class="hex">99 07 0F</td>
</tr>

<tr id="addr-891B">
<td class="addr"><a href="#addr-891B">891B</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-891C">
<td class="addr"><a href="#addr-891C">891C</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-891D">
<td class="addr"><a href="#addr-891D">891D</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8916">loop_c8916</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-891F">
<td class="addr"><a href="#addr-891F">891F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0d</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 0D</td>
</tr>

<tr id="addr-8921">
<td class="addr"><a href="#addr-8921">8921</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#5</span>  <span class="comment">; X=preserved through header build</span></td>
<td class="hex">A2 05</td>
</tr>

<tr id="addr-8923">
<td class="addr"><a href="#addr-8923">8923</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8926">
<td class="addr"><a href="#addr-8926">8926</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a></span>  <span class="comment">; X=0 on success, $D6 on not-found</span></td>
<td class="hex">86 BD</td>
</tr>

<tr id="addr-8928">
<td class="addr"><a href="#addr-8928">8928</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8929">
<td class="addr"><a href="#addr-8929">8929</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85E4">set_fs_flag</a></span></td>
<td class="hex">20 E4 85</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Restore arguments and return</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Common exit point for FS vector handlers. Reloads A from</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fs_last_byte_flag ($BD), X from fs_options ($BB), and Y from</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fs_block_offset ($BC) — the values saved at entry by</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; save_fscv_args — and returns to the caller.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-892C">
<td class="addr"><a href="#addr-892C">892C</a></td>
<td><span class="label">.restore_args_return</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a></span></td>
<td class="hex">A5 BD</td>
</tr>

<tr id="addr-892E">
<td class="addr"><a href="#addr-892E">892E</a></td>
<td><span class="label">.c892e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00BB">fs_options</a></span></td>
<td class="hex">A6 BB</td>
</tr>

<tr id="addr-8930">
<td class="addr"><a href="#addr-8930">8930</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00BC">fs_block_offset</a></span></td>
<td class="hex">A4 BC</td>
</tr>

<tr id="addr-8932">
<td class="addr"><a href="#addr-8932">8932</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8933">
<td class="addr"><a href="#addr-8933">8933</a></td>
<td><span class="label">.c8933</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8934">
<td class="addr"><a href="#addr-8934">8934</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-893A">c893a</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-8936">
<td class="addr"><a href="#addr-8936">8936</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#5</span></td>
<td class="hex">A9 05</td>
</tr>

<tr id="addr-8938">
<td class="addr"><a href="#addr-8938">8938</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-892E">c892e</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 F4</td>
</tr>

<tr id="addr-893A">
<td class="addr"><a href="#addr-893A">893A</a></td>
<td><span class="label">.c893a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-893B">
<td class="addr"><a href="#addr-893B">893B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">D0 EF</td>
</tr>

<tr id="addr-893D">
<td class="addr"><a href="#addr-893D">893D</a></td>
<td><span class="label">.loop_c893d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E0B">l0e0b</a>,y</span></td>
<td class="hex">B9 0B 0E</td>
</tr>

<tr id="addr-8940">
<td class="addr"><a href="#addr-8940">8940</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-8942">
<td class="addr"><a href="#addr-8942">8942</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8943">
<td class="addr"><a href="#addr-8943">8943</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-893D">loop_c893d</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-8945">
<td class="addr"><a href="#addr-8945">8945</a></td>
<td><span class="label">.c8945</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span>  <span class="comment">; A=operation (0=close, $40=read, $80=write, $C0=R/W)</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-8947">
<td class="addr"><a href="#addr-8947">8947</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-892E">c892e</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">10 E5</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FINDV handler (OSFIND entry point)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=0: close file -- delegates to close_handle ($8985)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A&gt;0: open file -- modes $40=read, $80=write/update, $C0=read/write</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; For open: the mode byte is converted to the fileserver&#39;s two-flag</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; format by flipping bit 7 (EOR #$80) and shifting. This produces</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Flag 1 (read/write direction) and Flag 2 (create/existing),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; matching the fileserver protocol. After a successful open, the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; new handle&#39;s bit is OR&#39;d into the EOF hint byte (marks it as</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; &#34;might be at EOF, query the server&#34;), and into the sequence</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; number tracking byte for the byte-stream protocol.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: operation (0=close, $40=read, $80=write, $C0=R/W)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: filename pointer low (open)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: file handle (close) or filename pointer high (open)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: handle on open, 0 on close-all, restored on close-one</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8949">
<td class="addr"><a href="#addr-8949">8949</a></td>
<td><span class="label">.findv_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8508">save_fscv_args</a></span></td>
<td class="hex">20 08 85</td>
</tr>

<tr id="addr-894C">
<td class="addr"><a href="#addr-894C">894C</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-894D">
<td class="addr"><a href="#addr-894D">894D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-858A">handle_to_mask</a></span>  <span class="comment">; Convert file handle to bitmask (Y2FS)</span></td>
<td class="hex">20 8A 85</td>
</tr>

<tr id="addr-8950">
<td class="addr"><a href="#addr-8950">8950</a></td>
<td>    <span class="opcode">TAX</span>  <span class="comment">; A=preserved</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8951">
<td class="addr"><a href="#addr-8951">8951</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8985">close_handle</a></span></td>
<td class="hex">F0 32</td>
</tr>

<tr id="addr-8953">
<td class="addr"><a href="#addr-8953">8953</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">29 3F</td>
</tr>

<tr id="addr-8955">
<td class="addr"><a href="#addr-8955">8955</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8945">c8945</a></span></td>
<td class="hex">D0 EE</td>
</tr>

<tr id="addr-8957">
<td class="addr"><a href="#addr-8957">8957</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8958">
<td class="addr"><a href="#addr-8958">8958</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;80</span></td>
<td class="hex">49 80</td>
</tr>

<tr id="addr-895A">
<td class="addr"><a href="#addr-895A">895A</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-895B">
<td class="addr"><a href="#addr-895B">895B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8D 05 0F</td>
</tr>

<tr id="addr-895E">
<td class="addr"><a href="#addr-895E">895E</a></td>
<td>    <span class="opcode">ROL</span></td>
<td class="hex">2A</td>
</tr>

<tr id="addr-895F">
<td class="addr"><a href="#addr-895F">895F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-8962">
<td class="addr"><a href="#addr-8962">8962</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-8964">
<td class="addr"><a href="#addr-8964">8964</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D65">copy_string_to_cmd</a></span></td>
<td class="hex">20 65 8D</td>
</tr>

<tr id="addr-8967">
<td class="addr"><a href="#addr-8967">8967</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#6</span></td>
<td class="hex">A0 06</td>
</tr>

<tr id="addr-8969">
<td class="addr"><a href="#addr-8969">8969</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-833A">l833a</a></span></td>
<td class="hex">2C 3A 83</td>
</tr>

<tr id="addr-896C">
<td class="addr"><a href="#addr-896C">896C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8351">prepare_fs_cmd_v</a></span></td>
<td class="hex">20 51 83</td>
</tr>

<tr id="addr-896F">
<td class="addr"><a href="#addr-896F">896F</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-892E">c892e</a></span></td>
<td class="hex">B0 BD</td>
</tr>

<tr id="addr-8971">
<td class="addr"><a href="#addr-8971">8971</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-8974">
<td class="addr"><a href="#addr-8974">8974</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8975">
<td class="addr"><a href="#addr-8975">8975</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85E4">set_fs_flag</a></span></td>
<td class="hex">20 E4 85</td>
</tr>

<tr id="addr-8978">
<td class="addr"><a href="#addr-8978">8978</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8979">
<td class="addr"><a href="#addr-8979">8979</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-0E08">fs_sequence_nos</a></span></td>
<td class="hex">0D 08 0E</td>
</tr>

<tr id="addr-897C">
<td class="addr"><a href="#addr-897C">897C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E08">fs_sequence_nos</a></span></td>
<td class="hex">8D 08 0E</td>
</tr>

<tr id="addr-897F">
<td class="addr"><a href="#addr-897F">897F</a></td>
<td>    <span class="opcode">TXA</span>  <span class="comment">; A=single-bit bitmask</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8980">
<td class="addr"><a href="#addr-8980">8980</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85A5">mask_to_handle</a></span>  <span class="comment">; Convert bitmask to handle number (FS2A)</span></td>
<td class="hex">20 A5 85</td>
</tr>

<tr id="addr-8983">
<td class="addr"><a href="#addr-8983">8983</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-892E">c892e</a></span></td>
<td class="hex">D0 A9</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Close file handle(s) (CLOSE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Y=0: close all files — first calls OSBYTE $77 (close SPOOL and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        EXEC files) to coordinate with the MOS before sending the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        close-all command to the fileserver. This ensures locally-</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        managed file handles are released before the server-side</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        handles are invalidated, preventing the MOS from writing to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        a closed spool file.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Y&gt;0: close single handle — sends FS close command and clears</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        the handle&#39;s bit in both the EOF hint byte and the sequence</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;        number tracking byte.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8985">
<td class="addr"><a href="#addr-8985">8985</a></td>
<td><span class="label">.close_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TYA</span>  <span class="comment">; Y=preserved</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8986">
<td class="addr"><a href="#addr-8986">8986</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-898F">close_single_handle</a></span></td>
<td class="hex">D0 07</td>
</tr>

<tr id="addr-8988">
<td class="addr"><a href="#addr-8988">8988</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_close_spool_exec</span></td>
<td class="hex">A9 77</td>
</tr>

<tr id="addr-898A">
<td class="addr"><a href="#addr-898A">898A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Close any *SPOOL and *EXEC files</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-898D">
<td class="addr"><a href="#addr-898D">898D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-898F">
<td class="addr"><a href="#addr-898F">898F</a></td>
<td><span class="label">.close_single_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8C 05 0F</td>
</tr>

<tr id="addr-8992">
<td class="addr"><a href="#addr-8992">8992</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span>  <span class="comment">; X=preserved through header build</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-8994">
<td class="addr"><a href="#addr-8994">8994</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#7</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 07</td>
</tr>

<tr id="addr-8996">
<td class="addr"><a href="#addr-8996">8996</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8999">
<td class="addr"><a href="#addr-8999">8999</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-899C">
<td class="addr"><a href="#addr-899C">899C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85E4">set_fs_flag</a></span></td>
<td class="hex">20 E4 85</td>
</tr>

<tr id="addr-899F">
<td class="addr"><a href="#addr-899F">899F</a></td>
<td><span class="label">.c899f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">90 8B</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FSCV 0: *OPT handler (OPTION)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handles *OPT X,Y to set filing system options:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   *OPT 1,Y (Y=0/1): set local user option in $0E06 (OPT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   *OPT 4,Y (Y=0-3): set boot option via FS command $16 (FCOPT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Other combinations generate error $CB (OPTER: &#34;bad option&#34;).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-89A1">
<td class="addr"><a href="#addr-89A1">89A1</a></td>
<td><span class="label">.opt_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#4</span></td>
<td class="hex">E0 04</td>
</tr>

<tr id="addr-89A3">
<td class="addr"><a href="#addr-89A3">89A3</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-89A9">c89a9</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-89A5">
<td class="addr"><a href="#addr-89A5">89A5</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#4</span></td>
<td class="hex">C0 04</td>
</tr>

<tr id="addr-89A7">
<td class="addr"><a href="#addr-89A7">89A7</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-89BB">c89bb</a></span></td>
<td class="hex">90 12</td>
</tr>

<tr id="addr-89A9">
<td class="addr"><a href="#addr-89A9">89A9</a></td>
<td><span class="label">.c89a9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#1</span></td>
<td class="hex">E0 01</td>
</tr>

<tr id="addr-89AB">
<td class="addr"><a href="#addr-89AB">89AB</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-89B6">c89b6</a></span></td>
<td class="hex">D0 09</td>
</tr>

<tr id="addr-89AD">
<td class="addr"><a href="#addr-89AD">89AD</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#2</span></td>
<td class="hex">C0 02</td>
</tr>

<tr id="addr-89AF">
<td class="addr"><a href="#addr-89AF">89AF</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-89B6">c89b6</a></span></td>
<td class="hex">B0 05</td>
</tr>

<tr id="addr-89B1">
<td class="addr"><a href="#addr-89B1">89B1</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0E06">fs_messages_flag</a></span></td>
<td class="hex">8C 06 0E</td>
</tr>

<tr id="addr-89B4">
<td class="addr"><a href="#addr-89B4">89B4</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-89C8">c89c8</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">90 12</td>
</tr>

<tr id="addr-89B6">
<td class="addr"><a href="#addr-89B6">89B6</a></td>
<td><span class="label">.c89b6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#7</span></td>
<td class="hex">A9 07</td>
</tr>

<tr id="addr-89B8">
<td class="addr"><a href="#addr-89B8">89B8</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-842A">c842a</a></span></td>
<td class="hex">4C 2A 84</td>
</tr>

<tr id="addr-89BB">
<td class="addr"><a href="#addr-89BB">89BB</a></td>
<td><span class="label">.c89bb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8C 05 0F</td>
</tr>

<tr id="addr-89BE">
<td class="addr"><a href="#addr-89BE">89BE</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;16</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 16</td>
</tr>

<tr id="addr-89C0">
<td class="addr"><a href="#addr-89C0">89C0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-89C3">
<td class="addr"><a href="#addr-89C3">89C3</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00BC">fs_block_offset</a></span></td>
<td class="hex">A4 BC</td>
</tr>

<tr id="addr-89C5">
<td class="addr"><a href="#addr-89C5">89C5</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0E05">fs_boot_option</a></span></td>
<td class="hex">8C 05 0E</td>
</tr>

<tr id="addr-89C8">
<td class="addr"><a href="#addr-89C8">89C8</a></td>
<td><span class="label">.c89c8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-899F">c899f</a></span></td>
<td class="hex">90 D5</td>
</tr>

<tr id="addr-89CA">
<td class="addr"><a href="#addr-89CA">89CA</a></td>
<td><span class="label">.adjust_addrs_9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#9</span></td>
<td class="hex">A0 09</td>
</tr>

<tr id="addr-89CC">
<td class="addr"><a href="#addr-89CC">89CC</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-89D1">adjust_addrs_clc</a></span></td>
<td class="hex">20 D1 89</td>
</tr>

<tr id="addr-89CF">
<td class="addr"><a href="#addr-89CF">89CF</a></td>
<td><span class="label">.adjust_addrs_1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-89D1">
<td class="addr"><a href="#addr-89D1">89D1</a></td>
<td><span class="label">.adjust_addrs_clc</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Bidirectional 4-byte address adjustment</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Adjusts a 4-byte value in the parameter block at (fs_options)+Y:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   If fs_load_addr_2 ($B2) is positive: adds fs_lib_handle+X values</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   If fs_load_addr_2 ($B2) is negative: subtracts fs_lib_handle+X</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Starting offset X=$FC means it reads from $0E06-$0E09 area.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Used to convert between absolute and relative file positions.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-89D2">
<td class="addr"><a href="#addr-89D2">89D2</a></td>
<td><span class="label">.adjust_addrs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;fc</span></td>
<td class="hex">A2 FC</td>
</tr>

<tr id="addr-89D4">
<td class="addr"><a href="#addr-89D4">89D4</a></td>
<td><span class="label">.loop_c89d4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-89D6">
<td class="addr"><a href="#addr-89D6">89D6</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">24 B2</td>
</tr>

<tr id="addr-89D8">
<td class="addr"><a href="#addr-89D8">89D8</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-89E0">c89e0</a></span></td>
<td class="hex">30 06</td>
</tr>

<tr id="addr-89DA">
<td class="addr"><a href="#addr-89DA">89DA</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-0E0A">fs_cmd_context</a>,x</span></td>
<td class="hex">7D 0A 0E</td>
</tr>

<tr id="addr-89DD">
<td class="addr"><a href="#addr-89DD">89DD</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-89E3">c89e3</a></span></td>
<td class="hex">4C E3 89</td>
</tr>

<tr id="addr-89E0">
<td class="addr"><a href="#addr-89E0">89E0</a></td>
<td><span class="label">.c89e0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">SBC</span> <span class="operand"><a href="#addr-0E0A">fs_cmd_context</a>,x</span></td>
<td class="hex">FD 0A 0E</td>
</tr>

<tr id="addr-89E3">
<td class="addr"><a href="#addr-89E3">89E3</a></td>
<td><span class="label">.c89e3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-89E5">
<td class="addr"><a href="#addr-89E5">89E5</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-89E6">
<td class="addr"><a href="#addr-89E6">89E6</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-89E7">
<td class="addr"><a href="#addr-89E7">89E7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-89D4">loop_c89d4</a></span></td>
<td class="hex">D0 EB</td>
</tr>

<tr id="addr-89E9">
<td class="addr"><a href="#addr-89E9">89E9</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; GBPBV handler (OSGBPB entry point)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=1-4: file read/write operations (handle-based)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   A=5-8: info queries (disc title, current dir, lib, filenames)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Calls 1-4 are standard file data transfers via the fileserver.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Calls 5-8 were a late addition to the MOS spec and are the only</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NFS operations requiring Tube data transfer -- described in the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; original source as &#34;untidy but useful in theory.&#34; The data format</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; uses length-prefixed strings (&lt;name length&gt;&lt;object name&gt;) rather</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; than the CR-terminated strings used elsewhere in the FS.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: call number (1-8)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: parameter block address low byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: parameter block address high byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: 0 after FS operation, else restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: restored</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-89EA">
<td class="addr"><a href="#addr-89EA">89EA</a></td>
<td><span class="label">.gbpbv_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8508">save_fscv_args</a></span></td>
<td class="hex">20 08 85</td>
</tr>

<tr id="addr-89ED">
<td class="addr"><a href="#addr-89ED">89ED</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-89EE">
<td class="addr"><a href="#addr-89EE">89EE</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-89F5">c89f5</a></span></td>
<td class="hex">F0 05</td>
</tr>

<tr id="addr-89F0">
<td class="addr"><a href="#addr-89F0">89F0</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-89F1">
<td class="addr"><a href="#addr-89F1">89F1</a></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#8</span></td>
<td class="hex">E0 08</td>
</tr>

<tr id="addr-89F3">
<td class="addr"><a href="#addr-89F3">89F3</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-89F8">c89f8</a></span></td>
<td class="hex">90 03</td>
</tr>

<tr id="addr-89F5">
<td class="addr"><a href="#addr-89F5">89F5</a></td>
<td><span class="label">.c89f5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">4C 2C 89</td>
</tr>

<tr id="addr-89F8">
<td class="addr"><a href="#addr-89F8">89F8</a></td>
<td><span class="label">.c89f8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-89F9">
<td class="addr"><a href="#addr-89F9">89F9</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-89FB">
<td class="addr"><a href="#addr-89FB">89FB</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-89FC">
<td class="addr"><a href="#addr-89FC">89FC</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#4</span></td>
<td class="hex">C9 04</td>
</tr>

<tr id="addr-89FE">
<td class="addr"><a href="#addr-89FE">89FE</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8A03">c8a03</a></span></td>
<td class="hex">90 03</td>
</tr>

<tr id="addr-8A00">
<td class="addr"><a href="#addr-8A00">8A00</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8AAD">osgbpb_info</a></span></td>
<td class="hex">4C AD 8A</td>
</tr>

<tr id="addr-8A03">
<td class="addr"><a href="#addr-8A03">8A03</a></td>
<td><span class="label">.c8a03</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8A05">
<td class="addr"><a href="#addr-8A05">8A05</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8588">handle_to_mask_a</a></span></td>
<td class="hex">20 88 85</td>
</tr>

<tr id="addr-8A08">
<td class="addr"><a href="#addr-8A08">8A08</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8C 05 0F</td>
</tr>

<tr id="addr-8A0B">
<td class="addr"><a href="#addr-8A0B">8A0B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0b</span></td>
<td class="hex">A0 0B</td>
</tr>

<tr id="addr-8A0D">
<td class="addr"><a href="#addr-8A0D">8A0D</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#6</span></td>
<td class="hex">A2 06</td>
</tr>

<tr id="addr-8A0F">
<td class="addr"><a href="#addr-8A0F">8A0F</a></td>
<td><span class="label">.loop_c8a0f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8A11">
<td class="addr"><a href="#addr-8A11">8A11</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a>,x</span></td>
<td class="hex">9D 06 0F</td>
</tr>

<tr id="addr-8A14">
<td class="addr"><a href="#addr-8A14">8A14</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8A15">
<td class="addr"><a href="#addr-8A15">8A15</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#8</span></td>
<td class="hex">C0 08</td>
</tr>

<tr id="addr-8A17">
<td class="addr"><a href="#addr-8A17">8A17</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8A1A">c8a1a</a></span></td>
<td class="hex">D0 01</td>
</tr>

<tr id="addr-8A19">
<td class="addr"><a href="#addr-8A19">8A19</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8A1A">
<td class="addr"><a href="#addr-8A1A">8A1A</a></td>
<td><span class="label">.c8a1a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8A1B">
<td class="addr"><a href="#addr-8A1B">8A1B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8A0F">loop_c8a0f</a></span></td>
<td class="hex">D0 F2</td>
</tr>

<tr id="addr-8A1D">
<td class="addr"><a href="#addr-8A1D">8A1D</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8A1E">
<td class="addr"><a href="#addr-8A1E">8A1E</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8A1F">
<td class="addr"><a href="#addr-8A1F">8A1F</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8A20">
<td class="addr"><a href="#addr-8A20">8A20</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8A23">c8a23</a></span></td>
<td class="hex">90 01</td>
</tr>

<tr id="addr-8A22">
<td class="addr"><a href="#addr-8A22">8A22</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8A23">
<td class="addr"><a href="#addr-8A23">8A23</a></td>
<td><span class="label">.c8a23</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8E 06 0F</td>
</tr>

<tr id="addr-8A26">
<td class="addr"><a href="#addr-8A26">8A26</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0b</span></td>
<td class="hex">A0 0B</td>
</tr>

<tr id="addr-8A28">
<td class="addr"><a href="#addr-8A28">8A28</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;91</span></td>
<td class="hex">A2 91</td>
</tr>

<tr id="addr-8A2A">
<td class="addr"><a href="#addr-8A2A">8A2A</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8A2B">
<td class="addr"><a href="#addr-8A2B">8A2B</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8A2C">
<td class="addr"><a href="#addr-8A2C">8A2C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8A31">c8a31</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-8A2E">
<td class="addr"><a href="#addr-8A2E">8A2E</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;92</span></td>
<td class="hex">A2 92</td>
</tr>

<tr id="addr-8A30">
<td class="addr"><a href="#addr-8A30">8A30</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;0a</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8A31">
<td class="addr"><a href="#addr-8A31">8A31</a></td>
<td><span class="label">.c8a31</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F02">fs_cmd_urd</a></span></td>
<td class="hex">8E 02 0F</td>
</tr>

<tr id="addr-8A34">
<td class="addr"><a href="#addr-8A34">8A34</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">86 B8</td>
</tr>

<tr id="addr-8A36">
<td class="addr"><a href="#addr-8A36">8A36</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#8</span></td>
<td class="hex">A2 08</td>
</tr>

<tr id="addr-8A38">
<td class="addr"><a href="#addr-8A38">8A38</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-8A3B">
<td class="addr"><a href="#addr-8A3B">8A3B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8340">prepare_cmd_with_flag</a></span></td>
<td class="hex">20 40 83</td>
</tr>

<tr id="addr-8A3E">
<td class="addr"><a href="#addr-8A3E">8A3E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B3">l00b3</a></span></td>
<td class="hex">A5 B3</td>
</tr>

<tr id="addr-8A40">
<td class="addr"><a href="#addr-8A40">8A40</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E08">fs_sequence_nos</a></span></td>
<td class="hex">8D 08 0E</td>
</tr>

<tr id="addr-8A43">
<td class="addr"><a href="#addr-8A43">8A43</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#4</span></td>
<td class="hex">A2 04</td>
</tr>

<tr id="addr-8A45">
<td class="addr"><a href="#addr-8A45">8A45</a></td>
<td><span class="label">.loop_c8a45</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8A47">
<td class="addr"><a href="#addr-8A47">8A47</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00AF">l00af</a>,y</span></td>
<td class="hex">99 AF 00</td>
</tr>

<tr id="addr-8A4A">
<td class="addr"><a href="#addr-8A4A">8A4A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00C7">l00c7</a>,y</span></td>
<td class="hex">99 C7 00</td>
</tr>

<tr id="addr-8A4D">
<td class="addr"><a href="#addr-8A4D">8A4D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-84A5">add_4_to_y</a></span></td>
<td class="hex">20 A5 84</td>
</tr>

<tr id="addr-8A50">
<td class="addr"><a href="#addr-8A50">8A50</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">71 BB</td>
</tr>

<tr id="addr-8A52">
<td class="addr"><a href="#addr-8A52">8A52</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00AF">l00af</a>,y</span></td>
<td class="hex">99 AF 00</td>
</tr>

<tr id="addr-8A55">
<td class="addr"><a href="#addr-8A55">8A55</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-84AB">sub_3_from_y</a></span></td>
<td class="hex">20 AB 84</td>
</tr>

<tr id="addr-8A58">
<td class="addr"><a href="#addr-8A58">8A58</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8A59">
<td class="addr"><a href="#addr-8A59">8A59</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8A45">loop_c8a45</a></span></td>
<td class="hex">D0 EA</td>
</tr>

<tr id="addr-8A5B">
<td class="addr"><a href="#addr-8A5B">8A5B</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8A5C">
<td class="addr"><a href="#addr-8A5C">8A5C</a></td>
<td><span class="label">.loop_c8a5c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F03">fs_cmd_csd</a>,x</span></td>
<td class="hex">BD 03 0F</td>
</tr>

<tr id="addr-8A5F">
<td class="addr"><a href="#addr-8A5F">8A5F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a>,x</span></td>
<td class="hex">9D 06 0F</td>
</tr>

<tr id="addr-8A62">
<td class="addr"><a href="#addr-8A62">8A62</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8A63">
<td class="addr"><a href="#addr-8A63">8A63</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8A5C">loop_c8a5c</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-8A65">
<td class="addr"><a href="#addr-8A65">8A65</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8A66">
<td class="addr"><a href="#addr-8A66">8A66</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8A70">c8a70</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-8A68">
<td class="addr"><a href="#addr-8A68">8A68</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F02">fs_cmd_urd</a></span></td>
<td class="hex">AD 02 0F</td>
</tr>

<tr id="addr-8A6B">
<td class="addr"><a href="#addr-8A6B">8A6B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-87C8">transfer_file_blocks</a></span></td>
<td class="hex">20 C8 87</td>
</tr>

<tr id="addr-8A6E">
<td class="addr"><a href="#addr-8A6E">8A6E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8A73">c8a73</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-8A70">
<td class="addr"><a href="#addr-8A70">8A70</a></td>
<td><span class="label">.c8a70</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8716">send_data_blocks</a></span></td>
<td class="hex">20 16 87</td>
</tr>

<tr id="addr-8A73">
<td class="addr"><a href="#addr-8A73">8A73</a></td>
<td><span class="label">.c8a73</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2a</span></td>
<td class="hex">A9 2A</td>
</tr>

<tr id="addr-8A75">
<td class="addr"><a href="#addr-8A75">8A75</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B8">fs_error_ptr</a></span></td>
<td class="hex">85 B8</td>
</tr>

<tr id="addr-8A77">
<td class="addr"><a href="#addr-8A77">8A77</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8380">send_fs_reply_cmd</a></span></td>
<td class="hex">20 80 83</td>
</tr>

<tr id="addr-8A7A">
<td class="addr"><a href="#addr-8A7A">8A7A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>,x)</span></td>
<td class="hex">A1 BB</td>
</tr>

<tr id="addr-8A7C">
<td class="addr"><a href="#addr-8A7C">8A7C</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">2C 05 0F</td>
</tr>

<tr id="addr-8A7F">
<td class="addr"><a href="#addr-8A7F">8A7F</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8A84">c8a84</a></span></td>
<td class="hex">30 03</td>
</tr>

<tr id="addr-8A81">
<td class="addr"><a href="#addr-8A81">8A81</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85DF">clear_fs_flag</a></span></td>
<td class="hex">20 DF 85</td>
</tr>

<tr id="addr-8A84">
<td class="addr"><a href="#addr-8A84">8A84</a></td>
<td><span class="label">.c8a84</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85E4">set_fs_flag</a></span></td>
<td class="hex">20 E4 85</td>
</tr>

<tr id="addr-8A87">
<td class="addr"><a href="#addr-8A87">8A87</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">86 B2</td>
</tr>

<tr id="addr-8A89">
<td class="addr"><a href="#addr-8A89">8A89</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-89CA">adjust_addrs_9</a></span></td>
<td class="hex">20 CA 89</td>
</tr>

<tr id="addr-8A8C">
<td class="addr"><a href="#addr-8A8C">8A8C</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">C6 B2</td>
</tr>

<tr id="addr-8A8E">
<td class="addr"><a href="#addr-8A8E">8A8E</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8A8F">
<td class="addr"><a href="#addr-8A8F">8A8F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-89D2">adjust_addrs</a></span></td>
<td class="hex">20 D2 89</td>
</tr>

<tr id="addr-8A92">
<td class="addr"><a href="#addr-8A92">8A92</a></td>
<td>    <span class="opcode">ASL</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">0E 05 0F</td>
</tr>

<tr id="addr-8A95">
<td class="addr"><a href="#addr-8A95">8A95</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8945">c8945</a></span></td>
<td class="hex">4C 45 89</td>
</tr>

<tr id="addr-8A98">
<td class="addr"><a href="#addr-8A98">8A98</a></td>
<td><span class="label">.c8a98</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;15</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 15</td>
</tr>

<tr id="addr-8A9A">
<td class="addr"><a href="#addr-8A9A">8A9A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8A9D">
<td class="addr"><a href="#addr-8A9D">8A9D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E05">fs_boot_option</a></span></td>
<td class="hex">AD 05 0E</td>
</tr>

<tr id="addr-8AA0">
<td class="addr"><a href="#addr-8AA0">8AA0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F16">l0f16</a></span></td>
<td class="hex">8D 16 0F</td>
</tr>

<tr id="addr-8AA3">
<td class="addr"><a href="#addr-8AA3">8AA3</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a></span>  <span class="comment">; X=0 on success, $D6 on not-found</span></td>
<td class="hex">86 B0</td>
</tr>

<tr id="addr-8AA5">
<td class="addr"><a href="#addr-8AA5">8AA5</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B1">fs_load_addr_hi</a></span></td>
<td class="hex">86 B1</td>
</tr>

<tr id="addr-8AA7">
<td class="addr"><a href="#addr-8AA7">8AA7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;12</span></td>
<td class="hex">A9 12</td>
</tr>

<tr id="addr-8AA9">
<td class="addr"><a href="#addr-8AA9">8AA9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">85 B2</td>
</tr>

<tr id="addr-8AAB">
<td class="addr"><a href="#addr-8AAB">8AAB</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8AFB">copy_reply_to_caller</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 4E</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSGBPB 5-8 info handler (OSINFO)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handles the &#34;messy interface tacked onto OSGBPB&#34; (original source).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks whether the destination address is in Tube space by comparing</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the high bytes against TBFLAG. If in Tube space, data must be</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; copied via the Tube FIFO registers (with delays to accommodate the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; slow 16032 co-processor) instead of direct memory access.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8AAD">
<td class="addr"><a href="#addr-8AAD">8AAD</a></td>
<td><span class="label">.osgbpb_info</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-8AAF">
<td class="addr"><a href="#addr-8AAF">8AAF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D52">tx_in_progress</a></span></td>
<td class="hex">AD 52 0D</td>
</tr>

<tr id="addr-8AB2">
<td class="addr"><a href="#addr-8AB2">8AB2</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8ABB">c8abb</a></span></td>
<td class="hex">F0 07</td>
</tr>

<tr id="addr-8AB4">
<td class="addr"><a href="#addr-8AB4">8AB4</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">D1 BB</td>
</tr>

<tr id="addr-8AB6">
<td class="addr"><a href="#addr-8AB6">8AB6</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8ABB">c8abb</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-8AB8">
<td class="addr"><a href="#addr-8AB8">8AB8</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;03</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8AB9">
<td class="addr"><a href="#addr-8AB9">8AB9</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">F1 BB</td>
</tr>

<tr id="addr-8ABB">
<td class="addr"><a href="#addr-8ABB">8ABB</a></td>
<td><span class="label">.c8abb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">85 CE</td>
</tr>

<tr id="addr-8ABD">
<td class="addr"><a href="#addr-8ABD">8ABD</a></td>
<td><span class="label">.loop_c8abd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8ABF">
<td class="addr"><a href="#addr-8ABF">8ABF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a>,y</span></td>
<td class="hex">99 BD 00</td>
</tr>

<tr id="addr-8AC2">
<td class="addr"><a href="#addr-8AC2">8AC2</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8AC3">
<td class="addr"><a href="#addr-8AC3">8AC3</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8ABD">loop_c8abd</a></span></td>
<td class="hex">D0 F8</td>
</tr>

<tr id="addr-8AC5">
<td class="addr"><a href="#addr-8AC5">8AC5</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8AC6">
<td class="addr"><a href="#addr-8AC6">8AC6</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#3</span></td>
<td class="hex">29 03</td>
</tr>

<tr id="addr-8AC8">
<td class="addr"><a href="#addr-8AC8">8AC8</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8A98">c8a98</a></span></td>
<td class="hex">F0 CE</td>
</tr>

<tr id="addr-8ACA">
<td class="addr"><a href="#addr-8ACA">8ACA</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8ACB">
<td class="addr"><a href="#addr-8ACB">8ACB</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8ACF">c8acf</a></span></td>
<td class="hex">F0 02</td>
</tr>

<tr id="addr-8ACD">
<td class="addr"><a href="#addr-8ACD">8ACD</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8B35">c8b35</a></span></td>
<td class="hex">B0 66</td>
</tr>

<tr id="addr-8ACF">
<td class="addr"><a href="#addr-8ACF">8ACF</a></td>
<td><span class="label">.c8acf</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAY</span>  <span class="comment">; Y=function code</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8AD0">
<td class="addr"><a href="#addr-8AD0">8AD0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E03">fs_csd_handle</a>,y</span></td>
<td class="hex">B9 03 0E</td>
</tr>

<tr id="addr-8AD3">
<td class="addr"><a href="#addr-8AD3">8AD3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F03">fs_cmd_csd</a></span></td>
<td class="hex">8D 03 0F</td>
</tr>

<tr id="addr-8AD6">
<td class="addr"><a href="#addr-8AD6">8AD6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E04">fs_lib_handle</a></span></td>
<td class="hex">AD 04 0E</td>
</tr>

<tr id="addr-8AD9">
<td class="addr"><a href="#addr-8AD9">8AD9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F04">fs_cmd_lib</a></span></td>
<td class="hex">8D 04 0F</td>
</tr>

<tr id="addr-8ADC">
<td class="addr"><a href="#addr-8ADC">8ADC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E02">fs_urd_handle</a></span></td>
<td class="hex">AD 02 0E</td>
</tr>

<tr id="addr-8ADF">
<td class="addr"><a href="#addr-8ADF">8ADF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F02">fs_cmd_urd</a></span></td>
<td class="hex">8D 02 0F</td>
</tr>

<tr id="addr-8AE2">
<td class="addr"><a href="#addr-8AE2">8AE2</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;12</span>  <span class="comment">; X=buffer extent (command-specific data bytes)</span></td>
<td class="hex">A2 12</td>
</tr>

<tr id="addr-8AE4">
<td class="addr"><a href="#addr-8AE4">8AE4</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F01">fs_cmd_y_param</a></span></td>
<td class="hex">8E 01 0F</td>
</tr>

<tr id="addr-8AE7">
<td class="addr"><a href="#addr-8AE7">8AE7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">A9 0D</td>
</tr>

<tr id="addr-8AE9">
<td class="addr"><a href="#addr-8AE9">8AE9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-8AEC">
<td class="addr"><a href="#addr-8AEC">8AEC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">85 B2</td>
</tr>

<tr id="addr-8AEE">
<td class="addr"><a href="#addr-8AEE">8AEE</a></td>
<td>    <span class="opcode">LSR</span>  <span class="comment">; A=timeout period for FS reply</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8AEF">
<td class="addr"><a href="#addr-8AEF">8AEF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8D 05 0F</td>
</tr>

<tr id="addr-8AF2">
<td class="addr"><a href="#addr-8AF2">8AF2</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-8AF3">
<td class="addr"><a href="#addr-8AF3">8AF3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-836A">build_send_fs_cmd</a></span>  <span class="comment">; Build and send FS command (DOFSOP)</span></td>
<td class="hex">20 6A 83</td>
</tr>

<tr id="addr-8AF6">
<td class="addr"><a href="#addr-8AF6">8AF6</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B1">fs_load_addr_hi</a></span>  <span class="comment">; X=0 on success, $D6 on not-found</span></td>
<td class="hex">86 B1</td>
</tr>

<tr id="addr-8AF8">
<td class="addr"><a href="#addr-8AF8">8AF8</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8AF9">
<td class="addr"><a href="#addr-8AF9">8AF9</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a></span></td>
<td class="hex">86 B0</td>
</tr>

<tr id="addr-8AFB">
<td class="addr"><a href="#addr-8AFB">8AFB</a></td>
<td><span class="label">.copy_reply_to_caller</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">A5 CE</td>
</tr>

<tr id="addr-8AFD">
<td class="addr"><a href="#addr-8AFD">8AFD</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8B10">c8b10</a></span></td>
<td class="hex">D0 11</td>
</tr>

<tr id="addr-8AFF">
<td class="addr"><a href="#addr-8AFF">8AFF</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a></span></td>
<td class="hex">A6 B0</td>
</tr>

<tr id="addr-8B01">
<td class="addr"><a href="#addr-8B01">8B01</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00B1">fs_load_addr_hi</a></span></td>
<td class="hex">A4 B1</td>
</tr>

<tr id="addr-8B03">
<td class="addr"><a href="#addr-8B03">8B03</a></td>
<td><span class="label">.loop_c8b03</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">BD 05 0F</td>
</tr>

<tr id="addr-8B06">
<td class="addr"><a href="#addr-8B06">8B06</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">91 BE</td>
</tr>

<tr id="addr-8B08">
<td class="addr"><a href="#addr-8B08">8B08</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8B09">
<td class="addr"><a href="#addr-8B09">8B09</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8B0A">
<td class="addr"><a href="#addr-8B0A">8B0A</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">C6 B2</td>
</tr>

<tr id="addr-8B0C">
<td class="addr"><a href="#addr-8B0C">8B0C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8B03">loop_c8b03</a></span></td>
<td class="hex">D0 F5</td>
</tr>

<tr id="addr-8B0E">
<td class="addr"><a href="#addr-8B0E">8B0E</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8B32">c8b32</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">F0 22</td>
</tr>

<tr id="addr-8B10">
<td class="addr"><a href="#addr-8B10">8B10</a></td>
<td><span class="label">.c8b10</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8B8A">tube_claim_loop</a></span></td>
<td class="hex">20 8A 8B</td>
</tr>

<tr id="addr-8B13">
<td class="addr"><a href="#addr-8B13">8B13</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-8B15">
<td class="addr"><a href="#addr-8B15">8B15</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00BB">fs_options</a></span></td>
<td class="hex">A6 BB</td>
</tr>

<tr id="addr-8B17">
<td class="addr"><a href="#addr-8B17">8B17</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00BC">fs_block_offset</a></span></td>
<td class="hex">A4 BC</td>
</tr>

<tr id="addr-8B19">
<td class="addr"><a href="#addr-8B19">8B19</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8B1A">
<td class="addr"><a href="#addr-8B1A">8B1A</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8B1D">c8b1d</a></span></td>
<td class="hex">D0 01</td>
</tr>

<tr id="addr-8B1C">
<td class="addr"><a href="#addr-8B1C">8B1C</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8B1D">
<td class="addr"><a href="#addr-8B1D">8B1D</a></td>
<td><span class="label">.c8b1d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr id="addr-8B20">
<td class="addr"><a href="#addr-8B20">8B20</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a></span></td>
<td class="hex">A6 B0</td>
</tr>

<tr id="addr-8B22">
<td class="addr"><a href="#addr-8B22">8B22</a></td>
<td><span class="label">.loop_c8b22</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">BD 05 0F</td>
</tr>

<tr id="addr-8B25">
<td class="addr"><a href="#addr-8B25">8B25</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">8D E5 FE</td>
</tr>

<tr id="addr-8B28">
<td class="addr"><a href="#addr-8B28">8B28</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8B29">
<td class="addr"><a href="#addr-8B29">8B29</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">C6 B2</td>
</tr>

<tr id="addr-8B2B">
<td class="addr"><a href="#addr-8B2B">8B2B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8B22">loop_c8b22</a></span></td>
<td class="hex">D0 F5</td>
</tr>

<tr id="addr-8B2D">
<td class="addr"><a href="#addr-8B2D">8B2D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;83</span></td>
<td class="hex">A9 83</td>
</tr>

<tr id="addr-8B2F">
<td class="addr"><a href="#addr-8B2F">8B2F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr id="addr-8B32">
<td class="addr"><a href="#addr-8B32">8B32</a></td>
<td><span class="label">.c8b32</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8945">c8945</a></span></td>
<td class="hex">4C 45 89</td>
</tr>

<tr id="addr-8B35">
<td class="addr"><a href="#addr-8B35">8B35</a></td>
<td><span class="label">.c8b35</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#9</span></td>
<td class="hex">A0 09</td>
</tr>

<tr id="addr-8B37">
<td class="addr"><a href="#addr-8B37">8B37</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8B39">
<td class="addr"><a href="#addr-8B39">8B39</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-8B3C">
<td class="addr"><a href="#addr-8B3C">8B3C</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#5</span></td>
<td class="hex">A0 05</td>
</tr>

<tr id="addr-8B3E">
<td class="addr"><a href="#addr-8B3E">8B3E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">B1 BB</td>
</tr>

<tr id="addr-8B40">
<td class="addr"><a href="#addr-8B40">8B40</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F07">l0f07</a></span></td>
<td class="hex">8D 07 0F</td>
</tr>

<tr id="addr-8B43">
<td class="addr"><a href="#addr-8B43">8B43</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0d</span>  <span class="comment">; X=preserved through header build</span></td>
<td class="hex">A2 0D</td>
</tr>

<tr id="addr-8B45">
<td class="addr"><a href="#addr-8B45">8B45</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F08">l0f08</a></span></td>
<td class="hex">8E 08 0F</td>
</tr>

<tr id="addr-8B48">
<td class="addr"><a href="#addr-8B48">8B48</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr id="addr-8B4A">
<td class="addr"><a href="#addr-8B4A">8B4A</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00B0">fs_load_addr</a></span></td>
<td class="hex">84 B0</td>
</tr>

<tr id="addr-8B4C">
<td class="addr"><a href="#addr-8B4C">8B4C</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8C 05 0F</td>
</tr>

<tr id="addr-8B4F">
<td class="addr"><a href="#addr-8B4F">8B4F</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=function code for HDRFN Y=&amp;03</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8B50">
<td class="addr"><a href="#addr-8B50">8B50</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8B53">
<td class="addr"><a href="#addr-8B53">8B53</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B1">fs_load_addr_hi</a></span>  <span class="comment">; X=0 on success, $D6 on not-found</span></td>
<td class="hex">86 B1</td>
</tr>

<tr id="addr-8B55">
<td class="addr"><a href="#addr-8B55">8B55</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">AD 06 0F</td>
</tr>

<tr id="addr-8B58">
<td class="addr"><a href="#addr-8B58">8B58</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>,x)</span></td>
<td class="hex">81 BB</td>
</tr>

<tr id="addr-8B5A">
<td class="addr"><a href="#addr-8B5A">8B5A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-8B5D">
<td class="addr"><a href="#addr-8B5D">8B5D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#9</span></td>
<td class="hex">A0 09</td>
</tr>

<tr id="addr-8B5F">
<td class="addr"><a href="#addr-8B5F">8B5F</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">71 BB</td>
</tr>

<tr id="addr-8B61">
<td class="addr"><a href="#addr-8B61">8B61</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BB">fs_options</a>),y</span></td>
<td class="hex">91 BB</td>
</tr>

<tr id="addr-8B63">
<td class="addr"><a href="#addr-8B63">8B63</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00C8">l00c8</a></span></td>
<td class="hex">A5 C8</td>
</tr>

<tr id="addr-8B65">
<td class="addr"><a href="#addr-8B65">8B65</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">#7</span></td>
<td class="hex">E9 07</td>
</tr>

<tr id="addr-8B67">
<td class="addr"><a href="#addr-8B67">8B67</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-8B6A">
<td class="addr"><a href="#addr-8B6A">8B6A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">85 B2</td>
</tr>

<tr id="addr-8B6C">
<td class="addr"><a href="#addr-8B6C">8B6C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8B71">c8b71</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-8B6E">
<td class="addr"><a href="#addr-8B6E">8B6E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8AFB">copy_reply_to_caller</a></span></td>
<td class="hex">20 FB 8A</td>
</tr>

<tr id="addr-8B71">
<td class="addr"><a href="#addr-8B71">8B71</a></td>
<td><span class="label">.c8b71</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-8B73">
<td class="addr"><a href="#addr-8B73">8B73</a></td>
<td><span class="label">.loop_c8b73</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F07">l0f07</a>,x</span></td>
<td class="hex">9D 07 0F</td>
</tr>

<tr id="addr-8B76">
<td class="addr"><a href="#addr-8B76">8B76</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8B77">
<td class="addr"><a href="#addr-8B77">8B77</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8B73">loop_c8b73</a></span></td>
<td class="hex">10 FA</td>
</tr>

<tr id="addr-8B79">
<td class="addr"><a href="#addr-8B79">8B79</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-89CF">adjust_addrs_1</a></span></td>
<td class="hex">20 CF 89</td>
</tr>

<tr id="addr-8B7C">
<td class="addr"><a href="#addr-8B7C">8B7C</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8B7D">
<td class="addr"><a href="#addr-8B7D">8B7D</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">C6 B2</td>
</tr>

<tr id="addr-8B7F">
<td class="addr"><a href="#addr-8B7F">8B7F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-8B82">
<td class="addr"><a href="#addr-8B82">8B82</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-8B85">
<td class="addr"><a href="#addr-8B85">8B85</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-89D2">adjust_addrs</a></span></td>
<td class="hex">20 D2 89</td>
</tr>

<tr id="addr-8B88">
<td class="addr"><a href="#addr-8B88">8B88</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8B32">c8b32</a></span></td>
<td class="hex">F0 A8</td>
</tr>

<tr id="addr-8B8A">
<td class="addr"><a href="#addr-8B8A">8B8A</a></td>
<td><span class="label">.tube_claim_loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;c3</span></td>
<td class="hex">A9 C3</td>
</tr>

<tr id="addr-8B8C">
<td class="addr"><a href="#addr-8B8C">8B8C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr id="addr-8B8F">
<td class="addr"><a href="#addr-8B8F">8B8F</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8B8A">tube_claim_loop</a></span></td>
<td class="hex">90 F9</td>
</tr>

<tr id="addr-8B91">
<td class="addr"><a href="#addr-8B91">8B91</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FSCV 2/3/4: unrecognised * command handler (DECODE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; CLI parser originally by Roger Wilson (later Sophie Wilson,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; co-designer of ARM). Matches command text against the table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; at $8BD6 using case-insensitive comparison with abbreviation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; support — commands can be shortened with &#39;.&#39; (e.g. &#34;I.&#34; for</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; &#34;INFO&#34;). The &#34;I.&#34; entry is a special fudge placed first in the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; table: since &#34;I.&#34; could match multiple commands, it jumps to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; forward_star_cmd to let the fileserver resolve the ambiguity.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The matching loop compares input characters against table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; entries. On mismatch, it skips to the next entry. On match</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; of all table characters, or when &#39;.&#39; abbreviation is found,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; it dispatches via PHA/PHA/RTS to the entry&#39;s handler address.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; After matching, adjusts fs_crc_lo/fs_crc_hi to point past</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the matched command text.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8B92">
<td class="addr"><a href="#addr-8B92">8B92</a></td>
<td><span class="label">.fscv_star_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8508">save_fscv_args</a></span></td>
<td class="hex">20 08 85</td>
</tr>

<tr id="addr-8B95">
<td class="addr"><a href="#addr-8B95">8B95</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A2 FF</td>
</tr>

<tr id="addr-8B97">
<td class="addr"><a href="#addr-8B97">8B97</a></td>
<td><span class="label">.loop_c8b97</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A0 FF</td>
</tr>

<tr id="addr-8B99">
<td class="addr"><a href="#addr-8B99">8B99</a></td>
<td><span class="label">.loop_c8b99</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8B9A">
<td class="addr"><a href="#addr-8B9A">8B9A</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8B9B">
<td class="addr"><a href="#addr-8B9B">8B9B</a></td>
<td><span class="label">.loop_c8b9b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8BD6">fs_cmd_match_table</a>,x</span></td>
<td class="hex">BD D6 8B</td>
</tr>

<tr id="addr-8B9E">
<td class="addr"><a href="#addr-8B9E">8B9E</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8BB8">c8bb8</a></span></td>
<td class="hex">30 18</td>
</tr>

<tr id="addr-8BA0">
<td class="addr"><a href="#addr-8BA0">8BA0</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">51 BE</td>
</tr>

<tr id="addr-8BA2">
<td class="addr"><a href="#addr-8BA2">8BA2</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;df</span></td>
<td class="hex">29 DF</td>
</tr>

<tr id="addr-8BA4">
<td class="addr"><a href="#addr-8BA4">8BA4</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8B99">loop_c8b99</a></span></td>
<td class="hex">F0 F3</td>
</tr>

<tr id="addr-8BA6">
<td class="addr"><a href="#addr-8BA6">8BA6</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8BA7">
<td class="addr"><a href="#addr-8BA7">8BA7</a></td>
<td><span class="label">.loop_c8ba7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8BA8">
<td class="addr"><a href="#addr-8BA8">8BA8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8BD6">fs_cmd_match_table</a>,x</span></td>
<td class="hex">BD D6 8B</td>
</tr>

<tr id="addr-8BAB">
<td class="addr"><a href="#addr-8BAB">8BAB</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8BA7">loop_c8ba7</a></span></td>
<td class="hex">10 FA</td>
</tr>

<tr id="addr-8BAD">
<td class="addr"><a href="#addr-8BAD">8BAD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">B1 BE</td>
</tr>

<tr id="addr-8BAF">
<td class="addr"><a href="#addr-8BAF">8BAF</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8BB0">
<td class="addr"><a href="#addr-8BB0">8BB0</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;2e</span></td>
<td class="hex">C9 2E</td>
</tr>

<tr id="addr-8BB2">
<td class="addr"><a href="#addr-8BB2">8BB2</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8B97">loop_c8b97</a></span></td>
<td class="hex">D0 E3</td>
</tr>

<tr id="addr-8BB4">
<td class="addr"><a href="#addr-8BB4">8BB4</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8BB5">
<td class="addr"><a href="#addr-8BB5">8BB5</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8BB6">
<td class="addr"><a href="#addr-8BB6">8BB6</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8B9B">loop_c8b9b</a></span></td>
<td class="hex">B0 E3</td>
</tr>

<tr id="addr-8BB8">
<td class="addr"><a href="#addr-8BB8">8BB8</a></td>
<td><span class="label">.c8bb8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8BB9">
<td class="addr"><a href="#addr-8BB9">8BB9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8BD7">l8bd7</a>,x</span></td>
<td class="hex">BD D7 8B</td>
</tr>

<tr id="addr-8BBC">
<td class="addr"><a href="#addr-8BBC">8BBC</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8BBD">
<td class="addr"><a href="#addr-8BBD">8BBD</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-8BBE">
<td class="addr"><a href="#addr-8BBE">8BBE</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8BBF">
<td class="addr"><a href="#addr-8BBF">8BBF</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00BF">fs_crc_hi</a></span></td>
<td class="hex">A6 BF</td>
</tr>

<tr id="addr-8BC1">
<td class="addr"><a href="#addr-8BC1">8BC1</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">65 BE</td>
</tr>

<tr id="addr-8BC3">
<td class="addr"><a href="#addr-8BC3">8BC3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E0B">l0e0b</a></span></td>
<td class="hex">8D 0B 0E</td>
</tr>

<tr id="addr-8BC6">
<td class="addr"><a href="#addr-8BC6">8BC6</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E10">fs_cmd_ptr</a></span></td>
<td class="hex">8D 10 0E</td>
</tr>

<tr id="addr-8BC9">
<td class="addr"><a href="#addr-8BC9">8BC9</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8BCC">c8bcc</a></span></td>
<td class="hex">90 01</td>
</tr>

<tr id="addr-8BCB">
<td class="addr"><a href="#addr-8BCB">8BCB</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8BCC">
<td class="addr"><a href="#addr-8BCC">8BCC</a></td>
<td><span class="label">.c8bcc</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0E0C">l0e0c</a></span></td>
<td class="hex">8E 0C 0E</td>
</tr>

<tr id="addr-8BCF">
<td class="addr"><a href="#addr-8BCF">8BCF</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0E11">l0e11</a></span></td>
<td class="hex">8E 11 0E</td>
</tr>

<tr id="addr-8BD2">
<td class="addr"><a href="#addr-8BD2">8BD2</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0E16">l0e16</a></span></td>
<td class="hex">8E 16 0E</td>
</tr>

<tr id="addr-8BD5">
<td class="addr"><a href="#addr-8BD5">8BD5</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; FS command match table (COMTAB)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Format: command letters (bit 7 clear), then dispatch address</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; as two bytes: high|(bit 7 set), low. The PHA/PHA/RTS trick</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; adds 1 to the stored (address-1). Matching is case-insensitive</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (AND $DF) and supports &#39;.&#39; abbreviation (standard Acorn pattern).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Entries:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   &#34;I.&#34;     → $8079 (forward_star_cmd) — placed first as a fudge</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;              to catch *I. abbreviation before matching *I AM</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   &#34;I AM&#34;   → $8D06 (i_am_handler: parse station.net, logon)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   &#34;EX &#34;    → $8BF2 (ex_handler: extended catalogue)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   &#34;EX&#34;\r   → $8BF2 (same, exact match at end of line)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   &#34;BYE&#34;\r  → $8349 (bye_handler: logoff)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   &lt;catch-all&gt; → $8079 (forward anything else to FS)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8BD6">
<td class="addr"><a href="#addr-8BD6">8BD6</a></td>
<td><span class="label">.fs_cmd_match_table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;49</td>
<td class="hex">49</td>
</tr>

<tr id="addr-8BD7">
<td class="addr"><a href="#addr-8BD7">8BD7</a></td>
<td><span class="label">.l8bd7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;2E, &amp;80</td>
<td class="hex">2E 80</td>
</tr>

<tr id="addr-8BD9">
<td class="addr"><a href="#addr-8BD9">8BD9</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;xI AM&quot;</span></td>
<td class="hex">78 49 20 41 4D</td>
</tr>

<tr id="addr-8BDE">
<td class="addr"><a href="#addr-8BDE">8BDE</a></td>
<td>    <span class="directive">EQUB</span> &amp;8D, &amp;05</td>
<td class="hex">8D 05</td>
</tr>

<tr id="addr-8BE0">
<td class="addr"><a href="#addr-8BE0">8BE0</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;EX &quot;</span></td>
<td class="hex">45 58 20</td>
</tr>

<tr id="addr-8BE3">
<td class="addr"><a href="#addr-8BE3">8BE3</a></td>
<td>    <span class="directive">EQUB</span> &amp;8B, &amp;F1, &amp;45, &amp;58, &amp;0D, &amp;8B, &amp;F1</td>
<td class="hex">8B F1 45 58 0D 8B F1</td>
</tr>

<tr id="addr-8BEA">
<td class="addr"><a href="#addr-8BEA">8BEA</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;BYE&quot;</span></td>
<td class="hex">42 59 45</td>
</tr>

<tr id="addr-8BED">
<td class="addr"><a href="#addr-8BED">8BED</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D, &amp;83, &amp;48, &amp;80, &amp;78</td>
<td class="hex">0D 83 48 80 78</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *EX handler (extended catalogue)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets column width $B6=$50 (80 columns, one file per line with</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; full details) and $B7=$01, then branches into cat_handler at</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $8C07, bypassing cat_handler&#39;s default 20-column setup.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8BF2">
<td class="addr"><a href="#addr-8BF2">8BF2</a></td>
<td><span class="label">.ex_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8BF3">
<td class="addr"><a href="#addr-8BF3">8BF3</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-8BF5">
<td class="addr"><a href="#addr-8BF5">8BF5</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B7">l00b7</a></span></td>
<td class="hex">86 B7</td>
</tr>

<tr id="addr-8BF7">
<td class="addr"><a href="#addr-8BF7">8BF7</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;50</span></td>
<td class="hex">A2 50</td>
</tr>

<tr id="addr-8BF9">
<td class="addr"><a href="#addr-8BF9">8BF9</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B6">l00b6</a></span></td>
<td class="hex">86 B6</td>
</tr>

<tr id="addr-8BFB">
<td class="addr"><a href="#addr-8BFB">8BFB</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8C07">c8c07</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 0A</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *CAT handler (directory catalogue)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets column width $B6=$14 (20 columns, four files per 80-column</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; line) and $B7=$03. The catalogue protocol is multi-step: first</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; sends FCUSER ($15: read user environment) to get CSD, disc, and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; library names, then sends FCREAD ($12: examine) repeatedly to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fetch entries in batches until zero are returned (end of dir).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The receive buffer abuts the examine request buffer and ends at</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; RXBUFE, allowing seamless data handling across request cycles.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The command code byte in the fileserver reply indicates FS type:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; zero means an old-format FS (client must format data locally),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; non-zero means new-format (server returns pre-formatted strings).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; This enables backward compatibility with older Acorn fileservers.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Display format:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Station number in parentheses</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - &#34;Owner&#34; or &#34;Public&#34; access level</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Boot option with name (Off/Load/Run/Exec)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Current directory and library paths</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Directory entries: CRFLAG ($CF) cycles 0-3 for multi-column</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     layout; at count 0 a newline is printed, others get spaces.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     *EX sets CRFLAG=$FF to force one entry per line.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8BFD">
<td class="addr"><a href="#addr-8BFD">8BFD</a></td>
<td><span class="label">.cat_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;14</span></td>
<td class="hex">A2 14</td>
</tr>

<tr id="addr-8BFF">
<td class="addr"><a href="#addr-8BFF">8BFF</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B6">l00b6</a></span></td>
<td class="hex">86 B6</td>
</tr>

<tr id="addr-8C01">
<td class="addr"><a href="#addr-8C01">8C01</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-8C03">
<td class="addr"><a href="#addr-8C03">8C03</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00B7">l00b7</a></span></td>
<td class="hex">86 B7</td>
</tr>

<tr id="addr-8C05">
<td class="addr"><a href="#addr-8C05">8C05</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8C07">
<td class="addr"><a href="#addr-8C07">8C07</a></td>
<td><span class="label">.c8c07</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#6</span></td>
<td class="hex">A9 06</td>
</tr>

<tr id="addr-8C09">
<td class="addr"><a href="#addr-8C09">8C09</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8D 05 0F</td>
</tr>

<tr id="addr-8C0C">
<td class="addr"><a href="#addr-8C0C">8C0C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8555">skip_spaces</a></span></td>
<td class="hex">20 55 85</td>
</tr>

<tr id="addr-8C0F">
<td class="addr"><a href="#addr-8C0F">8C0F</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00B3">l00b3</a></span></td>
<td class="hex">84 B3</td>
</tr>

<tr id="addr-8C11">
<td class="addr"><a href="#addr-8C11">8C11</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-8C13">
<td class="addr"><a href="#addr-8C13">8C13</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D67">copy_string_from_offset</a></span></td>
<td class="hex">20 67 8D</td>
</tr>

<tr id="addr-8C16">
<td class="addr"><a href="#addr-8C16">8C16</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;12</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 12</td>
</tr>

<tr id="addr-8C18">
<td class="addr"><a href="#addr-8C18">8C18</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8C1B">
<td class="addr"><a href="#addr-8C1B">8C1B</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-8C1D">
<td class="addr"><a href="#addr-8C1D">8C1D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D4F">print_reply_bytes</a></span></td>
<td class="hex">20 4F 8D</td>
</tr>

<tr id="addr-8C20">
<td class="addr"><a href="#addr-8C20">8C20</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C23">
<td class="addr"><a href="#addr-8C23">8C23</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;(&quot;</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-8C24">
<td class="addr"><a href="#addr-8C24">8C24</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F13">l0f13</a></span></td>
<td class="hex">AD 13 0F</td>
</tr>

<tr id="addr-8C27">
<td class="addr"><a href="#addr-8C27">8C27</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85AF">print_decimal</a></span></td>
<td class="hex">20 AF 85</td>
</tr>

<tr id="addr-8C2A">
<td class="addr"><a href="#addr-8C2A">8C2A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C2D">
<td class="addr"><a href="#addr-8C2D">8C2D</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;)&quot;</span></td>
<td class="hex">29</td>
</tr>

<tr id="addr-8C2E">
<td class="addr"><a href="#addr-8C2E">8C2E</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#5</span></td>
<td class="hex">A2 05</td>
</tr>

<tr id="addr-8C30">
<td class="addr"><a href="#addr-8C30">8C30</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D5C">print_spaces</a></span></td>
<td class="hex">20 5C 8D</td>
</tr>

<tr id="addr-8C33">
<td class="addr"><a href="#addr-8C33">8C33</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0F12">l0f12</a></span></td>
<td class="hex">AE 12 0F</td>
</tr>

<tr id="addr-8C36">
<td class="addr"><a href="#addr-8C36">8C36</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8C43">c8c43</a></span></td>
<td class="hex">D0 0B</td>
</tr>

<tr id="addr-8C38">
<td class="addr"><a href="#addr-8C38">8C38</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C3B">
<td class="addr"><a href="#addr-8C3B">8C3B</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Owner.&quot;</span></td>
<td class="hex">4F 77 6E 65 72 0D</td>
</tr>

<tr id="addr-8C41">
<td class="addr"><a href="#addr-8C41">8C41</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8C4D">c8c4d</a></span></td>
<td class="hex">D0 0A</td>
</tr>

<tr id="addr-8C43">
<td class="addr"><a href="#addr-8C43">8C43</a></td>
<td><span class="label">.c8c43</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C46">
<td class="addr"><a href="#addr-8C46">8C46</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Public.&quot;</span></td>
<td class="hex">50 75 62 6C 69 63 0D</td>
</tr>

<tr id="addr-8C4D">
<td class="addr"><a href="#addr-8C4D">8C4D</a></td>
<td><span class="label">.c8c4d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;15</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 15</td>
</tr>

<tr id="addr-8C4F">
<td class="addr"><a href="#addr-8C4F">8C4F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8C52">
<td class="addr"><a href="#addr-8C52">8C52</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8C53">
<td class="addr"><a href="#addr-8C53">8C53</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;10</span></td>
<td class="hex">A0 10</td>
</tr>

<tr id="addr-8C55">
<td class="addr"><a href="#addr-8C55">8C55</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D51">print_reply_counted</a></span></td>
<td class="hex">20 51 8D</td>
</tr>

<tr id="addr-8C58">
<td class="addr"><a href="#addr-8C58">8C58</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#4</span></td>
<td class="hex">A2 04</td>
</tr>

<tr id="addr-8C5A">
<td class="addr"><a href="#addr-8C5A">8C5A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D5C">print_spaces</a></span></td>
<td class="hex">20 5C 8D</td>
</tr>

<tr id="addr-8C5D">
<td class="addr"><a href="#addr-8C5D">8C5D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C60">
<td class="addr"><a href="#addr-8C60">8C60</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Option &quot;</span></td>
<td class="hex">4F 70 74 69 6F 6E 20</td>
</tr>

<tr id="addr-8C67">
<td class="addr"><a href="#addr-8C67">8C67</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E05">fs_boot_option</a></span></td>
<td class="hex">AD 05 0E</td>
</tr>

<tr id="addr-8C6A">
<td class="addr"><a href="#addr-8C6A">8C6A</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8C6B">
<td class="addr"><a href="#addr-8C6B">8C6B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85EB">print_hex</a></span></td>
<td class="hex">20 EB 85</td>
</tr>

<tr id="addr-8C6E">
<td class="addr"><a href="#addr-8C6E">8C6E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C71">
<td class="addr"><a href="#addr-8C71">8C71</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot; (&quot;</span></td>
<td class="hex">20 28</td>
</tr>

<tr id="addr-8C73">
<td class="addr"><a href="#addr-8C73">8C73</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-8D4B">option_name_offsets</a>,x</span></td>
<td class="hex">BC 4B 8D</td>
</tr>

<tr id="addr-8C76">
<td class="addr"><a href="#addr-8C76">8C76</a></td>
<td><span class="label">.loop_c8c76</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8D3A">option_name_strings</a>,y</span></td>
<td class="hex">B9 3A 8D</td>
</tr>

<tr id="addr-8C79">
<td class="addr"><a href="#addr-8C79">8C79</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8C81">c8c81</a></span></td>
<td class="hex">F0 06</td>
</tr>

<tr id="addr-8C7B">
<td class="addr"><a href="#addr-8C7B">8C7B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFE3">osasci</a></span>  <span class="comment">; Write character</span></td>
<td class="hex">20 E3 FF</td>
</tr>

<tr id="addr-8C7E">
<td class="addr"><a href="#addr-8C7E">8C7E</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8C7F">
<td class="addr"><a href="#addr-8C7F">8C7F</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8C76">loop_c8c76</a></span></td>
<td class="hex">D0 F5</td>
</tr>

<tr id="addr-8C81">
<td class="addr"><a href="#addr-8C81">8C81</a></td>
<td><span class="label">.c8c81</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C84">
<td class="addr"><a href="#addr-8C84">8C84</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;).Dir. &quot;</span></td>
<td class="hex">29 0D 44 69 72 2E 20</td>
</tr>

<tr id="addr-8C8B">
<td class="addr"><a href="#addr-8C8B">8C8B</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;11</span></td>
<td class="hex">A2 11</td>
</tr>

<tr id="addr-8C8D">
<td class="addr"><a href="#addr-8C8D">8C8D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D4F">print_reply_bytes</a></span></td>
<td class="hex">20 4F 8D</td>
</tr>

<tr id="addr-8C90">
<td class="addr"><a href="#addr-8C90">8C90</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#5</span></td>
<td class="hex">A2 05</td>
</tr>

<tr id="addr-8C92">
<td class="addr"><a href="#addr-8C92">8C92</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D5C">print_spaces</a></span></td>
<td class="hex">20 5C 8D</td>
</tr>

<tr id="addr-8C95">
<td class="addr"><a href="#addr-8C95">8C95</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8C98">
<td class="addr"><a href="#addr-8C98">8C98</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Lib. &quot;</span></td>
<td class="hex">4C 69 62 2E 20</td>
</tr>

<tr id="addr-8C9D">
<td class="addr"><a href="#addr-8C9D">8C9D</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;1b</span></td>
<td class="hex">A2 1B</td>
</tr>

<tr id="addr-8C9F">
<td class="addr"><a href="#addr-8C9F">8C9F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D4F">print_reply_bytes</a></span></td>
<td class="hex">20 4F 8D</td>
</tr>

<tr id="addr-8CA2">
<td class="addr"><a href="#addr-8CA2">8CA2</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-853B">print_inline</a></span></td>
<td class="hex">20 3B 85</td>
</tr>

<tr id="addr-8CA5">
<td class="addr"><a href="#addr-8CA5">8CA5</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;..&quot;</span></td>
<td class="hex">0D 0D</td>
</tr>

<tr id="addr-8CA7">
<td class="addr"><a href="#addr-8CA7">8CA7</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8C 06 0F</td>
</tr>

<tr id="addr-8CAA">
<td class="addr"><a href="#addr-8CAA">8CAA</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00B4">l00b4</a></span></td>
<td class="hex">84 B4</td>
</tr>

<tr id="addr-8CAC">
<td class="addr"><a href="#addr-8CAC">8CAC</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8CAD">
<td class="addr"><a href="#addr-8CAD">8CAD</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">49 FF</td>
</tr>

<tr id="addr-8CAF">
<td class="addr"><a href="#addr-8CAF">8CAF</a></td>
<td><span class="label">.loop_c8caf</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8CB0">
<td class="addr"><a href="#addr-8CB0">8CB0</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand"><a href="#addr-00B6">l00b6</a></span></td>
<td class="hex">E5 B6</td>
</tr>

<tr id="addr-8CB2">
<td class="addr"><a href="#addr-8CB2">8CB2</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8CB3">
<td class="addr"><a href="#addr-8CB3">8CB3</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8CAF">loop_c8caf</a></span></td>
<td class="hex">B0 FA</td>
</tr>

<tr id="addr-8CB5">
<td class="addr"><a href="#addr-8CB5">8CB5</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0F07">l0f07</a></span></td>
<td class="hex">8C 07 0F</td>
</tr>

<tr id="addr-8CB8">
<td class="addr"><a href="#addr-8CB8">8CB8</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00B5">l00b5</a></span></td>
<td class="hex">84 B5</td>
</tr>

<tr id="addr-8CBA">
<td class="addr"><a href="#addr-8CBA">8CBA</a></td>
<td><span class="label">.c8cba</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00B3">l00b3</a></span></td>
<td class="hex">A4 B3</td>
</tr>

<tr id="addr-8CBC">
<td class="addr"><a href="#addr-8CBC">8CBC</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-00B7">l00b7</a></span></td>
<td class="hex">A6 B7</td>
</tr>

<tr id="addr-8CBE">
<td class="addr"><a href="#addr-8CBE">8CBE</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">8E 05 0F</td>
</tr>

<tr id="addr-8CC1">
<td class="addr"><a href="#addr-8CC1">8CC1</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-8CC3">
<td class="addr"><a href="#addr-8CC3">8CC3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D67">copy_string_from_offset</a></span></td>
<td class="hex">20 67 8D</td>
</tr>

<tr id="addr-8CC6">
<td class="addr"><a href="#addr-8CC6">8CC6</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#3</span>  <span class="comment">; Y=function code for HDRFN</span></td>
<td class="hex">A0 03</td>
</tr>

<tr id="addr-8CC8">
<td class="addr"><a href="#addr-8CC8">8CC8</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8350">prepare_fs_cmd</a></span>  <span class="comment">; Prepare FS command buffer (12 references)</span></td>
<td class="hex">20 50 83</td>
</tr>

<tr id="addr-8CCB">
<td class="addr"><a href="#addr-8CCB">8CCB</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">AD 05 0F</td>
</tr>

<tr id="addr-8CCE">
<td class="addr"><a href="#addr-8CCE">8CCE</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8CFF">c8cff</a></span></td>
<td class="hex">F0 2F</td>
</tr>

<tr id="addr-8CD0">
<td class="addr"><a href="#addr-8CD0">8CD0</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-8CD2">
<td class="addr"><a href="#addr-8CD2">8CD2</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8D75">print_dir_from_offset</a></span></td>
<td class="hex">20 75 8D</td>
</tr>

<tr id="addr-8CD5">
<td class="addr"><a href="#addr-8CD5">8CD5</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-8CD6">
<td class="addr"><a href="#addr-8CD6">8CD6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B4">l00b4</a></span></td>
<td class="hex">A5 B4</td>
</tr>

<tr id="addr-8CD8">
<td class="addr"><a href="#addr-8CD8">8CD8</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a></span></td>
<td class="hex">6D 05 0F</td>
</tr>

<tr id="addr-8CDB">
<td class="addr"><a href="#addr-8CDB">8CDB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F06">l0f06</a></span></td>
<td class="hex">8D 06 0F</td>
</tr>

<tr id="addr-8CDE">
<td class="addr"><a href="#addr-8CDE">8CDE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B4">l00b4</a></span></td>
<td class="hex">85 B4</td>
</tr>

<tr id="addr-8CE0">
<td class="addr"><a href="#addr-8CE0">8CE0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B5">l00b5</a></span></td>
<td class="hex">A5 B5</td>
</tr>

<tr id="addr-8CE2">
<td class="addr"><a href="#addr-8CE2">8CE2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F07">l0f07</a></span></td>
<td class="hex">8D 07 0F</td>
</tr>

<tr id="addr-8CE5">
<td class="addr"><a href="#addr-8CE5">8CE5</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8CBA">c8cba</a></span></td>
<td class="hex">D0 D3</td>
</tr>

<tr id="addr-8CE7">
<td class="addr"><a href="#addr-8CE7">8CE7</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-212E">l212e</a></span></td>
<td class="hex">4C 2E 21</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Boot command strings for auto-boot</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The four boot options use OSCLI strings at offsets within page $8C:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Option 0 (Off):  offset $F6 → $8CF6 = bare CR (empty command)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Option 1 (Load): offset $E7 → $8CE7 = &#34;L.!BOOT&#34; (dual-purpose:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;       the JMP $212E instruction at $8CE7 has opcode $4C=&#39;L&#39; and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;       operand bytes $2E=&#39;.&#39; $21=&#39;!&#39;, forming the string &#34;L.!&#34;)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Option 2 (Run):  offset $E9 → $8CE9 = &#34;!BOOT&#34; (bare filename = *RUN)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Option 3 (Exec): offset $EF → $8CEF = &#34;E.!BOOT&#34;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; This is a classic BBC ROM space optimisation: the JMP instruction&#39;s</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; bytes serve double duty as both executable code and ASCII text.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8CEA">
<td class="addr"><a href="#addr-8CEA">8CEA</a></td>
<td><span class="label">.boot_cmd_strings</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;BOOT&quot;</span></td>
<td class="hex">42 4F 4F 54</td>
</tr>

<tr id="addr-8CEE">
<td class="addr"><a href="#addr-8CEE">8CEE</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D</td>
<td class="hex">0D</td>
</tr>

<tr id="addr-8CEF">
<td class="addr"><a href="#addr-8CEF">8CEF</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;E.!BOOT&quot;</span></td>
<td class="hex">45 2E 21 42 4F 4F 54</td>
</tr>

<tr id="addr-8CF6">
<td class="addr"><a href="#addr-8CF6">8CF6</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D</td>
<td class="hex">0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set library handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores Y into $0E04 (library directory handle in FS workspace).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Falls through to c8cff (JMP c892c) if Y is non-zero.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8CF7">
<td class="addr"><a href="#addr-8CF7">8CF7</a></td>
<td><span class="label">.set_lib_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0E04">fs_lib_handle</a></span></td>
<td class="hex">8C 04 0E</td>
</tr>

<tr id="addr-8CFA">
<td class="addr"><a href="#addr-8CFA">8CFA</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8CFF">c8cff</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set CSD handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores Y into $0E03 (current selected directory handle).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Falls through to c8cff (JMP c892c).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8CFC">
<td class="addr"><a href="#addr-8CFC">8CFC</a></td>
<td><span class="label">.set_csd_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0E03">fs_csd_handle</a></span></td>
<td class="hex">8C 03 0E</td>
</tr>

<tr id="addr-8CFF">
<td class="addr"><a href="#addr-8CFF">8CFF</a></td>
<td><span class="label">.c8cff</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-892C">restore_args_return</a></span></td>
<td class="hex">4C 2C 89</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Boot option → OSCLI string offset table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Four bytes indexed by the boot option value (0-3). Each byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; is the low byte of a pointer into page $8C, where the OSCLI</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; command string for that boot option lives. See boot_cmd_strings.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D02">
<td class="addr"><a href="#addr-8D02">8D02</a></td>
<td><span class="label">.boot_option_offsets</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;F6, &amp;E7, &amp;E9, &amp;EF</td>
<td class="hex">F6 E7 E9 EF</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; &#34;I AM&#34; command handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatched from the command match table when the user types</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; &#34;*I AM &lt;station&gt;&#34; or &#34;*I AM &lt;station&gt;.&lt;network&gt;&#34;.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Parses the station number (and optional network number after &#39;.&#39;)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; using skip_spaces and parse_decimal. Stores the results in:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0E00 = station number (or fileserver station)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0E01 = network number</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Then forwards the command to the fileserver via forward_star_cmd.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D06">
<td class="addr"><a href="#addr-8D06">8D06</a></td>
<td><span class="label">.i_am_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8555">skip_spaces</a></span></td>
<td class="hex">20 55 85</td>
</tr>

<tr id="addr-8D09">
<td class="addr"><a href="#addr-8D09">8D09</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8D1C">c8d1c</a></span></td>
<td class="hex">B0 11</td>
</tr>

<tr id="addr-8D0B">
<td class="addr"><a href="#addr-8D0B">8D0B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-8D0D">
<td class="addr"><a href="#addr-8D0D">8D0D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8560">parse_decimal</a></span>  <span class="comment">; Parse decimal number from (fs_options),Y (DECIN)</span></td>
<td class="hex">20 60 85</td>
</tr>

<tr id="addr-8D10">
<td class="addr"><a href="#addr-8D10">8D10</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8D16">c8d16</a></span></td>
<td class="hex">90 04</td>
</tr>

<tr id="addr-8D12">
<td class="addr"><a href="#addr-8D12">8D12</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=offset into (fs_options) buffer</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8D13">
<td class="addr"><a href="#addr-8D13">8D13</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8560">parse_decimal</a></span>  <span class="comment">; Parse decimal number from (fs_options),Y (DECIN)</span></td>
<td class="hex">20 60 85</td>
</tr>

<tr id="addr-8D16">
<td class="addr"><a href="#addr-8D16">8D16</a></td>
<td><span class="label">.c8d16</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E00">fs_server_stn</a></span>  <span class="comment">; A=parsed value (accumulated in $B2)</span></td>
<td class="hex">8D 00 0E</td>
</tr>

<tr id="addr-8D19">
<td class="addr"><a href="#addr-8D19">8D19</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0E01">fs_server_net</a></span>  <span class="comment">; X=corrupted</span></td>
<td class="hex">8E 01 0E</td>
</tr>

<tr id="addr-8D1C">
<td class="addr"><a href="#addr-8D1C">8D1C</a></td>
<td><span class="label">.c8d1c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8079">forward_star_cmd</a></span></td>
<td class="hex">4C 79 80</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy FS reply handles to workspace and execute boot command</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; SEC entry (LOGIN): copies 4 bytes from $0F05-$0F08 (FS reply) to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $0E02-$0E05 (URD, CSD, LIB handles and boot option), then</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; looks up the boot option in boot_option_offsets to get the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSCLI command string and executes it via JMP oscli.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The carry flag distinguishes LOGIN (SEC) from SDISC (CLC) — both</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; share the handle-copying code, but only LOGIN executes the boot</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; command. This use of the carry flag to select behaviour between</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; two callers avoids duplicating the handle-copy loop.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D1F">
<td class="addr"><a href="#addr-8D1F">8D1F</a></td>
<td><span class="label">.copy_handles_and_boot</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy FS reply handles to workspace (no boot)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; CLC entry (SDISC): copies handles only, then jumps to c8cff.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called when the FS reply contains updated handle values</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; but no boot action is needed.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D20">
<td class="addr"><a href="#addr-8D20">8D20</a></td>
<td><span class="label">.copy_handles</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-8D22">
<td class="addr"><a href="#addr-8D22">8D22</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8D2A">c8d2a</a></span></td>
<td class="hex">90 06</td>
</tr>

<tr id="addr-8D24">
<td class="addr"><a href="#addr-8D24">8D24</a></td>
<td><span class="label">.loop_c8d24</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">BD 05 0F</td>
</tr>

<tr id="addr-8D27">
<td class="addr"><a href="#addr-8D27">8D27</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E02">fs_urd_handle</a>,x</span></td>
<td class="hex">9D 02 0E</td>
</tr>

<tr id="addr-8D2A">
<td class="addr"><a href="#addr-8D2A">8D2A</a></td>
<td><span class="label">.c8d2a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8D2B">
<td class="addr"><a href="#addr-8D2B">8D2B</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8D24">loop_c8d24</a></span></td>
<td class="hex">10 F7</td>
</tr>

<tr id="addr-8D2D">
<td class="addr"><a href="#addr-8D2D">8D2D</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8CFF">c8cff</a></span></td>
<td class="hex">90 D0</td>
</tr>

<tr id="addr-8D2F">
<td class="addr"><a href="#addr-8D2F">8D2F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0E05">fs_boot_option</a></span></td>
<td class="hex">AC 05 0E</td>
</tr>

<tr id="addr-8D32">
<td class="addr"><a href="#addr-8D32">8D32</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-8D02">boot_option_offsets</a>,y</span></td>
<td class="hex">BE 02 8D</td>
</tr>

<tr id="addr-8D35">
<td class="addr"><a href="#addr-8D35">8D35</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;8c</span></td>
<td class="hex">A0 8C</td>
</tr>

<tr id="addr-8D37">
<td class="addr"><a href="#addr-8D37">8D37</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-FFF7">oscli</a></span></td>
<td class="hex">4C F7 FF</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Option name strings</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Null-terminated strings for the four boot option names:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   &#34;Off&#34;, &#34;Load&#34;, &#34;Run&#34;, &#34;Exec&#34;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Used by cat_handler to display the current boot option setting.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D3A">
<td class="addr"><a href="#addr-8D3A">8D3A</a></td>
<td><span class="label">.option_name_strings</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Off&quot;</span></td>
<td class="hex">4F 66 66</td>
</tr>

<tr id="addr-8D3D">
<td class="addr"><a href="#addr-8D3D">8D3D</a></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr id="addr-8D3E">
<td class="addr"><a href="#addr-8D3E">8D3E</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Load&quot;</span></td>
<td class="hex">4C 6F 61 64</td>
</tr>

<tr id="addr-8D42">
<td class="addr"><a href="#addr-8D42">8D42</a></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr id="addr-8D43">
<td class="addr"><a href="#addr-8D43">8D43</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Run&quot;</span></td>
<td class="hex">52 75 6E</td>
</tr>

<tr id="addr-8D46">
<td class="addr"><a href="#addr-8D46">8D46</a></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr id="addr-8D47">
<td class="addr"><a href="#addr-8D47">8D47</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;Exec&quot;</span></td>
<td class="hex">45 78 65 63</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Option name offsets</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Four-byte table of offsets into option_name_strings:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   0, 4, 9, $0D — one per boot option value (0-3).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D4B">
<td class="addr"><a href="#addr-8D4B">8D4B</a></td>
<td><span class="label">.option_name_offsets</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;00, &amp;04, &amp;09, &amp;0D</td>
<td class="hex">00 04 09 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print reply buffer bytes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Prints Y characters from the FS reply buffer ($0F05+X) to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the screen via OSASCI. X = starting offset, Y = count.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Used by cat_handler to display directory and library names.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D4F">
<td class="addr"><a href="#addr-8D4F">8D4F</a></td>
<td><span class="label">.print_reply_bytes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0a</span></td>
<td class="hex">A0 0A</td>
</tr>

<tr id="addr-8D51">
<td class="addr"><a href="#addr-8D51">8D51</a></td>
<td><span class="label">.print_reply_counted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">BD 05 0F</td>
</tr>

<tr id="addr-8D54">
<td class="addr"><a href="#addr-8D54">8D54</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFE3">osasci</a></span>  <span class="comment">; Write character</span></td>
<td class="hex">20 E3 FF</td>
</tr>

<tr id="addr-8D57">
<td class="addr"><a href="#addr-8D57">8D57</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8D58">
<td class="addr"><a href="#addr-8D58">8D58</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8D59">
<td class="addr"><a href="#addr-8D59">8D59</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8D51">print_reply_counted</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-8D5B">
<td class="addr"><a href="#addr-8D5B">8D5B</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print spaces</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Prints X space characters via print_space. Used by cat_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to align columns in the directory listing.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D5C">
<td class="addr"><a href="#addr-8D5C">8D5C</a></td>
<td><span class="label">.print_spaces</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8640">print_space</a></span></td>
<td class="hex">20 40 86</td>
</tr>

<tr id="addr-8D5F">
<td class="addr"><a href="#addr-8D5F">8D5F</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8D60">
<td class="addr"><a href="#addr-8D60">8D60</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8D5C">print_spaces</a></span></td>
<td class="hex">D0 FA</td>
</tr>

<tr id="addr-8D62">
<td class="addr"><a href="#addr-8D62">8D62</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy filename to FS command buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Entry with X=0: copies from (fs_crc_lo),Y to $0F05+X until CR.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Used to place a filename into the FS command buffer before</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; sending to the fileserver. Falls through to copy_string_to_cmd.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D63">
<td class="addr"><a href="#addr-8D63">8D63</a></td>
<td><span class="label">.copy_filename</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy string to FS command buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Entry with X and Y specified: copies bytes from (fs_crc_lo),Y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to $0F05+X, stopping when a CR ($0D) is encountered. The CR</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; itself is also copied. Returns with X pointing past the last</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; byte written.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D65">
<td class="addr"><a href="#addr-8D65">8D65</a></td>
<td><span class="label">.copy_string_to_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8D67">
<td class="addr"><a href="#addr-8D67">8D67</a></td>
<td><span class="label">.copy_string_from_offset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">B1 BE</td>
</tr>

<tr id="addr-8D69">
<td class="addr"><a href="#addr-8D69">8D69</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">9D 05 0F</td>
</tr>

<tr id="addr-8D6C">
<td class="addr"><a href="#addr-8D6C">8D6C</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8D6D">
<td class="addr"><a href="#addr-8D6D">8D6D</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8D6E">
<td class="addr"><a href="#addr-8D6E">8D6E</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">49 0D</td>
</tr>

<tr id="addr-8D70">
<td class="addr"><a href="#addr-8D70">8D70</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8D67">copy_string_from_offset</a></span></td>
<td class="hex">D0 F5</td>
</tr>

<tr id="addr-8D72">
<td class="addr"><a href="#addr-8D72">8D72</a></td>
<td><span class="label">.return_6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print directory name from reply buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Prints characters from the FS reply buffer ($0F05+X onwards).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Null bytes ($00) are replaced with CR ($0D) for display.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stops when a byte with bit 7 set is encountered (high-bit</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; terminator). Used by cat_handler to display Dir. and Lib. paths.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D73">
<td class="addr"><a href="#addr-8D73">8D73</a></td>
<td><span class="label">.print_dir_name</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-8D75">
<td class="addr"><a href="#addr-8D75">8D75</a></td>
<td><span class="label">.print_dir_from_offset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0F05">fs_cmd_data</a>,x</span></td>
<td class="hex">BD 05 0F</td>
</tr>

<tr id="addr-8D78">
<td class="addr"><a href="#addr-8D78">8D78</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8D72">return_6</a></span></td>
<td class="hex">30 F8</td>
</tr>

<tr id="addr-8D7A">
<td class="addr"><a href="#addr-8D7A">8D7A</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8D7E">c8d7e</a></span></td>
<td class="hex">D0 02</td>
</tr>

<tr id="addr-8D7C">
<td class="addr"><a href="#addr-8D7C">8D7C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">A9 0D</td>
</tr>

<tr id="addr-8D7E">
<td class="addr"><a href="#addr-8D7E">8D7E</a></td>
<td><span class="label">.c8d7e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFE3">osasci</a></span>  <span class="comment">; Write character 13</span></td>
<td class="hex">20 E3 FF</td>
</tr>

<tr id="addr-8D81">
<td class="addr"><a href="#addr-8D81">8D81</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8D82">
<td class="addr"><a href="#addr-8D82">8D82</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8D75">print_dir_from_offset</a></span></td>
<td class="hex">D0 F1</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Send FS load-as-command and execute response</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets up an FS command with function code $05 (FCCMND: load as</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; command) using send_fs_examine. If a Tube co-processor is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; present (tx_in_progress != 0), transfers the response data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to the Tube via tube_addr_claim. Otherwise jumps via the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; indirect pointer at ($0F09) to execute at the load address.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8D84">
<td class="addr"><a href="#addr-8D84">8D84</a></td>
<td><span class="label">.notify_and_exec</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A2 0E</td>
</tr>

<tr id="addr-8D86">
<td class="addr"><a href="#addr-8D86">8D86</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00BC">fs_block_offset</a></span></td>
<td class="hex">86 BC</td>
</tr>

<tr id="addr-8D88">
<td class="addr"><a href="#addr-8D88">8D88</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;10</span></td>
<td class="hex">A9 10</td>
</tr>

<tr id="addr-8D8A">
<td class="addr"><a href="#addr-8D8A">8D8A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BB">fs_options</a></span></td>
<td class="hex">85 BB</td>
</tr>

<tr id="addr-8D8C">
<td class="addr"><a href="#addr-8D8C">8D8C</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;4a</span></td>
<td class="hex">A2 4A</td>
</tr>

<tr id="addr-8D8E">
<td class="addr"><a href="#addr-8D8E">8D8E</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#5</span></td>
<td class="hex">A0 05</td>
</tr>

<tr id="addr-8D90">
<td class="addr"><a href="#addr-8D90">8D90</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-86D0">send_fs_examine</a></span></td>
<td class="hex">20 D0 86</td>
</tr>

<tr id="addr-8D93">
<td class="addr"><a href="#addr-8D93">8D93</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D52">tx_in_progress</a></span></td>
<td class="hex">AD 52 0D</td>
</tr>

<tr id="addr-8D96">
<td class="addr"><a href="#addr-8D96">8D96</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8DAC">c8dac</a></span></td>
<td class="hex">F0 14</td>
</tr>

<tr id="addr-8D98">
<td class="addr"><a href="#addr-8D98">8D98</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-0F0B">l0f0b</a></span></td>
<td class="hex">6D 0B 0F</td>
</tr>

<tr id="addr-8D9B">
<td class="addr"><a href="#addr-8D9B">8D9B</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-0F0C">l0f0c</a></span></td>
<td class="hex">6D 0C 0F</td>
</tr>

<tr id="addr-8D9E">
<td class="addr"><a href="#addr-8D9E">8D9E</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8DAC">c8dac</a></span></td>
<td class="hex">B0 0C</td>
</tr>

<tr id="addr-8DA0">
<td class="addr"><a href="#addr-8DA0">8DA0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8B8A">tube_claim_loop</a></span></td>
<td class="hex">20 8A 8B</td>
</tr>

<tr id="addr-8DA3">
<td class="addr"><a href="#addr-8DA3">8DA3</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#9</span></td>
<td class="hex">A2 09</td>
</tr>

<tr id="addr-8DA5">
<td class="addr"><a href="#addr-8DA5">8DA5</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0f</span></td>
<td class="hex">A0 0F</td>
</tr>

<tr id="addr-8DA7">
<td class="addr"><a href="#addr-8DA7">8DA7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#4</span></td>
<td class="hex">A9 04</td>
</tr>

<tr id="addr-8DA9">
<td class="addr"><a href="#addr-8DA9">8DA9</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">4C 06 04</td>
</tr>

<tr id="addr-8DAC">
<td class="addr"><a href="#addr-8DAC">8DAC</a></td>
<td><span class="label">.c8dac</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand">(<a href="#addr-0F09">l0f09</a>)</span></td>
<td class="hex">6C 09 0F</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *NET1: read file handle from received packet</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads a file handle byte from offset $6F in the RX buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (net_rx_ptr), stores it in $F0, then falls through to the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; common handle workspace cleanup at c8dda (clear fs_temp_ce).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8DAF">
<td class="addr"><a href="#addr-8DAF">8DAF</a></td>
<td><span class="label">.net1_read_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;6f</span></td>
<td class="hex">A0 6F</td>
</tr>

<tr id="addr-8DB1">
<td class="addr"><a href="#addr-8DB1">8DB1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-8DB3">
<td class="addr"><a href="#addr-8DB3">8DB3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00F0">l00f0</a></span></td>
<td class="hex">85 F0</td>
</tr>

<tr id="addr-8DB5">
<td class="addr"><a href="#addr-8DB5">8DB5</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8DDA">c8dda</a></span></td>
<td class="hex">90 23</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Calculate handle workspace offset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Converts a file handle number (in A) to a byte offset (in Y)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; into the NFS handle workspace. The calculation is A*12:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   ASL A (A*2), ASL A (A*4), PHA, ASL A (A*8),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   ADC stack (A*8 + A*4 = A*12).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Validates that the offset is &lt; $48 (max 6 handles × 12 bytes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; per handle entry = 72 bytes). If invalid (&gt;= $48), returns</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; with C set and Y=0, A=0 as an error indicator.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8DB7">
<td class="addr"><a href="#addr-8DB7">8DB7</a></td>
<td><span class="label">.calc_handle_offset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-8DB8">
<td class="addr"><a href="#addr-8DB8">8DB8</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-8DB9">
<td class="addr"><a href="#addr-8DB9">8DB9</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8DBA">
<td class="addr"><a href="#addr-8DBA">8DBA</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-8DBB">
<td class="addr"><a href="#addr-8DBB">8DBB</a></td>
<td>    <span class="opcode">TSX</span></td>
<td class="hex">BA</td>
</tr>

<tr id="addr-8DBC">
<td class="addr"><a href="#addr-8DBC">8DBC</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-0101">l0101</a>,x</span></td>
<td class="hex">7D 01 01</td>
</tr>

<tr id="addr-8DBF">
<td class="addr"><a href="#addr-8DBF">8DBF</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8DC0">
<td class="addr"><a href="#addr-8DC0">8DC0</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8DC1">
<td class="addr"><a href="#addr-8DC1">8DC1</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;48</span></td>
<td class="hex">C9 48</td>
</tr>

<tr id="addr-8DC3">
<td class="addr"><a href="#addr-8DC3">8DC3</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8DC8">return_7</a></span></td>
<td class="hex">90 03</td>
</tr>

<tr id="addr-8DC5">
<td class="addr"><a href="#addr-8DC5">8DC5</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8DC7">
<td class="addr"><a href="#addr-8DC7">8DC7</a></td>
<td>    <span class="opcode">TYA</span>  <span class="comment">; A=&amp;00</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8DC8">
<td class="addr"><a href="#addr-8DC8">8DC8</a></td>
<td><span class="label">.return_7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *NET2: read handle entry from workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Looks up the handle in $F0 via calc_handle_offset. If the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; workspace slot contains $3F (&#39;?&#39;, meaning unused/closed),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; returns 0. Otherwise returns the stored handle value.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Clears fs_temp_ce on exit.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8DC9">
<td class="addr"><a href="#addr-8DC9">8DC9</a></td>
<td><span class="label">.net2_read_handle_entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00F0">l00f0</a></span></td>
<td class="hex">A5 F0</td>
</tr>

<tr id="addr-8DCB">
<td class="addr"><a href="#addr-8DCB">8DCB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8DB7">calc_handle_offset</a></span></td>
<td class="hex">20 B7 8D</td>
</tr>

<tr id="addr-8DCE">
<td class="addr"><a href="#addr-8DCE">8DCE</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8DD6">c8dd6</a></span></td>
<td class="hex">B0 06</td>
</tr>

<tr id="addr-8DD0">
<td class="addr"><a href="#addr-8DD0">8DD0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">B1 9E</td>
</tr>

<tr id="addr-8DD2">
<td class="addr"><a href="#addr-8DD2">8DD2</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">C9 3F</td>
</tr>

<tr id="addr-8DD4">
<td class="addr"><a href="#addr-8DD4">8DD4</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8DD8">c8dd8</a></span></td>
<td class="hex">D0 02</td>
</tr>

<tr id="addr-8DD6">
<td class="addr"><a href="#addr-8DD6">8DD6</a></td>
<td><span class="label">.c8dd6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-8DD8">
<td class="addr"><a href="#addr-8DD8">8DD8</a></td>
<td><span class="label">.c8dd8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00F0">l00f0</a></span></td>
<td class="hex">85 F0</td>
</tr>

<tr id="addr-8DDA">
<td class="addr"><a href="#addr-8DDA">8DDA</a></td>
<td><span class="label">.c8dda</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-8DDC">
<td class="addr"><a href="#addr-8DDC">8DDC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">85 CE</td>
</tr>

<tr id="addr-8DDE">
<td class="addr"><a href="#addr-8DDE">8DDE</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *NET3: close handle (mark as unused)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Looks up the handle in $F0 via calc_handle_offset. Writes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $3F (&#39;?&#39;) to mark the handle slot as closed in the NFS</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; workspace. Preserves the carry flag state across the write</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; using ROL/ROR on rx_status_flags. Clears fs_temp_ce on exit.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8DDF">
<td class="addr"><a href="#addr-8DDF">8DDF</a></td>
<td><span class="label">.net3_close_handle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00F0">l00f0</a></span></td>
<td class="hex">A5 F0</td>
</tr>

<tr id="addr-8DE1">
<td class="addr"><a href="#addr-8DE1">8DE1</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8DB7">calc_handle_offset</a></span></td>
<td class="hex">20 B7 8D</td>
</tr>

<tr id="addr-8DE4">
<td class="addr"><a href="#addr-8DE4">8DE4</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8DD6">c8dd6</a></span></td>
<td class="hex">B0 F0</td>
</tr>

<tr id="addr-8DE6">
<td class="addr"><a href="#addr-8DE6">8DE6</a></td>
<td>    <span class="opcode">ROL</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">2E 38 0D</td>
</tr>

<tr id="addr-8DE9">
<td class="addr"><a href="#addr-8DE9">8DE9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">A9 3F</td>
</tr>

<tr id="addr-8DEB">
<td class="addr"><a href="#addr-8DEB">8DEB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8DED">
<td class="addr"><a href="#addr-8DED">8DED</a></td>
<td>    <span class="opcode">ROR</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">6E 38 0D</td>
</tr>

<tr id="addr-8DF0">
<td class="addr"><a href="#addr-8DF0">8DF0</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8DDA">c8dda</a></span></td>
<td class="hex">90 E8</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; *NET4: resume after remote operation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Calls resume_after_remote ($8146) to re-enable the keyboard</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and send a completion notification. The BVC always branches</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to c8dda (clear fs_temp_ce) since resume_after_remote</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; returns with V clear (from CLV in prepare_cmd_clv).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8DF2">
<td class="addr"><a href="#addr-8DF2">8DF2</a></td>
<td><span class="label">.net4_resume_remote</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8146">resume_after_remote</a></span></td>
<td class="hex">20 46 81</td>
</tr>

<tr id="addr-8DF5">
<td class="addr"><a href="#addr-8DF5">8DF5</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-8DDA">c8dda</a></span></td>
<td class="hex">50 E3</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Filing system OSWORD entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Subtracts $0F from the command code in $EF, giving a 0-4 index</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; for OSWORD calls $0F-$13 (15-19). Falls through to the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; PHA/PHA/RTS dispatch at $8E01.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8DF7">
<td class="addr"><a href="#addr-8DF7">8DF7</a></td>
<td><span class="label">.osword_fs_entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00EF">l00ef</a></span>  <span class="comment">; Command code from $EF</span></td>
<td class="hex">A5 EF</td>
</tr>

<tr id="addr-8DF9">
<td class="addr"><a href="#addr-8DF9">8DF9</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">#&amp;0f</span>  <span class="comment">; Subtract $0F: OSWORD $0F-$13 become indices 0-4</span></td>
<td class="hex">E9 0F</td>
</tr>

<tr id="addr-8DFB">
<td class="addr"><a href="#addr-8DFB">8DFB</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8E32">return_8</a></span></td>
<td class="hex">30 35</td>
</tr>

<tr id="addr-8DFD">
<td class="addr"><a href="#addr-8DFD">8DFD</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#5</span></td>
<td class="hex">C9 05</td>
</tr>

<tr id="addr-8DFF">
<td class="addr"><a href="#addr-8DFF">8DFF</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8E32">return_8</a></span></td>
<td class="hex">B0 31</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; PHA/PHA/RTS dispatch for filing system OSWORDs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; X = OSWORD number - $0F (0-4). Dispatches via the 5-entry table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; at $8E18 (low) / $8E1D (high).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8E01">
<td class="addr"><a href="#addr-8E01">8E01</a></td>
<td><span class="label">.fs_osword_dispatch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8E02">
<td class="addr"><a href="#addr-8E02">8E02</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8E1D">fs_osword_tbl_hi</a>,x</span></td>
<td class="hex">BD 1D 8E</td>
</tr>

<tr id="addr-8E05">
<td class="addr"><a href="#addr-8E05">8E05</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8E06">
<td class="addr"><a href="#addr-8E06">8E06</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8E18">fs_osword_tbl_lo</a>,x</span></td>
<td class="hex">BD 18 8E</td>
</tr>

<tr id="addr-8E09">
<td class="addr"><a href="#addr-8E09">8E09</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8E0A">
<td class="addr"><a href="#addr-8E0A">8E0A</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr id="addr-8E0C">
<td class="addr"><a href="#addr-8E0C">8E0C</a></td>
<td><span class="label">.loop_c8e0c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a>,y</span></td>
<td class="hex">B9 BD 00</td>
</tr>

<tr id="addr-8E0F">
<td class="addr"><a href="#addr-8E0F">8E0F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-8E11">
<td class="addr"><a href="#addr-8E11">8E11</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8E12">
<td class="addr"><a href="#addr-8E12">8E12</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8E0C">loop_c8e0c</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-8E14">
<td class="addr"><a href="#addr-8E14">8E14</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8E15">
<td class="addr"><a href="#addr-8E15">8E15</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8E17">
<td class="addr"><a href="#addr-8E17">8E17</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-8E18">
<td class="addr"><a href="#addr-8E18">8E18</a></td>
<td><span class="label">.fs_osword_tbl_lo</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;32  <span class="comment">; Dispatch table: low bytes for OSWORD $0F-$13 handlers</span></td>
<td class="hex">32</td>
</tr>

<tr id="addr-8E19">
<td class="addr"><a href="#addr-8E19">8E19</a></td>
<td>    <span class="directive">EQUB</span> &amp;EF</td>
<td class="hex">EF</td>
</tr>

<tr id="addr-8E1A">
<td class="addr"><a href="#addr-8E1A">8E1A</a></td>
<td>    <span class="directive">EQUB</span> &amp;52</td>
<td class="hex">52</td>
</tr>

<tr id="addr-8E1B">
<td class="addr"><a href="#addr-8E1B">8E1B</a></td>
<td>    <span class="directive">EQUB</span> &amp;7A</td>
<td class="hex">7A</td>
</tr>

<tr id="addr-8E1C">
<td class="addr"><a href="#addr-8E1C">8E1C</a></td>
<td>    <span class="directive">EQUB</span> &amp;71</td>
<td class="hex">71</td>
</tr>

<tr id="addr-8E1D">
<td class="addr"><a href="#addr-8E1D">8E1D</a></td>
<td><span class="label">.fs_osword_tbl_hi</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;8E  <span class="comment">; Dispatch table: high bytes for OSWORD $0F-$13 handlers</span></td>
<td class="hex">8E</td>
</tr>

<tr id="addr-8E1E">
<td class="addr"><a href="#addr-8E1E">8E1E</a></td>
<td>    <span class="directive">EQUB</span> &amp;8E</td>
<td class="hex">8E</td>
</tr>

<tr id="addr-8E1F">
<td class="addr"><a href="#addr-8E1F">8E1F</a></td>
<td>    <span class="directive">EQUB</span> &amp;8E</td>
<td class="hex">8E</td>
</tr>

<tr id="addr-8E20">
<td class="addr"><a href="#addr-8E20">8E20</a></td>
<td>    <span class="directive">EQUB</span> &amp;8E</td>
<td class="hex">8E</td>
</tr>

<tr id="addr-8E21">
<td class="addr"><a href="#addr-8E21">8E21</a></td>
<td>    <span class="directive">EQUB</span> &amp;8F</td>
<td class="hex">8F</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Bidirectional block copy between OSWORD param block and workspace.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; C=1: copy X+1 bytes from ($F0),Y to (fs_crc_lo),Y (param to workspace)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; C=0: copy X+1 bytes from (fs_crc_lo),Y to ($F0),Y (workspace to param)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8E22">
<td class="addr"><a href="#addr-8E22">8E22</a></td>
<td><span class="label">.copy_param_block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8E2A">c8e2a</a></span></td>
<td class="hex">90 06</td>
</tr>

<tr id="addr-8E24">
<td class="addr"><a href="#addr-8E24">8E24</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8E26">
<td class="addr"><a href="#addr-8E26">8E26</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">91 BE</td>
</tr>

<tr id="addr-8E28">
<td class="addr"><a href="#addr-8E28">8E28</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8E2E">c8e2e</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">B0 04</td>
</tr>

<tr id="addr-8E2A">
<td class="addr"><a href="#addr-8E2A">8E2A</a></td>
<td><span class="label">.c8e2a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">B1 BE</td>
</tr>

<tr id="addr-8E2C">
<td class="addr"><a href="#addr-8E2C">8E2C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8E2E">
<td class="addr"><a href="#addr-8E2E">8E2E</a></td>
<td><span class="label">.c8e2e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8E2F">
<td class="addr"><a href="#addr-8E2F">8E2F</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8E30">
<td class="addr"><a href="#addr-8E30">8E30</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8E22">copy_param_block</a></span></td>
<td class="hex">10 F0</td>
</tr>

<tr id="addr-8E32">
<td class="addr"><a href="#addr-8E32">8E32</a></td>
<td><span class="label">.return_8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSWORD $0F handler: initiate transmit (CALLTX)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks the TX semaphore (TXCLR at $0D62) via ASL -- if carry is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; clear, a TX is already in progress and the call returns an error,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; preventing user code from corrupting a system transmit. Otherwise</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; copies 16 bytes from the caller&#39;s OSWORD parameter block into the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; user TX control block (UTXCB) in static workspace. The TXCB</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; pointer is copied to LTXCBP only after the semaphore is claimed,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ensuring the low-level transmit code (BRIANX) sees a consistent</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; pointer -- if copied before claiming, another transmitter could</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; modify TXCBP between the copy and the claim.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: parameter block address low byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: parameter block address high byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: corrupted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: corrupted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: $FF</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8E33">
<td class="addr"><a href="#addr-8E33">8E33</a></td>
<td><span class="label">.osword_0f_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ASL</span> <span class="operand"><a href="#addr-0D3A">tx_ctrl_status</a></span></td>
<td class="hex">0E 3A 0D</td>
</tr>

<tr id="addr-8E36">
<td class="addr"><a href="#addr-8E36">8E36</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8E4F">c8e4f</a></span></td>
<td class="hex">90 17</td>
</tr>

<tr id="addr-8E38">
<td class="addr"><a href="#addr-8E38">8E38</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009D">net_rx_ptr_hi</a></span></td>
<td class="hex">A5 9D</td>
</tr>

<tr id="addr-8E3A">
<td class="addr"><a href="#addr-8E3A">8E3A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BF">fs_crc_hi</a></span></td>
<td class="hex">85 BF</td>
</tr>

<tr id="addr-8E3C">
<td class="addr"><a href="#addr-8E3C">8E3C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A1">nmi_tx_block_hi</a></span></td>
<td class="hex">85 A1</td>
</tr>

<tr id="addr-8E3E">
<td class="addr"><a href="#addr-8E3E">8E3E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;6f</span></td>
<td class="hex">A9 6F</td>
</tr>

<tr id="addr-8E40">
<td class="addr"><a href="#addr-8E40">8E40</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">85 BE</td>
</tr>

<tr id="addr-8E42">
<td class="addr"><a href="#addr-8E42">8E42</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A0">nmi_tx_block</a></span></td>
<td class="hex">85 A0</td>
</tr>

<tr id="addr-8E44">
<td class="addr"><a href="#addr-8E44">8E44</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0f</span></td>
<td class="hex">A2 0F</td>
</tr>

<tr id="addr-8E46">
<td class="addr"><a href="#addr-8E46">8E46</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8E22">copy_param_block</a></span></td>
<td class="hex">20 22 8E</td>
</tr>

<tr id="addr-8E49">
<td class="addr"><a href="#addr-8E49">8E49</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9660">trampoline_tx_setup</a></span></td>
<td class="hex">20 60 96</td>
</tr>

<tr id="addr-8E4C">
<td class="addr"><a href="#addr-8E4C">8E4C</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8F48">c8f48</a></span></td>
<td class="hex">4C 48 8F</td>
</tr>

<tr id="addr-8E4F">
<td class="addr"><a href="#addr-8E4F">8E4F</a></td>
<td><span class="label">.c8e4f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8E50">
<td class="addr"><a href="#addr-8E50">8E50</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8E51">
<td class="addr"><a href="#addr-8E51">8E51</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8E75">c8e75</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">B0 22</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSWORD $11 handler: read JSR arguments (READRA)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies the JSR (remote procedure call) argument buffer from the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; static workspace page back to the caller&#39;s OSWORD parameter block.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the buffer size from workspace offset JSRSIZ, then copies</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; that many bytes. After the copy, clears the old LSTAT byte via</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; CLRJSR to reset the protection status. Also provides READRB as</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; a sub-entry ($8E6A) to return just the buffer size and args size</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; without copying the data.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8E53">
<td class="addr"><a href="#addr-8E53">8E53</a></td>
<td><span class="label">.osword_11_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009D">net_rx_ptr_hi</a></span></td>
<td class="hex">A5 9D</td>
</tr>

<tr id="addr-8E55">
<td class="addr"><a href="#addr-8E55">8E55</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BF">fs_crc_hi</a></span></td>
<td class="hex">85 BF</td>
</tr>

<tr id="addr-8E57">
<td class="addr"><a href="#addr-8E57">8E57</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A0 7F</td>
</tr>

<tr id="addr-8E59">
<td class="addr"><a href="#addr-8E59">8E59</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-8E5B">
<td class="addr"><a href="#addr-8E5B">8E5B</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;80</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8E5C">
<td class="addr"><a href="#addr-8E5C">8E5C</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">84 BE</td>
</tr>

<tr id="addr-8E5E">
<td class="addr"><a href="#addr-8E5E">8E5E</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8E5F">
<td class="addr"><a href="#addr-8E5F">8E5F</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8E60">
<td class="addr"><a href="#addr-8E60">8E60</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8E62">
<td class="addr"><a href="#addr-8E62">8E62</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8E22">copy_param_block</a></span></td>
<td class="hex">20 22 8E</td>
</tr>

<tr id="addr-8E65">
<td class="addr"><a href="#addr-8E65">8E65</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-92D6">clear_jsr_protection</a></span></td>
<td class="hex">20 D6 92</td>
</tr>

<tr id="addr-8E68">
<td class="addr"><a href="#addr-8E68">8E68</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8EAC">c8eac</a></span></td>
<td class="hex">90 42</td>
</tr>

<tr id="addr-8E6A">
<td class="addr"><a href="#addr-8E6A">8E6A</a></td>
<td><span class="label">.read_args_size</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A0 7F</td>
</tr>

<tr id="addr-8E6C">
<td class="addr"><a href="#addr-8E6C">8E6C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-8E6E">
<td class="addr"><a href="#addr-8E6E">8E6E</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8E70">
<td class="addr"><a href="#addr-8E70">8E70</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8E72">
<td class="addr"><a href="#addr-8E72">8E72</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;02</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8E73">
<td class="addr"><a href="#addr-8E73">8E73</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-8E75">
<td class="addr"><a href="#addr-8E75">8E75</a></td>
<td><span class="label">.c8e75</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8E77">
<td class="addr"><a href="#addr-8E77">8E77</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8EE1">c8ee1</a></span></td>
<td class="hex">B0 68</td>
</tr>

<tr id="addr-8E79">
<td class="addr"><a href="#addr-8E79">8E79</a></td>
<td><span class="label">.l8e79</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;FF, &amp;01</td>
<td class="hex">FF 01</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSWORD $12 handler: read/set state information (RS)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatches on the sub-function code (0-9):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   0: read FS station (FSLOCN at $0E00)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   1: set FS station</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   2: read printer server station (PSLOCN)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   3: set printer server station</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   4: read protection masks (LSTAT at $D63)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   5: set protection masks</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   6: read context handles (URD/CSD/LIB, converted from</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;      internal single-bit form back to handle numbers)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   7: set context handles (converted to internal form)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   8: read local station number</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   9: read JSR arguments buffer size</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Even-numbered sub-functions read; odd-numbered ones write.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Uses the bidirectional copy at $8E22 for station read/set.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8E7B">
<td class="addr"><a href="#addr-8E7B">8E7B</a></td>
<td><span class="label">.osword_12_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#6</span></td>
<td class="hex">C9 06</td>
</tr>

<tr id="addr-8E7D">
<td class="addr"><a href="#addr-8E7D">8E7D</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8EB7">c8eb7</a></span></td>
<td class="hex">B0 38</td>
</tr>

<tr id="addr-8E7F">
<td class="addr"><a href="#addr-8E7F">8E7F</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#4</span></td>
<td class="hex">C9 04</td>
</tr>

<tr id="addr-8E81">
<td class="addr"><a href="#addr-8E81">8E81</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8E9B">c8e9b</a></span></td>
<td class="hex">B0 18</td>
</tr>

<tr id="addr-8E83">
<td class="addr"><a href="#addr-8E83">8E83</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8E84">
<td class="addr"><a href="#addr-8E84">8E84</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">A2 0D</td>
</tr>

<tr id="addr-8E86">
<td class="addr"><a href="#addr-8E86">8E86</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-8E87">
<td class="addr"><a href="#addr-8E87">8E87</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8E8B">c8e8b</a></span></td>
<td class="hex">F0 02</td>
</tr>

<tr id="addr-8E89">
<td class="addr"><a href="#addr-8E89">8E89</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A6 9F</td>
</tr>

<tr id="addr-8E8B">
<td class="addr"><a href="#addr-8E8B">8E8B</a></td>
<td><span class="label">.c8e8b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00BF">fs_crc_hi</a></span></td>
<td class="hex">86 BF</td>
</tr>

<tr id="addr-8E8D">
<td class="addr"><a href="#addr-8E8D">8E8D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8E79">l8e79</a>,y</span></td>
<td class="hex">B9 79 8E</td>
</tr>

<tr id="addr-8E90">
<td class="addr"><a href="#addr-8E90">8E90</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">85 BE</td>
</tr>

<tr id="addr-8E92">
<td class="addr"><a href="#addr-8E92">8E92</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-8E94">
<td class="addr"><a href="#addr-8E94">8E94</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8E96">
<td class="addr"><a href="#addr-8E96">8E96</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8E22">copy_param_block</a></span></td>
<td class="hex">20 22 8E</td>
</tr>

<tr id="addr-8E99">
<td class="addr"><a href="#addr-8E99">8E99</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8EAC">c8eac</a></span></td>
<td class="hex">D0 11</td>
</tr>

<tr id="addr-8E9B">
<td class="addr"><a href="#addr-8E9B">8E9B</a></td>
<td><span class="label">.c8e9b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8E9C">
<td class="addr"><a href="#addr-8E9C">8E9C</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8E9D">
<td class="addr"><a href="#addr-8E9D">8E9D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8E9F">
<td class="addr"><a href="#addr-8E9F">8E9F</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8EA6">c8ea6</a></span></td>
<td class="hex">B0 05</td>
</tr>

<tr id="addr-8EA1">
<td class="addr"><a href="#addr-8EA1">8EA1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">AD 63 0D</td>
</tr>

<tr id="addr-8EA4">
<td class="addr"><a href="#addr-8EA4">8EA4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8EA6">
<td class="addr"><a href="#addr-8EA6">8EA6</a></td>
<td><span class="label">.c8ea6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">8D 63 0D</td>
</tr>

<tr id="addr-8EA9">
<td class="addr"><a href="#addr-8EA9">8EA9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3B">rx_ctrl_copy</a></span></td>
<td class="hex">8D 3B 0D</td>
</tr>

<tr id="addr-8EAC">
<td class="addr"><a href="#addr-8EAC">8EAC</a></td>
<td><span class="label">.c8eac</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-8EAD">
<td class="addr"><a href="#addr-8EAD">8EAD</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8EE1">c8ee1</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">B0 32</td>
</tr>

<tr id="addr-8EAF">
<td class="addr"><a href="#addr-8EAF">8EAF</a></td>
<td><span class="label">.loop_c8eaf</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D62">tx_clear_flag</a></span></td>
<td class="hex">AD 62 0D</td>
</tr>

<tr id="addr-8EB2">
<td class="addr"><a href="#addr-8EB2">8EB2</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8EB3">
<td class="addr"><a href="#addr-8EB3">8EB3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8EB5">
<td class="addr"><a href="#addr-8EB5">8EB5</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8EE1">c8ee1</a></span></td>
<td class="hex">B0 2A</td>
</tr>

<tr id="addr-8EB7">
<td class="addr"><a href="#addr-8EB7">8EB7</a></td>
<td><span class="label">.c8eb7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#8</span></td>
<td class="hex">C9 08</td>
</tr>

<tr id="addr-8EB9">
<td class="addr"><a href="#addr-8EB9">8EB9</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8EAF">loop_c8eaf</a></span></td>
<td class="hex">F0 F4</td>
</tr>

<tr id="addr-8EBB">
<td class="addr"><a href="#addr-8EBB">8EBB</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#9</span></td>
<td class="hex">C9 09</td>
</tr>

<tr id="addr-8EBD">
<td class="addr"><a href="#addr-8EBD">8EBD</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8E6A">read_args_size</a></span></td>
<td class="hex">F0 AB</td>
</tr>

<tr id="addr-8EBF">
<td class="addr"><a href="#addr-8EBF">8EBF</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8EDB">c8edb</a></span></td>
<td class="hex">10 1A</td>
</tr>

<tr id="addr-8EC1">
<td class="addr"><a href="#addr-8EC1">8EC1</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#3</span></td>
<td class="hex">A0 03</td>
</tr>

<tr id="addr-8EC3">
<td class="addr"><a href="#addr-8EC3">8EC3</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8EC4">
<td class="addr"><a href="#addr-8EC4">8EC4</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-8EE3">c8ee3</a></span></td>
<td class="hex">90 1D</td>
</tr>

<tr id="addr-8EC6">
<td class="addr"><a href="#addr-8EC6">8EC6</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">84 CD</td>
</tr>

<tr id="addr-8EC8">
<td class="addr"><a href="#addr-8EC8">8EC8</a></td>
<td><span class="label">.loop_c8ec8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">A4 CD</td>
</tr>

<tr id="addr-8ECA">
<td class="addr"><a href="#addr-8ECA">8ECA</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8ECC">
<td class="addr"><a href="#addr-8ECC">8ECC</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8588">handle_to_mask_a</a></span></td>
<td class="hex">20 88 85</td>
</tr>

<tr id="addr-8ECF">
<td class="addr"><a href="#addr-8ECF">8ECF</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-8ED0">
<td class="addr"><a href="#addr-8ED0">8ED0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">A4 CD</td>
</tr>

<tr id="addr-8ED2">
<td class="addr"><a href="#addr-8ED2">8ED2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0E01">fs_server_net</a>,y</span></td>
<td class="hex">99 01 0E</td>
</tr>

<tr id="addr-8ED5">
<td class="addr"><a href="#addr-8ED5">8ED5</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00CD">fs_temp_cd</a></span></td>
<td class="hex">C6 CD</td>
</tr>

<tr id="addr-8ED7">
<td class="addr"><a href="#addr-8ED7">8ED7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8EC8">loop_c8ec8</a></span></td>
<td class="hex">D0 EF</td>
</tr>

<tr id="addr-8ED9">
<td class="addr"><a href="#addr-8ED9">8ED9</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8F48">c8f48</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">F0 6D</td>
</tr>

<tr id="addr-8EDB">
<td class="addr"><a href="#addr-8EDB">8EDB</a></td>
<td><span class="label">.c8edb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8EDC">
<td class="addr"><a href="#addr-8EDC">8EDC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E09">fs_last_error</a></span></td>
<td class="hex">AD 09 0E</td>
</tr>

<tr id="addr-8EDF">
<td class="addr"><a href="#addr-8EDF">8EDF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8EE1">
<td class="addr"><a href="#addr-8EE1">8EE1</a></td>
<td><span class="label">.c8ee1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8F48">c8f48</a></span></td>
<td class="hex">B0 65</td>
</tr>

<tr id="addr-8EE3">
<td class="addr"><a href="#addr-8EE3">8EE3</a></td>
<td><span class="label">.c8ee3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0E01">fs_server_net</a>,y</span>  <span class="comment">; A=single-bit bitmask</span></td>
<td class="hex">B9 01 0E</td>
</tr>

<tr id="addr-8EE6">
<td class="addr"><a href="#addr-8EE6">8EE6</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-85A5">mask_to_handle</a></span>  <span class="comment">; Convert bitmask to handle number (FS2A)</span></td>
<td class="hex">20 A5 85</td>
</tr>

<tr id="addr-8EE9">
<td class="addr"><a href="#addr-8EE9">8EE9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span>  <span class="comment">; A=handle number ($20-$27) Y=preserved</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8EEB">
<td class="addr"><a href="#addr-8EEB">8EEB</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=parameter block address high byte</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8EEC">
<td class="addr"><a href="#addr-8EEC">8EEC</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8EE3">c8ee3</a></span></td>
<td class="hex">D0 F5</td>
</tr>

<tr id="addr-8EEE">
<td class="addr"><a href="#addr-8EEE">8EEE</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8F48">c8f48</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">F0 58</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSWORD $10 handler: open/read RX control block (OPENRX)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If the first byte of the caller&#39;s parameter block is zero, scans</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; for a free RXCB (flag byte = $3F = deleted) starting from RXCB #3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (RXCBs 0-2 are dedicated: printer, remote, FS). Returns the RXCB</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; number in the first byte, or zero if none free. If the first byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; is non-zero, reads the specified RXCB&#39;s data back into the caller&#39;s</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; parameter block (12 bytes) and then deletes the RXCB by setting</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; its flag byte to $3F -- a consume-once semantic so user code reads</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; received data and frees the CB in a single atomic operation,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; preventing double-reads. The low-level user RX flag (LFLAG) is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; temporarily disabled via ROR/ROL during the operation to prevent</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the interrupt-driven receive code from modifying a CB that is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; being read or opened.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: parameter block address low byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: parameter block address high byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: corrupted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: corrupted</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: $FF</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8EF0">
<td class="addr"><a href="#addr-8EF0">8EF0</a></td>
<td><span class="label">.osword_10_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A6 9F</td>
</tr>

<tr id="addr-8EF2">
<td class="addr"><a href="#addr-8EF2">8EF2</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-00BF">fs_crc_hi</a></span></td>
<td class="hex">86 BF</td>
</tr>

<tr id="addr-8EF4">
<td class="addr"><a href="#addr-8EF4">8EF4</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">84 BE</td>
</tr>

<tr id="addr-8EF6">
<td class="addr"><a href="#addr-8EF6">8EF6</a></td>
<td>    <span class="opcode">ROR</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">6E 38 0D</td>
</tr>

<tr id="addr-8EF9">
<td class="addr"><a href="#addr-8EF9">8EF9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8EFB">
<td class="addr"><a href="#addr-8EFB">8EFB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a></span></td>
<td class="hex">85 BD</td>
</tr>

<tr id="addr-8EFD">
<td class="addr"><a href="#addr-8EFD">8EFD</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F1A">c8f1a</a></span></td>
<td class="hex">D0 1B</td>
</tr>

<tr id="addr-8EFF">
<td class="addr"><a href="#addr-8EFF">8EFF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#3</span></td>
<td class="hex">A9 03</td>
</tr>

<tr id="addr-8F01">
<td class="addr"><a href="#addr-8F01">8F01</a></td>
<td><span class="label">.loop_c8f01</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8DB7">calc_handle_offset</a></span></td>
<td class="hex">20 B7 8D</td>
</tr>

<tr id="addr-8F04">
<td class="addr"><a href="#addr-8F04">8F04</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8F43">c8f43</a></span></td>
<td class="hex">B0 3D</td>
</tr>

<tr id="addr-8F06">
<td class="addr"><a href="#addr-8F06">8F06</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8F07">
<td class="addr"><a href="#addr-8F07">8F07</a></td>
<td>    <span class="opcode">LSR</span></td>
<td class="hex">4A</td>
</tr>

<tr id="addr-8F08">
<td class="addr"><a href="#addr-8F08">8F08</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8F09">
<td class="addr"><a href="#addr-8F09">8F09</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">B1 BE</td>
</tr>

<tr id="addr-8F0B">
<td class="addr"><a href="#addr-8F0B">8F0B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8F43">c8f43</a></span></td>
<td class="hex">F0 36</td>
</tr>

<tr id="addr-8F0D">
<td class="addr"><a href="#addr-8F0D">8F0D</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">C9 3F</td>
</tr>

<tr id="addr-8F0F">
<td class="addr"><a href="#addr-8F0F">8F0F</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8F15">c8f15</a></span></td>
<td class="hex">F0 04</td>
</tr>

<tr id="addr-8F11">
<td class="addr"><a href="#addr-8F11">8F11</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-8F12">
<td class="addr"><a href="#addr-8F12">8F12</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8F13">
<td class="addr"><a href="#addr-8F13">8F13</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F01">loop_c8f01</a></span></td>
<td class="hex">D0 EC</td>
</tr>

<tr id="addr-8F15">
<td class="addr"><a href="#addr-8F15">8F15</a></td>
<td><span class="label">.c8f15</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8F16">
<td class="addr"><a href="#addr-8F16">8F16</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-8F18">
<td class="addr"><a href="#addr-8F18">8F18</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>,x)</span></td>
<td class="hex">81 F0</td>
</tr>

<tr id="addr-8F1A">
<td class="addr"><a href="#addr-8F1A">8F1A</a></td>
<td><span class="label">.c8f1a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8DB7">calc_handle_offset</a></span></td>
<td class="hex">20 B7 8D</td>
</tr>

<tr id="addr-8F1D">
<td class="addr"><a href="#addr-8F1D">8F1D</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8F43">c8f43</a></span></td>
<td class="hex">B0 24</td>
</tr>

<tr id="addr-8F1F">
<td class="addr"><a href="#addr-8F1F">8F1F</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8F20">
<td class="addr"><a href="#addr-8F20">8F20</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">84 BE</td>
</tr>

<tr id="addr-8F22">
<td class="addr"><a href="#addr-8F22">8F22</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;c0</span></td>
<td class="hex">A9 C0</td>
</tr>

<tr id="addr-8F24">
<td class="addr"><a href="#addr-8F24">8F24</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8F26">
<td class="addr"><a href="#addr-8F26">8F26</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0b</span></td>
<td class="hex">A2 0B</td>
</tr>

<tr id="addr-8F28">
<td class="addr"><a href="#addr-8F28">8F28</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a></span></td>
<td class="hex">C4 BD</td>
</tr>

<tr id="addr-8F2A">
<td class="addr"><a href="#addr-8F2A">8F2A</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">71 BE</td>
</tr>

<tr id="addr-8F2C">
<td class="addr"><a href="#addr-8F2C">8F2C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8F31">c8f31</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-8F2E">
<td class="addr"><a href="#addr-8F2E">8F2E</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-8F3E">c8f3e</a></span></td>
<td class="hex">30 0E</td>
</tr>

<tr id="addr-8F30">
<td class="addr"><a href="#addr-8F30">8F30</a></td>
<td><span class="label">.loop_c8f30</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-8F31">
<td class="addr"><a href="#addr-8F31">8F31</a></td>
<td><span class="label">.c8f31</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8E22">copy_param_block</a></span></td>
<td class="hex">20 22 8E</td>
</tr>

<tr id="addr-8F34">
<td class="addr"><a href="#addr-8F34">8F34</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8F45">c8f45</a></span></td>
<td class="hex">B0 0F</td>
</tr>

<tr id="addr-8F36">
<td class="addr"><a href="#addr-8F36">8F36</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">A9 3F</td>
</tr>

<tr id="addr-8F38">
<td class="addr"><a href="#addr-8F38">8F38</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8F3A">
<td class="addr"><a href="#addr-8F3A">8F3A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00BE">fs_crc_lo</a>),y</span></td>
<td class="hex">91 BE</td>
</tr>

<tr id="addr-8F3C">
<td class="addr"><a href="#addr-8F3C">8F3C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F45">c8f45</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 07</td>
</tr>

<tr id="addr-8F3E">
<td class="addr"><a href="#addr-8F3E">8F3E</a></td>
<td><span class="label">.c8f3e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#1</span></td>
<td class="hex">69 01</td>
</tr>

<tr id="addr-8F40">
<td class="addr"><a href="#addr-8F40">8F40</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F30">loop_c8f30</a></span></td>
<td class="hex">D0 EE</td>
</tr>

<tr id="addr-8F42">
<td class="addr"><a href="#addr-8F42">8F42</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8F43">
<td class="addr"><a href="#addr-8F43">8F43</a></td>
<td><span class="label">.c8f43</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8F45">
<td class="addr"><a href="#addr-8F45">8F45</a></td>
<td><span class="label">.c8f45</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ROL</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">2E 38 0D</td>
</tr>

<tr id="addr-8F48">
<td class="addr"><a href="#addr-8F48">8F48</a></td>
<td><span class="label">.c8f48</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-8F4A">
<td class="addr"><a href="#addr-8F4A">8F4A</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00CE">fs_temp_ce</a></span></td>
<td class="hex">84 CE</td>
</tr>

<tr id="addr-8F4C">
<td class="addr"><a href="#addr-8F4C">8F4C</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr id="addr-8F4E">
<td class="addr"><a href="#addr-8F4E">8F4E</a></td>
<td><span class="label">.loop_c8f4e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-8F50">
<td class="addr"><a href="#addr-8F50">8F50</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00BD">fs_last_byte_flag</a>,y</span></td>
<td class="hex">99 BD 00</td>
</tr>

<tr id="addr-8F53">
<td class="addr"><a href="#addr-8F53">8F53</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8F54">
<td class="addr"><a href="#addr-8F54">8F54</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-8F4E">loop_c8f4e</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-8F56">
<td class="addr"><a href="#addr-8F56">8F56</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set up RX buffer pointers in NFS workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Calculates the start address of the RX data area ($F0+1) and stores</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; it at workspace offset $28. Also reads the data length from ($F0)+1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and adds it to $F0 to compute the end address at offset $2C.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8F57">
<td class="addr"><a href="#addr-8F57">8F57</a></td>
<td><span class="label">.setup_rx_buffer_ptrs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;28</span></td>
<td class="hex">A0 28</td>
</tr>

<tr id="addr-8F59">
<td class="addr"><a href="#addr-8F59">8F59</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00F0">l00f0</a></span></td>
<td class="hex">A5 F0</td>
</tr>

<tr id="addr-8F5B">
<td class="addr"><a href="#addr-8F5B">8F5B</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#1</span></td>
<td class="hex">69 01</td>
</tr>

<tr id="addr-8F5D">
<td class="addr"><a href="#addr-8F5D">8F5D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8F68">store_16bit_at_y</a></span></td>
<td class="hex">20 68 8F</td>
</tr>

<tr id="addr-8F60">
<td class="addr"><a href="#addr-8F60">8F60</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8F62">
<td class="addr"><a href="#addr-8F62">8F62</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8F64">
<td class="addr"><a href="#addr-8F64">8F64</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;2c</span></td>
<td class="hex">A0 2C</td>
</tr>

<tr id="addr-8F66">
<td class="addr"><a href="#addr-8F66">8F66</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00F0">l00f0</a></span></td>
<td class="hex">65 F0</td>
</tr>

<tr id="addr-8F68">
<td class="addr"><a href="#addr-8F68">8F68</a></td>
<td><span class="label">.store_16bit_at_y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8F6A">
<td class="addr"><a href="#addr-8F6A">8F6A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8F6B">
<td class="addr"><a href="#addr-8F6B">8F6B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00F1">l00f1</a></span></td>
<td class="hex">A5 F1</td>
</tr>

<tr id="addr-8F6D">
<td class="addr"><a href="#addr-8F6D">8F6D</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#0</span></td>
<td class="hex">69 00</td>
</tr>

<tr id="addr-8F6F">
<td class="addr"><a href="#addr-8F6F">8F6F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8F71">
<td class="addr"><a href="#addr-8F71">8F71</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Econet transmit/receive handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; A=0: Initialise TX control block from ROM template at $8310</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;      (zero entries substituted from NMI workspace $0DDA), transmit</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;      it, set up RX control block, and receive reply.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; A&gt;=1: Handle transmit result (branch to cleanup at $8F48).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-8F72">
<td class="addr"><a href="#addr-8F72">8F72</a></td>
<td><span class="label">.econet_tx_rx</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#1</span>  <span class="comment">; A=0: set up and transmit; A&gt;=1: handle result</span></td>
<td class="hex">C9 01</td>
</tr>

<tr id="addr-8F74">
<td class="addr"><a href="#addr-8F74">8F74</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-8FC0">c8fc0</a></span></td>
<td class="hex">B0 4A</td>
</tr>

<tr id="addr-8F76">
<td class="addr"><a href="#addr-8F76">8F76</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;2f</span></td>
<td class="hex">A0 2F</td>
</tr>

<tr id="addr-8F78">
<td class="addr"><a href="#addr-8F78">8F78</a></td>
<td><span class="label">.loop_c8f78</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8310">init_tx_ctrl_port</a>,y</span>  <span class="comment">; Load from ROM template (zero = use NMI workspace value)</span></td>
<td class="hex">B9 10 83</td>
</tr>

<tr id="addr-8F7B">
<td class="addr"><a href="#addr-8F7B">8F7B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F80">c8f80</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-8F7D">
<td class="addr"><a href="#addr-8F7D">8F7D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0DDA">l0dda</a>,y</span></td>
<td class="hex">B9 DA 0D</td>
</tr>

<tr id="addr-8F80">
<td class="addr"><a href="#addr-8F80">8F80</a></td>
<td><span class="label">.c8f80</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8F82">
<td class="addr"><a href="#addr-8F82">8F82</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8F83">
<td class="addr"><a href="#addr-8F83">8F83</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;23</span></td>
<td class="hex">C0 23</td>
</tr>

<tr id="addr-8F85">
<td class="addr"><a href="#addr-8F85">8F85</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F78">loop_c8f78</a></span></td>
<td class="hex">D0 F1</td>
</tr>

<tr id="addr-8F87">
<td class="addr"><a href="#addr-8F87">8F87</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8F88">
<td class="addr"><a href="#addr-8F88">8F88</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a></span></td>
<td class="hex">84 9A</td>
</tr>

<tr id="addr-8F8A">
<td class="addr"><a href="#addr-8F8A">8F8A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8F57">setup_rx_buffer_ptrs</a></span></td>
<td class="hex">20 57 8F</td>
</tr>

<tr id="addr-8F8D">
<td class="addr"><a href="#addr-8F8D">8F8D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr id="addr-8F8F">
<td class="addr"><a href="#addr-8F8F">8F8F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;90</span></td>
<td class="hex">A9 90</td>
</tr>

<tr id="addr-8F91">
<td class="addr"><a href="#addr-8F91">8F91</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8F93">
<td class="addr"><a href="#addr-8F93">8F93</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;03</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8F94">
<td class="addr"><a href="#addr-8F94">8F94</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;04</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8F95">
<td class="addr"><a href="#addr-8F95">8F95</a></td>
<td><span class="label">.loop_c8f95</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0DFE">l0dfe</a>,y</span></td>
<td class="hex">B9 FE 0D</td>
</tr>

<tr id="addr-8F98">
<td class="addr"><a href="#addr-8F98">8F98</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">91 F0</td>
</tr>

<tr id="addr-8F9A">
<td class="addr"><a href="#addr-8F9A">8F9A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8F9B">
<td class="addr"><a href="#addr-8F9B">8F9B</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#7</span></td>
<td class="hex">C0 07</td>
</tr>

<tr id="addr-8F9D">
<td class="addr"><a href="#addr-8F9D">8F9D</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F95">loop_c8f95</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-8F9F">
<td class="addr"><a href="#addr-8F9F">8F9F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A5 9F</td>
</tr>

<tr id="addr-8FA1">
<td class="addr"><a href="#addr-8FA1">8FA1</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-009B">net_tx_ptr_hi</a></span></td>
<td class="hex">85 9B</td>
</tr>

<tr id="addr-8FA3">
<td class="addr"><a href="#addr-8FA3">8FA3</a></td>
<td>    <span class="opcode">CLI</span>  <span class="comment">; Enable interrupts before transmit</span></td>
<td class="hex">58</td>
</tr>

<tr id="addr-8FA4">
<td class="addr"><a href="#addr-8FA4">8FA4</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-864E">tx_poll_timeout</a></span></td>
<td class="hex">20 4E 86</td>
</tr>

<tr id="addr-8FA7">
<td class="addr"><a href="#addr-8FA7">8FA7</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;2c</span></td>
<td class="hex">A0 2C</td>
</tr>

<tr id="addr-8FA9">
<td class="addr"><a href="#addr-8FA9">8FA9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span>  <span class="comment">; Dest station = $FFFF (accept reply from any station)</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-8FAB">
<td class="addr"><a href="#addr-8FAB">8FAB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8FAD">
<td class="addr"><a href="#addr-8FAD">8FAD</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;2d</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8FAE">
<td class="addr"><a href="#addr-8FAE">8FAE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8FB0">
<td class="addr"><a href="#addr-8FB0">8FB0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;25</span></td>
<td class="hex">A0 25</td>
</tr>

<tr id="addr-8FB2">
<td class="addr"><a href="#addr-8FB2">8FB2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;90</span></td>
<td class="hex">A9 90</td>
</tr>

<tr id="addr-8FB4">
<td class="addr"><a href="#addr-8FB4">8FB4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8FB6">
<td class="addr"><a href="#addr-8FB6">8FB6</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;24</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8FB7">
<td class="addr"><a href="#addr-8FB7">8FB7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A9 7F</td>
</tr>

<tr id="addr-8FB9">
<td class="addr"><a href="#addr-8FB9">8FB9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-8FBB">
<td class="addr"><a href="#addr-8FBB">8FBB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8448">send_to_fs_star</a></span>  <span class="comment">; Initiate receive with timeout</span></td>
<td class="hex">20 48 84</td>
</tr>

<tr id="addr-8FBE">
<td class="addr"><a href="#addr-8FBE">8FBE</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8F48">c8f48</a></span>  <span class="comment">; Non-zero = error/timeout: jump to cleanup</span></td>
<td class="hex">D0 88</td>
</tr>

<tr id="addr-8FC0">
<td class="addr"><a href="#addr-8FC0">8FC0</a></td>
<td><span class="label">.c8fc0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-8FC1">
<td class="addr"><a href="#addr-8FC1">8FC1</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-8FC3">
<td class="addr"><a href="#addr-8FC3">8FC3</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8FC5">
<td class="addr"><a href="#addr-8FC5">8FC5</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-8FC6">
<td class="addr"><a href="#addr-8FC6">8FC6</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;02</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8FC7">
<td class="addr"><a href="#addr-8FC7">8FC7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8FC9">
<td class="addr"><a href="#addr-8FC9">8FC9</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;03</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-8FCA">
<td class="addr"><a href="#addr-8FCA">8FCA</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">84 BE</td>
</tr>

<tr id="addr-8FCC">
<td class="addr"><a href="#addr-8FCC">8FCC</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;72</span></td>
<td class="hex">A0 72</td>
</tr>

<tr id="addr-8FCE">
<td class="addr"><a href="#addr-8FCE">8FCE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-8FD0">
<td class="addr"><a href="#addr-8FD0">8FD0</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;71</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-8FD1">
<td class="addr"><a href="#addr-8FD1">8FD1</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-8FD2">
<td class="addr"><a href="#addr-8FD2">8FD2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-8FD4">
<td class="addr"><a href="#addr-8FD4">8FD4</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-8FD5">
<td class="addr"><a href="#addr-8FD5">8FD5</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8FF5">c8ff5</a></span></td>
<td class="hex">D0 1E</td>
</tr>

<tr id="addr-8FD7">
<td class="addr"><a href="#addr-8FD7">8FD7</a></td>
<td><span class="label">.loop_c8fd7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span>  <span class="comment">; Receive data blocks until command byte = $00 or $0D</span></td>
<td class="hex">A4 BE</td>
</tr>

<tr id="addr-8FD9">
<td class="addr"><a href="#addr-8FD9">8FD9</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00BE">fs_crc_lo</a></span></td>
<td class="hex">E6 BE</td>
</tr>

<tr id="addr-8FDB">
<td class="addr"><a href="#addr-8FDB">8FDB</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-8FDD">
<td class="addr"><a href="#addr-8FDD">8FDD</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;7d</span></td>
<td class="hex">A0 7D</td>
</tr>

<tr id="addr-8FDF">
<td class="addr"><a href="#addr-8FDF">8FDF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-8FE1">
<td class="addr"><a href="#addr-8FE1">8FE1</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-8FE2">
<td class="addr"><a href="#addr-8FE2">8FE2</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9159">ctrl_block_setup_alt</a></span></td>
<td class="hex">20 59 91</td>
</tr>

<tr id="addr-8FE5">
<td class="addr"><a href="#addr-8FE5">8FE5</a></td>
<td>    <span class="opcode">CLI</span></td>
<td class="hex">58</td>
</tr>

<tr id="addr-8FE6">
<td class="addr"><a href="#addr-8FE6">8FE6</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8650">tx_poll_core</a></span>  <span class="comment">; Core transmit and poll routine (XMIT)</span></td>
<td class="hex">20 50 86</td>
</tr>

<tr id="addr-8FE9">
<td class="addr"><a href="#addr-8FE9">8FE9</a></td>
<td><span class="label">.loop_c8fe9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-8FEA">
<td class="addr"><a href="#addr-8FEA">8FEA</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8FE9">loop_c8fe9</a></span></td>
<td class="hex">D0 FD</td>
</tr>

<tr id="addr-8FEC">
<td class="addr"><a href="#addr-8FEC">8FEC</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-8FED">
<td class="addr"><a href="#addr-8FED">8FED</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-8FF3">c8ff3</a></span></td>
<td class="hex">F0 04</td>
</tr>

<tr id="addr-8FEF">
<td class="addr"><a href="#addr-8FEF">8FEF</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;0d</span>  <span class="comment">; Test for end-of-data marker ($0D)</span></td>
<td class="hex">49 0D</td>
</tr>

<tr id="addr-8FF1">
<td class="addr"><a href="#addr-8FF1">8FF1</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-8FD7">loop_c8fd7</a></span></td>
<td class="hex">D0 E4</td>
</tr>

<tr id="addr-8FF3">
<td class="addr"><a href="#addr-8FF3">8FF3</a></td>
<td><span class="label">.c8ff3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9004">c9004</a></span></td>
<td class="hex">F0 0F</td>
</tr>

<tr id="addr-8FF5">
<td class="addr"><a href="#addr-8FF5">8FF5</a></td>
<td><span class="label">.c8ff5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9159">ctrl_block_setup_alt</a></span></td>
<td class="hex">20 59 91</td>
</tr>

<tr id="addr-8FF8">
<td class="addr"><a href="#addr-8FF8">8FF8</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;7b</span></td>
<td class="hex">A0 7B</td>
</tr>

<tr id="addr-8FFA">
<td class="addr"><a href="#addr-8FFA">8FFA</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-8FFC">
<td class="addr"><a href="#addr-8FFC">8FFC</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#3</span></td>
<td class="hex">69 03</td>
</tr>

<tr id="addr-8FFE">
<td class="addr"><a href="#addr-8FFE">8FFE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-9000">
<td class="addr"><a href="#addr-9000">9000</a></td>
<td>    <span class="opcode">CLI</span></td>
<td class="hex">58</td>
</tr>

<tr id="addr-9001">
<td class="addr"><a href="#addr-9001">9001</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-864C">tx_poll_ff</a></span></td>
<td class="hex">20 4C 86</td>
</tr>

<tr id="addr-9004">
<td class="addr"><a href="#addr-9004">9004</a></td>
<td><span class="label">.c9004</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-8F48">c8f48</a></span></td>
<td class="hex">4C 48 8F</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NETVEC dispatch handler (ENTRY)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Indirected from NETVEC at $0224. Saves all registers and flags,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; retrieves the reason code from the stacked A, and dispatches to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; one of 9 handlers (codes 0-8) via the PHA/PHA/RTS trampoline at</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $9020. Reason codes &gt;= 9 are ignored.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Dispatch targets (from NFS09):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   0:   no-op (RTS)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   1-3: PRINT -- chars in printer buffer / Ctrl-B / Ctrl-C</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   4:   NWRCH -- write character to screen (net write char)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   5:   SELECT -- printer selection changed</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   6:   no-op (net read char -- not implemented)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   7:   NBYTE -- remote OSBYTE call</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   8:   NWORD -- remote OSWORD call</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: reason code (0-8)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: preserved</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9007">
<td class="addr"><a href="#addr-9007">9007</a></td>
<td><span class="label">.osword_dispatch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9008">
<td class="addr"><a href="#addr-9008">9008</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9009">
<td class="addr"><a href="#addr-9009">9009</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-900A">
<td class="addr"><a href="#addr-900A">900A</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-900B">
<td class="addr"><a href="#addr-900B">900B</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-900C">
<td class="addr"><a href="#addr-900C">900C</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-900D">
<td class="addr"><a href="#addr-900D">900D</a></td>
<td>    <span class="opcode">TSX</span></td>
<td class="hex">BA</td>
</tr>

<tr id="addr-900E">
<td class="addr"><a href="#addr-900E">900E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0103">l0103</a>,x</span>  <span class="comment">; Retrieve original A (function code) from stack</span></td>
<td class="hex">BD 03 01</td>
</tr>

<tr id="addr-9011">
<td class="addr"><a href="#addr-9011">9011</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#9</span></td>
<td class="hex">C9 09</td>
</tr>

<tr id="addr-9013">
<td class="addr"><a href="#addr-9013">9013</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9019">c9019</a></span></td>
<td class="hex">B0 04</td>
</tr>

<tr id="addr-9015">
<td class="addr"><a href="#addr-9015">9015</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9016">
<td class="addr"><a href="#addr-9016">9016</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9020">osword_trampoline</a></span></td>
<td class="hex">20 20 90</td>
</tr>

<tr id="addr-9019">
<td class="addr"><a href="#addr-9019">9019</a></td>
<td><span class="label">.c9019</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-901A">
<td class="addr"><a href="#addr-901A">901A</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-901B">
<td class="addr"><a href="#addr-901B">901B</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-901C">
<td class="addr"><a href="#addr-901C">901C</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-901D">
<td class="addr"><a href="#addr-901D">901D</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-901E">
<td class="addr"><a href="#addr-901E">901E</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-901F">
<td class="addr"><a href="#addr-901F">901F</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-9020">
<td class="addr"><a href="#addr-9020">9020</a></td>
<td><span class="label">.osword_trampoline</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9034">osword_tbl_hi</a>,x</span>  <span class="comment">; PHA/PHA/RTS trampoline: push handler addr-1, RTS jumps to it</span></td>
<td class="hex">BD 34 90</td>
</tr>

<tr id="addr-9023">
<td class="addr"><a href="#addr-9023">9023</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9024">
<td class="addr"><a href="#addr-9024">9024</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-902B">osword_tbl_lo</a>,x</span></td>
<td class="hex">BD 2B 90</td>
</tr>

<tr id="addr-9027">
<td class="addr"><a href="#addr-9027">9027</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9028">
<td class="addr"><a href="#addr-9028">9028</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00EF">l00ef</a></span></td>
<td class="hex">A5 EF</td>
</tr>

<tr id="addr-902A">
<td class="addr"><a href="#addr-902A">902A</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-902B">
<td class="addr"><a href="#addr-902B">902B</a></td>
<td><span class="label">.osword_tbl_lo</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;44</td>
<td class="hex">44</td>
</tr>

<tr id="addr-902C">
<td class="addr"><a href="#addr-902C">902C</a></td>
<td>    <span class="directive">EQUB</span> &amp;C6</td>
<td class="hex">C6</td>
</tr>

<tr id="addr-902D">
<td class="addr"><a href="#addr-902D">902D</a></td>
<td>    <span class="directive">EQUB</span> &amp;C6</td>
<td class="hex">C6</td>
</tr>

<tr id="addr-902E">
<td class="addr"><a href="#addr-902E">902E</a></td>
<td>    <span class="directive">EQUB</span> &amp;C6</td>
<td class="hex">C6</td>
</tr>

<tr id="addr-902F">
<td class="addr"><a href="#addr-902F">902F</a></td>
<td>    <span class="directive">EQUB</span> &amp;3C</td>
<td class="hex">3C</td>
</tr>

<tr id="addr-9030">
<td class="addr"><a href="#addr-9030">9030</a></td>
<td>    <span class="directive">EQUB</span> &amp;B4</td>
<td class="hex">B4</td>
</tr>

<tr id="addr-9031">
<td class="addr"><a href="#addr-9031">9031</a></td>
<td>    <span class="directive">EQUB</span> &amp;44</td>
<td class="hex">44</td>
</tr>

<tr id="addr-9032">
<td class="addr"><a href="#addr-9032">9032</a></td>
<td>    <span class="directive">EQUB</span> &amp;62</td>
<td class="hex">62</td>
</tr>

<tr id="addr-9033">
<td class="addr"><a href="#addr-9033">9033</a></td>
<td>    <span class="directive">EQUB</span> &amp;CC</td>
<td class="hex">CC</td>
</tr>

<tr id="addr-9034">
<td class="addr"><a href="#addr-9034">9034</a></td>
<td><span class="label">.osword_tbl_hi</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-9035">
<td class="addr"><a href="#addr-9035">9035</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-9036">
<td class="addr"><a href="#addr-9036">9036</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-9037">
<td class="addr"><a href="#addr-9037">9037</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-9038">
<td class="addr"><a href="#addr-9038">9038</a></td>
<td>    <span class="directive">EQUB</span> &amp;90</td>
<td class="hex">90</td>
</tr>

<tr id="addr-9039">
<td class="addr"><a href="#addr-9039">9039</a></td>
<td>    <span class="directive">EQUB</span> &amp;91</td>
<td class="hex">91</td>
</tr>

<tr id="addr-903A">
<td class="addr"><a href="#addr-903A">903A</a></td>
<td>    <span class="directive">EQUB</span> &amp;81</td>
<td class="hex">81</td>
</tr>

<tr id="addr-903B">
<td class="addr"><a href="#addr-903B">903B</a></td>
<td>    <span class="directive">EQUB</span> &amp;90</td>
<td class="hex">90</td>
</tr>

<tr id="addr-903C">
<td class="addr"><a href="#addr-903C">903C</a></td>
<td>    <span class="directive">EQUB</span> &amp;90</td>
<td class="hex">90</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Fn 4: net write character (NWRCH)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Writes a character (passed in Y) to the screen via OSWRITCH.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Before the write, uses TSX to reach into the stack and zero the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; carry flag in the caller&#39;s saved processor status byte -- ROR</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; followed by ASL on the stacked P byte ($0106,X) shifts carry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; out and back in as zero. This ensures the calling code&#39;s PLP</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; restores carry=0, signalling &#34;character accepted&#34; without needing</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; a separate CLC/PHP sequence. A classic 6502 trick for modifying</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; return flags without touching the actual processor status.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Entry:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: character to write</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On Exit:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     A: $3F</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     X: 0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     Y: 0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ***************************************************************************************</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-903D">
<td class="addr"><a href="#addr-903D">903D</a></td>
<td><span class="label">.net_write_char</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TSX</span></td>
<td class="hex">BA</td>
</tr>

<tr id="addr-903E">
<td class="addr"><a href="#addr-903E">903E</a></td>
<td>    <span class="opcode">ROR</span> <span class="operand"><a href="#addr-0106">l0106</a>,x</span>  <span class="comment">; ROR/ASL on stacked P: zeros carry to signal success</span></td>
<td class="hex">7E 06 01</td>
</tr>

<tr id="addr-9041">
<td class="addr"><a href="#addr-9041">9041</a></td>
<td>    <span class="opcode">ASL</span> <span class="operand"><a href="#addr-0106">l0106</a>,x</span></td>
<td class="hex">1E 06 01</td>
</tr>

<tr id="addr-9044">
<td class="addr"><a href="#addr-9044">9044</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-9045">
<td class="addr"><a href="#addr-9045">9045</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;da</span></td>
<td class="hex">A0 DA</td>
</tr>

<tr id="addr-9047">
<td class="addr"><a href="#addr-9047">9047</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-9049">
<td class="addr"><a href="#addr-9049">9049</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Set up TX control block and send</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Builds a TX control block at (nfs_workspace)+$0C from the current</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; workspace state, then initiates transmission via the ADLC TX path.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; This is the common send routine used after command data has been</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; prepared. The exact control block layout and field mapping need</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; further analysis.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-904B">
<td class="addr"><a href="#addr-904B">904B</a></td>
<td><span class="label">.setup_tx_and_send</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;d9</span></td>
<td class="hex">A0 D9</td>
</tr>

<tr id="addr-904D">
<td class="addr"><a href="#addr-904D">904D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-904F">
<td class="addr"><a href="#addr-904F">904F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-9051">
<td class="addr"><a href="#addr-9051">9051</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">A0 0C</td>
</tr>

<tr id="addr-9053">
<td class="addr"><a href="#addr-9053">9053</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-9055">
<td class="addr"><a href="#addr-9055">9055</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a></span></td>
<td class="hex">84 9A</td>
</tr>

<tr id="addr-9057">
<td class="addr"><a href="#addr-9057">9057</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A6 9F</td>
</tr>

<tr id="addr-9059">
<td class="addr"><a href="#addr-9059">9059</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-009B">net_tx_ptr_hi</a></span></td>
<td class="hex">86 9B</td>
</tr>

<tr id="addr-905B">
<td class="addr"><a href="#addr-905B">905B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-864C">tx_poll_ff</a></span></td>
<td class="hex">20 4C 86</td>
</tr>

<tr id="addr-905E">
<td class="addr"><a href="#addr-905E">905E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;3f</span></td>
<td class="hex">A9 3F</td>
</tr>

<tr id="addr-9060">
<td class="addr"><a href="#addr-9060">9060</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>,x)</span></td>
<td class="hex">81 9A</td>
</tr>

<tr id="addr-9062">
<td class="addr"><a href="#addr-9062">9062</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Fn 7: remote OSBYTE handler (NBYTE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Full RPC mechanism for OSBYTE calls across the network. When a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; machine is remoted, OSBYTE/OSWORD calls that affect terminal-side</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; hardware (keyboard scanning, flash rates, etc.) must be indirected</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; across the net. OSBYTE calls are classified into three categories:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Y&gt;0 (NCTBPL table): executed on BOTH machines (flash rates etc.)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Y&lt;0 (NCTBMI table): executed on terminal only, result sent back</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   Y=0: not recognised, passed through unhandled</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Results returned via stack manipulation: the saved processor status</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; byte at $0106 has V-flag (bit 6) forced on to tell the MOS the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; call was claimed (preventing dispatch to other ROMs), and the I-bit</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (bit 2) forced on to disable interrupts during register restoration,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; preventing race conditions. The carry flag in the saved P is also</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; manipulated via ROR/ASL to zero it, signaling success to the caller.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; OSBYTE $81 (INKEY) gets special handling as it must read the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; terminal&#39;s keyboard.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9063">
<td class="addr"><a href="#addr-9063">9063</a></td>
<td><span class="label">.remote_cmd_dispatch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00F1">l00f1</a></span></td>
<td class="hex">A4 F1</td>
</tr>

<tr id="addr-9065">
<td class="addr"><a href="#addr-9065">9065</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;81</span></td>
<td class="hex">C9 81</td>
</tr>

<tr id="addr-9067">
<td class="addr"><a href="#addr-9067">9067</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-907C">c907c</a></span></td>
<td class="hex">F0 13</td>
</tr>

<tr id="addr-9069">
<td class="addr"><a href="#addr-9069">9069</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-906B">
<td class="addr"><a href="#addr-906B">906B</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#7</span></td>
<td class="hex">A2 07</td>
</tr>

<tr id="addr-906D">
<td class="addr"><a href="#addr-906D">906D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-90B5">match_osbyte_code</a></span></td>
<td class="hex">20 B5 90</td>
</tr>

<tr id="addr-9070">
<td class="addr"><a href="#addr-9070">9070</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-907C">c907c</a></span></td>
<td class="hex">F0 0A</td>
</tr>

<tr id="addr-9072">
<td class="addr"><a href="#addr-9072">9072</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9073">
<td class="addr"><a href="#addr-9073">9073</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9074">
<td class="addr"><a href="#addr-9074">9074</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A2 0E</td>
</tr>

<tr id="addr-9076">
<td class="addr"><a href="#addr-9076">9076</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-90B5">match_osbyte_code</a></span></td>
<td class="hex">20 B5 90</td>
</tr>

<tr id="addr-9079">
<td class="addr"><a href="#addr-9079">9079</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-907C">c907c</a></span></td>
<td class="hex">F0 01</td>
</tr>

<tr id="addr-907B">
<td class="addr"><a href="#addr-907B">907B</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-907C">
<td class="addr"><a href="#addr-907C">907C</a></td>
<td><span class="label">.c907c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-907E">
<td class="addr"><a href="#addr-907E">907E</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-907F">
<td class="addr"><a href="#addr-907F">907F</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-90B4">return_9</a></span></td>
<td class="hex">F0 33</td>
</tr>

<tr id="addr-9081">
<td class="addr"><a href="#addr-9081">9081</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9082">
<td class="addr"><a href="#addr-9082">9082</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9085">c9085</a></span></td>
<td class="hex">10 01</td>
</tr>

<tr id="addr-9084">
<td class="addr"><a href="#addr-9084">9084</a></td>
<td>    <span class="opcode">INX</span>  <span class="comment">; X=&amp;03</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-9085">
<td class="addr"><a href="#addr-9085">9085</a></td>
<td><span class="label">.c9085</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;dc</span></td>
<td class="hex">A0 DC</td>
</tr>

<tr id="addr-9087">
<td class="addr"><a href="#addr-9087">9087</a></td>
<td><span class="label">.loop_c9087</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0015">l0015</a>,y</span></td>
<td class="hex">B9 15 00</td>
</tr>

<tr id="addr-908A">
<td class="addr"><a href="#addr-908A">908A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-908C">
<td class="addr"><a href="#addr-908C">908C</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-908D">
<td class="addr"><a href="#addr-908D">908D</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;da</span></td>
<td class="hex">C0 DA</td>
</tr>

<tr id="addr-908F">
<td class="addr"><a href="#addr-908F">908F</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9087">loop_c9087</a></span></td>
<td class="hex">10 F6</td>
</tr>

<tr id="addr-9091">
<td class="addr"><a href="#addr-9091">9091</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-9092">
<td class="addr"><a href="#addr-9092">9092</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-904B">setup_tx_and_send</a></span></td>
<td class="hex">20 4B 90</td>
</tr>

<tr id="addr-9095">
<td class="addr"><a href="#addr-9095">9095</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9096">
<td class="addr"><a href="#addr-9096">9096</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-90B4">return_9</a></span></td>
<td class="hex">10 1C</td>
</tr>

<tr id="addr-9098">
<td class="addr"><a href="#addr-9098">9098</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A9 7F</td>
</tr>

<tr id="addr-909A">
<td class="addr"><a href="#addr-909A">909A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>,x)</span></td>
<td class="hex">81 9A</td>
</tr>

<tr id="addr-909C">
<td class="addr"><a href="#addr-909C">909C</a></td>
<td><span class="label">.loop_c909c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>,x)</span></td>
<td class="hex">A1 9A</td>
</tr>

<tr id="addr-909E">
<td class="addr"><a href="#addr-909E">909E</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-909C">loop_c909c</a></span></td>
<td class="hex">10 FC</td>
</tr>

<tr id="addr-90A0">
<td class="addr"><a href="#addr-90A0">90A0</a></td>
<td>    <span class="opcode">TSX</span></td>
<td class="hex">BA</td>
</tr>

<tr id="addr-90A1">
<td class="addr"><a href="#addr-90A1">90A1</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;dd</span></td>
<td class="hex">A0 DD</td>
</tr>

<tr id="addr-90A3">
<td class="addr"><a href="#addr-90A3">90A3</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">B1 9E</td>
</tr>

<tr id="addr-90A5">
<td class="addr"><a href="#addr-90A5">90A5</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;44</span></td>
<td class="hex">09 44</td>
</tr>

<tr id="addr-90A7">
<td class="addr"><a href="#addr-90A7">90A7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-90AD">c90ad</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-90A9">
<td class="addr"><a href="#addr-90A9">90A9</a></td>
<td><span class="label">.loop_c90a9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-90AA">
<td class="addr"><a href="#addr-90AA">90AA</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-90AB">
<td class="addr"><a href="#addr-90AB">90AB</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">B1 9E</td>
</tr>

<tr id="addr-90AD">
<td class="addr"><a href="#addr-90AD">90AD</a></td>
<td><span class="label">.c90ad</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0106">l0106</a>,x</span></td>
<td class="hex">9D 06 01</td>
</tr>

<tr id="addr-90B0">
<td class="addr"><a href="#addr-90B0">90B0</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;da</span></td>
<td class="hex">C0 DA</td>
</tr>

<tr id="addr-90B2">
<td class="addr"><a href="#addr-90B2">90B2</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-90A9">loop_c90a9</a></span></td>
<td class="hex">D0 F5</td>
</tr>

<tr id="addr-90B4">
<td class="addr"><a href="#addr-90B4">90B4</a></td>
<td><span class="label">.return_9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-90B5">
<td class="addr"><a href="#addr-90B5">90B5</a></td>
<td><span class="label">.match_osbyte_code</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-90BE">l90be</a>,x</span></td>
<td class="hex">DD BE 90</td>
</tr>

<tr id="addr-90B8">
<td class="addr"><a href="#addr-90B8">90B8</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-90BD">return_10</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-90BA">
<td class="addr"><a href="#addr-90BA">90BA</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-90BB">
<td class="addr"><a href="#addr-90BB">90BB</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-90B5">match_osbyte_code</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-90BD">
<td class="addr"><a href="#addr-90BD">90BD</a></td>
<td><span class="label">.return_10</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-90BE">
<td class="addr"><a href="#addr-90BE">90BE</a></td>
<td><span class="label">.l90be</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;04, &amp;09, &amp;0A, &amp;14, &amp;9A, &amp;9B, &amp;9C, &amp;E2, &amp;0B, &amp;0C, &amp;0F, &amp;79, &amp;7A, &amp;E3, &amp;E4</td>
<td class="hex">04 09 0A 14 9A 9B 9C E2 0B 0C 0F 79 7A E3 E4</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Fn 8: remote OSWORD handler (NWORD)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Only intercepts OSWORD 7 (make a sound) and OSWORD 8 (define an</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; envelope). Unlike NBYTE which returns results, NWORD is entirely</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fire-and-forget — no return path is implemented. The developer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; explicitly noted this was acceptable since sound/envelope commands</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; don&#39;t return meaningful results. Copies up to 14 parameter bytes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; from the RX buffer to workspace, tags the message as RWORD, and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; transmits.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-90CD">
<td class="addr"><a href="#addr-90CD">90CD</a></td>
<td><span class="label">.remote_cmd_data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A0 0E</td>
</tr>

<tr id="addr-90CF">
<td class="addr"><a href="#addr-90CF">90CF</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#7</span></td>
<td class="hex">C9 07</td>
</tr>

<tr id="addr-90D1">
<td class="addr"><a href="#addr-90D1">90D1</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-90D7">c90d7</a></span></td>
<td class="hex">F0 04</td>
</tr>

<tr id="addr-90D3">
<td class="addr"><a href="#addr-90D3">90D3</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#8</span></td>
<td class="hex">C9 08</td>
</tr>

<tr id="addr-90D5">
<td class="addr"><a href="#addr-90D5">90D5</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-90FB">return_11</a></span></td>
<td class="hex">D0 24</td>
</tr>

<tr id="addr-90D7">
<td class="addr"><a href="#addr-90D7">90D7</a></td>
<td><span class="label">.c90d7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;db</span></td>
<td class="hex">A2 DB</td>
</tr>

<tr id="addr-90D9">
<td class="addr"><a href="#addr-90D9">90D9</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">86 9E</td>
</tr>

<tr id="addr-90DB">
<td class="addr"><a href="#addr-90DB">90DB</a></td>
<td><span class="label">.loop_c90db</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00F0">l00f0</a>),y</span></td>
<td class="hex">B1 F0</td>
</tr>

<tr id="addr-90DD">
<td class="addr"><a href="#addr-90DD">90DD</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-90DF">
<td class="addr"><a href="#addr-90DF">90DF</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-90E0">
<td class="addr"><a href="#addr-90E0">90E0</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-90DB">loop_c90db</a></span></td>
<td class="hex">10 F9</td>
</tr>

<tr id="addr-90E2">
<td class="addr"><a href="#addr-90E2">90E2</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-90E3">
<td class="addr"><a href="#addr-90E3">90E3</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">C6 9E</td>
</tr>

<tr id="addr-90E5">
<td class="addr"><a href="#addr-90E5">90E5</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00EF">l00ef</a></span></td>
<td class="hex">A5 EF</td>
</tr>

<tr id="addr-90E7">
<td class="addr"><a href="#addr-90E7">90E7</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-90E9">
<td class="addr"><a href="#addr-90E9">90E9</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">84 9E</td>
</tr>

<tr id="addr-90EB">
<td class="addr"><a href="#addr-90EB">90EB</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;14</span></td>
<td class="hex">A0 14</td>
</tr>

<tr id="addr-90ED">
<td class="addr"><a href="#addr-90ED">90ED</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e9</span></td>
<td class="hex">A9 E9</td>
</tr>

<tr id="addr-90EF">
<td class="addr"><a href="#addr-90EF">90EF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-90F1">
<td class="addr"><a href="#addr-90F1">90F1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-90F3">
<td class="addr"><a href="#addr-90F3">90F3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-904B">setup_tx_and_send</a></span></td>
<td class="hex">20 4B 90</td>
</tr>

<tr id="addr-90F6">
<td class="addr"><a href="#addr-90F6">90F6</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">86 9E</td>
</tr>

<tr id="addr-90F8">
<td class="addr"><a href="#addr-90F8">90F8</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9159">ctrl_block_setup_alt</a></span></td>
<td class="hex">20 59 91</td>
</tr>

<tr id="addr-90FB">
<td class="addr"><a href="#addr-90FB">90FB</a></td>
<td><span class="label">.return_11</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Remote boot/execute handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Validates byte 4 of the RX control block (must be zero), copies the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 2-byte execution address from RX offsets $80/$81 into NFS workspace,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; sets up a control block, disables keyboard (OSBYTE $C9), then falls</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; through to execute_at_0100.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-90FC">
<td class="addr"><a href="#addr-90FC">90FC</a></td>
<td><span class="label">.remote_boot_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-90FE">
<td class="addr"><a href="#addr-90FE">90FE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-9100">
<td class="addr"><a href="#addr-9100">9100</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9105">c9105</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-9102">
<td class="addr"><a href="#addr-9102">9102</a></td>
<td><span class="label">.c9102</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-92D6">clear_jsr_protection</a></span></td>
<td class="hex">4C D6 92</td>
</tr>

<tr id="addr-9105">
<td class="addr"><a href="#addr-9105">9105</a></td>
<td><span class="label">.c9105</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#9</span></td>
<td class="hex">09 09</td>
</tr>

<tr id="addr-9107">
<td class="addr"><a href="#addr-9107">9107</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-9109">
<td class="addr"><a href="#addr-9109">9109</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A2 80</td>
</tr>

<tr id="addr-910B">
<td class="addr"><a href="#addr-910B">910B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A0 80</td>
</tr>

<tr id="addr-910D">
<td class="addr"><a href="#addr-910D">910D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-910F">
<td class="addr"><a href="#addr-910F">910F</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9110">
<td class="addr"><a href="#addr-9110">9110</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;81</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9111">
<td class="addr"><a href="#addr-9111">9111</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-9113">
<td class="addr"><a href="#addr-9113">9113</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0f</span></td>
<td class="hex">A0 0F</td>
</tr>

<tr id="addr-9115">
<td class="addr"><a href="#addr-9115">9115</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-9117">
<td class="addr"><a href="#addr-9117">9117</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;0e</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9118">
<td class="addr"><a href="#addr-9118">9118</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9119">
<td class="addr"><a href="#addr-9119">9119</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-911B">
<td class="addr"><a href="#addr-911B">911B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-815C">clear_osbyte_ce_cf</a></span></td>
<td class="hex">20 5C 81</td>
</tr>

<tr id="addr-911E">
<td class="addr"><a href="#addr-911E">911E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9162">ctrl_block_setup</a></span></td>
<td class="hex">20 62 91</td>
</tr>

<tr id="addr-9121">
<td class="addr"><a href="#addr-9121">9121</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#1</span></td>
<td class="hex">A2 01</td>
</tr>

<tr id="addr-9123">
<td class="addr"><a href="#addr-9123">9123</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-9125">
<td class="addr"><a href="#addr-9125">9125</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_write_econet_keyboard_disable</span></td>
<td class="hex">A9 C9</td>
</tr>

<tr id="addr-9127">
<td class="addr"><a href="#addr-9127">9127</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Disable keyboard (for Econet)</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Execute downloaded code at $0100</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Zeroes $0100-$0102 (safe BRK default), restores the protection mask,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and JMP $0100 to execute code received over the network.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-912A">
<td class="addr"><a href="#addr-912A">912A</a></td>
<td><span class="label">.execute_at_0100</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#2</span></td>
<td class="hex">A2 02</td>
</tr>

<tr id="addr-912C">
<td class="addr"><a href="#addr-912C">912C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-912E">
<td class="addr"><a href="#addr-912E">912E</a></td>
<td><span class="label">.loop_c912e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0100">l0100</a>,x</span></td>
<td class="hex">9D 00 01</td>
</tr>

<tr id="addr-9131">
<td class="addr"><a href="#addr-9131">9131</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-9132">
<td class="addr"><a href="#addr-9132">9132</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-912E">loop_c912e</a></span></td>
<td class="hex">10 FA</td>
</tr>

<tr id="addr-9134">
<td class="addr"><a href="#addr-9134">9134</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-92D6">clear_jsr_protection</a></span></td>
<td class="hex">20 D6 92</td>
</tr>

<tr id="addr-9137">
<td class="addr"><a href="#addr-9137">9137</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0100">l0100</a></span></td>
<td class="hex">4C 00 01</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Remote operation with source validation (REMOT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Validates that the source station/network in the received packet</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; matches the controlling station stored in the remote RXCB. This</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ensures that only the station that initiated the remote session</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; can send commands — characters from other stations are rejected.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Full init sequence: 1) disable keyboard, 2) set workspace ptr,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 3) set status busy, 4) set R/W/byte/word masks, 5) set up CB,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 6) set MODE 7 (the only mode guaranteed for terminal emulation),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 7) set auto repeat rates, 8) enter current language. This is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; essentially a &#34;thin terminal&#34; setup — the local machine becomes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; a remote display/keyboard for the controlling station.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Bit 0 of the status byte disallows further remote takeover</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; attempts (preventing re-entrant remote control), while bit 3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; marks the machine as currently remoted.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-913A">
<td class="addr"><a href="#addr-913A">913A</a></td>
<td><span class="label">.remote_validated</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-913C">
<td class="addr"><a href="#addr-913C">913C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-913E">
<td class="addr"><a href="#addr-913E">913E</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9105">c9105</a></span></td>
<td class="hex">F0 C5</td>
</tr>

<tr id="addr-9140">
<td class="addr"><a href="#addr-9140">9140</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A0 80</td>
</tr>

<tr id="addr-9142">
<td class="addr"><a href="#addr-9142">9142</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-9144">
<td class="addr"><a href="#addr-9144">9144</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A0 0E</td>
</tr>

<tr id="addr-9146">
<td class="addr"><a href="#addr-9146">9146</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">D1 9E</td>
</tr>

<tr id="addr-9148">
<td class="addr"><a href="#addr-9148">9148</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9102">c9102</a></span></td>
<td class="hex">D0 B8</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Insert remote keypress</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads a character from RX block offset $82 and inserts it into</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; keyboard input buffer 0 via OSBYTE $99.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-914A">
<td class="addr"><a href="#addr-914A">914A</a></td>
<td><span class="label">.insert_remote_key</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;82</span></td>
<td class="hex">A0 82</td>
</tr>

<tr id="addr-914C">
<td class="addr"><a href="#addr-914C">914C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-914E">
<td class="addr"><a href="#addr-914E">914E</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-914F">
<td class="addr"><a href="#addr-914F">914F</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-9151">
<td class="addr"><a href="#addr-9151">9151</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-92D6">clear_jsr_protection</a></span></td>
<td class="hex">20 D6 92</td>
</tr>

<tr id="addr-9154">
<td class="addr"><a href="#addr-9154">9154</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_insert_input_buffer</span></td>
<td class="hex">A9 99</td>
</tr>

<tr id="addr-9156">
<td class="addr"><a href="#addr-9156">9156</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Insert character Y into input buffer X</span></td>
<td class="hex">4C F4 FF</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Alternate entry into control block setup</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets X=$0D, Y=$7C. Tests bit 6 of $833A to choose target:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   V=0 (bit 6 clear): stores to (nfs_workspace)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   V=1 (bit 6 set):   stores to (net_rx_ptr)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9159">
<td class="addr"><a href="#addr-9159">9159</a></td>
<td><span class="label">.ctrl_block_setup_alt</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">A2 0D</td>
</tr>

<tr id="addr-915B">
<td class="addr"><a href="#addr-915B">915B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;7c</span></td>
<td class="hex">A0 7C</td>
</tr>

<tr id="addr-915D">
<td class="addr"><a href="#addr-915D">915D</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-833A">l833a</a></span></td>
<td class="hex">2C 3A 83</td>
</tr>

<tr id="addr-9160">
<td class="addr"><a href="#addr-9160">9160</a></td>
<td>    <span class="opcode">BVS</span> <span class="operand"><a href="#addr-9167">c9167</a></span></td>
<td class="hex">70 05</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Control block setup — main entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sets X=$1A, Y=$17, clears V (stores to nfs_workspace).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the template table at $918E indexed by X, storing each</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; value into the target workspace at offset Y. Both X and Y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; are decremented on each iteration.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Template sentinel values:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FE = stop (end of template for this entry path)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FD = skip (leave existing value unchanged)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FC = use page high byte of target pointer</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9162">
<td class="addr"><a href="#addr-9162">9162</a></td>
<td><span class="label">.ctrl_block_setup</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;17</span></td>
<td class="hex">A0 17</td>
</tr>

<tr id="addr-9164">
<td class="addr"><a href="#addr-9164">9164</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;1a</span></td>
<td class="hex">A2 1A</td>
</tr>

<tr id="addr-9166">
<td class="addr"><a href="#addr-9166">9166</a></td>
<td><span class="label">.ctrl_block_setup_clv</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLV</span></td>
<td class="hex">B8</td>
</tr>

<tr id="addr-9167">
<td class="addr"><a href="#addr-9167">9167</a></td>
<td><span class="label">.c9167</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-918E">ctrl_block_template</a>,x</span>  <span class="comment">; Load template byte from ctrl_block_template[X]</span></td>
<td class="hex">BD 8E 91</td>
</tr>

<tr id="addr-916A">
<td class="addr"><a href="#addr-916A">916A</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;fe</span></td>
<td class="hex">C9 FE</td>
</tr>

<tr id="addr-916C">
<td class="addr"><a href="#addr-916C">916C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-918A">c918a</a></span></td>
<td class="hex">F0 1C</td>
</tr>

<tr id="addr-916E">
<td class="addr"><a href="#addr-916E">916E</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;fd</span></td>
<td class="hex">C9 FD</td>
</tr>

<tr id="addr-9170">
<td class="addr"><a href="#addr-9170">9170</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9186">c9186</a></span></td>
<td class="hex">F0 14</td>
</tr>

<tr id="addr-9172">
<td class="addr"><a href="#addr-9172">9172</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;fc</span></td>
<td class="hex">C9 FC</td>
</tr>

<tr id="addr-9174">
<td class="addr"><a href="#addr-9174">9174</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-917E">c917e</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-9176">
<td class="addr"><a href="#addr-9176">9176</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009D">net_rx_ptr_hi</a></span></td>
<td class="hex">A5 9D</td>
</tr>

<tr id="addr-9178">
<td class="addr"><a href="#addr-9178">9178</a></td>
<td>    <span class="opcode">BVS</span> <span class="operand"><a href="#addr-917C">c917c</a></span></td>
<td class="hex">70 02</td>
</tr>

<tr id="addr-917A">
<td class="addr"><a href="#addr-917A">917A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A5 9F</td>
</tr>

<tr id="addr-917C">
<td class="addr"><a href="#addr-917C">917C</a></td>
<td><span class="label">.c917c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-009B">net_tx_ptr_hi</a></span></td>
<td class="hex">85 9B</td>
</tr>

<tr id="addr-917E">
<td class="addr"><a href="#addr-917E">917E</a></td>
<td><span class="label">.c917e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BVS</span> <span class="operand"><a href="#addr-9184">c9184</a></span></td>
<td class="hex">70 04</td>
</tr>

<tr id="addr-9180">
<td class="addr"><a href="#addr-9180">9180</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-9182">
<td class="addr"><a href="#addr-9182">9182</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9186">c9186</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">50 02</td>
</tr>

<tr id="addr-9184">
<td class="addr"><a href="#addr-9184">9184</a></td>
<td><span class="label">.c9184</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-9186">
<td class="addr"><a href="#addr-9186">9186</a></td>
<td><span class="label">.c9186</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9187">
<td class="addr"><a href="#addr-9187">9187</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-9188">
<td class="addr"><a href="#addr-9188">9188</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9167">c9167</a></span></td>
<td class="hex">10 DD</td>
</tr>

<tr id="addr-918A">
<td class="addr"><a href="#addr-918A">918A</a></td>
<td><span class="label">.c918a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-918B">
<td class="addr"><a href="#addr-918B">918B</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a></span></td>
<td class="hex">84 9A</td>
</tr>

<tr id="addr-918D">
<td class="addr"><a href="#addr-918D">918D</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Control block initialisation template</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Read by the loop at $9167, indexed by X from a starting value</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; down to 0. Values are stored into either (nfs_workspace) or</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (net_rx_ptr) at offset Y, depending on the V flag.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Two entry paths read different slices of this table:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   ctrl_block_setup:   X=$1A (26) down, Y=$17 (23) down, V=0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   ctrl_block_setup_alt: X=$0D (13) down, Y=$7C (124) down, V from BIT $833A</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sentinel values:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FE = stop processing</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FD = skip this offset (decrement Y but don&#39;t store)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $FC = substitute the page byte (net_rx_ptr_hi or nfs_workspace_hi)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-918E">
<td class="addr"><a href="#addr-918E">918E</a></td>
<td><span class="label">.ctrl_block_template</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;85, &amp;00, &amp;FD, &amp;FD, &amp;7D, &amp;FC, &amp;FF, &amp;FF, &amp;7E, &amp;FC, &amp;FF, &amp;FF, &amp;00, &amp;00, &amp;FE, &amp;80, &amp;93, &amp;FD, &amp;FD, &amp;D9, &amp;FC, &amp;FF, &amp;FF, &amp;DE, &amp;FC, &amp;FF, &amp;FF, &amp;FE, &amp;D1, &amp;FD, &amp;FD, &amp;1F, &amp;FD, &amp;FF, &amp;FF, &amp;FD, &amp;FD, &amp;FF, &amp;FF</td>
<td class="hex">85 00 FD FD 7D FC FF FF 7E FC FF FF 00 00 FE 80 93 FD FD D9 FC FF FF DE FC FF FF FE D1 FD FD 1F FD FF FF FD FD FF FF</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Fn 5: printer selection changed (SELECT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called when the printer selection changes. Compares the new</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; selection (in PARMX) against the network printer (buffer 4).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If it matches, initialises the printer buffer pointer (PBUFFP)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and sets the initial flag byte ($41). Otherwise just updates</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the printer status flags (PFLAGS).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-91B5">
<td class="addr"><a href="#addr-91B5">91B5</a></td>
<td><span class="label">.remote_display_setup</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-91B7">
<td class="addr"><a href="#addr-91B7">91B7</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-91B8">
<td class="addr"><a href="#addr-91B8">91B8</a></td>
<td>    <span class="opcode">CPX</span> <span class="operand"><a href="#addr-00F0">l00f0</a></span></td>
<td class="hex">E4 F0</td>
</tr>

<tr id="addr-91BA">
<td class="addr"><a href="#addr-91BA">91BA</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-91C3">c91c3</a></span></td>
<td class="hex">D0 07</td>
</tr>

<tr id="addr-91BC">
<td class="addr"><a href="#addr-91BC">91BC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;1f</span></td>
<td class="hex">A9 1F</td>
</tr>

<tr id="addr-91BE">
<td class="addr"><a href="#addr-91BE">91BE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D61">printer_buf_ptr</a></span></td>
<td class="hex">8D 61 0D</td>
</tr>

<tr id="addr-91C1">
<td class="addr"><a href="#addr-91C1">91C1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;43</span></td>
<td class="hex">A9 43</td>
</tr>

<tr id="addr-91C3">
<td class="addr"><a href="#addr-91C3">91C3</a></td>
<td><span class="label">.c91c3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">8D 60 0D</td>
</tr>

<tr id="addr-91C6">
<td class="addr"><a href="#addr-91C6">91C6</a></td>
<td><span class="label">.return_12</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Fn 1/2/3: network printer handler (PRINT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handles network printer output. Reason 1 = chars in buffer (extract</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; from MOS buffer 3 and accumulate), reason 2 = Ctrl-B (start print),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; reason 3 = Ctrl-C (end print). The printer status byte PFLAGS uses:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit 7 = sequence number (toggles per packet for dup detection)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit 6 = always 1 (validity marker)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit 0 = 0 when print active</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Print streams reuse the BSXMIT (byte-stream transmit) code with</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; handle=0, which causes the AND SEQNOS to produce zero and sidestep</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; per-file sequence tracking. After transmission, TXCB pointer bytes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; are filled with $FF to prevent stale values corrupting subsequent</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; BGET/BPUT operations (a historically significant bug fix).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; N.B. The printer and REMOTE facility share the same dynamically</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; allocated static workspace page via WORKP1 ($9E,$9F) — care must</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; be taken to never leave the pointer corrupted, as corruption would</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; cause one subsystem to overwrite the other&#39;s data.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Only handles buffer 4 (network printer); others are ignored.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-91C7">
<td class="addr"><a href="#addr-91C7">91C7</a></td>
<td><span class="label">.remote_print_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#4</span></td>
<td class="hex">C0 04</td>
</tr>

<tr id="addr-91C9">
<td class="addr"><a href="#addr-91C9">91C9</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-91C6">return_12</a></span></td>
<td class="hex">D0 FB</td>
</tr>

<tr id="addr-91CB">
<td class="addr"><a href="#addr-91CB">91CB</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-91CC">
<td class="addr"><a href="#addr-91CC">91CC</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-91CD">
<td class="addr"><a href="#addr-91CD">91CD</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-91F5">c91f5</a></span></td>
<td class="hex">D0 26</td>
</tr>

<tr id="addr-91CF">
<td class="addr"><a href="#addr-91CF">91CF</a></td>
<td>    <span class="opcode">TSX</span></td>
<td class="hex">BA</td>
</tr>

<tr id="addr-91D0">
<td class="addr"><a href="#addr-91D0">91D0</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-0106">l0106</a>,x</span></td>
<td class="hex">1D 06 01</td>
</tr>

<tr id="addr-91D3">
<td class="addr"><a href="#addr-91D3">91D3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0106">l0106</a>,x</span></td>
<td class="hex">9D 06 01</td>
</tr>

<tr id="addr-91D6">
<td class="addr"><a href="#addr-91D6">91D6</a></td>
<td><span class="label">.c91d6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_buffer</span></td>
<td class="hex">A9 91</td>
</tr>

<tr id="addr-91D8">
<td class="addr"><a href="#addr-91D8">91D8</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#buffer_printer</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-91DA">
<td class="addr"><a href="#addr-91DA">91DA</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Get character from input buffer (C is set if the buffer is empty, otherwise Y=extracted character)</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-91DD">
<td class="addr"><a href="#addr-91DD">91DD</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-91C6">return_12</a></span></td>
<td class="hex">B0 E7</td>
</tr>

<tr id="addr-91DF">
<td class="addr"><a href="#addr-91DF">91DF</a></td>
<td>    <span class="opcode">TYA</span>  <span class="comment">; Y is the character extracted from the buffer</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-91E0">
<td class="addr"><a href="#addr-91E0">91E0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-91EC">store_output_byte</a></span></td>
<td class="hex">20 EC 91</td>
</tr>

<tr id="addr-91E3">
<td class="addr"><a href="#addr-91E3">91E3</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;6e</span></td>
<td class="hex">C0 6E</td>
</tr>

<tr id="addr-91E5">
<td class="addr"><a href="#addr-91E5">91E5</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-91D6">c91d6</a></span></td>
<td class="hex">90 EF</td>
</tr>

<tr id="addr-91E7">
<td class="addr"><a href="#addr-91E7">91E7</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9217">flush_output_block</a></span></td>
<td class="hex">20 17 92</td>
</tr>

<tr id="addr-91EA">
<td class="addr"><a href="#addr-91EA">91EA</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-91D6">c91d6</a></span></td>
<td class="hex">D0 EA</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Store output byte to network buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores byte A at the current output offset in the RX buffer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; pointed to by (net_rx_ptr). Advances the offset counter and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; triggers a flush if the buffer is full.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-91EC">
<td class="addr"><a href="#addr-91EC">91EC</a></td>
<td><span class="label">.store_output_byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D61">printer_buf_ptr</a></span></td>
<td class="hex">AC 61 0D</td>
</tr>

<tr id="addr-91EF">
<td class="addr"><a href="#addr-91EF">91EF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-91F1">
<td class="addr"><a href="#addr-91F1">91F1</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-0D61">printer_buf_ptr</a></span></td>
<td class="hex">EE 61 0D</td>
</tr>

<tr id="addr-91F4">
<td class="addr"><a href="#addr-91F4">91F4</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-91F5">
<td class="addr"><a href="#addr-91F5">91F5</a></td>
<td><span class="label">.c91f5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-91F6">
<td class="addr"><a href="#addr-91F6">91F6</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-91EC">store_output_byte</a></span></td>
<td class="hex">20 EC 91</td>
</tr>

<tr id="addr-91F9">
<td class="addr"><a href="#addr-91F9">91F9</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">4D 60 0D</td>
</tr>

<tr id="addr-91FC">
<td class="addr"><a href="#addr-91FC">91FC</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-91FD">
<td class="addr"><a href="#addr-91FD">91FD</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-920E">c920e</a></span></td>
<td class="hex">90 0F</td>
</tr>

<tr id="addr-91FF">
<td class="addr"><a href="#addr-91FF">91FF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">AD 60 0D</td>
</tr>

<tr id="addr-9202">
<td class="addr"><a href="#addr-9202">9202</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-9203">
<td class="addr"><a href="#addr-9203">9203</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-920B">c920b</a></span></td>
<td class="hex">90 06</td>
</tr>

<tr id="addr-9205">
<td class="addr"><a href="#addr-9205">9205</a></td>
<td>    <span class="opcode">ROL</span></td>
<td class="hex">2A</td>
</tr>

<tr id="addr-9206">
<td class="addr"><a href="#addr-9206">9206</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">29 7F</td>
</tr>

<tr id="addr-9208">
<td class="addr"><a href="#addr-9208">9208</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">8D 60 0D</td>
</tr>

<tr id="addr-920B">
<td class="addr"><a href="#addr-920B">920B</a></td>
<td><span class="label">.c920b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9217">flush_output_block</a></span></td>
<td class="hex">20 17 92</td>
</tr>

<tr id="addr-920E">
<td class="addr"><a href="#addr-920E">920E</a></td>
<td><span class="label">.c920e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ROR</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">6E 60 0D</td>
</tr>

<tr id="addr-9211">
<td class="addr"><a href="#addr-9211">9211</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9212">
<td class="addr"><a href="#addr-9212">9212</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-9213">
<td class="addr"><a href="#addr-9213">9213</a></td>
<td>    <span class="opcode">ROL</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">2E 60 0D</td>
</tr>

<tr id="addr-9216">
<td class="addr"><a href="#addr-9216">9216</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Flush output block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sends the accumulated output block over the network, resets the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; buffer pointer, and prepares for the next block of output data.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9217">
<td class="addr"><a href="#addr-9217">9217</a></td>
<td><span class="label">.flush_output_block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-9219">
<td class="addr"><a href="#addr-9219">9219</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D61">printer_buf_ptr</a></span></td>
<td class="hex">AD 61 0D</td>
</tr>

<tr id="addr-921C">
<td class="addr"><a href="#addr-921C">921C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-921E">
<td class="addr"><a href="#addr-921E">921E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009D">net_rx_ptr_hi</a></span></td>
<td class="hex">A5 9D</td>
</tr>

<tr id="addr-9220">
<td class="addr"><a href="#addr-9220">9220</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;09</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9221">
<td class="addr"><a href="#addr-9221">9221</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-9223">
<td class="addr"><a href="#addr-9223">9223</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#5</span></td>
<td class="hex">A0 05</td>
</tr>

<tr id="addr-9225">
<td class="addr"><a href="#addr-9225">9225</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-9227">
<td class="addr"><a href="#addr-9227">9227</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0b</span></td>
<td class="hex">A0 0B</td>
</tr>

<tr id="addr-9229">
<td class="addr"><a href="#addr-9229">9229</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;26</span></td>
<td class="hex">A2 26</td>
</tr>

<tr id="addr-922B">
<td class="addr"><a href="#addr-922B">922B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9166">ctrl_block_setup_clv</a></span></td>
<td class="hex">20 66 91</td>
</tr>

<tr id="addr-922E">
<td class="addr"><a href="#addr-922E">922E</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-922F">
<td class="addr"><a href="#addr-922F">922F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">AD 60 0D</td>
</tr>

<tr id="addr-9232">
<td class="addr"><a href="#addr-9232">9232</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9233">
<td class="addr"><a href="#addr-9233">9233</a></td>
<td>    <span class="opcode">ROL</span></td>
<td class="hex">2A</td>
</tr>

<tr id="addr-9234">
<td class="addr"><a href="#addr-9234">9234</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9235">
<td class="addr"><a href="#addr-9235">9235</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;80</span></td>
<td class="hex">49 80</td>
</tr>

<tr id="addr-9237">
<td class="addr"><a href="#addr-9237">9237</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D60">l0d60</a></span></td>
<td class="hex">8D 60 0D</td>
</tr>

<tr id="addr-923A">
<td class="addr"><a href="#addr-923A">923A</a></td>
<td>    <span class="opcode">ROL</span></td>
<td class="hex">2A</td>
</tr>

<tr id="addr-923B">
<td class="addr"><a href="#addr-923B">923B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-923D">
<td class="addr"><a href="#addr-923D">923D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;1f</span></td>
<td class="hex">A0 1F</td>
</tr>

<tr id="addr-923F">
<td class="addr"><a href="#addr-923F">923F</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0D61">printer_buf_ptr</a></span></td>
<td class="hex">8C 61 0D</td>
</tr>

<tr id="addr-9242">
<td class="addr"><a href="#addr-9242">9242</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9244">
<td class="addr"><a href="#addr-9244">9244</a></td>
<td>    <span class="opcode">TAX</span>  <span class="comment">; X=&amp;00</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9245">
<td class="addr"><a href="#addr-9245">9245</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A4 9F</td>
</tr>

<tr id="addr-9247">
<td class="addr"><a href="#addr-9247">9247</a></td>
<td>    <span class="opcode">CLI</span></td>
<td class="hex">58</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Transmit with retry loop (XMITFS/XMITFY)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Calls the low-level transmit routine (BRIANX) with FSTRY ($FF = 255)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; retries and FSDELY ($60 = 96) ms delay between attempts. On each</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; iteration, checks the result code: zero means success, non-zero</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; means retry. After all retries exhausted, reports a &#39;Net error&#39;.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Entry point XMITFY allows a custom delay in Y.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9248">
<td class="addr"><a href="#addr-9248">9248</a></td>
<td><span class="label">.econet_tx_retry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a></span></td>
<td class="hex">86 9A</td>
</tr>

<tr id="addr-924A">
<td class="addr"><a href="#addr-924A">924A</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-009B">net_tx_ptr_hi</a></span></td>
<td class="hex">84 9B</td>
</tr>

<tr id="addr-924C">
<td class="addr"><a href="#addr-924C">924C</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-924D">
<td class="addr"><a href="#addr-924D">924D</a></td>
<td>    <span class="opcode">AND</span> <span class="operand"><a href="#addr-0E08">fs_sequence_nos</a></span></td>
<td class="hex">2D 08 0E</td>
</tr>

<tr id="addr-9250">
<td class="addr"><a href="#addr-9250">9250</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9254">c9254</a></span></td>
<td class="hex">F0 02</td>
</tr>

<tr id="addr-9252">
<td class="addr"><a href="#addr-9252">9252</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-9254">
<td class="addr"><a href="#addr-9254">9254</a></td>
<td><span class="label">.c9254</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-9256">
<td class="addr"><a href="#addr-9256">9256</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">11 9A</td>
</tr>

<tr id="addr-9258">
<td class="addr"><a href="#addr-9258">9258</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9259">
<td class="addr"><a href="#addr-9259">9259</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">91 9A</td>
</tr>

<tr id="addr-925B">
<td class="addr"><a href="#addr-925B">925B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-864C">tx_poll_ff</a></span></td>
<td class="hex">20 4C 86</td>
</tr>

<tr id="addr-925E">
<td class="addr"><a href="#addr-925E">925E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-9260">
<td class="addr"><a href="#addr-9260">9260</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-9262">
<td class="addr"><a href="#addr-9262">9262</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">91 9A</td>
</tr>

<tr id="addr-9264">
<td class="addr"><a href="#addr-9264">9264</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;09</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9265">
<td class="addr"><a href="#addr-9265">9265</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">91 9A</td>
</tr>

<tr id="addr-9267">
<td class="addr"><a href="#addr-9267">9267</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9268">
<td class="addr"><a href="#addr-9268">9268</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9269">
<td class="addr"><a href="#addr-9269">9269</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;d1</span></td>
<td class="hex">A0 D1</td>
</tr>

<tr id="addr-926B">
<td class="addr"><a href="#addr-926B">926B</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-926C">
<td class="addr"><a href="#addr-926C">926C</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-926D">
<td class="addr"><a href="#addr-926D">926D</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9271">c9271</a></span></td>
<td class="hex">F0 02</td>
</tr>

<tr id="addr-926F">
<td class="addr"><a href="#addr-926F">926F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;90</span></td>
<td class="hex">A0 90</td>
</tr>

<tr id="addr-9271">
<td class="addr"><a href="#addr-9271">9271</a></td>
<td><span class="label">.c9271</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-9272">
<td class="addr"><a href="#addr-9272">9272</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#1</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-9274">
<td class="addr"><a href="#addr-9274">9274</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">91 9A</td>
</tr>

<tr id="addr-9276">
<td class="addr"><a href="#addr-9276">9276</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-9277">
<td class="addr"><a href="#addr-9277">9277</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;00</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9278">
<td class="addr"><a href="#addr-9278">9278</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9279">
<td class="addr"><a href="#addr-9279">9279</a></td>
<td><span class="label">.loop_c9279</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A9 7F</td>
</tr>

<tr id="addr-927B">
<td class="addr"><a href="#addr-927B">927B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">91 9A</td>
</tr>

<tr id="addr-927D">
<td class="addr"><a href="#addr-927D">927D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-8448">send_to_fs_star</a></span></td>
<td class="hex">20 48 84</td>
</tr>

<tr id="addr-9280">
<td class="addr"><a href="#addr-9280">9280</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9281">
<td class="addr"><a href="#addr-9281">9281</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9282">
<td class="addr"><a href="#addr-9282">9282</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">(<a href="#addr-009A">net_tx_ptr</a>),y</span></td>
<td class="hex">51 9A</td>
</tr>

<tr id="addr-9284">
<td class="addr"><a href="#addr-9284">9284</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-9285">
<td class="addr"><a href="#addr-9285">9285</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9279">loop_c9279</a></span></td>
<td class="hex">B0 F2</td>
</tr>

<tr id="addr-9287">
<td class="addr"><a href="#addr-9287">9287</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9288">
<td class="addr"><a href="#addr-9288">9288</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9289">
<td class="addr"><a href="#addr-9289">9289</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-928A">
<td class="addr"><a href="#addr-928A">928A</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-928B">
<td class="addr"><a href="#addr-928B">928B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9290">return_13</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-928D">
<td class="addr"><a href="#addr-928D">928D</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand"><a href="#addr-0E08">fs_sequence_nos</a></span></td>
<td class="hex">4D 08 0E</td>
</tr>

<tr id="addr-9290">
<td class="addr"><a href="#addr-9290">9290</a></td>
<td><span class="label">.return_13</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Save palette and VDU state (CVIEW)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Part of the VIEW facility (second iteration, started 27/7/82).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Uses dynamically allocated buffer store. The WORKP1 pointer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ($9E,$9F) serves double duty: non-zero indicates data ready AND</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; provides the buffer address — an efficient use of scarce zero-</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; page space. This code must be user-transparent as the NFS may not</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; be the dominant filing system.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads all 16 palette entries using OSWORD $0B (read palette) and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; stores the results. Then reads cursor position (OSBYTE $85),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; shadow RAM allocation (OSBYTE $C2), and screen start address</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (OSBYTE $C3) using the 3-entry table at $9304 (osbyte_vdu_table).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On completion, restores the JSR buffer protection bits (LSTAT)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; from OLDJSR to re-enable JSR reception, which was disabled during</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the screen data capture to prevent interference.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9291">
<td class="addr"><a href="#addr-9291">9291</a></td>
<td><span class="label">.save_palette_vdu</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">A5 B2</td>
</tr>

<tr id="addr-9293">
<td class="addr"><a href="#addr-9293">9293</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9294">
<td class="addr"><a href="#addr-9294">9294</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e9</span></td>
<td class="hex">A9 E9</td>
</tr>

<tr id="addr-9296">
<td class="addr"><a href="#addr-9296">9296</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">85 9E</td>
</tr>

<tr id="addr-9298">
<td class="addr"><a href="#addr-9298">9298</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-929A">
<td class="addr"><a href="#addr-929A">929A</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">84 B2</td>
</tr>

<tr id="addr-929C">
<td class="addr"><a href="#addr-929C">929C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0350">l0350</a></span></td>
<td class="hex">AD 50 03</td>
</tr>

<tr id="addr-929F">
<td class="addr"><a href="#addr-929F">929F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-92A1">
<td class="addr"><a href="#addr-92A1">92A1</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">E6 9E</td>
</tr>

<tr id="addr-92A3">
<td class="addr"><a href="#addr-92A3">92A3</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0351">l0351</a></span></td>
<td class="hex">AD 51 03</td>
</tr>

<tr id="addr-92A6">
<td class="addr"><a href="#addr-92A6">92A6</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-92A7">
<td class="addr"><a href="#addr-92A7">92A7</a></td>
<td>    <span class="opcode">TYA</span>  <span class="comment">; A=&amp;00</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-92A8">
<td class="addr"><a href="#addr-92A8">92A8</a></td>
<td><span class="label">.loop_c92a8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-92AA">
<td class="addr"><a href="#addr-92AA">92AA</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">A6 9E</td>
</tr>

<tr id="addr-92AC">
<td class="addr"><a href="#addr-92AC">92AC</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A4 9F</td>
</tr>

<tr id="addr-92AE">
<td class="addr"><a href="#addr-92AE">92AE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osword_read_palette</span></td>
<td class="hex">A9 0B</td>
</tr>

<tr id="addr-92B0">
<td class="addr"><a href="#addr-92B0">92B0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF1">osword</a></span>  <span class="comment">; Read palette</span></td>
<td class="hex">20 F1 FF</td>
</tr>

<tr id="addr-92B3">
<td class="addr"><a href="#addr-92B3">92B3</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-92B4">
<td class="addr"><a href="#addr-92B4">92B4</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-92B6">
<td class="addr"><a href="#addr-92B6">92B6</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-92B8">
<td class="addr"><a href="#addr-92B8">92B8</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;01</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-92B9">
<td class="addr"><a href="#addr-92B9">92B9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">B1 9E</td>
</tr>

<tr id="addr-92BB">
<td class="addr"><a href="#addr-92BB">92BB</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-92BC">
<td class="addr"><a href="#addr-92BC">92BC</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">A6 9E</td>
</tr>

<tr id="addr-92BE">
<td class="addr"><a href="#addr-92BE">92BE</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">E6 9E</td>
</tr>

<tr id="addr-92C0">
<td class="addr"><a href="#addr-92C0">92C0</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">E6 B2</td>
</tr>

<tr id="addr-92C2">
<td class="addr"><a href="#addr-92C2">92C2</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;00</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-92C3">
<td class="addr"><a href="#addr-92C3">92C3</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">A5 B2</td>
</tr>

<tr id="addr-92C5">
<td class="addr"><a href="#addr-92C5">92C5</a></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#&amp;f9</span></td>
<td class="hex">E0 F9</td>
</tr>

<tr id="addr-92C7">
<td class="addr"><a href="#addr-92C7">92C7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-92A8">loop_c92a8</a></span></td>
<td class="hex">D0 DF</td>
</tr>

<tr id="addr-92C9">
<td class="addr"><a href="#addr-92C9">92C9</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-92CA">
<td class="addr"><a href="#addr-92CA">92CA</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">84 B2</td>
</tr>

<tr id="addr-92CC">
<td class="addr"><a href="#addr-92CC">92CC</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">E6 9E</td>
</tr>

<tr id="addr-92CE">
<td class="addr"><a href="#addr-92CE">92CE</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-92DD">save_vdu_state</a></span></td>
<td class="hex">20 DD 92</td>
</tr>

<tr id="addr-92D1">
<td class="addr"><a href="#addr-92D1">92D1</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">E6 9E</td>
</tr>

<tr id="addr-92D3">
<td class="addr"><a href="#addr-92D3">92D3</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-92D4">
<td class="addr"><a href="#addr-92D4">92D4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">85 B2</td>
</tr>

<tr id="addr-92D6">
<td class="addr"><a href="#addr-92D6">92D6</a></td>
<td><span class="label">.clear_jsr_protection</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3B">rx_ctrl_copy</a></span></td>
<td class="hex">AD 3B 0D</td>
</tr>

<tr id="addr-92D9">
<td class="addr"><a href="#addr-92D9">92D9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">8D 63 0D</td>
</tr>

<tr id="addr-92DC">
<td class="addr"><a href="#addr-92DC">92DC</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Save VDU workspace state</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores the cursor position value from $0355 into NFS workspace,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; then reads cursor position (OSBYTE $85), shadow RAM (OSBYTE $C2),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and screen start (OSBYTE $C3) via read_vdu_osbyte, storing</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; each result into consecutive workspace bytes.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-92DD">
<td class="addr"><a href="#addr-92DD">92DD</a></td>
<td><span class="label">.save_vdu_state</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0355">l0355</a></span></td>
<td class="hex">AD 55 03</td>
</tr>

<tr id="addr-92E0">
<td class="addr"><a href="#addr-92E0">92E0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>),y</span></td>
<td class="hex">91 9E</td>
</tr>

<tr id="addr-92E2">
<td class="addr"><a href="#addr-92E2">92E2</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-92E3">
<td class="addr"><a href="#addr-92E3">92E3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-92F0">read_vdu_osbyte</a></span></td>
<td class="hex">20 F0 92</td>
</tr>

<tr id="addr-92E6">
<td class="addr"><a href="#addr-92E6">92E6</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">E6 9E</td>
</tr>

<tr id="addr-92E8">
<td class="addr"><a href="#addr-92E8">92E8</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-92E9">
<td class="addr"><a href="#addr-92E9">92E9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>,x)</span></td>
<td class="hex">81 9E</td>
</tr>

<tr id="addr-92EB">
<td class="addr"><a href="#addr-92EB">92EB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-92EE">read_vdu_osbyte_x0</a></span></td>
<td class="hex">20 EE 92</td>
</tr>

<tr id="addr-92EE">
<td class="addr"><a href="#addr-92EE">92EE</a></td>
<td><span class="label">.read_vdu_osbyte_x0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-92F0">
<td class="addr"><a href="#addr-92F0">92F0</a></td>
<td><span class="label">.read_vdu_osbyte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">A4 B2</td>
</tr>

<tr id="addr-92F2">
<td class="addr"><a href="#addr-92F2">92F2</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00B2">fs_load_addr_2</a></span></td>
<td class="hex">E6 B2</td>
</tr>

<tr id="addr-92F4">
<td class="addr"><a href="#addr-92F4">92F4</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-009E">nfs_workspace</a></span></td>
<td class="hex">E6 9E</td>
</tr>

<tr id="addr-92F6">
<td class="addr"><a href="#addr-92F6">92F6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9304">osbyte_vdu_table</a>,y</span></td>
<td class="hex">B9 04 93</td>
</tr>

<tr id="addr-92F9">
<td class="addr"><a href="#addr-92F9">92F9</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A0 FF</td>
</tr>

<tr id="addr-92FB">
<td class="addr"><a href="#addr-92FB">92FB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-92FE">
<td class="addr"><a href="#addr-92FE">92FE</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-92FF">
<td class="addr"><a href="#addr-92FF">92FF</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-9301">
<td class="addr"><a href="#addr-9301">9301</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009E">nfs_workspace</a>,x)</span></td>
<td class="hex">81 9E</td>
</tr>

<tr id="addr-9303">
<td class="addr"><a href="#addr-9303">9303</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Table of 3 OSBYTE codes used by save_palette_vdu_state ($9291):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $85 = read cursor position</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $C2 = read shadow RAM allocation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $C3 = read screen start address</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9304">
<td class="addr"><a href="#addr-9304">9304</a></td>
<td><span class="label">.osbyte_vdu_table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;85, &amp;C2, &amp;C3</td>
<td class="hex">85 C2 C3</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Tube BRK handler (BRKV target) — reference: NFS11 NEWBR</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sends error information to the Tube co-processor via R2 and R4:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   1. Sends $FF to R4 (WRIFOR) to signal error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   2. Reads R2 data (flush any pending byte)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   3. Sends $00 via R2, then error number from ($FD),0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   4. Loops sending error string bytes via R2 until zero terminator</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   5. Falls through to tube_reset_stack → tube_main_loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The main loop continuously polls R1 for WRCH requests (forwarded</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to OSWRITCH $FFCB) and R2 for command bytes (dispatched via the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 14-entry table at $0500). The R2 command byte is stored at $55</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; before dispatch via JMP ($0500).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-0016">
<td class="addr"><a href="#addr-0016">0016</a></td>
<td><span class="label">.nmi_workspace_start</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="label">.tube_brk_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-0018">
<td class="addr"><a href="#addr-0018">0018</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D9">tube_send_r4</a></span></td>
<td class="hex">20 D9 06</td>
</tr>

<tr id="addr-001B">
<td class="addr"><a href="#addr-001B">001B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">AD E3 FE</td>
</tr>

<tr id="addr-001E">
<td class="addr"><a href="#addr-001E">001E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-0020">
<td class="addr"><a href="#addr-0020">0020</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0023">
<td class="addr"><a href="#addr-0023">0023</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-0024">
<td class="addr"><a href="#addr-0024">0024</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00FD">l00fd</a>),y</span></td>
<td class="hex">B1 FD</td>
</tr>

<tr id="addr-0026">
<td class="addr"><a href="#addr-0026">0026</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0029">
<td class="addr"><a href="#addr-0029">0029</a></td>
<td><span class="label">.tube_brk_send_loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-002A">
<td class="addr"><a href="#addr-002A">002A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00FD">l00fd</a>),y</span></td>
<td class="hex">B1 FD</td>
</tr>

<tr id="addr-002C">
<td class="addr"><a href="#addr-002C">002C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-002F">
<td class="addr"><a href="#addr-002F">002F</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-0030">
<td class="addr"><a href="#addr-0030">0030</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-0029">tube_brk_send_loop</a></span></td>
<td class="hex">D0 F7</td>
</tr>

<tr id="addr-0032">
<td class="addr"><a href="#addr-0032">0032</a></td>
<td><span class="label">.tube_reset_stack</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A2 FF</td>
</tr>

<tr id="addr-0034">
<td class="addr"><a href="#addr-0034">0034</a></td>
<td>    <span class="opcode">TXS</span></td>
<td class="hex">9A</td>
</tr>

<tr id="addr-0035">
<td class="addr"><a href="#addr-0035">0035</a></td>
<td>    <span class="opcode">CLI</span></td>
<td class="hex">58</td>
</tr>

<tr id="addr-0036">
<td class="addr"><a href="#addr-0036">0036</a></td>
<td><span class="label">.c0036</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0011">zp_temp_11</a></span></td>
<td class="hex">86 11</td>
</tr>

<tr id="addr-0038">
<td class="addr"><a href="#addr-0038">0038</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0010">zp_temp_10</a></span></td>
<td class="hex">84 10</td>
</tr>

<tr id="addr-003A">
<td class="addr"><a href="#addr-003A">003A</a></td>
<td><span class="label">.tube_main_loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">2C E0 FE</td>
</tr>

<tr id="addr-003D">
<td class="addr"><a href="#addr-003D">003D</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0045">tube_poll_r2</a></span></td>
<td class="hex">10 06</td>
</tr>

<tr id="addr-003F">
<td class="addr"><a href="#addr-003F">003F</a></td>
<td><span class="label">.tube_handle_wrch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEE1">tube_data_register_1</a></span></td>
<td class="hex">AD E1 FE</td>
</tr>

<tr id="addr-0042">
<td class="addr"><a href="#addr-0042">0042</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFCB">nvwrch</a></span>  <span class="comment">; Write character</span></td>
<td class="hex">20 CB FF</td>
</tr>

<tr id="addr-0045">
<td class="addr"><a href="#addr-0045">0045</a></td>
<td><span class="label">.tube_poll_r2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-0048">
<td class="addr"><a href="#addr-0048">0048</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-003A">tube_main_loop</a></span></td>
<td class="hex">10 F0</td>
</tr>

<tr id="addr-004A">
<td class="addr"><a href="#addr-004A">004A</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">2C E0 FE</td>
</tr>

<tr id="addr-004D">
<td class="addr"><a href="#addr-004D">004D</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-003F">tube_handle_wrch</a></span></td>
<td class="hex">30 F0</td>
</tr>

<tr id="addr-004F">
<td class="addr"><a href="#addr-004F">004F</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">AE E3 FE</td>
</tr>

<tr id="addr-0052">
<td class="addr"><a href="#addr-0052">0052</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0055">l0055</a></span></td>
<td class="hex">86 55</td>
</tr>

<tr id="addr-0054">
<td class="addr"><a href="#addr-0054">0054</a></td>
<td><span class="label">.tube_dispatch_cmd</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand">(<a href="#addr-0500">tube_dispatch_table</a>)</span></td>
<td class="hex">6C 00 05</td>
</tr>

<tr id="addr-0057">
<td class="addr"><a href="#addr-0057">0057</a></td>
<td><span class="label">.tube_transfer_addr</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr id="addr-0058">
<td class="addr"><a href="#addr-0058">0058</a></td>
<td><span class="label">.l0058</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;80</td>
<td class="hex">80</td>
</tr>

<tr id="addr-0059">
<td class="addr"><a href="#addr-0059">0059</a></td>
<td><span class="label">.l0059</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr id="addr-005A">
<td class="addr"><a href="#addr-005A">005A</a></td>
<td><span class="label">.l005a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;00</td>
<td class="hex">00</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Tube host code page 4 — reference: NFS12 (BEGIN, ADRR, SENDW)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copied from ROM at $934C during init. The first 28 bytes ($0400-$041B)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; overlap with the end of the ZP block (the same ROM bytes serve both</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the ZP copy at $005B-$0076 and this page at $0400-$041B). Contains:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0400: JMP $0473 (BEGIN — CLI parser / startup entry)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0403: JMP $06E2 (tube_escape_check)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0406: tube_addr_claim — Tube address claim protocol (ADRR)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0414: tube_post_init — called after ROM→RAM copy</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0473: BEGIN — startup/CLI entry, break type check</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $04E7: tube_rdch_handler — RDCHV target</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $04EF: tube_restore_regs — restore X,Y, dispatch entry 6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $04F7: tube_read_r2 — poll R2 status, read data byte to A</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-0400">
<td class="addr"><a href="#addr-0400">0400</a></td>
<td><span class="label">.tube_code_page4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0473">c0473</a></span></td>
<td class="hex">4C 73 04</td>
</tr>

<tr id="addr-0403">
<td class="addr"><a href="#addr-0403">0403</a></td>
<td><span class="label">.tube_escape_entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-06E2">tube_escape_check</a></span></td>
<td class="hex">4C E2 06</td>
</tr>

<tr id="addr-0406">
<td class="addr"><a href="#addr-0406">0406</a></td>
<td><span class="label">.tube_addr_claim</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;80</span></td>
<td class="hex">C9 80</td>
</tr>

<tr id="addr-0408">
<td class="addr"><a href="#addr-0408">0408</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-0426">c0426</a></span></td>
<td class="hex">90 1C</td>
</tr>

<tr id="addr-040A">
<td class="addr"><a href="#addr-040A">040A</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;c0</span></td>
<td class="hex">C9 C0</td>
</tr>

<tr id="addr-040C">
<td class="addr"><a href="#addr-040C">040C</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-0419">c0419</a></span></td>
<td class="hex">B0 0B</td>
</tr>

<tr id="addr-040E">
<td class="addr"><a href="#addr-040E">040E</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;40</span></td>
<td class="hex">09 40</td>
</tr>

<tr id="addr-0410">
<td class="addr"><a href="#addr-0410">0410</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0015">l0015</a></span></td>
<td class="hex">C5 15</td>
</tr>

<tr id="addr-0412">
<td class="addr"><a href="#addr-0412">0412</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-0425">return_14</a></span></td>
<td class="hex">D0 11</td>
</tr>

<tr id="addr-0414">
<td class="addr"><a href="#addr-0414">0414</a></td>
<td><span class="label">.tube_post_init</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-0416">
<td class="addr"><a href="#addr-0416">0416</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0014">l0014</a></span></td>
<td class="hex">85 14</td>
</tr>

<tr id="addr-0418">
<td class="addr"><a href="#addr-0418">0418</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-0419">
<td class="addr"><a href="#addr-0419">0419</a></td>
<td><span class="label">.c0419</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ASL</span> <span class="operand"><a href="#addr-0014">l0014</a></span></td>
<td class="hex">06 14</td>
</tr>

<tr id="addr-041B">
<td class="addr"><a href="#addr-041B">041B</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-0423">c0423</a></span></td>
<td class="hex">B0 06</td>
</tr>

<tr id="addr-041D">
<td class="addr"><a href="#addr-041D">041D</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0015">l0015</a></span></td>
<td class="hex">C5 15</td>
</tr>

<tr id="addr-041F">
<td class="addr"><a href="#addr-041F">041F</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-0425">return_14</a></span></td>
<td class="hex">F0 04</td>
</tr>

<tr id="addr-0421">
<td class="addr"><a href="#addr-0421">0421</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-0422">
<td class="addr"><a href="#addr-0422">0422</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-0423">
<td class="addr"><a href="#addr-0423">0423</a></td>
<td><span class="label">.c0423</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0015">l0015</a></span></td>
<td class="hex">85 15</td>
</tr>

<tr id="addr-0425">
<td class="addr"><a href="#addr-0425">0425</a></td>
<td><span class="label">.return_14</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-0426">
<td class="addr"><a href="#addr-0426">0426</a></td>
<td><span class="label">.c0426</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0013">l0013</a></span></td>
<td class="hex">84 13</td>
</tr>

<tr id="addr-0428">
<td class="addr"><a href="#addr-0428">0428</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0012">l0012</a></span></td>
<td class="hex">86 12</td>
</tr>

<tr id="addr-042A">
<td class="addr"><a href="#addr-042A">042A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D9">tube_send_r4</a></span></td>
<td class="hex">20 D9 06</td>
</tr>

<tr id="addr-042D">
<td class="addr"><a href="#addr-042D">042D</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-042E">
<td class="addr"><a href="#addr-042E">042E</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#3</span></td>
<td class="hex">A0 03</td>
</tr>

<tr id="addr-0430">
<td class="addr"><a href="#addr-0430">0430</a></td>
<td><span class="label">.loop_c0430</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-0012">l0012</a>),y</span></td>
<td class="hex">B1 12</td>
</tr>

<tr id="addr-0432">
<td class="addr"><a href="#addr-0432">0432</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D9">tube_send_r4</a></span></td>
<td class="hex">20 D9 06</td>
</tr>

<tr id="addr-0435">
<td class="addr"><a href="#addr-0435">0435</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-0436">
<td class="addr"><a href="#addr-0436">0436</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0430">loop_c0430</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-0438">
<td class="addr"><a href="#addr-0438">0438</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-043A">
<td class="addr"><a href="#addr-043A">043A</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">8C E0 FE</td>
</tr>

<tr id="addr-043D">
<td class="addr"><a href="#addr-043D">043D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;10</span></td>
<td class="hex">A0 10</td>
</tr>

<tr id="addr-043F">
<td class="addr"><a href="#addr-043F">043F</a></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#2</span></td>
<td class="hex">E0 02</td>
</tr>

<tr id="addr-0441">
<td class="addr"><a href="#addr-0441">0441</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-0445">c0445</a></span></td>
<td class="hex">90 02</td>
</tr>

<tr id="addr-0443">
<td class="addr"><a href="#addr-0443">0443</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;90</span></td>
<td class="hex">A0 90</td>
</tr>

<tr id="addr-0445">
<td class="addr"><a href="#addr-0445">0445</a></td>
<td><span class="label">.c0445</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">8C E0 FE</td>
</tr>

<tr id="addr-0448">
<td class="addr"><a href="#addr-0448">0448</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D9">tube_send_r4</a></span></td>
<td class="hex">20 D9 06</td>
</tr>

<tr id="addr-044B">
<td class="addr"><a href="#addr-044B">044B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;88</span></td>
<td class="hex">A0 88</td>
</tr>

<tr id="addr-044D">
<td class="addr"><a href="#addr-044D">044D</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-044E">
<td class="addr"><a href="#addr-044E">044E</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-0464">c0464</a></span></td>
<td class="hex">F0 14</td>
</tr>

<tr id="addr-0450">
<td class="addr"><a href="#addr-0450">0450</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#2</span></td>
<td class="hex">C9 02</td>
</tr>

<tr id="addr-0452">
<td class="addr"><a href="#addr-0452">0452</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-0464">c0464</a></span></td>
<td class="hex">F0 10</td>
</tr>

<tr id="addr-0454">
<td class="addr"><a href="#addr-0454">0454</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">8C E0 FE</td>
</tr>

<tr id="addr-0457">
<td class="addr"><a href="#addr-0457">0457</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#4</span></td>
<td class="hex">C9 04</td>
</tr>

<tr id="addr-0459">
<td class="addr"><a href="#addr-0459">0459</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-0472">return_15</a></span></td>
<td class="hex">D0 17</td>
</tr>

<tr id="addr-045B">
<td class="addr"><a href="#addr-045B">045B</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-045C">
<td class="addr"><a href="#addr-045C">045C</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-045D">
<td class="addr"><a href="#addr-045D">045D</a></td>
<td><span class="label">.c045d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-045F">
<td class="addr"><a href="#addr-045F">045F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0014">l0014</a></span></td>
<td class="hex">85 14</td>
</tr>

<tr id="addr-0461">
<td class="addr"><a href="#addr-0461">0461</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-05CD">tube_reply_byte</a></span></td>
<td class="hex">4C CD 05</td>
</tr>

<tr id="addr-0464">
<td class="addr"><a href="#addr-0464">0464</a></td>
<td><span class="label">.c0464</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE6">tube_status_register_4_and_cpu_control</a></span></td>
<td class="hex">2C E6 FE</td>
</tr>

<tr id="addr-0467">
<td class="addr"><a href="#addr-0467">0467</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-0464">c0464</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-0469">
<td class="addr"><a href="#addr-0469">0469</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">2C E5 FE</td>
</tr>

<tr id="addr-046C">
<td class="addr"><a href="#addr-046C">046C</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">2C E5 FE</td>
</tr>

<tr id="addr-046F">
<td class="addr"><a href="#addr-046F">046F</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">8C E0 FE</td>
</tr>

<tr id="addr-0472">
<td class="addr"><a href="#addr-0472">0472</a></td>
<td><span class="label">.return_15</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-0473">
<td class="addr"><a href="#addr-0473">0473</a></td>
<td><span class="label">.c0473</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CLI</span></td>
<td class="hex">58</td>
</tr>

<tr id="addr-0474">
<td class="addr"><a href="#addr-0474">0474</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-0475">
<td class="addr"><a href="#addr-0475">0475</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-0476">
<td class="addr"><a href="#addr-0476">0476</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-0478">
<td class="addr"><a href="#addr-0478">0478</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0057">tube_transfer_addr</a></span></td>
<td class="hex">84 57</td>
</tr>

<tr id="addr-047A">
<td class="addr"><a href="#addr-047A">047A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-047C">
<td class="addr"><a href="#addr-047C">047C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0058">l0058</a></span></td>
<td class="hex">85 58</td>
</tr>

<tr id="addr-047E">
<td class="addr"><a href="#addr-047E">047E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0001">l0001</a></span></td>
<td class="hex">85 01</td>
</tr>

<tr id="addr-0480">
<td class="addr"><a href="#addr-0480">0480</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A9 20</td>
</tr>

<tr id="addr-0482">
<td class="addr"><a href="#addr-0482">0482</a></td>
<td>    <span class="opcode">AND</span> <span class="operand"><a href="#addr-8006">rom_type</a></span></td>
<td class="hex">2D 06 80</td>
</tr>

<tr id="addr-0485">
<td class="addr"><a href="#addr-0485">0485</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-04A0">c04a0</a></span></td>
<td class="hex">F0 19</td>
</tr>

<tr id="addr-0487">
<td class="addr"><a href="#addr-0487">0487</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-8007">copyright_offset</a></span></td>
<td class="hex">AE 07 80</td>
</tr>

<tr id="addr-048A">
<td class="addr"><a href="#addr-048A">048A</a></td>
<td><span class="label">.loop_c048a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-048B">
<td class="addr"><a href="#addr-048B">048B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8000">rom_header</a>,x</span></td>
<td class="hex">BD 00 80</td>
</tr>

<tr id="addr-048E">
<td class="addr"><a href="#addr-048E">048E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-048A">loop_c048a</a></span></td>
<td class="hex">D0 FA</td>
</tr>

<tr id="addr-0490">
<td class="addr"><a href="#addr-0490">0490</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8001">l8001</a>,x</span></td>
<td class="hex">BD 01 80</td>
</tr>

<tr id="addr-0493">
<td class="addr"><a href="#addr-0493">0493</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0057">tube_transfer_addr</a></span></td>
<td class="hex">85 57</td>
</tr>

<tr id="addr-0495">
<td class="addr"><a href="#addr-0495">0495</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8002">l8002</a>,x</span></td>
<td class="hex">BD 02 80</td>
</tr>

<tr id="addr-0498">
<td class="addr"><a href="#addr-0498">0498</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0058">l0058</a></span></td>
<td class="hex">85 58</td>
</tr>

<tr id="addr-049A">
<td class="addr"><a href="#addr-049A">049A</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-8003">service_entry</a>,x</span></td>
<td class="hex">BC 03 80</td>
</tr>

<tr id="addr-049D">
<td class="addr"><a href="#addr-049D">049D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-8004">l8004</a>,x</span></td>
<td class="hex">BD 04 80</td>
</tr>

<tr id="addr-04A0">
<td class="addr"><a href="#addr-04A0">04A0</a></td>
<td><span class="label">.c04a0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-005A">l005a</a></span></td>
<td class="hex">85 5A</td>
</tr>

<tr id="addr-04A2">
<td class="addr"><a href="#addr-04A2">04A2</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0059">l0059</a></span></td>
<td class="hex">84 59</td>
</tr>

<tr id="addr-04A4">
<td class="addr"><a href="#addr-04A4">04A4</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-04A5">
<td class="addr"><a href="#addr-04A5">04A5</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-04A6">
<td class="addr"><a href="#addr-04A6">04A6</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-04BA">c04ba</a></span></td>
<td class="hex">B0 12</td>
</tr>

<tr id="addr-04A8">
<td class="addr"><a href="#addr-04A8">04A8</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-04A9">
<td class="addr"><a href="#addr-04A9">04A9</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-04AE">c04ae</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-04AB">
<td class="addr"><a href="#addr-04AB">04AB</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-05CB">tube_reply_ack</a></span></td>
<td class="hex">4C CB 05</td>
</tr>

<tr id="addr-04AE">
<td class="addr"><a href="#addr-04AE">04AE</a></td>
<td><span class="label">.c04ae</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-04B0">
<td class="addr"><a href="#addr-04B0">04B0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A0 FF</td>
</tr>

<tr id="addr-04B2">
<td class="addr"><a href="#addr-04B2">04B2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_write_last_break_type</span></td>
<td class="hex">A9 FD</td>
</tr>

<tr id="addr-04B4">
<td class="addr"><a href="#addr-04B4">04B4</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Read type of last reset</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-04B7">
<td class="addr"><a href="#addr-04B7">04B7</a></td>
<td>    <span class="opcode">TXA</span>  <span class="comment">; X=value of type of last reset</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-04B8">
<td class="addr"><a href="#addr-04B8">04B8</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-045D">c045d</a></span></td>
<td class="hex">F0 A3</td>
</tr>

<tr id="addr-04BA">
<td class="addr"><a href="#addr-04BA">04BA</a></td>
<td><span class="label">.c04ba</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-04BC">
<td class="addr"><a href="#addr-04BC">04BC</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr id="addr-04BF">
<td class="addr"><a href="#addr-04BF">04BF</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-04BA">c04ba</a></span></td>
<td class="hex">90 F9</td>
</tr>

<tr id="addr-04C1">
<td class="addr"><a href="#addr-04C1">04C1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-04C3">
<td class="addr"><a href="#addr-04C3">04C3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04E0">tube_setup_transfer</a></span></td>
<td class="hex">20 E0 04</td>
</tr>

<tr id="addr-04C6">
<td class="addr"><a href="#addr-04C6">04C6</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-04C8">
<td class="addr"><a href="#addr-04C8">04C8</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0000">l0000</a></span></td>
<td class="hex">84 00</td>
</tr>

<tr id="addr-04CA">
<td class="addr"><a href="#addr-04CA">04CA</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;40</span></td>
<td class="hex">A2 40</td>
</tr>

<tr id="addr-04CC">
<td class="addr"><a href="#addr-04CC">04CC</a></td>
<td><span class="label">.c04cc</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-0000">l0000</a>),y</span></td>
<td class="hex">B1 00</td>
</tr>

<tr id="addr-04CE">
<td class="addr"><a href="#addr-04CE">04CE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">8D E5 FE</td>
</tr>

<tr id="addr-04D1">
<td class="addr"><a href="#addr-04D1">04D1</a></td>
<td><span class="label">.loop_c04d1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE4">tube_status_register_3</a></span></td>
<td class="hex">2C E4 FE</td>
</tr>

<tr id="addr-04D4">
<td class="addr"><a href="#addr-04D4">04D4</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-04D1">loop_c04d1</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-04D6">
<td class="addr"><a href="#addr-04D6">04D6</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-04D7">
<td class="addr"><a href="#addr-04D7">04D7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-04CC">c04cc</a></span></td>
<td class="hex">D0 F3</td>
</tr>

<tr id="addr-04D9">
<td class="addr"><a href="#addr-04D9">04D9</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-0001">l0001</a></span></td>
<td class="hex">E6 01</td>
</tr>

<tr id="addr-04DB">
<td class="addr"><a href="#addr-04DB">04DB</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-04DC">
<td class="addr"><a href="#addr-04DC">04DC</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-04CC">c04cc</a></span></td>
<td class="hex">D0 EE</td>
</tr>

<tr id="addr-04DE">
<td class="addr"><a href="#addr-04DE">04DE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#4</span></td>
<td class="hex">A9 04</td>
</tr>

<tr id="addr-04E0">
<td class="addr"><a href="#addr-04E0">04E0</a></td>
<td><span class="label">.tube_setup_transfer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-04E2">
<td class="addr"><a href="#addr-04E2">04E2</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;57</span></td>
<td class="hex">A2 57</td>
</tr>

<tr id="addr-04E4">
<td class="addr"><a href="#addr-04E4">04E4</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">4C 06 04</td>
</tr>

<tr id="addr-04E7">
<td class="addr"><a href="#addr-04E7">04E7</a></td>
<td><span class="label">.tube_rdch_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-04E9">
<td class="addr"><a href="#addr-04E9">04E9</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-04EC">
<td class="addr"><a href="#addr-04EC">04EC</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0036">c0036</a></span></td>
<td class="hex">4C 36 00</td>
</tr>

<tr id="addr-04EF">
<td class="addr"><a href="#addr-04EF">04EF</a></td>
<td><span class="label">.tube_restore_regs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0010">zp_temp_10</a></span></td>
<td class="hex">A4 10</td>
</tr>

<tr id="addr-04F1">
<td class="addr"><a href="#addr-04F1">04F1</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0011">zp_temp_11</a></span></td>
<td class="hex">A6 11</td>
</tr>

<tr id="addr-04F3">
<td class="addr"><a href="#addr-04F3">04F3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-04F6">
<td class="addr"><a href="#addr-04F6">04F6</a></td>
<td>    <span class="opcode">ASL</span></td>
<td class="hex">0A</td>
</tr>

<tr id="addr-04F7">
<td class="addr"><a href="#addr-04F7">04F7</a></td>
<td><span class="label">.tube_read_r2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-04FA">
<td class="addr"><a href="#addr-04FA">04FA</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">10 FB</td>
</tr>

<tr id="addr-04FC">
<td class="addr"><a href="#addr-04FC">04FC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">AD E3 FE</td>
</tr>

<tr id="addr-04FF">
<td class="addr"><a href="#addr-04FF">04FF</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Tube host code page 5 — reference: NFS13 (TASKS, BPUT-FILE)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copied from ROM at $944C during init. Contains:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0500: tube_dispatch_table — 14-entry handler address table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $051C: tube_wrch_handler — WRCHV target</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $051F: tube_send_and_poll — send byte via R2, poll for reply</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0527: tube_poll_r1_wrch — service R1 WRCH while waiting for R2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $053D: tube_release_return — restore regs and RTS</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0543: tube_osbput — write byte to file</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0550: tube_osbget — read byte from file</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $055B: tube_osrdch — read character</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0569: tube_osfind — open file</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0580: tube_osfind_close — close file (A=0)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $058C: tube_osargs — file argument read/write</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $05B1: tube_read_string — read CR-terminated string into $0700</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $05C5: tube_oscli — execute * command</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $05CB: tube_reply_ack — send $7F acknowledge</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $05CD: tube_reply_byte — send byte and return to main loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $05D8: tube_osfile — whole file operation</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-0500">
<td class="addr"><a href="#addr-0500">0500</a></td>
<td><span class="label">.tube_dispatch_table</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;5B, &amp;05, &amp;C5, &amp;05, &amp;26, &amp;06, &amp;3B, &amp;06, &amp;5D, &amp;06, &amp;A3, &amp;06, &amp;EF, &amp;04, &amp;3D, &amp;05, &amp;8C, &amp;05, &amp;50, &amp;05, &amp;43, &amp;05, &amp;69, &amp;05, &amp;D8, &amp;05, &amp;02, &amp;06</td>
<td class="hex">5B 05 C5 05 26 06 3B 06 5D 06 A3 06 EF 04 3D 05 8C 05 50 05 43 05 69 05 D8 05 02 06</td>
</tr>

<tr id="addr-051C">
<td class="addr"><a href="#addr-051C">051C</a></td>
<td><span class="label">.tube_wrch_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-051D">
<td class="addr"><a href="#addr-051D">051D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-051F">
<td class="addr"><a href="#addr-051F">051F</a></td>
<td><span class="label">.tube_send_and_poll</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0522">
<td class="addr"><a href="#addr-0522">0522</a></td>
<td><span class="label">.c0522</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-0525">
<td class="addr"><a href="#addr-0525">0525</a></td>
<td>    <span class="opcode">BVS</span> <span class="operand"><a href="#addr-0535">c0535</a></span></td>
<td class="hex">70 0E</td>
</tr>

<tr id="addr-0527">
<td class="addr"><a href="#addr-0527">0527</a></td>
<td><span class="label">.tube_poll_r1_wrch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">2C E0 FE</td>
</tr>

<tr id="addr-052A">
<td class="addr"><a href="#addr-052A">052A</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0522">c0522</a></span></td>
<td class="hex">10 F6</td>
</tr>

<tr id="addr-052C">
<td class="addr"><a href="#addr-052C">052C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEE1">tube_data_register_1</a></span></td>
<td class="hex">AD E1 FE</td>
</tr>

<tr id="addr-052F">
<td class="addr"><a href="#addr-052F">052F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFCB">nvwrch</a></span>  <span class="comment">; Write character</span></td>
<td class="hex">20 CB FF</td>
</tr>

<tr id="addr-0532">
<td class="addr"><a href="#addr-0532">0532</a></td>
<td><span class="label">.tube_resume_poll</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0522">c0522</a></span></td>
<td class="hex">4C 22 05</td>
</tr>

<tr id="addr-0535">
<td class="addr"><a href="#addr-0535">0535</a></td>
<td><span class="label">.c0535</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-0536">
<td class="addr"><a href="#addr-0536">0536</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">8D E3 FE</td>
</tr>

<tr id="addr-0539">
<td class="addr"><a href="#addr-0539">0539</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-053A">
<td class="addr"><a href="#addr-053A">053A</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0036">c0036</a></span></td>
<td class="hex">4C 36 00</td>
</tr>

<tr id="addr-053D">
<td class="addr"><a href="#addr-053D">053D</a></td>
<td><span class="label">.tube_release_return</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-0011">zp_temp_11</a></span></td>
<td class="hex">A6 11</td>
</tr>

<tr id="addr-053F">
<td class="addr"><a href="#addr-053F">053F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0010">zp_temp_10</a></span></td>
<td class="hex">A4 10</td>
</tr>

<tr id="addr-0541">
<td class="addr"><a href="#addr-0541">0541</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-0542">
<td class="addr"><a href="#addr-0542">0542</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-0543">
<td class="addr"><a href="#addr-0543">0543</a></td>
<td><span class="label">.tube_osbput</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0546">
<td class="addr"><a href="#addr-0546">0546</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-0547">
<td class="addr"><a href="#addr-0547">0547</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-054A">
<td class="addr"><a href="#addr-054A">054A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFD4">osbput</a></span>  <span class="comment">; Write a single byte A to an open file Y</span></td>
<td class="hex">20 D4 FF</td>
</tr>

<tr id="addr-054D">
<td class="addr"><a href="#addr-054D">054D</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-05CB">tube_reply_ack</a></span></td>
<td class="hex">4C CB 05</td>
</tr>

<tr id="addr-0550">
<td class="addr"><a href="#addr-0550">0550</a></td>
<td><span class="label">.tube_osbget</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0553">
<td class="addr"><a href="#addr-0553">0553</a></td>
<td>    <span class="opcode">TAY</span>  <span class="comment">; Y=file handle</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-0554">
<td class="addr"><a href="#addr-0554">0554</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFD7">osbget</a></span>  <span class="comment">; Read a single byte from an open file Y</span></td>
<td class="hex">20 D7 FF</td>
</tr>

<tr id="addr-0557">
<td class="addr"><a href="#addr-0557">0557</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-0558">
<td class="addr"><a href="#addr-0558">0558</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-055F">c055f</a></span></td>
<td class="hex">4C 5F 05</td>
</tr>

<tr id="addr-055B">
<td class="addr"><a href="#addr-055B">055B</a></td>
<td><span class="label">.tube_osrdch</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFC8">nvrdch</a></span>  <span class="comment">; Read a character from the current input stream</span></td>
<td class="hex">20 C8 FF</td>
</tr>

<tr id="addr-055E">
<td class="addr"><a href="#addr-055E">055E</a></td>
<td>    <span class="opcode">PHA</span>  <span class="comment">; A=character read</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-055F">
<td class="addr"><a href="#addr-055F">055F</a></td>
<td><span class="label">.c055f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">09 80</td>
</tr>

<tr id="addr-0561">
<td class="addr"><a href="#addr-0561">0561</a></td>
<td><span class="label">.tube_rdch_reply</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-0562">
<td class="addr"><a href="#addr-0562">0562</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0565">
<td class="addr"><a href="#addr-0565">0565</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-0566">
<td class="addr"><a href="#addr-0566">0566</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-05CD">tube_reply_byte</a></span></td>
<td class="hex">4C CD 05</td>
</tr>

<tr id="addr-0569">
<td class="addr"><a href="#addr-0569">0569</a></td>
<td><span class="label">.tube_osfind</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-056C">
<td class="addr"><a href="#addr-056C">056C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-0580">tube_osfind_close</a></span></td>
<td class="hex">F0 12</td>
</tr>

<tr id="addr-056E">
<td class="addr"><a href="#addr-056E">056E</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-056F">
<td class="addr"><a href="#addr-056F">056F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-05B1">tube_read_string</a></span></td>
<td class="hex">20 B1 05</td>
</tr>

<tr id="addr-0572">
<td class="addr"><a href="#addr-0572">0572</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-0573">
<td class="addr"><a href="#addr-0573">0573</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFCE">osfind</a></span>  <span class="comment">; Open or close file(s)</span></td>
<td class="hex">20 CE FF</td>
</tr>

<tr id="addr-0576">
<td class="addr"><a href="#addr-0576">0576</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-0577">
<td class="addr"><a href="#addr-0577">0577</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-0579">
<td class="addr"><a href="#addr-0579">0579</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-057C">
<td class="addr"><a href="#addr-057C">057C</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-057D">
<td class="addr"><a href="#addr-057D">057D</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-05CD">tube_reply_byte</a></span></td>
<td class="hex">4C CD 05</td>
</tr>

<tr id="addr-0580">
<td class="addr"><a href="#addr-0580">0580</a></td>
<td><span class="label">.tube_osfind_close</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0583">
<td class="addr"><a href="#addr-0583">0583</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-0584">
<td class="addr"><a href="#addr-0584">0584</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osfind_close</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-0586">
<td class="addr"><a href="#addr-0586">0586</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFCE">osfind</a></span>  <span class="comment">; Close one or all files</span></td>
<td class="hex">20 CE FF</td>
</tr>

<tr id="addr-0589">
<td class="addr"><a href="#addr-0589">0589</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-05CB">tube_reply_ack</a></span></td>
<td class="hex">4C CB 05</td>
</tr>

<tr id="addr-058C">
<td class="addr"><a href="#addr-058C">058C</a></td>
<td><span class="label">.tube_osargs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-058F">
<td class="addr"><a href="#addr-058F">058F</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-0590">
<td class="addr"><a href="#addr-0590">0590</a></td>
<td><span class="label">.tube_read_params</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-0592">
<td class="addr"><a href="#addr-0592">0592</a></td>
<td><span class="label">.loop_c0592</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0595">
<td class="addr"><a href="#addr-0595">0595</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0000">l0000</a>,x</span></td>
<td class="hex">95 00</td>
</tr>

<tr id="addr-0597">
<td class="addr"><a href="#addr-0597">0597</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-0598">
<td class="addr"><a href="#addr-0598">0598</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0592">loop_c0592</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-059A">
<td class="addr"><a href="#addr-059A">059A</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-059B">
<td class="addr"><a href="#addr-059B">059B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-059E">
<td class="addr"><a href="#addr-059E">059E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFDA">osargs</a></span>  <span class="comment">; Read or write a file&#39;s attributes</span></td>
<td class="hex">20 DA FF</td>
</tr>

<tr id="addr-05A1">
<td class="addr"><a href="#addr-05A1">05A1</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-05A4">
<td class="addr"><a href="#addr-05A4">05A4</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#3</span></td>
<td class="hex">A2 03</td>
</tr>

<tr id="addr-05A6">
<td class="addr"><a href="#addr-05A6">05A6</a></td>
<td><span class="label">.loop_c05a6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0000">l0000</a>,x</span></td>
<td class="hex">B5 00</td>
</tr>

<tr id="addr-05A8">
<td class="addr"><a href="#addr-05A8">05A8</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-05AB">
<td class="addr"><a href="#addr-05AB">05AB</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-05AC">
<td class="addr"><a href="#addr-05AC">05AC</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-05A6">loop_c05a6</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-05AE">
<td class="addr"><a href="#addr-05AE">05AE</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-003A">tube_main_loop</a></span></td>
<td class="hex">4C 3A 00</td>
</tr>

<tr id="addr-05B1">
<td class="addr"><a href="#addr-05B1">05B1</a></td>
<td><span class="label">.tube_read_string</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-05B3">
<td class="addr"><a href="#addr-05B3">05B3</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-05B5">
<td class="addr"><a href="#addr-05B5">05B5</a></td>
<td><span class="label">.loop_c05b5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-05B8">
<td class="addr"><a href="#addr-05B8">05B8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0700">l0700</a>,y</span></td>
<td class="hex">99 00 07</td>
</tr>

<tr id="addr-05BB">
<td class="addr"><a href="#addr-05BB">05BB</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-05BC">
<td class="addr"><a href="#addr-05BC">05BC</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-05C2">c05c2</a></span></td>
<td class="hex">F0 04</td>
</tr>

<tr id="addr-05BE">
<td class="addr"><a href="#addr-05BE">05BE</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">C9 0D</td>
</tr>

<tr id="addr-05C0">
<td class="addr"><a href="#addr-05C0">05C0</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-05B5">loop_c05b5</a></span></td>
<td class="hex">D0 F3</td>
</tr>

<tr id="addr-05C2">
<td class="addr"><a href="#addr-05C2">05C2</a></td>
<td><span class="label">.c05c2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#7</span></td>
<td class="hex">A0 07</td>
</tr>

<tr id="addr-05C4">
<td class="addr"><a href="#addr-05C4">05C4</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-05C5">
<td class="addr"><a href="#addr-05C5">05C5</a></td>
<td><span class="label">.tube_oscli</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-05B1">tube_read_string</a></span></td>
<td class="hex">20 B1 05</td>
</tr>

<tr id="addr-05C8">
<td class="addr"><a href="#addr-05C8">05C8</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF7">oscli</a></span></td>
<td class="hex">20 F7 FF</td>
</tr>

<tr id="addr-05CB">
<td class="addr"><a href="#addr-05CB">05CB</a></td>
<td><span class="label">.tube_reply_ack</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A9 7F</td>
</tr>

<tr id="addr-05CD">
<td class="addr"><a href="#addr-05CD">05CD</a></td>
<td><span class="label">.tube_reply_byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-05D0">
<td class="addr"><a href="#addr-05D0">05D0</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-05CD">tube_reply_byte</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-05D2">
<td class="addr"><a href="#addr-05D2">05D2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">8D E3 FE</td>
</tr>

<tr id="addr-05D5">
<td class="addr"><a href="#addr-05D5">05D5</a></td>
<td><span class="label">.c05d5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-003A">tube_main_loop</a></span></td>
<td class="hex">4C 3A 00</td>
</tr>

<tr id="addr-05D8">
<td class="addr"><a href="#addr-05D8">05D8</a></td>
<td><span class="label">.tube_osfile</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;10</span></td>
<td class="hex">A2 10</td>
</tr>

<tr id="addr-05DA">
<td class="addr"><a href="#addr-05DA">05DA</a></td>
<td><span class="label">.loop_c05da</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-05DD">
<td class="addr"><a href="#addr-05DD">05DD</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0001">l0001</a>,x</span></td>
<td class="hex">95 01</td>
</tr>

<tr id="addr-05DF">
<td class="addr"><a href="#addr-05DF">05DF</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-05E0">
<td class="addr"><a href="#addr-05E0">05E0</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-05DA">loop_c05da</a></span></td>
<td class="hex">D0 F8</td>
</tr>

<tr id="addr-05E2">
<td class="addr"><a href="#addr-05E2">05E2</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-05B1">tube_read_string</a></span></td>
<td class="hex">20 B1 05</td>
</tr>

<tr id="addr-05E5">
<td class="addr"><a href="#addr-05E5">05E5</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0000">l0000</a></span></td>
<td class="hex">86 00</td>
</tr>

<tr id="addr-05E7">
<td class="addr"><a href="#addr-05E7">05E7</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0001">l0001</a></span></td>
<td class="hex">84 01</td>
</tr>

<tr id="addr-05E9">
<td class="addr"><a href="#addr-05E9">05E9</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-05EB">
<td class="addr"><a href="#addr-05EB">05EB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-05EE">
<td class="addr"><a href="#addr-05EE">05EE</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFDD">osfile</a></span></td>
<td class="hex">20 DD FF</td>
</tr>

<tr id="addr-05F1">
<td class="addr"><a href="#addr-05F1">05F1</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">09 80</td>
</tr>

<tr id="addr-05F3">
<td class="addr"><a href="#addr-05F3">05F3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-05F6">
<td class="addr"><a href="#addr-05F6">05F6</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;10</span></td>
<td class="hex">A2 10</td>
</tr>

<tr id="addr-05F8">
<td class="addr"><a href="#addr-05F8">05F8</a></td>
<td><span class="label">.loop_c05f8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0001">l0001</a>,x</span></td>
<td class="hex">B5 01</td>
</tr>

<tr id="addr-05FA">
<td class="addr"><a href="#addr-05FA">05FA</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-05FD">
<td class="addr"><a href="#addr-05FD">05FD</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-05FE">
<td class="addr"><a href="#addr-05FE">05FE</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-05F8">loop_c05f8</a></span></td>
<td class="hex">D0 F8</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Tube host code page 6 — reference: NFS13 (GBPB-ESCA)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copied from ROM at $954C during init. $0600-$0601 is the tail</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; of tube_osfile (BEQ to tube_reply_byte when done). Contains:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0602: tube_osgbpb — multi-byte file I/O</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $0626: tube_osbyte_short — 2-param OSBYTE (returns X)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $063B: tube_osbyte_long — 3-param OSBYTE (returns carry+Y+X)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $065D: tube_osword — variable-length OSWORD (buffer at $0130)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $06A3: tube_osword_rdln — OSWORD 0 (read line, 5-byte params)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $06BB: tube_rdln_send_line — send input line from $0700</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $06D0: tube_send_r2 — poll R2 status, write A to R2 data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $06D9: tube_send_r4 — poll R4 status, write A to R4 data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $06E2: tube_escape_check — check $FF, forward escape to R1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $06E8: tube_event_handler — EVNTV: forward event (A,X,Y) via R1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $06F7: tube_send_r1 — poll R1 status, write A to R1 data</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-0600">
<td class="addr"><a href="#addr-0600">0600</a></td>
<td><span class="label">.tube_code_page6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-05D5">c05d5</a></span></td>
<td class="hex">F0 D3</td>
</tr>

<tr id="addr-0602">
<td class="addr"><a href="#addr-0602">0602</a></td>
<td><span class="label">.tube_osgbpb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">A2 0C</td>
</tr>

<tr id="addr-0604">
<td class="addr"><a href="#addr-0604">0604</a></td>
<td><span class="label">.loop_c0604</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0607">
<td class="addr"><a href="#addr-0607">0607</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0000">l0000</a>,x</span></td>
<td class="hex">95 00</td>
</tr>

<tr id="addr-0609">
<td class="addr"><a href="#addr-0609">0609</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-060A">
<td class="addr"><a href="#addr-060A">060A</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0604">loop_c0604</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-060C">
<td class="addr"><a href="#addr-060C">060C</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-060F">
<td class="addr"><a href="#addr-060F">060F</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-0610">
<td class="addr"><a href="#addr-0610">0610</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-0612">
<td class="addr"><a href="#addr-0612">0612</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFD1">osgbpb</a></span>  <span class="comment">; Read or write multiple bytes to an open file</span></td>
<td class="hex">20 D1 FF</td>
</tr>

<tr id="addr-0615">
<td class="addr"><a href="#addr-0615">0615</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-0616">
<td class="addr"><a href="#addr-0616">0616</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0619">
<td class="addr"><a href="#addr-0619">0619</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">A2 0C</td>
</tr>

<tr id="addr-061B">
<td class="addr"><a href="#addr-061B">061B</a></td>
<td><span class="label">.loop_c061b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0000">l0000</a>,x</span></td>
<td class="hex">B5 00</td>
</tr>

<tr id="addr-061D">
<td class="addr"><a href="#addr-061D">061D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0620">
<td class="addr"><a href="#addr-0620">0620</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-0621">
<td class="addr"><a href="#addr-0621">0621</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-061B">loop_c061b</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-0623">
<td class="addr"><a href="#addr-0623">0623</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-003A">tube_main_loop</a></span></td>
<td class="hex">4C 3A 00</td>
</tr>

<tr id="addr-0626">
<td class="addr"><a href="#addr-0626">0626</a></td>
<td><span class="label">.tube_osbyte_short</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0629">
<td class="addr"><a href="#addr-0629">0629</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-062A">
<td class="addr"><a href="#addr-062A">062A</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-062D">
<td class="addr"><a href="#addr-062D">062D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-0630">
<td class="addr"><a href="#addr-0630">0630</a></td>
<td><span class="label">.tube_osbyte_send_x</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-0633">
<td class="addr"><a href="#addr-0633">0633</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-0630">tube_osbyte_send_x</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-0635">
<td class="addr"><a href="#addr-0635">0635</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">8E E3 FE</td>
</tr>

<tr id="addr-0638">
<td class="addr"><a href="#addr-0638">0638</a></td>
<td><span class="label">.loop_c0638</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-003A">tube_main_loop</a></span></td>
<td class="hex">4C 3A 00</td>
</tr>

<tr id="addr-063B">
<td class="addr"><a href="#addr-063B">063B</a></td>
<td><span class="label">.tube_osbyte_long</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-063E">
<td class="addr"><a href="#addr-063E">063E</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-063F">
<td class="addr"><a href="#addr-063F">063F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0642">
<td class="addr"><a href="#addr-0642">0642</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-0643">
<td class="addr"><a href="#addr-0643">0643</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0646">
<td class="addr"><a href="#addr-0646">0646</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-0649">
<td class="addr"><a href="#addr-0649">0649</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;9d</span></td>
<td class="hex">49 9D</td>
</tr>

<tr id="addr-064B">
<td class="addr"><a href="#addr-064B">064B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-0638">loop_c0638</a></span></td>
<td class="hex">F0 EB</td>
</tr>

<tr id="addr-064D">
<td class="addr"><a href="#addr-064D">064D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;40</span></td>
<td class="hex">A9 40</td>
</tr>

<tr id="addr-064F">
<td class="addr"><a href="#addr-064F">064F</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-0650">
<td class="addr"><a href="#addr-0650">0650</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0653">
<td class="addr"><a href="#addr-0653">0653</a></td>
<td><span class="label">.tube_osbyte_send_y</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-0656">
<td class="addr"><a href="#addr-0656">0656</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-0653">tube_osbyte_send_y</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-0658">
<td class="addr"><a href="#addr-0658">0658</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">8C E3 FE</td>
</tr>

<tr id="addr-065B">
<td class="addr"><a href="#addr-065B">065B</a></td>
<td>    <span class="opcode">BVS</span> <span class="operand"><a href="#addr-0630">tube_osbyte_send_x</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">70 D3</td>
</tr>

<tr id="addr-065D">
<td class="addr"><a href="#addr-065D">065D</a></td>
<td><span class="label">.tube_osword</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-0660">
<td class="addr"><a href="#addr-0660">0660</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-0661">
<td class="addr"><a href="#addr-0661">0661</a></td>
<td><span class="label">.tube_osword_read</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-0664">
<td class="addr"><a href="#addr-0664">0664</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0661">tube_osword_read</a></span></td>
<td class="hex">10 FB</td>
</tr>

<tr id="addr-0666">
<td class="addr"><a href="#addr-0666">0666</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">AE E3 FE</td>
</tr>

<tr id="addr-0669">
<td class="addr"><a href="#addr-0669">0669</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-066A">
<td class="addr"><a href="#addr-066A">066A</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-067B">c067b</a></span></td>
<td class="hex">30 0F</td>
</tr>

<tr id="addr-066C">
<td class="addr"><a href="#addr-066C">066C</a></td>
<td><span class="label">.tube_osword_read_lp</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-066F">
<td class="addr"><a href="#addr-066F">066F</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-066C">tube_osword_read_lp</a></span></td>
<td class="hex">10 FB</td>
</tr>

<tr id="addr-0671">
<td class="addr"><a href="#addr-0671">0671</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">AD E3 FE</td>
</tr>

<tr id="addr-0674">
<td class="addr"><a href="#addr-0674">0674</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0130">l0130</a>,x</span></td>
<td class="hex">9D 30 01</td>
</tr>

<tr id="addr-0677">
<td class="addr"><a href="#addr-0677">0677</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-0678">
<td class="addr"><a href="#addr-0678">0678</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-066C">tube_osword_read_lp</a></span></td>
<td class="hex">10 F2</td>
</tr>

<tr id="addr-067A">
<td class="addr"><a href="#addr-067A">067A</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-067B">
<td class="addr"><a href="#addr-067B">067B</a></td>
<td><span class="label">.c067b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&lt;(l0130)</span></td>
<td class="hex">A2 30</td>
</tr>

<tr id="addr-067D">
<td class="addr"><a href="#addr-067D">067D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&gt;(l0130)</span></td>
<td class="hex">A0 01</td>
</tr>

<tr id="addr-067F">
<td class="addr"><a href="#addr-067F">067F</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF1">osword</a></span></td>
<td class="hex">20 F1 FF</td>
</tr>

<tr id="addr-0682">
<td class="addr"><a href="#addr-0682">0682</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-0684">
<td class="addr"><a href="#addr-0684">0684</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-0687">
<td class="addr"><a href="#addr-0687">0687</a></td>
<td><span class="label">.loop_c0687</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-068A">
<td class="addr"><a href="#addr-068A">068A</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0687">loop_c0687</a></span></td>
<td class="hex">10 FB</td>
</tr>

<tr id="addr-068C">
<td class="addr"><a href="#addr-068C">068C</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">AE E3 FE</td>
</tr>

<tr id="addr-068F">
<td class="addr"><a href="#addr-068F">068F</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-0690">
<td class="addr"><a href="#addr-0690">0690</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-06A0">tube_return_main</a></span></td>
<td class="hex">30 0E</td>
</tr>

<tr id="addr-0692">
<td class="addr"><a href="#addr-0692">0692</a></td>
<td><span class="label">.tube_osword_write</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0130">l0130</a>,x</span></td>
<td class="hex">BC 30 01</td>
</tr>

<tr id="addr-0695">
<td class="addr"><a href="#addr-0695">0695</a></td>
<td><span class="label">.tube_osword_write_lp</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-0698">
<td class="addr"><a href="#addr-0698">0698</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-0695">tube_osword_write_lp</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-069A">
<td class="addr"><a href="#addr-069A">069A</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">8C E3 FE</td>
</tr>

<tr id="addr-069D">
<td class="addr"><a href="#addr-069D">069D</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-069E">
<td class="addr"><a href="#addr-069E">069E</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-0692">tube_osword_write</a></span></td>
<td class="hex">10 F2</td>
</tr>

<tr id="addr-06A0">
<td class="addr"><a href="#addr-06A0">06A0</a></td>
<td><span class="label">.tube_return_main</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-003A">tube_main_loop</a></span></td>
<td class="hex">4C 3A 00</td>
</tr>

<tr id="addr-06A3">
<td class="addr"><a href="#addr-06A3">06A3</a></td>
<td><span class="label">.tube_osword_rdln</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#4</span></td>
<td class="hex">A2 04</td>
</tr>

<tr id="addr-06A5">
<td class="addr"><a href="#addr-06A5">06A5</a></td>
<td><span class="label">.loop_c06a5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-04F7">tube_read_r2</a></span></td>
<td class="hex">20 F7 04</td>
</tr>

<tr id="addr-06A8">
<td class="addr"><a href="#addr-06A8">06A8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0000">l0000</a>,x</span></td>
<td class="hex">95 00</td>
</tr>

<tr id="addr-06AA">
<td class="addr"><a href="#addr-06AA">06AA</a></td>
<td>    <span class="opcode">DEX</span></td>
<td class="hex">CA</td>
</tr>

<tr id="addr-06AB">
<td class="addr"><a href="#addr-06AB">06AB</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-06A5">loop_c06a5</a></span></td>
<td class="hex">10 F8</td>
</tr>

<tr id="addr-06AD">
<td class="addr"><a href="#addr-06AD">06AD</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-06AE">
<td class="addr"><a href="#addr-06AE">06AE</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-06B0">
<td class="addr"><a href="#addr-06B0">06B0</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-06B1">
<td class="addr"><a href="#addr-06B1">06B1</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF1">osword</a></span></td>
<td class="hex">20 F1 FF</td>
</tr>

<tr id="addr-06B4">
<td class="addr"><a href="#addr-06B4">06B4</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-06BB">tube_rdln_send_line</a></span></td>
<td class="hex">90 05</td>
</tr>

<tr id="addr-06B6">
<td class="addr"><a href="#addr-06B6">06B6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-06B8">
<td class="addr"><a href="#addr-06B8">06B8</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-05CD">tube_reply_byte</a></span></td>
<td class="hex">4C CD 05</td>
</tr>

<tr id="addr-06BB">
<td class="addr"><a href="#addr-06BB">06BB</a></td>
<td><span class="label">.tube_rdln_send_line</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-06BD">
<td class="addr"><a href="#addr-06BD">06BD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A9 7F</td>
</tr>

<tr id="addr-06BF">
<td class="addr"><a href="#addr-06BF">06BF</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-06C2">
<td class="addr"><a href="#addr-06C2">06C2</a></td>
<td><span class="label">.tube_rdln_send_loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0700">l0700</a>,x</span></td>
<td class="hex">BD 00 07</td>
</tr>

<tr id="addr-06C5">
<td class="addr"><a href="#addr-06C5">06C5</a></td>
<td><span class="label">.tube_rdln_send_byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">20 D0 06</td>
</tr>

<tr id="addr-06C8">
<td class="addr"><a href="#addr-06C8">06C8</a></td>
<td>    <span class="opcode">INX</span></td>
<td class="hex">E8</td>
</tr>

<tr id="addr-06C9">
<td class="addr"><a href="#addr-06C9">06C9</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;0d</span></td>
<td class="hex">C9 0D</td>
</tr>

<tr id="addr-06CB">
<td class="addr"><a href="#addr-06CB">06CB</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-06C2">tube_rdln_send_loop</a></span></td>
<td class="hex">D0 F5</td>
</tr>

<tr id="addr-06CD">
<td class="addr"><a href="#addr-06CD">06CD</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-003A">tube_main_loop</a></span></td>
<td class="hex">4C 3A 00</td>
</tr>

<tr id="addr-06D0">
<td class="addr"><a href="#addr-06D0">06D0</a></td>
<td><span class="label">.tube_send_r2</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE2">tube_status_register_2</a></span></td>
<td class="hex">2C E2 FE</td>
</tr>

<tr id="addr-06D3">
<td class="addr"><a href="#addr-06D3">06D3</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-06D0">tube_send_r2</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-06D5">
<td class="addr"><a href="#addr-06D5">06D5</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE3">tube_data_register_2</a></span></td>
<td class="hex">8D E3 FE</td>
</tr>

<tr id="addr-06D8">
<td class="addr"><a href="#addr-06D8">06D8</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-06D9">
<td class="addr"><a href="#addr-06D9">06D9</a></td>
<td><span class="label">.tube_send_r4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE6">tube_status_register_4_and_cpu_control</a></span></td>
<td class="hex">2C E6 FE</td>
</tr>

<tr id="addr-06DC">
<td class="addr"><a href="#addr-06DC">06DC</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-06D9">tube_send_r4</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-06DE">
<td class="addr"><a href="#addr-06DE">06DE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE7">tube_data_register_4</a></span></td>
<td class="hex">8D E7 FE</td>
</tr>

<tr id="addr-06E1">
<td class="addr"><a href="#addr-06E1">06E1</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-06E2">
<td class="addr"><a href="#addr-06E2">06E2</a></td>
<td><span class="label">.tube_escape_check</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00FF">l00ff</a></span></td>
<td class="hex">A5 FF</td>
</tr>

<tr id="addr-06E4">
<td class="addr"><a href="#addr-06E4">06E4</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-06E5">
<td class="addr"><a href="#addr-06E5">06E5</a></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-06E6">
<td class="addr"><a href="#addr-06E6">06E6</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-06F7">tube_send_r1</a></span></td>
<td class="hex">30 0F</td>
</tr>

<tr id="addr-06E8">
<td class="addr"><a href="#addr-06E8">06E8</a></td>
<td><span class="label">.tube_event_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-06E9">
<td class="addr"><a href="#addr-06E9">06E9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-06EB">
<td class="addr"><a href="#addr-06EB">06EB</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06F7">tube_send_r1</a></span></td>
<td class="hex">20 F7 06</td>
</tr>

<tr id="addr-06EE">
<td class="addr"><a href="#addr-06EE">06EE</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-06EF">
<td class="addr"><a href="#addr-06EF">06EF</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06F7">tube_send_r1</a></span></td>
<td class="hex">20 F7 06</td>
</tr>

<tr id="addr-06F2">
<td class="addr"><a href="#addr-06F2">06F2</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-06F3">
<td class="addr"><a href="#addr-06F3">06F3</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-06F7">tube_send_r1</a></span></td>
<td class="hex">20 F7 06</td>
</tr>

<tr id="addr-06F6">
<td class="addr"><a href="#addr-06F6">06F6</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-06F7">
<td class="addr"><a href="#addr-06F7">06F7</a></td>
<td><span class="label">.tube_send_r1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEE0">tube_status_1_and_tube_control</a></span></td>
<td class="hex">2C E0 FE</td>
</tr>

<tr id="addr-06FA">
<td class="addr"><a href="#addr-06FA">06FA</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-06F7">tube_send_r1</a></span></td>
<td class="hex">50 FB</td>
</tr>

<tr id="addr-06FC">
<td class="addr"><a href="#addr-06FC">06FC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE1">tube_data_register_1</a></span></td>
<td class="hex">8D E1 FE</td>
</tr>

<tr id="addr-06FF">
<td class="addr"><a href="#addr-06FF">06FF</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-964C">
<td class="addr"><a href="#addr-964C">964C</a></td>
<td>    <span class="directive">EQUB</span> &amp;60, &amp;FF, &amp;42, &amp;FF, &amp;00, &amp;FF, &amp;77, &amp;FF, &amp;FF, &amp;FF, &amp;DF, &amp;FF, &amp;00, &amp;FF, &amp;00, &amp;FF, &amp;00, &amp;FF, &amp;04, &amp;FF</td>
<td class="hex">60 FF 42 FF 00 FF 77 FF FF FF DF FF 00 FF 00 FF 00 FF 04 FF</td>
</tr>

<tr id="addr-9660">
<td class="addr"><a href="#addr-9660">9660</a></td>
<td><span class="label">.trampoline_tx_setup</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9BE4">c9be4</a></span></td>
<td class="hex">4C E4 9B</td>
</tr>

<tr id="addr-9663">
<td class="addr"><a href="#addr-9663">9663</a></td>
<td><span class="label">.trampoline_adlc_init</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-966F">adlc_init</a></span></td>
<td class="hex">4C 6F 96</td>
</tr>

<tr id="addr-9666">
<td class="addr"><a href="#addr-9666">9666</a></td>
<td><span class="label">.svc_nmi_release</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-969D">save_econet_state</a></span></td>
<td class="hex">4C 9D 96</td>
</tr>

<tr id="addr-9669">
<td class="addr"><a href="#addr-9669">9669</a></td>
<td><span class="label">.svc_nmi_claim</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-96B4">restore_econet_state</a></span></td>
<td class="hex">4C B4 96</td>
</tr>

<tr id="addr-966C">
<td class="addr"><a href="#addr-966C">966C</a></td>
<td><span class="label">.svc_unknown_irq</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9B52">c9b52</a></span></td>
<td class="hex">4C 52 9B</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ADLC initialisation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads station ID (INTOFF side effect), performs full ADLC reset,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; checks for Tube presence (OSBYTE $EA), then falls through to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; adlc_init_workspace.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-966F">
<td class="addr"><a href="#addr-966F">966F</a></td>
<td><span class="label">.adlc_init</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span></td>
<td class="hex">2C 18 FE</td>
</tr>

<tr id="addr-9672">
<td class="addr"><a href="#addr-9672">9672</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-96DC">adlc_full_reset</a></span></td>
<td class="hex">20 DC 96</td>
</tr>

<tr id="addr-9675">
<td class="addr"><a href="#addr-9675">9675</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#osbyte_read_tube_presence</span></td>
<td class="hex">A9 EA</td>
</tr>

<tr id="addr-9677">
<td class="addr"><a href="#addr-9677">9677</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#0</span></td>
<td class="hex">A2 00</td>
</tr>

<tr id="addr-9679">
<td class="addr"><a href="#addr-9679">9679</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">A0 FF</td>
</tr>

<tr id="addr-967B">
<td class="addr"><a href="#addr-967B">967B</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-FFF4">osbyte</a></span>  <span class="comment">; Read Tube present flag</span></td>
<td class="hex">20 F4 FF</td>
</tr>

<tr id="addr-967E">
<td class="addr"><a href="#addr-967E">967E</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0D52">tx_in_progress</a></span>  <span class="comment">; X=value of Tube present flag</span></td>
<td class="hex">8E 52 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Initialise NMI workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies NMI shim from ROM to $0D00, stores current ROM bank number</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; into shim self-modifying code, sets TX status to $80 (idle/complete),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; saves station ID from $FE18 into TX scout buffer, re-enables NMIs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; by reading $FE20.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9681">
<td class="addr"><a href="#addr-9681">9681</a></td>
<td><span class="label">.adlc_init_workspace</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-96CD">install_nmi_shim</a></span></td>
<td class="hex">20 CD 96</td>
</tr>

<tr id="addr-9684">
<td class="addr"><a href="#addr-9684">9684</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00F4">romsel_copy</a></span></td>
<td class="hex">A5 F4</td>
</tr>

<tr id="addr-9686">
<td class="addr"><a href="#addr-9686">9686</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D07">nmi_shim_07</a></span></td>
<td class="hex">8D 07 0D</td>
</tr>

<tr id="addr-9689">
<td class="addr"><a href="#addr-9689">9689</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-968B">
<td class="addr"><a href="#addr-968B">968B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3A">tx_ctrl_status</a></span></td>
<td class="hex">8D 3A 0D</td>
</tr>

<tr id="addr-968E">
<td class="addr"><a href="#addr-968E">968E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span></td>
<td class="hex">AD 18 FE</td>
</tr>

<tr id="addr-9691">
<td class="addr"><a href="#addr-9691">9691</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D22">tx_src_stn</a></span></td>
<td class="hex">8D 22 0D</td>
</tr>

<tr id="addr-9694">
<td class="addr"><a href="#addr-9694">9694</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9696">
<td class="addr"><a href="#addr-9696">9696</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D23">tx_src_net</a></span></td>
<td class="hex">8D 23 0D</td>
</tr>

<tr id="addr-9699">
<td class="addr"><a href="#addr-9699">9699</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE20">video_ula_control</a></span></td>
<td class="hex">2C 20 FE</td>
</tr>

<tr id="addr-969C">
<td class="addr"><a href="#addr-969C">969C</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Save Econet state to RX control block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores rx_status_flags, protection_mask, and tx_in_progress</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to (net_rx_ptr) at offsets 8-10. INTOFF side effect on entry.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-969D">
<td class="addr"><a href="#addr-969D">969D</a></td>
<td><span class="label">.save_econet_state</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span></td>
<td class="hex">2C 18 FE</td>
</tr>

<tr id="addr-96A0">
<td class="addr"><a href="#addr-96A0">96A0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-96A2">
<td class="addr"><a href="#addr-96A2">96A2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">AD 38 0D</td>
</tr>

<tr id="addr-96A5">
<td class="addr"><a href="#addr-96A5">96A5</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-96A7">
<td class="addr"><a href="#addr-96A7">96A7</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;09</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-96A8">
<td class="addr"><a href="#addr-96A8">96A8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">AD 63 0D</td>
</tr>

<tr id="addr-96AB">
<td class="addr"><a href="#addr-96AB">96AB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-96AD">
<td class="addr"><a href="#addr-96AD">96AD</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;0a</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-96AE">
<td class="addr"><a href="#addr-96AE">96AE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D52">tx_in_progress</a></span></td>
<td class="hex">AD 52 0D</td>
</tr>

<tr id="addr-96B1">
<td class="addr"><a href="#addr-96B1">96B1</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-96B3">
<td class="addr"><a href="#addr-96B3">96B3</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Restore Econet state from RX control block</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Loads rx_status_flags, protection_mask, and tx_in_progress</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; from (net_rx_ptr) at offsets 8-10, then reinitialises via</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; adlc_init_workspace.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-96B4">
<td class="addr"><a href="#addr-96B4">96B4</a></td>
<td><span class="label">.restore_econet_state</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span></td>
<td class="hex">2C 18 FE</td>
</tr>

<tr id="addr-96B7">
<td class="addr"><a href="#addr-96B7">96B7</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-96B9">
<td class="addr"><a href="#addr-96B9">96B9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-96BB">
<td class="addr"><a href="#addr-96BB">96BB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">8D 38 0D</td>
</tr>

<tr id="addr-96BE">
<td class="addr"><a href="#addr-96BE">96BE</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;09</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-96BF">
<td class="addr"><a href="#addr-96BF">96BF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-96C1">
<td class="addr"><a href="#addr-96C1">96C1</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">8D 63 0D</td>
</tr>

<tr id="addr-96C4">
<td class="addr"><a href="#addr-96C4">96C4</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;0a</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-96C5">
<td class="addr"><a href="#addr-96C5">96C5</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">B1 9C</td>
</tr>

<tr id="addr-96C7">
<td class="addr"><a href="#addr-96C7">96C7</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D52">tx_in_progress</a></span></td>
<td class="hex">8D 52 0D</td>
</tr>

<tr id="addr-96CA">
<td class="addr"><a href="#addr-96CA">96CA</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9681">adlc_init_workspace</a></span></td>
<td class="hex">4C 81 96</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copy NMI shim from ROM ($9FCA) to RAM ($0D00)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Copies 32 bytes. Interrupts are enabled during the copy.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-96CD">
<td class="addr"><a href="#addr-96CD">96CD</a></td>
<td><span class="label">.install_nmi_shim</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-96CE">
<td class="addr"><a href="#addr-96CE">96CE</a></td>
<td>    <span class="opcode">CLI</span></td>
<td class="hex">58</td>
</tr>

<tr id="addr-96CF">
<td class="addr"><a href="#addr-96CF">96CF</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A0 20</td>
</tr>

<tr id="addr-96D1">
<td class="addr"><a href="#addr-96D1">96D1</a></td>
<td><span class="label">.loop_c96d1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9FCA">nmi_shim_rom_src</a>,y</span></td>
<td class="hex">B9 CA 9F</td>
</tr>

<tr id="addr-96D4">
<td class="addr"><a href="#addr-96D4">96D4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0CFF">l0cff</a>,y</span></td>
<td class="hex">99 FF 0C</td>
</tr>

<tr id="addr-96D7">
<td class="addr"><a href="#addr-96D7">96D7</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-96D8">
<td class="addr"><a href="#addr-96D8">96D8</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-96D1">loop_c96d1</a></span></td>
<td class="hex">D0 F7</td>
</tr>

<tr id="addr-96DA">
<td class="addr"><a href="#addr-96DA">96DA</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-96DB">
<td class="addr"><a href="#addr-96DB">96DB</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ADLC full reset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Aborts all activity and returns to idle RX listen mode.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-96DC">
<td class="addr"><a href="#addr-96DC">96DC</a></td>
<td><span class="label">.adlc_full_reset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;c1</span>  <span class="comment">; CR1=$C1: TX_RESET | RX_RESET | AC (both sections in reset, address control set)</span></td>
<td class="hex">A9 C1</td>
</tr>

<tr id="addr-96DE">
<td class="addr"><a href="#addr-96DE">96DE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-96E1">
<td class="addr"><a href="#addr-96E1">96E1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;1e</span>  <span class="comment">; CR4=$1E (via AC=1): 8-bit RX word length, abort extend enabled, NRZ encoding</span></td>
<td class="hex">A9 1E</td>
</tr>

<tr id="addr-96E3">
<td class="addr"><a href="#addr-96E3">96E3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA3">econet_data_terminate_frame</a></span></td>
<td class="hex">8D A3 FE</td>
</tr>

<tr id="addr-96E6">
<td class="addr"><a href="#addr-96E6">96E6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span>  <span class="comment">; CR3=$00 (via AC=1): no loop-back, no AEX, NRZ, no DTR</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-96E8">
<td class="addr"><a href="#addr-96E8">96E8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Enter RX listen mode</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX held in reset, RX active with interrupts. Clears all status.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-96EB">
<td class="addr"><a href="#addr-96EB">96EB</a></td>
<td><span class="label">.adlc_rx_listen</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;82</span>  <span class="comment">; CR1=$82: TX_RESET | RIE (TX in reset, RX interrupts enabled)</span></td>
<td class="hex">A9 82</td>
</tr>

<tr id="addr-96ED">
<td class="addr"><a href="#addr-96ED">96ED</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-96F0">
<td class="addr"><a href="#addr-96F0">96F0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;67</span>  <span class="comment">; CR2=$67: CLR_TX_ST | CLR_RX_ST | FC_TDRA | 2_1_BYTE | PSE</span></td>
<td class="hex">A9 67</td>
</tr>

<tr id="addr-96F2">
<td class="addr"><a href="#addr-96F2">96F2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-96F5">
<td class="addr"><a href="#addr-96F5">96F5</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NMI RX scout handler (initial byte)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Default NMI handler for incoming scout frames. Checks if the frame</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; is addressed to us or is a broadcast. Installed as the NMI target</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; during idle RX listen mode.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Tests SR2 bit0 (AP = Address Present) to detect incoming data.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the first byte (destination station) from the RX FIFO and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; compares against our station ID. Reading $FE18 also disables NMIs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (INTOFF side effect).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-96F6">
<td class="addr"><a href="#addr-96F6">96F6</a></td>
<td><span class="label">.nmi_rx_scout</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span>  <span class="comment">; A=$01: mask for SR2 bit0 (AP = Address Present)</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-96F8">
<td class="addr"><a href="#addr-96F8">96F8</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: Z = A AND SR2 -- tests if AP is set</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-96FB">
<td class="addr"><a href="#addr-96FB">96FB</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9737">scout_error</a></span>  <span class="comment">; AP not set, no incoming data -- check for errors</span></td>
<td class="hex">F0 3A</td>
</tr>

<tr id="addr-96FD">
<td class="addr"><a href="#addr-96FD">96FD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read first RX byte (destination station address)</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9700">
<td class="addr"><a href="#addr-9700">9700</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; Compare to our station ID ($FE18 read = INTOFF, disables NMIs)</span></td>
<td class="hex">CD 18 FE</td>
</tr>

<tr id="addr-9703">
<td class="addr"><a href="#addr-9703">9703</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-970E">c970e</a></span>  <span class="comment">; Match -- accept frame</span></td>
<td class="hex">F0 09</td>
</tr>

<tr id="addr-9705">
<td class="addr"><a href="#addr-9705">9705</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;ff</span>  <span class="comment">; Check for broadcast address ($FF)</span></td>
<td class="hex">C9 FF</td>
</tr>

<tr id="addr-9707">
<td class="addr"><a href="#addr-9707">9707</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9723">scout_reject</a></span>  <span class="comment">; Neither our address nor broadcast -- reject frame</span></td>
<td class="hex">D0 1A</td>
</tr>

<tr id="addr-9709">
<td class="addr"><a href="#addr-9709">9709</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;40</span>  <span class="comment">; Flag $40 = broadcast frame</span></td>
<td class="hex">A9 40</td>
</tr>

<tr id="addr-970B">
<td class="addr"><a href="#addr-970B">970B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr id="addr-970E">
<td class="addr"><a href="#addr-970E">970E</a></td>
<td><span class="label">.c970e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;15</span>  <span class="comment">; Install next NMI handler at $9715 (RX scout second byte)</span></td>
<td class="hex">A9 15</td>
</tr>

<tr id="addr-9710">
<td class="addr"><a href="#addr-9710">9710</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;97</span></td>
<td class="hex">A0 97</td>
</tr>

<tr id="addr-9712">
<td class="addr"><a href="#addr-9712">9712</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; RX scout second byte handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the second byte of an incoming scout (destination network).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks for network match: 0 = local network (accept), $FF = broadcast</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (accept and flag), anything else = reject.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Installs the scout data reading loop handler at $9747.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9715">
<td class="addr"><a href="#addr-9715">9715</a></td>
<td><span class="label">.nmi_rx_scout_net</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test for RDA (bit7 = data available)</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9718">
<td class="addr"><a href="#addr-9718">9718</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9737">scout_error</a></span>  <span class="comment">; No RDA -- check errors</span></td>
<td class="hex">10 1D</td>
</tr>

<tr id="addr-971A">
<td class="addr"><a href="#addr-971A">971A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read destination network byte</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-971D">
<td class="addr"><a href="#addr-971D">971D</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-972B">c972b</a></span>  <span class="comment">; Network = 0 -- local network, accept</span></td>
<td class="hex">F0 0C</td>
</tr>

<tr id="addr-971F">
<td class="addr"><a href="#addr-971F">971F</a></td>
<td>    <span class="opcode">EOR</span> <span class="operand">#&amp;ff</span>  <span class="comment">; EOR $FF: test if network = $FF (broadcast)</span></td>
<td class="hex">49 FF</td>
</tr>

<tr id="addr-9721">
<td class="addr"><a href="#addr-9721">9721</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-972E">c972e</a></span>  <span class="comment">; Broadcast network -- accept</span></td>
<td class="hex">F0 0B</td>
</tr>

<tr id="addr-9723">
<td class="addr"><a href="#addr-9723">9723</a></td>
<td><span class="label">.scout_reject</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;a2</span>  <span class="comment">; Reject: wrong network. CR1=$A2: RIE|RX_DISCONTINUE</span></td>
<td class="hex">A9 A2</td>
</tr>

<tr id="addr-9725">
<td class="addr"><a href="#addr-9725">9725</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9728">
<td class="addr"><a href="#addr-9728">9728</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A43">discard_after_reset</a></span></td>
<td class="hex">4C 43 9A</td>
</tr>

<tr id="addr-972B">
<td class="addr"><a href="#addr-972B">972B</a></td>
<td><span class="label">.c972b</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span>  <span class="comment">; Network = $FF broadcast: clear $0D4A</span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr id="addr-972E">
<td class="addr"><a href="#addr-972E">972E</a></td>
<td><span class="label">.c972e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span>  <span class="comment">; Store Y offset for scout data buffer</span></td>
<td class="hex">85 A2</td>
</tr>

<tr id="addr-9730">
<td class="addr"><a href="#addr-9730">9730</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;47</span>  <span class="comment">; Install scout data reading loop at $9747</span></td>
<td class="hex">A9 47</td>
</tr>

<tr id="addr-9732">
<td class="addr"><a href="#addr-9732">9732</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;97</span></td>
<td class="hex">A0 97</td>
</tr>

<tr id="addr-9734">
<td class="addr"><a href="#addr-9734">9734</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Scout error/discard handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reached when the scout data loop sees no RDA (BPL at $974C) or</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; when scout completion finds unexpected SR2 state.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If SR2 &amp; $81 is non-zero (AP or RDA still active), performs full</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ADLC reset and discards. If zero (clean end), discards via $9A40.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; This path is a common landing for any unexpected ADLC state during</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; scout reception.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9737">
<td class="addr"><a href="#addr-9737">9737</a></td>
<td><span class="label">.scout_error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Read SR2</span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-973A">
<td class="addr"><a href="#addr-973A">973A</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;81</span>  <span class="comment">; Test AP (b0) | RDA (b7)</span></td>
<td class="hex">29 81</td>
</tr>

<tr id="addr-973C">
<td class="addr"><a href="#addr-973C">973C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9744">scout_discard</a></span>  <span class="comment">; Neither set -- clean end, discard via $9A40</span></td>
<td class="hex">F0 06</td>
</tr>

<tr id="addr-973E">
<td class="addr"><a href="#addr-973E">973E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-96DC">adlc_full_reset</a></span>  <span class="comment">; Unexpected data/status: full ADLC reset</span></td>
<td class="hex">20 DC 96</td>
</tr>

<tr id="addr-9741">
<td class="addr"><a href="#addr-9741">9741</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A43">discard_after_reset</a></span>  <span class="comment">; Discard and return to idle</span></td>
<td class="hex">4C 43 9A</td>
</tr>

<tr id="addr-9744">
<td class="addr"><a href="#addr-9744">9744</a></td>
<td><span class="label">.scout_discard</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A40">discard_listen</a></span></td>
<td class="hex">4C 40 9A</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Scout data reading loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the body of a scout frame, two bytes per iteration. Stores</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; bytes at $0D3D+Y (scout buffer: src_stn, src_net, ctrl, port, ...).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Between each pair it checks SR2:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - SR2 &amp; $81 tested at entry ($974A): AP|RDA bits</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     - Neither set (BEQ) -&gt; discard ($9744 -&gt; $9A40)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     - AP without RDA (BPL) -&gt; error ($9737)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     - RDA set (BMI) -&gt; read byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - After first byte ($9755): full SR2 tested</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     - SR2 non-zero (BNE) -&gt; scout completion ($9771)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;       This is the FV detection point: when FV is set (by inline refill</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;       of the last byte during the preceding RX FIFO read), SR2 is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;       non-zero and the branch is taken.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     - SR2 = 0 -&gt; read second byte and loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - After second byte ($9769): re-test SR2 &amp; $81 for next pair</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     - RDA set (BMI) -&gt; loop back to $974E</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;     - Neither set -&gt; RTI, wait for next NMI</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The loop ends at Y=$0C (12 bytes max in scout buffer).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9747">
<td class="addr"><a href="#addr-9747">9747</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span>  <span class="comment">; Y = buffer offset</span></td>
<td class="hex">A4 A2</td>
</tr>

<tr id="addr-9749">
<td class="addr"><a href="#addr-9749">9749</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Read SR2</span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-974C">
<td class="addr"><a href="#addr-974C">974C</a></td>
<td><span class="label">.scout_loop_rda</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9737">scout_error</a></span>  <span class="comment">; No RDA -- error handler $9737</span></td>
<td class="hex">10 E9</td>
</tr>

<tr id="addr-974E">
<td class="addr"><a href="#addr-974E">974E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read data byte from RX FIFO</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9751">
<td class="addr"><a href="#addr-9751">9751</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a>,y</span>  <span class="comment">; Store at $0D3D+Y (scout buffer)</span></td>
<td class="hex">99 3D 0D</td>
</tr>

<tr id="addr-9754">
<td class="addr"><a href="#addr-9754">9754</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Advance buffer index</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9755">
<td class="addr"><a href="#addr-9755">9755</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Read SR2 again (FV detection point)</span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-9758">
<td class="addr"><a href="#addr-9758">9758</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-975C">scout_loop_second</a></span>  <span class="comment">; RDA set -- more data, read second byte</span></td>
<td class="hex">30 02</td>
</tr>

<tr id="addr-975A">
<td class="addr"><a href="#addr-975A">975A</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9771">scout_complete</a></span>  <span class="comment">; SR2 non-zero (FV or other) -- scout completion</span></td>
<td class="hex">D0 15</td>
</tr>

<tr id="addr-975C">
<td class="addr"><a href="#addr-975C">975C</a></td>
<td><span class="label">.scout_loop_second</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read second byte of pair</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-975F">
<td class="addr"><a href="#addr-975F">975F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a>,y</span>  <span class="comment">; Store at $0D3D+Y</span></td>
<td class="hex">99 3D 0D</td>
</tr>

<tr id="addr-9762">
<td class="addr"><a href="#addr-9762">9762</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Advance and check buffer limit</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9763">
<td class="addr"><a href="#addr-9763">9763</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">C0 0C</td>
</tr>

<tr id="addr-9765">
<td class="addr"><a href="#addr-9765">9765</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9771">scout_complete</a></span>  <span class="comment">; Buffer full (Y=12) -- force completion</span></td>
<td class="hex">F0 0A</td>
</tr>

<tr id="addr-9767">
<td class="addr"><a href="#addr-9767">9767</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span>  <span class="comment">; Save Y for next iteration</span></td>
<td class="hex">84 A2</td>
</tr>

<tr id="addr-9769">
<td class="addr"><a href="#addr-9769">9769</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Read SR2 for next pair</span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-976C">
<td class="addr"><a href="#addr-976C">976C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-974C">scout_loop_rda</a></span>  <span class="comment">; SR2 non-zero -- loop back for more bytes</span></td>
<td class="hex">D0 DE</td>
</tr>

<tr id="addr-976E">
<td class="addr"><a href="#addr-976E">976E</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D14">nmi_rti</a></span>  <span class="comment">; SR2 = 0 -- RTI, wait for next NMI</span></td>
<td class="hex">4C 14 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Scout completion handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reached from the scout data loop when SR2 is non-zero (FV detected).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Disables PSE to allow individual SR2 bit testing:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR1=$00 (clear all enables)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   CR2=$84 (RDA_SUPPRESS_FV | FC_TDRA) -- no PSE, no CLR bits</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Then checks FV (bit1) and RDA (bit7):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - No FV (BEQ) -&gt; error $9737 (not a valid frame end)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - FV set, no RDA (BPL) -&gt; error $9737 (missing last byte)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - FV set, RDA set -&gt; read last byte, process scout</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; After reading the last byte, the complete scout buffer ($0D3D-$0D48)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; contains: src_stn, src_net, ctrl, port [, extra_data...].</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The port byte at $0D40 determines further processing:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Port = 0 -&gt; immediate operation ($9A59)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Port non-zero -&gt; check if it matches an open receive block</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9771">
<td class="addr"><a href="#addr-9771">9771</a></td>
<td><span class="label">.scout_complete</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span>  <span class="comment">; CR1=$00: disable all interrupts</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9773">
<td class="addr"><a href="#addr-9773">9773</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9776">
<td class="addr"><a href="#addr-9776">9776</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;84</span>  <span class="comment">; CR2=$84: disable PSE, enable RDA_SUPPRESS_FV</span></td>
<td class="hex">A9 84</td>
</tr>

<tr id="addr-9778">
<td class="addr"><a href="#addr-9778">9778</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-977B">
<td class="addr"><a href="#addr-977B">977B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span>  <span class="comment">; A=$02: FV mask for SR2 bit1</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-977D">
<td class="addr"><a href="#addr-977D">977D</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test FV (Z) and RDA (N)</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9780">
<td class="addr"><a href="#addr-9780">9780</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9737">scout_error</a></span>  <span class="comment">; No FV -- not a valid frame end, error</span></td>
<td class="hex">F0 B5</td>
</tr>

<tr id="addr-9782">
<td class="addr"><a href="#addr-9782">9782</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9737">scout_error</a></span>  <span class="comment">; FV set but no RDA -- missing last byte, error</span></td>
<td class="hex">10 B3</td>
</tr>

<tr id="addr-9784">
<td class="addr"><a href="#addr-9784">9784</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read last byte from RX FIFO</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9787">
<td class="addr"><a href="#addr-9787">9787</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a>,y</span>  <span class="comment">; Store last byte at $0D3D+Y</span></td>
<td class="hex">99 3D 0D</td>
</tr>

<tr id="addr-978A">
<td class="addr"><a href="#addr-978A">978A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;44</span>  <span class="comment">; CR1=$44: RX_RESET | TIE (switch to TX for ACK)</span></td>
<td class="hex">A9 44</td>
</tr>

<tr id="addr-978C">
<td class="addr"><a href="#addr-978C">978C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-978F">
<td class="addr"><a href="#addr-978F">978F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D40">rx_port</a></span>  <span class="comment">; Check port byte: 0 = immediate op, non-zero = data transfer</span></td>
<td class="hex">AD 40 0D</td>
</tr>

<tr id="addr-9792">
<td class="addr"><a href="#addr-9792">9792</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-979A">scout_match_port</a></span>  <span class="comment">; Port non-zero -- look for matching receive block</span></td>
<td class="hex">D0 06</td>
</tr>

<tr id="addr-9794">
<td class="addr"><a href="#addr-9794">9794</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A59">immediate_op</a></span>  <span class="comment">; Port = 0 -- immediate operation handler</span></td>
<td class="hex">4C 59 9A</td>
</tr>

<tr id="addr-9797">
<td class="addr"><a href="#addr-9797">9797</a></td>
<td><span class="label">.scout_no_match</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">4C 8A 98</td>
</tr>

<tr id="addr-979A">
<td class="addr"><a href="#addr-979A">979A</a></td>
<td><span class="label">.scout_match_port</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-979D">
<td class="addr"><a href="#addr-979D">979D</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-97A4">c97a4</a></span></td>
<td class="hex">50 05</td>
</tr>

<tr id="addr-979F">
<td class="addr"><a href="#addr-979F">979F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#7</span></td>
<td class="hex">A9 07</td>
</tr>

<tr id="addr-97A1">
<td class="addr"><a href="#addr-97A1">97A1</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-97A4">
<td class="addr"><a href="#addr-97A4">97A4</a></td>
<td><span class="label">.c97a4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">2C 38 0D</td>
</tr>

<tr id="addr-97A7">
<td class="addr"><a href="#addr-97A7">97A7</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-97E4">c97e4</a></span></td>
<td class="hex">10 3B</td>
</tr>

<tr id="addr-97A9">
<td class="addr"><a href="#addr-97A9">97A9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;c0</span></td>
<td class="hex">A9 C0</td>
</tr>

<tr id="addr-97AB">
<td class="addr"><a href="#addr-97AB">97AB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a></span></td>
<td class="hex">85 A6</td>
</tr>

<tr id="addr-97AD">
<td class="addr"><a href="#addr-97AD">97AD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-97AF">
<td class="addr"><a href="#addr-97AF">97AF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A7">rx_buf_offset</a></span></td>
<td class="hex">85 A7</td>
</tr>

<tr id="addr-97B1">
<td class="addr"><a href="#addr-97B1">97B1</a></td>
<td><span class="label">.c97b1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-97B3">
<td class="addr"><a href="#addr-97B3">97B3</a></td>
<td><span class="label">.c97b3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">B1 A6</td>
</tr>

<tr id="addr-97B5">
<td class="addr"><a href="#addr-97B5">97B5</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-97E0">c97e0</a></span></td>
<td class="hex">F0 29</td>
</tr>

<tr id="addr-97B7">
<td class="addr"><a href="#addr-97B7">97B7</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">C9 7F</td>
</tr>

<tr id="addr-97B9">
<td class="addr"><a href="#addr-97B9">97B9</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-97D7">c97d7</a></span></td>
<td class="hex">D0 1C</td>
</tr>

<tr id="addr-97BB">
<td class="addr"><a href="#addr-97BB">97BB</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-97BC">
<td class="addr"><a href="#addr-97BC">97BC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">B1 A6</td>
</tr>

<tr id="addr-97BE">
<td class="addr"><a href="#addr-97BE">97BE</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-97C5">c97c5</a></span></td>
<td class="hex">F0 05</td>
</tr>

<tr id="addr-97C0">
<td class="addr"><a href="#addr-97C0">97C0</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0D40">rx_port</a></span></td>
<td class="hex">CD 40 0D</td>
</tr>

<tr id="addr-97C3">
<td class="addr"><a href="#addr-97C3">97C3</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-97D7">c97d7</a></span></td>
<td class="hex">D0 12</td>
</tr>

<tr id="addr-97C5">
<td class="addr"><a href="#addr-97C5">97C5</a></td>
<td><span class="label">.c97c5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-97C6">
<td class="addr"><a href="#addr-97C6">97C6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">B1 A6</td>
</tr>

<tr id="addr-97C8">
<td class="addr"><a href="#addr-97C8">97C8</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-97CF">c97cf</a></span></td>
<td class="hex">F0 05</td>
</tr>

<tr id="addr-97CA">
<td class="addr"><a href="#addr-97CA">97CA</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a></span></td>
<td class="hex">CD 3D 0D</td>
</tr>

<tr id="addr-97CD">
<td class="addr"><a href="#addr-97CD">97CD</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-97D7">c97d7</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-97CF">
<td class="addr"><a href="#addr-97CF">97CF</a></td>
<td><span class="label">.c97cf</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-97D0">
<td class="addr"><a href="#addr-97D0">97D0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">B1 A6</td>
</tr>

<tr id="addr-97D2">
<td class="addr"><a href="#addr-97D2">97D2</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0D3E">rx_src_net</a></span></td>
<td class="hex">CD 3E 0D</td>
</tr>

<tr id="addr-97D5">
<td class="addr"><a href="#addr-97D5">97D5</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-97F3">c97f3</a></span></td>
<td class="hex">F0 1C</td>
</tr>

<tr id="addr-97D7">
<td class="addr"><a href="#addr-97D7">97D7</a></td>
<td><span class="label">.c97d7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a></span></td>
<td class="hex">A5 A6</td>
</tr>

<tr id="addr-97D9">
<td class="addr"><a href="#addr-97D9">97D9</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-97DA">
<td class="addr"><a href="#addr-97DA">97DA</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">69 0C</td>
</tr>

<tr id="addr-97DC">
<td class="addr"><a href="#addr-97DC">97DC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a></span></td>
<td class="hex">85 A6</td>
</tr>

<tr id="addr-97DE">
<td class="addr"><a href="#addr-97DE">97DE</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-97B1">c97b1</a></span></td>
<td class="hex">90 D1</td>
</tr>

<tr id="addr-97E0">
<td class="addr"><a href="#addr-97E0">97E0</a></td>
<td><span class="label">.c97e0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A7">rx_buf_offset</a></span></td>
<td class="hex">A5 A7</td>
</tr>

<tr id="addr-97E2">
<td class="addr"><a href="#addr-97E2">97E2</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9797">scout_no_match</a></span></td>
<td class="hex">D0 B3</td>
</tr>

<tr id="addr-97E4">
<td class="addr"><a href="#addr-97E4">97E4</a></td>
<td><span class="label">.c97e4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D38">rx_status_flags</a></span></td>
<td class="hex">2C 38 0D</td>
</tr>

<tr id="addr-97E7">
<td class="addr"><a href="#addr-97E7">97E7</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9797">scout_no_match</a></span></td>
<td class="hex">50 AE</td>
</tr>

<tr id="addr-97E9">
<td class="addr"><a href="#addr-97E9">97E9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-009F">nfs_workspace_hi</a></span></td>
<td class="hex">A5 9F</td>
</tr>

<tr id="addr-97EB">
<td class="addr"><a href="#addr-97EB">97EB</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A7">rx_buf_offset</a></span></td>
<td class="hex">85 A7</td>
</tr>

<tr id="addr-97ED">
<td class="addr"><a href="#addr-97ED">97ED</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-97EF">
<td class="addr"><a href="#addr-97EF">97EF</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a></span></td>
<td class="hex">84 A6</td>
</tr>

<tr id="addr-97F1">
<td class="addr"><a href="#addr-97F1">97F1</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-97B3">c97b3</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">F0 C0</td>
</tr>

<tr id="addr-97F3">
<td class="addr"><a href="#addr-97F3">97F3</a></td>
<td><span class="label">.c97f3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-97F6">
<td class="addr"><a href="#addr-97F6">97F6</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-97FB">c97fb</a></span></td>
<td class="hex">50 03</td>
</tr>

<tr id="addr-97F8">
<td class="addr"><a href="#addr-97F8">97F8</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A4A">c9a4a</a></span></td>
<td class="hex">4C 4A 9A</td>
</tr>

<tr id="addr-97FB">
<td class="addr"><a href="#addr-97FB">97FB</a></td>
<td><span class="label">.c97fb</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#3</span></td>
<td class="hex">A9 03</td>
</tr>

<tr id="addr-97FD">
<td class="addr"><a href="#addr-97FD">97FD</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D5C">scout_status</a></span></td>
<td class="hex">8D 5C 0D</td>
</tr>

<tr id="addr-9800">
<td class="addr"><a href="#addr-9800">9800</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A0">nmi_tx_block</a></span></td>
<td class="hex">A5 A0</td>
</tr>

<tr id="addr-9802">
<td class="addr"><a href="#addr-9802">9802</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9803">
<td class="addr"><a href="#addr-9803">9803</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A1">nmi_tx_block_hi</a></span></td>
<td class="hex">A5 A1</td>
</tr>

<tr id="addr-9805">
<td class="addr"><a href="#addr-9805">9805</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9806">
<td class="addr"><a href="#addr-9806">9806</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a></span></td>
<td class="hex">A5 A6</td>
</tr>

<tr id="addr-9808">
<td class="addr"><a href="#addr-9808">9808</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A0">nmi_tx_block</a></span></td>
<td class="hex">85 A0</td>
</tr>

<tr id="addr-980A">
<td class="addr"><a href="#addr-980A">980A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A7">rx_buf_offset</a></span></td>
<td class="hex">A5 A7</td>
</tr>

<tr id="addr-980C">
<td class="addr"><a href="#addr-980C">980C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A1">nmi_tx_block_hi</a></span></td>
<td class="hex">85 A1</td>
</tr>

<tr id="addr-980E">
<td class="addr"><a href="#addr-980E">980E</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9F5B">tx_calc_transfer</a></span></td>
<td class="hex">20 5B 9F</td>
</tr>

<tr id="addr-9811">
<td class="addr"><a href="#addr-9811">9811</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9812">
<td class="addr"><a href="#addr-9812">9812</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A1">nmi_tx_block_hi</a></span></td>
<td class="hex">85 A1</td>
</tr>

<tr id="addr-9814">
<td class="addr"><a href="#addr-9814">9814</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9815">
<td class="addr"><a href="#addr-9815">9815</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A0">nmi_tx_block</a></span></td>
<td class="hex">85 A0</td>
</tr>

<tr id="addr-9817">
<td class="addr"><a href="#addr-9817">9817</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-981C">c981c</a></span></td>
<td class="hex">B0 03</td>
</tr>

<tr id="addr-9819">
<td class="addr"><a href="#addr-9819">9819</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9797">scout_no_match</a></span></td>
<td class="hex">4C 97 97</td>
</tr>

<tr id="addr-981C">
<td class="addr"><a href="#addr-981C">981C</a></td>
<td><span class="label">.c981c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;44</span></td>
<td class="hex">A9 44</td>
</tr>

<tr id="addr-981E">
<td class="addr"><a href="#addr-981E">981E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9821">
<td class="addr"><a href="#addr-9821">9821</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;a7</span></td>
<td class="hex">A9 A7</td>
</tr>

<tr id="addr-9823">
<td class="addr"><a href="#addr-9823">9823</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9826">
<td class="addr"><a href="#addr-9826">9826</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2d</span></td>
<td class="hex">A9 2D</td>
</tr>

<tr id="addr-9828">
<td class="addr"><a href="#addr-9828">9828</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;98</span></td>
<td class="hex">A0 98</td>
</tr>

<tr id="addr-982A">
<td class="addr"><a href="#addr-982A">982A</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9974">ack_tx_write_dest</a></span></td>
<td class="hex">4C 74 99</td>
</tr>

<tr id="addr-982D">
<td class="addr"><a href="#addr-982D">982D</a></td>
<td><span class="label">.data_rx_setup</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;82</span>  <span class="comment">; CR1=$82: TX_RESET | RIE (switch to RX for data frame)</span></td>
<td class="hex">A9 82</td>
</tr>

<tr id="addr-982F">
<td class="addr"><a href="#addr-982F">982F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9832">
<td class="addr"><a href="#addr-9832">9832</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;39</span></td>
<td class="hex">A9 39</td>
</tr>

<tr id="addr-9834">
<td class="addr"><a href="#addr-9834">9834</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;98</span></td>
<td class="hex">A0 98</td>
</tr>

<tr id="addr-9836">
<td class="addr"><a href="#addr-9836">9836</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Data frame RX handler (four-way handshake)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Receives the data frame after the scout ACK has been sent.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; First checks AP (Address Present) for the start of the data frame.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads and validates the first two address bytes (dest_stn, dest_net)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; against our station address, then installs continuation handlers</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to read the remaining data payload into the open port buffer.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handler chain: $9839 (AP+addr check) -&gt; $984F (net=0 check) -&gt;</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $9865 (skip ctrl+port) -&gt; $989A (bulk data read) -&gt; $98CE (completion)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9839">
<td class="addr"><a href="#addr-9839">9839</a></td>
<td><span class="label">.nmi_data_rx</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span>  <span class="comment">; Read SR2 for AP check</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-983B">
<td class="addr"><a href="#addr-983B">983B</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-983E">
<td class="addr"><a href="#addr-983E">983E</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">F0 4A</td>
</tr>

<tr id="addr-9840">
<td class="addr"><a href="#addr-9840">9840</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9843">
<td class="addr"><a href="#addr-9843">9843</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span></td>
<td class="hex">CD 18 FE</td>
</tr>

<tr id="addr-9846">
<td class="addr"><a href="#addr-9846">9846</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">D0 42</td>
</tr>

<tr id="addr-9848">
<td class="addr"><a href="#addr-9848">9848</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;4f</span></td>
<td class="hex">A9 4F</td>
</tr>

<tr id="addr-984A">
<td class="addr"><a href="#addr-984A">984A</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;98</span></td>
<td class="hex">A0 98</td>
</tr>

<tr id="addr-984C">
<td class="addr"><a href="#addr-984C">984C</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-984F">
<td class="addr"><a href="#addr-984F">984F</a></td>
<td><span class="label">.nmi_data_rx_net</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Validate source network = 0</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9852">
<td class="addr"><a href="#addr-9852">9852</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">10 36</td>
</tr>

<tr id="addr-9854">
<td class="addr"><a href="#addr-9854">9854</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9857">
<td class="addr"><a href="#addr-9857">9857</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">D0 31</td>
</tr>

<tr id="addr-9859">
<td class="addr"><a href="#addr-9859">9859</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;65</span></td>
<td class="hex">A9 65</td>
</tr>

<tr id="addr-985B">
<td class="addr"><a href="#addr-985B">985B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;98</span></td>
<td class="hex">A0 98</td>
</tr>

<tr id="addr-985D">
<td class="addr"><a href="#addr-985D">985D</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9860">
<td class="addr"><a href="#addr-9860">9860</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-9865">nmi_data_rx_skip</a></span></td>
<td class="hex">30 03</td>
</tr>

<tr id="addr-9862">
<td class="addr"><a href="#addr-9862">9862</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9865">
<td class="addr"><a href="#addr-9865">9865</a></td>
<td><span class="label">.nmi_data_rx_skip</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Skip control and port bytes (already known from scout)</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9868">
<td class="addr"><a href="#addr-9868">9868</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">10 20</td>
</tr>

<tr id="addr-986A">
<td class="addr"><a href="#addr-986A">986A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Discard control byte</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-986D">
<td class="addr"><a href="#addr-986D">986D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Discard port byte</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9870">
<td class="addr"><a href="#addr-9870">9870</a></td>
<td><span class="label">.c9870</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-9872">
<td class="addr"><a href="#addr-9872">9872</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-9875">
<td class="addr"><a href="#addr-9875">9875</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9883">c9883</a></span></td>
<td class="hex">D0 0C</td>
</tr>

<tr id="addr-9877">
<td class="addr"><a href="#addr-9877">9877</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;9a</span></td>
<td class="hex">A9 9A</td>
</tr>

<tr id="addr-9879">
<td class="addr"><a href="#addr-9879">9879</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;98</span></td>
<td class="hex">A0 98</td>
</tr>

<tr id="addr-987B">
<td class="addr"><a href="#addr-987B">987B</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-987E">
<td class="addr"><a href="#addr-987E">987E</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-989A">nmi_data_rx_bulk</a></span></td>
<td class="hex">30 1A</td>
</tr>

<tr id="addr-9880">
<td class="addr"><a href="#addr-9880">9880</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9883">
<td class="addr"><a href="#addr-9883">9883</a></td>
<td><span class="label">.c9883</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;f7</span></td>
<td class="hex">A9 F7</td>
</tr>

<tr id="addr-9885">
<td class="addr"><a href="#addr-9885">9885</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;98</span></td>
<td class="hex">A0 98</td>
</tr>

<tr id="addr-9887">
<td class="addr"><a href="#addr-9887">9887</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-988A">
<td class="addr"><a href="#addr-988A">988A</a></td>
<td><span class="label">.rx_error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-988D">
<td class="addr"><a href="#addr-988D">988D</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9894">rx_error_reset</a></span></td>
<td class="hex">10 05</td>
</tr>

<tr id="addr-988F">
<td class="addr"><a href="#addr-988F">988F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;41</span></td>
<td class="hex">A9 41</td>
</tr>

<tr id="addr-9891">
<td class="addr"><a href="#addr-9891">9891</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9F3F">tx_store_result</a></span></td>
<td class="hex">4C 3F 9F</td>
</tr>

<tr id="addr-9894">
<td class="addr"><a href="#addr-9894">9894</a></td>
<td><span class="label">.rx_error_reset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-96DC">adlc_full_reset</a></span></td>
<td class="hex">20 DC 96</td>
</tr>

<tr id="addr-9897">
<td class="addr"><a href="#addr-9897">9897</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A34">discard_reset_listen</a></span></td>
<td class="hex">4C 34 9A</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Data frame bulk read loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads data payload bytes from the RX FIFO and stores them into</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the open port buffer at (open_port_buf),Y. Reads bytes in pairs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (like the scout data loop), checking SR2 between each pair.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; SR2 non-zero (FV or other) -&gt; frame completion at $98CE.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; SR2 = 0 -&gt; RTI, wait for next NMI to continue.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-989A">
<td class="addr"><a href="#addr-989A">989A</a></td>
<td><span class="label">.nmi_data_rx_bulk</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span>  <span class="comment">; Y = buffer offset, resume from last position</span></td>
<td class="hex">A4 A2</td>
</tr>

<tr id="addr-989C">
<td class="addr"><a href="#addr-989C">989C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Read SR2 for next pair</span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-989F">
<td class="addr"><a href="#addr-989F">989F</a></td>
<td><span class="label">.c989f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-98CE">data_rx_complete</a></span></td>
<td class="hex">10 2D</td>
</tr>

<tr id="addr-98A1">
<td class="addr"><a href="#addr-98A1">98A1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-98A4">
<td class="addr"><a href="#addr-98A4">98A4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A4">open_port_buf</a>),y</span></td>
<td class="hex">91 A4</td>
</tr>

<tr id="addr-98A6">
<td class="addr"><a href="#addr-98A6">98A6</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-98A7">
<td class="addr"><a href="#addr-98A7">98A7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-98AF">c98af</a></span></td>
<td class="hex">D0 06</td>
</tr>

<tr id="addr-98A9">
<td class="addr"><a href="#addr-98A9">98A9</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-98AB">
<td class="addr"><a href="#addr-98AB">98AB</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">C6 A3</td>
</tr>

<tr id="addr-98AD">
<td class="addr"><a href="#addr-98AD">98AD</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">F0 DB</td>
</tr>

<tr id="addr-98AF">
<td class="addr"><a href="#addr-98AF">98AF</a></td>
<td><span class="label">.c98af</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-98B2">
<td class="addr"><a href="#addr-98B2">98B2</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-98B6">c98b6</a></span></td>
<td class="hex">30 02</td>
</tr>

<tr id="addr-98B4">
<td class="addr"><a href="#addr-98B4">98B4</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-98CE">data_rx_complete</a></span></td>
<td class="hex">D0 18</td>
</tr>

<tr id="addr-98B6">
<td class="addr"><a href="#addr-98B6">98B6</a></td>
<td><span class="label">.c98b6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-98B9">
<td class="addr"><a href="#addr-98B9">98B9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A4">open_port_buf</a>),y</span></td>
<td class="hex">91 A4</td>
</tr>

<tr id="addr-98BB">
<td class="addr"><a href="#addr-98BB">98BB</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-98BC">
<td class="addr"><a href="#addr-98BC">98BC</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">84 A2</td>
</tr>

<tr id="addr-98BE">
<td class="addr"><a href="#addr-98BE">98BE</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-98C6">c98c6</a></span></td>
<td class="hex">D0 06</td>
</tr>

<tr id="addr-98C0">
<td class="addr"><a href="#addr-98C0">98C0</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-98C2">
<td class="addr"><a href="#addr-98C2">98C2</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">C6 A3</td>
</tr>

<tr id="addr-98C4">
<td class="addr"><a href="#addr-98C4">98C4</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-98CE">data_rx_complete</a></span></td>
<td class="hex">F0 08</td>
</tr>

<tr id="addr-98C6">
<td class="addr"><a href="#addr-98C6">98C6</a></td>
<td><span class="label">.c98c6</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-98C9">
<td class="addr"><a href="#addr-98C9">98C9</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-989F">c989f</a></span></td>
<td class="hex">D0 D4</td>
</tr>

<tr id="addr-98CB">
<td class="addr"><a href="#addr-98CB">98CB</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D14">nmi_rti</a></span></td>
<td class="hex">4C 14 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Data frame completion</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reached when SR2 non-zero during data RX (FV detected).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Same pattern as scout completion ($9771): disables PSE (CR1=$00,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; CR2=$84), then tests FV and RDA. If FV+RDA, reads the last byte.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If extra data available and buffer space remains, stores it.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Proceeds to send the final ACK via $995E.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-98CE">
<td class="addr"><a href="#addr-98CE">98CE</a></td>
<td><span class="label">.data_rx_complete</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span>  <span class="comment">; CR1=$00: disable all interrupts</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-98D0">
<td class="addr"><a href="#addr-98D0">98D0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-98D3">
<td class="addr"><a href="#addr-98D3">98D3</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;84</span>  <span class="comment">; CR2=$84: disable PSE for individual bit testing</span></td>
<td class="hex">A9 84</td>
</tr>

<tr id="addr-98D5">
<td class="addr"><a href="#addr-98D5">98D5</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-98D8">
<td class="addr"><a href="#addr-98D8">98D8</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">84 A2</td>
</tr>

<tr id="addr-98DA">
<td class="addr"><a href="#addr-98DA">98DA</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span>  <span class="comment">; A=$02: FV mask</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-98DC">
<td class="addr"><a href="#addr-98DC">98DC</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test FV (Z) and RDA (N)</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-98DF">
<td class="addr"><a href="#addr-98DF">98DF</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-988A">rx_error</a></span>  <span class="comment">; No FV -- error</span></td>
<td class="hex">F0 A9</td>
</tr>

<tr id="addr-98E1">
<td class="addr"><a href="#addr-98E1">98E1</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-98F4">c98f4</a></span>  <span class="comment">; FV set, no RDA -- proceed to ACK</span></td>
<td class="hex">10 11</td>
</tr>

<tr id="addr-98E3">
<td class="addr"><a href="#addr-98E3">98E3</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">A5 A3</td>
</tr>

<tr id="addr-98E5">
<td class="addr"><a href="#addr-98E5">98E5</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">F0 A3</td>
</tr>

<tr id="addr-98E7">
<td class="addr"><a href="#addr-98E7">98E7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; FV+RDA: read and store last data byte</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-98EA">
<td class="addr"><a href="#addr-98EA">98EA</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">A4 A2</td>
</tr>

<tr id="addr-98EC">
<td class="addr"><a href="#addr-98EC">98EC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A4">open_port_buf</a>),y</span></td>
<td class="hex">91 A4</td>
</tr>

<tr id="addr-98EE">
<td class="addr"><a href="#addr-98EE">98EE</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">E6 A2</td>
</tr>

<tr id="addr-98F0">
<td class="addr"><a href="#addr-98F0">98F0</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-98F4">c98f4</a></span></td>
<td class="hex">D0 02</td>
</tr>

<tr id="addr-98F2">
<td class="addr"><a href="#addr-98F2">98F2</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-98F4">
<td class="addr"><a href="#addr-98F4">98F4</a></td>
<td><span class="label">.c98f4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-995E">ack_tx</a></span></td>
<td class="hex">4C 5E 99</td>
</tr>

<tr id="addr-98F7">
<td class="addr"><a href="#addr-98F7">98F7</a></td>
<td><span class="label">.nmi_data_rx_tube</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-98FA">
<td class="addr"><a href="#addr-98FA">98FA</a></td>
<td><span class="label">.c98fa</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9933">data_rx_tube_complete</a></span></td>
<td class="hex">10 37</td>
</tr>

<tr id="addr-98FC">
<td class="addr"><a href="#addr-98FC">98FC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-98FF">
<td class="addr"><a href="#addr-98FF">98FF</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">E6 A2</td>
</tr>

<tr id="addr-9901">
<td class="addr"><a href="#addr-9901">9901</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">8D E5 FE</td>
</tr>

<tr id="addr-9904">
<td class="addr"><a href="#addr-9904">9904</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9912">c9912</a></span></td>
<td class="hex">D0 0C</td>
</tr>

<tr id="addr-9906">
<td class="addr"><a href="#addr-9906">9906</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">E6 A3</td>
</tr>

<tr id="addr-9908">
<td class="addr"><a href="#addr-9908">9908</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9912">c9912</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-990A">
<td class="addr"><a href="#addr-990A">990A</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A4">open_port_buf</a></span></td>
<td class="hex">E6 A4</td>
</tr>

<tr id="addr-990C">
<td class="addr"><a href="#addr-990C">990C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9912">c9912</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-990E">
<td class="addr"><a href="#addr-990E">990E</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-9910">
<td class="addr"><a href="#addr-9910">9910</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9930">data_rx_tube_error</a></span></td>
<td class="hex">F0 1E</td>
</tr>

<tr id="addr-9912">
<td class="addr"><a href="#addr-9912">9912</a></td>
<td><span class="label">.c9912</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9915">
<td class="addr"><a href="#addr-9915">9915</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">8D E5 FE</td>
</tr>

<tr id="addr-9918">
<td class="addr"><a href="#addr-9918">9918</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">E6 A2</td>
</tr>

<tr id="addr-991A">
<td class="addr"><a href="#addr-991A">991A</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9928">c9928</a></span></td>
<td class="hex">D0 0C</td>
</tr>

<tr id="addr-991C">
<td class="addr"><a href="#addr-991C">991C</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">E6 A3</td>
</tr>

<tr id="addr-991E">
<td class="addr"><a href="#addr-991E">991E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9928">c9928</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-9920">
<td class="addr"><a href="#addr-9920">9920</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A4">open_port_buf</a></span></td>
<td class="hex">E6 A4</td>
</tr>

<tr id="addr-9922">
<td class="addr"><a href="#addr-9922">9922</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9928">c9928</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-9924">
<td class="addr"><a href="#addr-9924">9924</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-9926">
<td class="addr"><a href="#addr-9926">9926</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9933">data_rx_tube_complete</a></span></td>
<td class="hex">F0 0B</td>
</tr>

<tr id="addr-9928">
<td class="addr"><a href="#addr-9928">9928</a></td>
<td><span class="label">.c9928</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">AD A1 FE</td>
</tr>

<tr id="addr-992B">
<td class="addr"><a href="#addr-992B">992B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-98FA">c98fa</a></span></td>
<td class="hex">D0 CD</td>
</tr>

<tr id="addr-992D">
<td class="addr"><a href="#addr-992D">992D</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D14">nmi_rti</a></span></td>
<td class="hex">4C 14 0D</td>
</tr>

<tr id="addr-9930">
<td class="addr"><a href="#addr-9930">9930</a></td>
<td><span class="label">.data_rx_tube_error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">4C 8A 98</td>
</tr>

<tr id="addr-9933">
<td class="addr"><a href="#addr-9933">9933</a></td>
<td><span class="label">.data_rx_tube_complete</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9935">
<td class="addr"><a href="#addr-9935">9935</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9938">
<td class="addr"><a href="#addr-9938">9938</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;84</span></td>
<td class="hex">A9 84</td>
</tr>

<tr id="addr-993A">
<td class="addr"><a href="#addr-993A">993A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-993D">
<td class="addr"><a href="#addr-993D">993D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-993F">
<td class="addr"><a href="#addr-993F">993F</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9942">
<td class="addr"><a href="#addr-9942">9942</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9930">data_rx_tube_error</a></span></td>
<td class="hex">F0 EC</td>
</tr>

<tr id="addr-9944">
<td class="addr"><a href="#addr-9944">9944</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-995E">ack_tx</a></span></td>
<td class="hex">10 18</td>
</tr>

<tr id="addr-9946">
<td class="addr"><a href="#addr-9946">9946</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">A5 A2</td>
</tr>

<tr id="addr-9948">
<td class="addr"><a href="#addr-9948">9948</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">05 A3</td>
</tr>

<tr id="addr-994A">
<td class="addr"><a href="#addr-994A">994A</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-00A4">open_port_buf</a></span></td>
<td class="hex">05 A4</td>
</tr>

<tr id="addr-994C">
<td class="addr"><a href="#addr-994C">994C</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">05 A5</td>
</tr>

<tr id="addr-994E">
<td class="addr"><a href="#addr-994E">994E</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9930">data_rx_tube_error</a></span></td>
<td class="hex">F0 E0</td>
</tr>

<tr id="addr-9950">
<td class="addr"><a href="#addr-9950">9950</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9953">
<td class="addr"><a href="#addr-9953">9953</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D5D">rx_extra_byte</a></span></td>
<td class="hex">8D 5D 0D</td>
</tr>

<tr id="addr-9956">
<td class="addr"><a href="#addr-9956">9956</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A9 20</td>
</tr>

<tr id="addr-9958">
<td class="addr"><a href="#addr-9958">9958</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">0D 4A 0D</td>
</tr>

<tr id="addr-995B">
<td class="addr"><a href="#addr-995B">995B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ACK transmission</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sends a scout ACK or final ACK frame as part of the four-way handshake.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If bit7 of $0D4A is set, this is a final ACK -&gt; completion ($9F39).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Otherwise, configures for TX (CR1=$44, CR2=$A7) and sends the ACK</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; frame (dst_stn, dst_net from $0D3D, src_stn from $FE18, src_net=0).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The ACK frame has no data payload -- just address bytes.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; After writing the address bytes to the TX FIFO, installs the next</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NMI handler from $0D4B/$0D4C (saved by the scout/data RX handler)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and sends TX_LAST_DATA (CR2=$3F) to close the frame.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-995E">
<td class="addr"><a href="#addr-995E">995E</a></td>
<td><span class="label">.ack_tx</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-9961">
<td class="addr"><a href="#addr-9961">9961</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9966">ack_tx_configure</a></span></td>
<td class="hex">10 03</td>
</tr>

<tr id="addr-9963">
<td class="addr"><a href="#addr-9963">9963</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9F39">tx_result_ok</a></span></td>
<td class="hex">4C 39 9F</td>
</tr>

<tr id="addr-9966">
<td class="addr"><a href="#addr-9966">9966</a></td>
<td><span class="label">.ack_tx_configure</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;44</span>  <span class="comment">; CR1=$44: RX_RESET | TIE (switch to TX mode)</span></td>
<td class="hex">A9 44</td>
</tr>

<tr id="addr-9968">
<td class="addr"><a href="#addr-9968">9968</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-996B">
<td class="addr"><a href="#addr-996B">996B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;a7</span>  <span class="comment">; CR2=$A7: RTS|CLR_TX_ST|FC_TDRA|2_1_BYTE|PSE</span></td>
<td class="hex">A9 A7</td>
</tr>

<tr id="addr-996D">
<td class="addr"><a href="#addr-996D">996D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9970">
<td class="addr"><a href="#addr-9970">9970</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;bb</span>  <span class="comment">; Install saved next handler ($99BB for scout ACK)</span></td>
<td class="hex">A9 BB</td>
</tr>

<tr id="addr-9972">
<td class="addr"><a href="#addr-9972">9972</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;99</span></td>
<td class="hex">A0 99</td>
</tr>

<tr id="addr-9974">
<td class="addr"><a href="#addr-9974">9974</a></td>
<td><span class="label">.ack_tx_write_dest</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4B">nmi_next_lo</a></span></td>
<td class="hex">8D 4B 0D</td>
</tr>

<tr id="addr-9977">
<td class="addr"><a href="#addr-9977">9977</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0D4C">nmi_next_hi</a></span></td>
<td class="hex">8C 4C 0D</td>
</tr>

<tr id="addr-997A">
<td class="addr"><a href="#addr-997A">997A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a></span>  <span class="comment">; Load dest station from RX scout buffer</span></td>
<td class="hex">AD 3D 0D</td>
</tr>

<tr id="addr-997D">
<td class="addr"><a href="#addr-997D">997D</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: test TDRA (V=bit6)</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9980">
<td class="addr"><a href="#addr-9980">9980</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-99B8">c99b8</a></span>  <span class="comment">; TDRA not ready -- error</span></td>
<td class="hex">50 36</td>
</tr>

<tr id="addr-9982">
<td class="addr"><a href="#addr-9982">9982</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Write dest station to TX FIFO</span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9985">
<td class="addr"><a href="#addr-9985">9985</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3E">rx_src_net</a></span>  <span class="comment">; Write dest network to TX FIFO</span></td>
<td class="hex">AD 3E 0D</td>
</tr>

<tr id="addr-9988">
<td class="addr"><a href="#addr-9988">9988</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-998B">
<td class="addr"><a href="#addr-998B">998B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;92</span>  <span class="comment">; Install handler at $9992 (write src addr)</span></td>
<td class="hex">A9 92</td>
</tr>

<tr id="addr-998D">
<td class="addr"><a href="#addr-998D">998D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;99</span></td>
<td class="hex">A0 99</td>
</tr>

<tr id="addr-998F">
<td class="addr"><a href="#addr-998F">998F</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ACK TX continuation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Writes source station and network to TX FIFO, completing the 4-byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ACK frame. Then sends TX_LAST_DATA (CR2=$3F) to close the frame.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9992">
<td class="addr"><a href="#addr-9992">9992</a></td>
<td><span class="label">.nmi_ack_tx_src</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; Load our station ID (also INTOFF)</span></td>
<td class="hex">AD 18 FE</td>
</tr>

<tr id="addr-9995">
<td class="addr"><a href="#addr-9995">9995</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: test TDRA</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9998">
<td class="addr"><a href="#addr-9998">9998</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-99B8">c99b8</a></span>  <span class="comment">; TDRA not ready -- error</span></td>
<td class="hex">50 1E</td>
</tr>

<tr id="addr-999A">
<td class="addr"><a href="#addr-999A">999A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Write our station to TX FIFO</span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-999D">
<td class="addr"><a href="#addr-999D">999D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span>  <span class="comment">; Write network=0 to TX FIFO</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-999F">
<td class="addr"><a href="#addr-999F">999F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-99A2">
<td class="addr"><a href="#addr-99A2">99A2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-99A5">
<td class="addr"><a href="#addr-99A5">99A5</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-99B5">c99b5</a></span></td>
<td class="hex">30 0E</td>
</tr>

<tr id="addr-99A7">
<td class="addr"><a href="#addr-99A7">99A7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;3f</span>  <span class="comment">; CR2=$3F: TX_LAST_DATA | CLR_RX_ST | FLAG_IDLE | FC_TDRA | 2_1_BYTE | PSE</span></td>
<td class="hex">A9 3F</td>
</tr>

<tr id="addr-99A9">
<td class="addr"><a href="#addr-99A9">99A9</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-99AC">
<td class="addr"><a href="#addr-99AC">99AC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4B">nmi_next_lo</a></span>  <span class="comment">; Install saved handler from $0D4B/$0D4C</span></td>
<td class="hex">AD 4B 0D</td>
</tr>

<tr id="addr-99AF">
<td class="addr"><a href="#addr-99AF">99AF</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D4C">nmi_next_hi</a></span></td>
<td class="hex">AC 4C 0D</td>
</tr>

<tr id="addr-99B2">
<td class="addr"><a href="#addr-99B2">99B2</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-99B5">
<td class="addr"><a href="#addr-99B5">99B5</a></td>
<td><span class="label">.c99b5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9E3B">data_tx_begin</a></span></td>
<td class="hex">4C 3B 9E</td>
</tr>

<tr id="addr-99B8">
<td class="addr"><a href="#addr-99B8">99B8</a></td>
<td><span class="label">.c99b8</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">4C 8A 98</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Post-ACK scout processing</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called after the scout ACK has been transmitted. Processes the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; received scout data stored in the buffer at $0D3D-$0D48.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks the port byte ($0D40) against open receive blocks to</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; find a matching listener. If a match is found, sets up the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; data RX handler chain for the four-way handshake data phase.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If no match, discards the frame.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-99BB">
<td class="addr"><a href="#addr-99BB">99BB</a></td>
<td><span class="label">.post_ack_scout</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D40">rx_port</a></span></td>
<td class="hex">AD 40 0D</td>
</tr>

<tr id="addr-99BE">
<td class="addr"><a href="#addr-99BE">99BE</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-99C3">c99c3</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-99C0">
<td class="addr"><a href="#addr-99C0">99C0</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9B12">c9b12</a></span></td>
<td class="hex">4C 12 9B</td>
</tr>

<tr id="addr-99C3">
<td class="addr"><a href="#addr-99C3">99C3</a></td>
<td><span class="label">.c99c3</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-99C5">
<td class="addr"><a href="#addr-99C5">99C5</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-99C8">
<td class="addr"><a href="#addr-99C8">99C8</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9A07">c9a07</a></span></td>
<td class="hex">F0 3D</td>
</tr>

<tr id="addr-99CA">
<td class="addr"><a href="#addr-99CA">99CA</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-99CB">
<td class="addr"><a href="#addr-99CB">99CB</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-99CC">
<td class="addr"><a href="#addr-99CC">99CC</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-99CE">
<td class="addr"><a href="#addr-99CE">99CE</a></td>
<td><span class="label">.loop_c99ce</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">B1 A6</td>
</tr>

<tr id="addr-99D0">
<td class="addr"><a href="#addr-99D0">99D0</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-99D1">
<td class="addr"><a href="#addr-99D1">99D1</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a>,y</span></td>
<td class="hex">79 9A 00</td>
</tr>

<tr id="addr-99D4">
<td class="addr"><a href="#addr-99D4">99D4</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-99D6">
<td class="addr"><a href="#addr-99D6">99D6</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-99D7">
<td class="addr"><a href="#addr-99D7">99D7</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-99D8">
<td class="addr"><a href="#addr-99D8">99D8</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">C0 0C</td>
</tr>

<tr id="addr-99DA">
<td class="addr"><a href="#addr-99DA">99DA</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-99CE">loop_c99ce</a></span></td>
<td class="hex">90 F2</td>
</tr>

<tr id="addr-99DC">
<td class="addr"><a href="#addr-99DC">99DC</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-99DD">
<td class="addr"><a href="#addr-99DD">99DD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A9 20</td>
</tr>

<tr id="addr-99DF">
<td class="addr"><a href="#addr-99DF">99DF</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-99E2">
<td class="addr"><a href="#addr-99E2">99E2</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9A04">c9a04</a></span></td>
<td class="hex">F0 20</td>
</tr>

<tr id="addr-99E4">
<td class="addr"><a href="#addr-99E4">99E4</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-99E5">
<td class="addr"><a href="#addr-99E5">99E5</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-99E6">
<td class="addr"><a href="#addr-99E6">99E6</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#8</span></td>
<td class="hex">A9 08</td>
</tr>

<tr id="addr-99E8">
<td class="addr"><a href="#addr-99E8">99E8</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-99E9">
<td class="addr"><a href="#addr-99E9">99E9</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00A6">port_ws_offset</a></span></td>
<td class="hex">65 A6</td>
</tr>

<tr id="addr-99EB">
<td class="addr"><a href="#addr-99EB">99EB</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-99EC">
<td class="addr"><a href="#addr-99EC">99EC</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00A7">rx_buf_offset</a></span></td>
<td class="hex">A4 A7</td>
</tr>

<tr id="addr-99EE">
<td class="addr"><a href="#addr-99EE">99EE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-99F0">
<td class="addr"><a href="#addr-99F0">99F0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr id="addr-99F3">
<td class="addr"><a href="#addr-99F3">99F3</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D5D">rx_extra_byte</a></span></td>
<td class="hex">AD 5D 0D</td>
</tr>

<tr id="addr-99F6">
<td class="addr"><a href="#addr-99F6">99F6</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">8D E5 FE</td>
</tr>

<tr id="addr-99F9">
<td class="addr"><a href="#addr-99F9">99F9</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-99FA">
<td class="addr"><a href="#addr-99FA">99FA</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-99FB">
<td class="addr"><a href="#addr-99FB">99FB</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-99FD">
<td class="addr"><a href="#addr-99FD">99FD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">B1 A6</td>
</tr>

<tr id="addr-99FF">
<td class="addr"><a href="#addr-99FF">99FF</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9A00">
<td class="addr"><a href="#addr-9A00">9A00</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#0</span></td>
<td class="hex">69 00</td>
</tr>

<tr id="addr-9A02">
<td class="addr"><a href="#addr-9A02">9A02</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-9A04">
<td class="addr"><a href="#addr-9A04">9A04</a></td>
<td><span class="label">.c9a04</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A19">c9a19</a></span></td>
<td class="hex">4C 19 9A</td>
</tr>

<tr id="addr-9A07">
<td class="addr"><a href="#addr-9A07">9A07</a></td>
<td><span class="label">.c9a07</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">A5 A2</td>
</tr>

<tr id="addr-9A09">
<td class="addr"><a href="#addr-9A09">9A09</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-9A0A">
<td class="addr"><a href="#addr-9A0A">9A0A</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00A4">open_port_buf</a></span></td>
<td class="hex">65 A4</td>
</tr>

<tr id="addr-9A0C">
<td class="addr"><a href="#addr-9A0C">9A0C</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9A10">c9a10</a></span></td>
<td class="hex">90 02</td>
</tr>

<tr id="addr-9A0E">
<td class="addr"><a href="#addr-9A0E">9A0E</a></td>
<td><span class="label">.c9a0e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-9A10">
<td class="addr"><a href="#addr-9A10">9A10</a></td>
<td><span class="label">.c9a10</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-9A12">
<td class="addr"><a href="#addr-9A12">9A12</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-9A14">
<td class="addr"><a href="#addr-9A14">9A14</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;09</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9A15">
<td class="addr"><a href="#addr-9A15">9A15</a></td>
<td><span class="label">.sub_c9a15</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">A5 A5</td>
</tr>

<tr id="addr-9A17">
<td class="addr"><a href="#addr-9A17">9A17</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-9A19">
<td class="addr"><a href="#addr-9A19">9A19</a></td>
<td><span class="label">.c9a19</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3E">rx_src_net</a></span></td>
<td class="hex">AD 3E 0D</td>
</tr>

<tr id="addr-9A1C">
<td class="addr"><a href="#addr-9A1C">9A1C</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#3</span></td>
<td class="hex">A0 03</td>
</tr>

<tr id="addr-9A1E">
<td class="addr"><a href="#addr-9A1E">9A1E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-9A20">
<td class="addr"><a href="#addr-9A20">9A20</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;02</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9A21">
<td class="addr"><a href="#addr-9A21">9A21</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a></span></td>
<td class="hex">AD 3D 0D</td>
</tr>

<tr id="addr-9A24">
<td class="addr"><a href="#addr-9A24">9A24</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-9A26">
<td class="addr"><a href="#addr-9A26">9A26</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;01</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9A27">
<td class="addr"><a href="#addr-9A27">9A27</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D40">rx_port</a></span></td>
<td class="hex">AD 40 0D</td>
</tr>

<tr id="addr-9A2A">
<td class="addr"><a href="#addr-9A2A">9A2A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-9A2C">
<td class="addr"><a href="#addr-9A2C">9A2C</a></td>
<td>    <span class="opcode">DEY</span>  <span class="comment">; Y=&amp;00</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9A2D">
<td class="addr"><a href="#addr-9A2D">9A2D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3F">rx_ctrl</a></span></td>
<td class="hex">AD 3F 0D</td>
</tr>

<tr id="addr-9A30">
<td class="addr"><a href="#addr-9A30">9A30</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">09 80</td>
</tr>

<tr id="addr-9A32">
<td class="addr"><a href="#addr-9A32">9A32</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Discard with full ADLC reset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Performs adlc_full_reset (CR1=$C1, reset both TX and RX sections),</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; then falls through to discard_after_reset. Used when the ADLC is</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; in an unexpected state and needs a hard reset before returning</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to idle listen mode. 5 references — the main error recovery path.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9A34">
<td class="addr"><a href="#addr-9A34">9A34</a></td>
<td><span class="label">.discard_reset_listen</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-9A36">
<td class="addr"><a href="#addr-9A36">9A36</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-9A39">
<td class="addr"><a href="#addr-9A39">9A39</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9A40">discard_listen</a></span></td>
<td class="hex">F0 05</td>
</tr>

<tr id="addr-9A3B">
<td class="addr"><a href="#addr-9A3B">9A3B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;82</span></td>
<td class="hex">A9 82</td>
</tr>

<tr id="addr-9A3D">
<td class="addr"><a href="#addr-9A3D">9A3D</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Discard frame (gentle)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sends RX_DISCONTINUE (CR1=$A2: RIE|RX_DISCONTINUE) to abort the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; current frame reception without a full reset, then falls through</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to discard_after_reset. Used for clean rejection of frames that</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; are correctly formatted but not for us (wrong station/network).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9A40">
<td class="addr"><a href="#addr-9A40">9A40</a></td>
<td><span class="label">.discard_listen</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-96EB">adlc_rx_listen</a></span></td>
<td class="hex">20 EB 96</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Return to idle listen after reset/discard</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Just calls adlc_rx_listen (CR1=$82, CR2=$67) to re-enter idle</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; RX mode, then RTI. The simplest of the three discard paths —</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; used as the tail of both discard_reset_listen and discard_listen.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9A43">
<td class="addr"><a href="#addr-9A43">9A43</a></td>
<td><span class="label">.discard_after_reset</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;f6</span></td>
<td class="hex">A9 F6</td>
</tr>

<tr id="addr-9A45">
<td class="addr"><a href="#addr-9A45">9A45</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;96</span></td>
<td class="hex">A0 96</td>
</tr>

<tr id="addr-9A47">
<td class="addr"><a href="#addr-9A47">9A47</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9A4A">
<td class="addr"><a href="#addr-9A4A">9A4A</a></td>
<td><span class="label">.c9a4a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-9A4C">
<td class="addr"><a href="#addr-9A4C">9A4C</a></td>
<td><span class="label">.loop_c9a4c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a>,y</span></td>
<td class="hex">B9 3D 0D</td>
</tr>

<tr id="addr-9A4F">
<td class="addr"><a href="#addr-9A4F">9A4F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A6">port_ws_offset</a>),y</span></td>
<td class="hex">91 A6</td>
</tr>

<tr id="addr-9A51">
<td class="addr"><a href="#addr-9A51">9A51</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9A52">
<td class="addr"><a href="#addr-9A52">9A52</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">C0 0C</td>
</tr>

<tr id="addr-9A54">
<td class="addr"><a href="#addr-9A54">9A54</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9A4C">loop_c9a4c</a></span></td>
<td class="hex">D0 F6</td>
</tr>

<tr id="addr-9A56">
<td class="addr"><a href="#addr-9A56">9A56</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A19">c9a19</a></span></td>
<td class="hex">4C 19 9A</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Immediate operation handler (port = 0)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handles immediate (non-data-transfer) operations received via</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; scout frames with port byte = 0. The control byte ($0D3F)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; determines the operation type:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $81 = PEEK (read memory)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $82 = POKE (write memory)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $83 = JSR (remote procedure call)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $84 = user procedure</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $85 = OS procedure</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $86 = HALT</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $87 = CONTINUE</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The protection mask (LSTAT at $D63) controls which operations</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; are permitted — each bit enables or disables an operation type.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If the operation is not permitted by the mask, it is silently</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ignored. LSTAT can be read/set via OSWORD $12 sub-functions 4/5.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9A59">
<td class="addr"><a href="#addr-9A59">9A59</a></td>
<td><span class="label">.immediate_op</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D3F">rx_ctrl</a></span></td>
<td class="hex">AC 3F 0D</td>
</tr>

<tr id="addr-9A5C">
<td class="addr"><a href="#addr-9A5C">9A5C</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;81</span></td>
<td class="hex">C0 81</td>
</tr>

<tr id="addr-9A5E">
<td class="addr"><a href="#addr-9A5E">9A5E</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9A8C">c9a8c</a></span></td>
<td class="hex">90 2C</td>
</tr>

<tr id="addr-9A60">
<td class="addr"><a href="#addr-9A60">9A60</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;89</span></td>
<td class="hex">C0 89</td>
</tr>

<tr id="addr-9A62">
<td class="addr"><a href="#addr-9A62">9A62</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9A8C">c9a8c</a></span></td>
<td class="hex">B0 28</td>
</tr>

<tr id="addr-9A64">
<td class="addr"><a href="#addr-9A64">9A64</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;87</span></td>
<td class="hex">C0 87</td>
</tr>

<tr id="addr-9A66">
<td class="addr"><a href="#addr-9A66">9A66</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9A80">c9a80</a></span></td>
<td class="hex">B0 18</td>
</tr>

<tr id="addr-9A68">
<td class="addr"><a href="#addr-9A68">9A68</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a></span></td>
<td class="hex">AD 3D 0D</td>
</tr>

<tr id="addr-9A6B">
<td class="addr"><a href="#addr-9A6B">9A6B</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;f0</span></td>
<td class="hex">C9 F0</td>
</tr>

<tr id="addr-9A6D">
<td class="addr"><a href="#addr-9A6D">9A6D</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9A80">c9a80</a></span></td>
<td class="hex">B0 11</td>
</tr>

<tr id="addr-9A6F">
<td class="addr"><a href="#addr-9A6F">9A6F</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-9A70">
<td class="addr"><a href="#addr-9A70">9A70</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9A71">
<td class="addr"><a href="#addr-9A71">9A71</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">#&amp;81</span></td>
<td class="hex">E9 81</td>
</tr>

<tr id="addr-9A73">
<td class="addr"><a href="#addr-9A73">9A73</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-9A74">
<td class="addr"><a href="#addr-9A74">9A74</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">AD 63 0D</td>
</tr>

<tr id="addr-9A77">
<td class="addr"><a href="#addr-9A77">9A77</a></td>
<td><span class="label">.loop_c9a77</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">ROR</span></td>
<td class="hex">6A</td>
</tr>

<tr id="addr-9A78">
<td class="addr"><a href="#addr-9A78">9A78</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9A79">
<td class="addr"><a href="#addr-9A79">9A79</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9A77">loop_c9a77</a></span></td>
<td class="hex">10 FC</td>
</tr>

<tr id="addr-9A7B">
<td class="addr"><a href="#addr-9A7B">9A7B</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9A80">c9a80</a></span></td>
<td class="hex">90 03</td>
</tr>

<tr id="addr-9A7D">
<td class="addr"><a href="#addr-9A7D">9A7D</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9B4F">c9b4f</a></span></td>
<td class="hex">4C 4F 9B</td>
</tr>

<tr id="addr-9A80">
<td class="addr"><a href="#addr-9A80">9A80</a></td>
<td><span class="label">.c9a80</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D3F">rx_ctrl</a></span></td>
<td class="hex">AC 3F 0D</td>
</tr>

<tr id="addr-9A83">
<td class="addr"><a href="#addr-9A83">9A83</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9A16">l9a16</a>,y</span></td>
<td class="hex">B9 16 9A</td>
</tr>

<tr id="addr-9A86">
<td class="addr"><a href="#addr-9A86">9A86</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9A87">
<td class="addr"><a href="#addr-9A87">9A87</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9A0E">c9a0e</a>,y</span></td>
<td class="hex">B9 0E 9A</td>
</tr>

<tr id="addr-9A8A">
<td class="addr"><a href="#addr-9A8A">9A8A</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9A8B">
<td class="addr"><a href="#addr-9A8B">9A8B</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-9A8C">
<td class="addr"><a href="#addr-9A8C">9A8C</a></td>
<td><span class="label">.c9a8c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-988A">rx_error</a></span></td>
<td class="hex">4C 8A 98</td>
</tr>

<tr id="addr-9A8F">
<td class="addr"><a href="#addr-9A8F">9A8F</a></td>
<td>    <span class="directive">EQUB</span> &amp;DA, &amp;BC, &amp;9E, &amp;9E, &amp;9E, &amp;00, &amp;00, &amp;C7, &amp;9A, &amp;9A, &amp;9A, &amp;9A, &amp;9A, &amp;9B, &amp;9B, &amp;9A, &amp;A9, &amp;00, &amp;85, &amp;A4, &amp;A9, &amp;82, &amp;85, &amp;A2, &amp;A9, &amp;01, &amp;85, &amp;A3, &amp;A5, &amp;9D, &amp;85, &amp;A5, &amp;A0, &amp;03, &amp;B9, &amp;41, &amp;0D, &amp;99, &amp;58, &amp;0D, &amp;88, &amp;10, &amp;F7, &amp;4C, &amp;1C, &amp;98, &amp;A9, &amp;3D, &amp;85, &amp;A6, &amp;A9, &amp;0D, &amp;85, &amp;A7, &amp;4C, &amp;FB, &amp;97, &amp;A9, &amp;01, &amp;85, &amp;A3, &amp;A9, &amp;FC, &amp;85, &amp;A2, &amp;A9, &amp;21, &amp;85, &amp;A4, &amp;A9, &amp;7F, &amp;85, &amp;A5, &amp;4C, &amp;F9, &amp;9A, &amp;A5, &amp;A0, &amp;48, &amp;A5, &amp;A1, &amp;48, &amp;A9, &amp;3D, &amp;85, &amp;A0, &amp;A9, &amp;0D, &amp;85, &amp;A1, &amp;A9, &amp;02, &amp;8D, &amp;5C, &amp;0D, &amp;20, &amp;5B, &amp;9F, &amp;68, &amp;85, &amp;A1, &amp;68, &amp;85, &amp;A0, &amp;90, &amp;56, &amp;AD, &amp;4A, &amp;0D, &amp;09, &amp;80, &amp;8D, &amp;4A, &amp;0D, &amp;A9, &amp;44, &amp;8D, &amp;A0, &amp;FE, &amp;A9, &amp;A7, &amp;8D, &amp;A1, &amp;FE, &amp;A9, &amp;2F, &amp;A0</td>
<td class="hex">DA BC 9E 9E 9E 00 00 C7 9A 9A 9A 9A 9A 9B 9B 9A A9 00 85 A4 A9 82 85 A2 A9 01 85 A3 A5 9D 85 A5 A0 03 B9 41 0D 99 58 0D 88 10 F7 4C 1C 98 A9 3D 85 A6 A9 0D 85 A7 4C FB 97 A9 01 85 A3 A9 FC 85 A2 A9 21 85 A4 A9 7F 85 A5 4C F9 9A A5 A0 48 A5 A1 48 A9 3D 85 A0 A9 0D 85 A1 A9 02 8D 5C 0D 20 5B 9F 68 85 A1 68 85 A0 90 56 AD 4A 0D 09 80 8D 4A 0D A9 44 8D A0 FE A9 A7 8D A1 FE A9 2F A0</td>
</tr>

<tr id="addr-9B0E">
<td class="addr"><a href="#addr-9B0E">9B0E</a></td>
<td><span class="label">.l9b0e</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="directive">EQUB</span> &amp;9B, &amp;4C, &amp;74, &amp;99</td>
<td class="hex">9B 4C 74 99</td>
</tr>

<tr id="addr-9B12">
<td class="addr"><a href="#addr-9B12">9B12</a></td>
<td><span class="label">.c9b12</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D3F">rx_ctrl</a></span></td>
<td class="hex">AC 3F 0D</td>
</tr>

<tr id="addr-9B15">
<td class="addr"><a href="#addr-9B15">9B15</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;82</span></td>
<td class="hex">C0 82</td>
</tr>

<tr id="addr-9B17">
<td class="addr"><a href="#addr-9B17">9B17</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9B4F">c9b4f</a></span></td>
<td class="hex">F0 36</td>
</tr>

<tr id="addr-9B19">
<td class="addr"><a href="#addr-9B19">9B19</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">A5 A2</td>
</tr>

<tr id="addr-9B1B">
<td class="addr"><a href="#addr-9B1B">9B1B</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-9B1C">
<td class="addr"><a href="#addr-9B1C">9B1C</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand">#&amp;80</span></td>
<td class="hex">69 80</td>
</tr>

<tr id="addr-9B1E">
<td class="addr"><a href="#addr-9B1E">9B1E</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;7f</span></td>
<td class="hex">A0 7F</td>
</tr>

<tr id="addr-9B20">
<td class="addr"><a href="#addr-9B20">9B20</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-9B22">
<td class="addr"><a href="#addr-9B22">9B22</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A0 80</td>
</tr>

<tr id="addr-9B24">
<td class="addr"><a href="#addr-9B24">9B24</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3D">rx_src_stn</a></span></td>
<td class="hex">AD 3D 0D</td>
</tr>

<tr id="addr-9B27">
<td class="addr"><a href="#addr-9B27">9B27</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-9B29">
<td class="addr"><a href="#addr-9B29">9B29</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;81</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9B2A">
<td class="addr"><a href="#addr-9B2A">9B2A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3E">rx_src_net</a></span></td>
<td class="hex">AD 3E 0D</td>
</tr>

<tr id="addr-9B2D">
<td class="addr"><a href="#addr-9B2D">9B2D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-009C">net_rx_ptr</a>),y</span></td>
<td class="hex">91 9C</td>
</tr>

<tr id="addr-9B2F">
<td class="addr"><a href="#addr-9B2F">9B2F</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D3F">rx_ctrl</a></span></td>
<td class="hex">AD 3F 0D</td>
</tr>

<tr id="addr-9B32">
<td class="addr"><a href="#addr-9B32">9B32</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D57">tx_work_57</a></span></td>
<td class="hex">8D 57 0D</td>
</tr>

<tr id="addr-9B35">
<td class="addr"><a href="#addr-9B35">9B35</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;84</span></td>
<td class="hex">A9 84</td>
</tr>

<tr id="addr-9B37">
<td class="addr"><a href="#addr-9B37">9B37</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FE4E">system_via_ier</a></span></td>
<td class="hex">8D 4E FE</td>
</tr>

<tr id="addr-9B3A">
<td class="addr"><a href="#addr-9B3A">9B3A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE4B">system_via_acr</a></span></td>
<td class="hex">AD 4B FE</td>
</tr>

<tr id="addr-9B3D">
<td class="addr"><a href="#addr-9B3D">9B3D</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;1c</span></td>
<td class="hex">29 1C</td>
</tr>

<tr id="addr-9B3F">
<td class="addr"><a href="#addr-9B3F">9B3F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D51">tx_work_51</a></span></td>
<td class="hex">8D 51 0D</td>
</tr>

<tr id="addr-9B42">
<td class="addr"><a href="#addr-9B42">9B42</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE4B">system_via_acr</a></span></td>
<td class="hex">AD 4B FE</td>
</tr>

<tr id="addr-9B45">
<td class="addr"><a href="#addr-9B45">9B45</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;e3</span></td>
<td class="hex">29 E3</td>
</tr>

<tr id="addr-9B47">
<td class="addr"><a href="#addr-9B47">9B47</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#8</span></td>
<td class="hex">09 08</td>
</tr>

<tr id="addr-9B49">
<td class="addr"><a href="#addr-9B49">9B49</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FE4B">system_via_acr</a></span></td>
<td class="hex">8D 4B FE</td>
</tr>

<tr id="addr-9B4C">
<td class="addr"><a href="#addr-9B4C">9B4C</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE4A">system_via_sr</a></span></td>
<td class="hex">2C 4A FE</td>
</tr>

<tr id="addr-9B4F">
<td class="addr"><a href="#addr-9B4F">9B4F</a></td>
<td><span class="label">.c9b4f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A34">discard_reset_listen</a></span></td>
<td class="hex">4C 34 9A</td>
</tr>

<tr id="addr-9B52">
<td class="addr"><a href="#addr-9B52">9B52</a></td>
<td><span class="label">.c9b52</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#4</span></td>
<td class="hex">A9 04</td>
</tr>

<tr id="addr-9B54">
<td class="addr"><a href="#addr-9B54">9B54</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE4D">system_via_ifr</a></span></td>
<td class="hex">2C 4D FE</td>
</tr>

<tr id="addr-9B57">
<td class="addr"><a href="#addr-9B57">9B57</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9B5C">c9b5c</a></span></td>
<td class="hex">D0 03</td>
</tr>

<tr id="addr-9B59">
<td class="addr"><a href="#addr-9B59">9B59</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#5</span></td>
<td class="hex">A9 05</td>
</tr>

<tr id="addr-9B5B">
<td class="addr"><a href="#addr-9B5B">9B5B</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-9B5C">
<td class="addr"><a href="#addr-9B5C">9B5C</a></td>
<td><span class="label">.c9b5c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-9B5D">
<td class="addr"><a href="#addr-9B5D">9B5D</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9B5E">
<td class="addr"><a href="#addr-9B5E">9B5E</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-9B5F">
<td class="addr"><a href="#addr-9B5F">9B5F</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9B60">
<td class="addr"><a href="#addr-9B60">9B60</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE4B">system_via_acr</a></span></td>
<td class="hex">AD 4B FE</td>
</tr>

<tr id="addr-9B63">
<td class="addr"><a href="#addr-9B63">9B63</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">#&amp;e3</span></td>
<td class="hex">29 E3</td>
</tr>

<tr id="addr-9B65">
<td class="addr"><a href="#addr-9B65">9B65</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand"><a href="#addr-0D51">tx_work_51</a></span></td>
<td class="hex">0D 51 0D</td>
</tr>

<tr id="addr-9B68">
<td class="addr"><a href="#addr-9B68">9B68</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FE4B">system_via_acr</a></span></td>
<td class="hex">8D 4B FE</td>
</tr>

<tr id="addr-9B6B">
<td class="addr"><a href="#addr-9B6B">9B6B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE4A">system_via_sr</a></span></td>
<td class="hex">AD 4A FE</td>
</tr>

<tr id="addr-9B6E">
<td class="addr"><a href="#addr-9B6E">9B6E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#4</span></td>
<td class="hex">A9 04</td>
</tr>

<tr id="addr-9B70">
<td class="addr"><a href="#addr-9B70">9B70</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FE4D">system_via_ifr</a></span></td>
<td class="hex">8D 4D FE</td>
</tr>

<tr id="addr-9B73">
<td class="addr"><a href="#addr-9B73">9B73</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FE4E">system_via_ier</a></span></td>
<td class="hex">8D 4E FE</td>
</tr>

<tr id="addr-9B76">
<td class="addr"><a href="#addr-9B76">9B76</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D57">tx_work_57</a></span></td>
<td class="hex">AC 57 0D</td>
</tr>

<tr id="addr-9B79">
<td class="addr"><a href="#addr-9B79">9B79</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;86</span></td>
<td class="hex">C0 86</td>
</tr>

<tr id="addr-9B7B">
<td class="addr"><a href="#addr-9B7B">9B7B</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9B88">c9b88</a></span></td>
<td class="hex">B0 0B</td>
</tr>

<tr id="addr-9B7D">
<td class="addr"><a href="#addr-9B7D">9B7D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">AD 63 0D</td>
</tr>

<tr id="addr-9B80">
<td class="addr"><a href="#addr-9B80">9B80</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3B">rx_ctrl_copy</a></span></td>
<td class="hex">8D 3B 0D</td>
</tr>

<tr id="addr-9B83">
<td class="addr"><a href="#addr-9B83">9B83</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#&amp;1c</span></td>
<td class="hex">09 1C</td>
</tr>

<tr id="addr-9B85">
<td class="addr"><a href="#addr-9B85">9B85</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D63">prot_status</a></span></td>
<td class="hex">8D 63 0D</td>
</tr>

<tr id="addr-9B88">
<td class="addr"><a href="#addr-9B88">9B88</a></td>
<td><span class="label">.c9b88</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9B13">l9b13</a>,y</span></td>
<td class="hex">B9 13 9B</td>
</tr>

<tr id="addr-9B8B">
<td class="addr"><a href="#addr-9B8B">9B8B</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9B8C">
<td class="addr"><a href="#addr-9B8C">9B8C</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9B0E">l9b0e</a>,y</span></td>
<td class="hex">B9 0E 9B</td>
</tr>

<tr id="addr-9B8F">
<td class="addr"><a href="#addr-9B8F">9B8F</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9B90">
<td class="addr"><a href="#addr-9B90">9B90</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-9B91">
<td class="addr"><a href="#addr-9B91">9B91</a></td>
<td>    <span class="directive">EQUB</span> &amp;9A, &amp;A3, &amp;B1, &amp;BD, &amp;D4, &amp;9B, &amp;9B, &amp;9B, &amp;9B, &amp;9B, &amp;A9, &amp;9B, &amp;48, &amp;A9, &amp;DC</td>
<td class="hex">9A A3 B1 BD D4 9B 9B 9B 9B 9B A9 9B 48 A9 DC</td>
</tr>

<tr id="addr-9BA0">
<td class="addr"><a href="#addr-9BA0">9BA0</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;HlX&quot;</span></td>
<td class="hex">48 6C 58</td>
</tr>

<tr id="addr-9BA3">
<td class="addr"><a href="#addr-9BA3">9BA3</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D, &amp;A0, &amp;08, &amp;AE, &amp;58, &amp;0D, &amp;AD, &amp;59, &amp;0D, &amp;20, &amp;BF, &amp;FF, &amp;4C, &amp;DD, &amp;9B, &amp;AE, &amp;58, &amp;0D, &amp;AC, &amp;59, &amp;0D, &amp;20, &amp;00, &amp;80, &amp;4C, &amp;DD, &amp;9B, &amp;A9, &amp;04, &amp;2C, &amp;38, &amp;0D, &amp;D0, &amp;18, &amp;0D, &amp;38, &amp;0D, &amp;8D, &amp;38, &amp;0D, &amp;A9, &amp;04</td>
<td class="hex">0D A0 08 AE 58 0D AD 59 0D 20 BF FF 4C DD 9B AE 58 0D AC 59 0D 20 00 80 4C DD 9B A9 04 2C 38 0D D0 18 0D 38 0D 8D 38 0D A9 04</td>
</tr>

<tr id="addr-9BCD">
<td class="addr"><a href="#addr-9BCD">9BCD</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;X,8&quot;</span></td>
<td class="hex">58 2C 38</td>
</tr>

<tr id="addr-9BD0">
<td class="addr"><a href="#addr-9BD0">9BD0</a></td>
<td>    <span class="directive">EQUB</span> &amp;0D, &amp;D0, &amp;FB, &amp;F0, &amp;08, &amp;AD, &amp;38, &amp;0D, &amp;29, &amp;FB, &amp;8D, &amp;38, &amp;0D, &amp;68, &amp;A8, &amp;68, &amp;AA, &amp;A9, &amp;00, &amp;60</td>
<td class="hex">0D D0 FB F0 08 AD 38 0D 29 FB 8D 38 0D 68 A8 68 AA A9 00 60</td>
</tr>

<tr id="addr-9BE4">
<td class="addr"><a href="#addr-9BE4">9BE4</a></td>
<td><span class="label">.c9be4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-9BE5">
<td class="addr"><a href="#addr-9BE5">9BE5</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9BE6">
<td class="addr"><a href="#addr-9BE6">9BE6</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#2</span></td>
<td class="hex">A0 02</td>
</tr>

<tr id="addr-9BE8">
<td class="addr"><a href="#addr-9BE8">9BE8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9BEA">
<td class="addr"><a href="#addr-9BEA">9BEA</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D20">tx_dst_stn</a></span></td>
<td class="hex">8D 20 0D</td>
</tr>

<tr id="addr-9BED">
<td class="addr"><a href="#addr-9BED">9BED</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;03</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9BEE">
<td class="addr"><a href="#addr-9BEE">9BEE</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9BF0">
<td class="addr"><a href="#addr-9BF0">9BF0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D21">tx_dst_net</a></span></td>
<td class="hex">8D 21 0D</td>
</tr>

<tr id="addr-9BF3">
<td class="addr"><a href="#addr-9BF3">9BF3</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-9BF5">
<td class="addr"><a href="#addr-9BF5">9BF5</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9BF7">
<td class="addr"><a href="#addr-9BF7">9BF7</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-9BFC">c9bfc</a></span></td>
<td class="hex">30 03</td>
</tr>

<tr id="addr-9BF9">
<td class="addr"><a href="#addr-9BF9">9BF9</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9C84">tx_active_start</a></span></td>
<td class="hex">4C 84 9C</td>
</tr>

<tr id="addr-9BFC">
<td class="addr"><a href="#addr-9BFC">9BFC</a></td>
<td><span class="label">.c9bfc</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D24">tx_ctrl_byte</a></span></td>
<td class="hex">8D 24 0D</td>
</tr>

<tr id="addr-9BFF">
<td class="addr"><a href="#addr-9BFF">9BFF</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9C00">
<td class="addr"><a href="#addr-9C00">9C00</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9C01">
<td class="addr"><a href="#addr-9C01">9C01</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9C03">
<td class="addr"><a href="#addr-9C03">9C03</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D25">tx_port</a></span></td>
<td class="hex">8D 25 0D</td>
</tr>

<tr id="addr-9C06">
<td class="addr"><a href="#addr-9C06">9C06</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9C37">c9c37</a></span></td>
<td class="hex">D0 2F</td>
</tr>

<tr id="addr-9C08">
<td class="addr"><a href="#addr-9C08">9C08</a></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#&amp;83</span></td>
<td class="hex">E0 83</td>
</tr>

<tr id="addr-9C0A">
<td class="addr"><a href="#addr-9C0A">9C0A</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9C27">c9c27</a></span></td>
<td class="hex">B0 1B</td>
</tr>

<tr id="addr-9C0C">
<td class="addr"><a href="#addr-9C0C">9C0C</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9C0D">
<td class="addr"><a href="#addr-9C0D">9C0D</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9C0E">
<td class="addr"><a href="#addr-9C0E">9C0E</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-9C10">
<td class="addr"><a href="#addr-9C10">9C10</a></td>
<td><span class="label">.loop_c9c10</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9C12">
<td class="addr"><a href="#addr-9C12">9C12</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9C13">
<td class="addr"><a href="#addr-9C13">9C13</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9C14">
<td class="addr"><a href="#addr-9C14">9C14</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9C15">
<td class="addr"><a href="#addr-9C15">9C15</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9C16">
<td class="addr"><a href="#addr-9C16">9C16</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9C17">
<td class="addr"><a href="#addr-9C17">9C17</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">F1 A0</td>
</tr>

<tr id="addr-9C19">
<td class="addr"><a href="#addr-9C19">9C19</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D26">tx_data_start</a>,y</span></td>
<td class="hex">99 26 0D</td>
</tr>

<tr id="addr-9C1C">
<td class="addr"><a href="#addr-9C1C">9C1C</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9C1D">
<td class="addr"><a href="#addr-9C1D">9C1D</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9C1E">
<td class="addr"><a href="#addr-9C1E">9C1E</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9C1F">
<td class="addr"><a href="#addr-9C1F">9C1F</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9C20">
<td class="addr"><a href="#addr-9C20">9C20</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9C21">
<td class="addr"><a href="#addr-9C21">9C21</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9C22">
<td class="addr"><a href="#addr-9C22">9C22</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">C0 0C</td>
</tr>

<tr id="addr-9C24">
<td class="addr"><a href="#addr-9C24">9C24</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9C10">loop_c9c10</a></span></td>
<td class="hex">90 EA</td>
</tr>

<tr id="addr-9C26">
<td class="addr"><a href="#addr-9C26">9C26</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9C27">
<td class="addr"><a href="#addr-9C27">9C27</a></td>
<td><span class="label">.c9c27</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">CPX</span> <span class="operand">#&amp;89</span></td>
<td class="hex">E0 89</td>
</tr>

<tr id="addr-9C29">
<td class="addr"><a href="#addr-9C29">9C29</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9C84">tx_active_start</a></span></td>
<td class="hex">B0 59</td>
</tr>

<tr id="addr-9C2B">
<td class="addr"><a href="#addr-9C2B">9C2B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">A0 0C</td>
</tr>

<tr id="addr-9C2D">
<td class="addr"><a href="#addr-9C2D">9C2D</a></td>
<td><span class="label">.loop_c9c2d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9C2F">
<td class="addr"><a href="#addr-9C2F">9C2F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D1A">nmi_shim_1a</a>,y</span></td>
<td class="hex">99 1A 0D</td>
</tr>

<tr id="addr-9C32">
<td class="addr"><a href="#addr-9C32">9C32</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9C33">
<td class="addr"><a href="#addr-9C33">9C33</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;10</span></td>
<td class="hex">C0 10</td>
</tr>

<tr id="addr-9C35">
<td class="addr"><a href="#addr-9C35">9C35</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9C2D">loop_c9c2d</a></span></td>
<td class="hex">90 F6</td>
</tr>

<tr id="addr-9C37">
<td class="addr"><a href="#addr-9C37">9C37</a></td>
<td><span class="label">.c9c37</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;20</span></td>
<td class="hex">A9 20</td>
</tr>

<tr id="addr-9C39">
<td class="addr"><a href="#addr-9C39">9C39</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9C3C">
<td class="addr"><a href="#addr-9C3C">9C3C</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9C94">c9c94</a></span></td>
<td class="hex">D0 56</td>
</tr>

<tr id="addr-9C3E">
<td class="addr"><a href="#addr-9C3E">9C3E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;fd</span></td>
<td class="hex">A9 FD</td>
</tr>

<tr id="addr-9C40">
<td class="addr"><a href="#addr-9C40">9C40</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9C41">
<td class="addr"><a href="#addr-9C41">9C41</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#6</span></td>
<td class="hex">A9 06</td>
</tr>

<tr id="addr-9C43">
<td class="addr"><a href="#addr-9C43">9C43</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D50">tx_length</a></span></td>
<td class="hex">8D 50 0D</td>
</tr>

<tr id="addr-9C46">
<td class="addr"><a href="#addr-9C46">9C46</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; INACTIVE polling loop</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Polls SR2 for INACTIVE (bit2) to confirm the network line is idle before</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; attempting transmission. Uses a 3-byte timeout counter on the stack.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The timeout (~256^3 iterations) generates &#34;Line Jammed&#34; if INACTIVE</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; never appears.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; The CTS check at $9C66-$9C6B works because CR2=$67 has RTS=0, so</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; cts_input_ is always true, and SR1_CTS reflects presence of clock hardware.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9C48">
<td class="addr"><a href="#addr-9C48">9C48</a></td>
<td><span class="label">.inactive_poll</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4F">tx_index</a></span></td>
<td class="hex">8D 4F 0D</td>
</tr>

<tr id="addr-9C4B">
<td class="addr"><a href="#addr-9C4B">9C4B</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9C4C">
<td class="addr"><a href="#addr-9C4C">9C4C</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9C4D">
<td class="addr"><a href="#addr-9C4D">9C4D</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;e7</span>  <span class="comment">; Y=$E7: CR2 value for TX prep (RTS|CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)</span></td>
<td class="hex">A0 E7</td>
</tr>

<tr id="addr-9C4F">
<td class="addr"><a href="#addr-9C4F">9C4F</a></td>
<td><span class="label">.c9c4f</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#4</span>  <span class="comment">; A=$04: INACTIVE mask for SR2 bit2</span></td>
<td class="hex">A9 04</td>
</tr>

<tr id="addr-9C51">
<td class="addr"><a href="#addr-9C51">9C51</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9C52">
<td class="addr"><a href="#addr-9C52">9C52</a></td>
<td>    <span class="opcode">SEI</span></td>
<td class="hex">78</td>
</tr>

<tr id="addr-9C53">
<td class="addr"><a href="#addr-9C53">9C53</a></td>
<td><span class="label">.c9c53</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; INTOFF -- disable NMIs</span></td>
<td class="hex">2C 18 FE</td>
</tr>

<tr id="addr-9C56">
<td class="addr"><a href="#addr-9C56">9C56</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; INTOFF again (belt-and-braces)</span></td>
<td class="hex">2C 18 FE</td>
</tr>

<tr id="addr-9C59">
<td class="addr"><a href="#addr-9C59">9C59</a></td>
<td><span class="label">.sub_c9c59</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: Z = $04 AND SR2 -- tests INACTIVE</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9C5C">
<td class="addr"><a href="#addr-9C5C">9C5C</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9C6D">c9c6d</a></span>  <span class="comment">; INACTIVE not set -- re-enable NMIs and loop</span></td>
<td class="hex">F0 0F</td>
</tr>

<tr id="addr-9C5E">
<td class="addr"><a href="#addr-9C5E">9C5E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; Read SR1 (acknowledge pending interrupt)</span></td>
<td class="hex">AD A0 FE</td>
</tr>

<tr id="addr-9C61">
<td class="addr"><a href="#addr-9C61">9C61</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;67</span>  <span class="comment">; CR2=$67: CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE</span></td>
<td class="hex">A9 67</td>
</tr>

<tr id="addr-9C63">
<td class="addr"><a href="#addr-9C63">9C63</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9C66">
<td class="addr"><a href="#addr-9C66">9C66</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;10</span>  <span class="comment">; A=$10: CTS mask for SR1 bit4</span></td>
<td class="hex">A9 10</td>
</tr>

<tr id="addr-9C68">
<td class="addr"><a href="#addr-9C68">9C68</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: tests CTS present</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9C6B">
<td class="addr"><a href="#addr-9C6B">9C6B</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9CA2">tx_prepare</a></span>  <span class="comment">; CTS set -- clock hardware detected, start TX</span></td>
<td class="hex">D0 35</td>
</tr>

<tr id="addr-9C6D">
<td class="addr"><a href="#addr-9C6D">9C6D</a></td>
<td><span class="label">.c9c6d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE20">video_ula_control</a></span>  <span class="comment">; INTON -- re-enable NMIs ($FE20 read)</span></td>
<td class="hex">2C 20 FE</td>
</tr>

<tr id="addr-9C70">
<td class="addr"><a href="#addr-9C70">9C70</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9C71">
<td class="addr"><a href="#addr-9C71">9C71</a></td>
<td>    <span class="opcode">TSX</span>  <span class="comment">; 3-byte timeout counter on stack</span></td>
<td class="hex">BA</td>
</tr>

<tr id="addr-9C72">
<td class="addr"><a href="#addr-9C72">9C72</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-0101">l0101</a>,x</span></td>
<td class="hex">FE 01 01</td>
</tr>

<tr id="addr-9C75">
<td class="addr"><a href="#addr-9C75">9C75</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9C4F">c9c4f</a></span></td>
<td class="hex">D0 D8</td>
</tr>

<tr id="addr-9C77">
<td class="addr"><a href="#addr-9C77">9C77</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-0102">l0102</a>,x</span></td>
<td class="hex">FE 02 01</td>
</tr>

<tr id="addr-9C7A">
<td class="addr"><a href="#addr-9C7A">9C7A</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9C4F">c9c4f</a></span></td>
<td class="hex">D0 D3</td>
</tr>

<tr id="addr-9C7C">
<td class="addr"><a href="#addr-9C7C">9C7C</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-0103">l0103</a>,x</span></td>
<td class="hex">FE 03 01</td>
</tr>

<tr id="addr-9C7F">
<td class="addr"><a href="#addr-9C7F">9C7F</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9C4F">c9c4f</a></span></td>
<td class="hex">D0 CE</td>
</tr>

<tr id="addr-9C81">
<td class="addr"><a href="#addr-9C81">9C81</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9C88">tx_line_jammed</a></span></td>
<td class="hex">4C 88 9C</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX_ACTIVE branch (A=$44 = CR1 value for TX active)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9C84">
<td class="addr"><a href="#addr-9C84">9C84</a></td>
<td><span class="label">.tx_active_start</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;44</span></td>
<td class="hex">A9 44</td>
</tr>

<tr id="addr-9C86">
<td class="addr"><a href="#addr-9C86">9C86</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9C96">c9c96</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 0E</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Timeout error: writes CR2=$07 to abort, cleans stack,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; returns error $40 (&#34;Line Jammed&#34;).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9C88">
<td class="addr"><a href="#addr-9C88">9C88</a></td>
<td><span class="label">.tx_line_jammed</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#7</span>  <span class="comment">; CR2=$07: FC_TDRA | 2_1_BYTE | PSE (abort TX)</span></td>
<td class="hex">A9 07</td>
</tr>

<tr id="addr-9C8A">
<td class="addr"><a href="#addr-9C8A">9C8A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9C8D">
<td class="addr"><a href="#addr-9C8D">9C8D</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9C8E">
<td class="addr"><a href="#addr-9C8E">9C8E</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9C8F">
<td class="addr"><a href="#addr-9C8F">9C8F</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9C90">
<td class="addr"><a href="#addr-9C90">9C90</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;40</span>  <span class="comment">; Error $40 = &#39;Line Jammed&#39;</span></td>
<td class="hex">A9 40</td>
</tr>

<tr id="addr-9C92">
<td class="addr"><a href="#addr-9C92">9C92</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9C96">c9c96</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 02</td>
</tr>

<tr id="addr-9C94">
<td class="addr"><a href="#addr-9C94">9C94</a></td>
<td><span class="label">.c9c94</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;43</span></td>
<td class="hex">A9 43</td>
</tr>

<tr id="addr-9C96">
<td class="addr"><a href="#addr-9C96">9C96</a></td>
<td><span class="label">.c9c96</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-9C98">
<td class="addr"><a href="#addr-9C98">9C98</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">91 A0</td>
</tr>

<tr id="addr-9C9A">
<td class="addr"><a href="#addr-9C9A">9C9A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-9C9C">
<td class="addr"><a href="#addr-9C9C">9C9C</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3A">tx_ctrl_status</a></span></td>
<td class="hex">8D 3A 0D</td>
</tr>

<tr id="addr-9C9F">
<td class="addr"><a href="#addr-9C9F">9C9F</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9CA0">
<td class="addr"><a href="#addr-9CA0">9CA0</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9CA1">
<td class="addr"><a href="#addr-9CA1">9CA1</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX preparation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Configures ADLC for transmission: asserts RTS via CR2, enables TIE via CR1,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; installs NMI TX handler at $9D4C, and re-enables NMIs.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9CA2">
<td class="addr"><a href="#addr-9CA2">9CA2</a></td>
<td><span class="label">.tx_prepare</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; Write CR2 = Y ($E7: RTS|CLR_TX_ST|CLR_RX_ST|FC_TDRA|2_1_BYTE|PSE)</span></td>
<td class="hex">8C A1 FE</td>
</tr>

<tr id="addr-9CA5">
<td class="addr"><a href="#addr-9CA5">9CA5</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;44</span>  <span class="comment">; CR1=$44: RX_RESET | TIE (TX active, TX interrupts enabled)</span></td>
<td class="hex">A2 44</td>
</tr>

<tr id="addr-9CA7">
<td class="addr"><a href="#addr-9CA7">9CA7</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8E A0 FE</td>
</tr>

<tr id="addr-9CAA">
<td class="addr"><a href="#addr-9CAA">9CAA</a></td>
<td>    <span class="opcode">LDX</span> <span class="operand">#&amp;4c</span>  <span class="comment">; Install NMI handler at $9D4C (TX data handler)</span></td>
<td class="hex">A2 4C</td>
</tr>

<tr id="addr-9CAC">
<td class="addr"><a href="#addr-9CAC">9CAC</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9d</span></td>
<td class="hex">A0 9D</td>
</tr>

<tr id="addr-9CAE">
<td class="addr"><a href="#addr-9CAE">9CAE</a></td>
<td>    <span class="opcode">STX</span> <span class="operand"><a href="#addr-0D0C">nmi_jmp_lo</a></span></td>
<td class="hex">8E 0C 0D</td>
</tr>

<tr id="addr-9CB1">
<td class="addr"><a href="#addr-9CB1">9CB1</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0D0D">nmi_jmp_hi</a></span></td>
<td class="hex">8C 0D 0D</td>
</tr>

<tr id="addr-9CB4">
<td class="addr"><a href="#addr-9CB4">9CB4</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE20">video_ula_control</a></span>  <span class="comment">; INTON -- NMIs now fire for TDRA ($FE20 read)</span></td>
<td class="hex">2C 20 FE</td>
</tr>

<tr id="addr-9CB7">
<td class="addr"><a href="#addr-9CB7">9CB7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D25">tx_port</a></span></td>
<td class="hex">AD 25 0D</td>
</tr>

<tr id="addr-9CBA">
<td class="addr"><a href="#addr-9CBA">9CBA</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9D16">c9d16</a></span></td>
<td class="hex">D0 5A</td>
</tr>

<tr id="addr-9CBC">
<td class="addr"><a href="#addr-9CBC">9CBC</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D24">tx_ctrl_byte</a></span></td>
<td class="hex">AC 24 0D</td>
</tr>

<tr id="addr-9CBF">
<td class="addr"><a href="#addr-9CBF">9CBF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9ED2">l9ed2</a>,y</span></td>
<td class="hex">B9 D2 9E</td>
</tr>

<tr id="addr-9CC2">
<td class="addr"><a href="#addr-9CC2">9CC2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr id="addr-9CC5">
<td class="addr"><a href="#addr-9CC5">9CC5</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9ECA">l9eca</a>,y</span></td>
<td class="hex">B9 CA 9E</td>
</tr>

<tr id="addr-9CC8">
<td class="addr"><a href="#addr-9CC8">9CC8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D50">tx_length</a></span></td>
<td class="hex">8D 50 0D</td>
</tr>

<tr id="addr-9CCB">
<td class="addr"><a href="#addr-9CCB">9CCB</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9C5B">l9c5b</a>,y</span></td>
<td class="hex">B9 5B 9C</td>
</tr>

<tr id="addr-9CCE">
<td class="addr"><a href="#addr-9CCE">9CCE</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9CCF">
<td class="addr"><a href="#addr-9CCF">9CCF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-9C53">c9c53</a>,y</span></td>
<td class="hex">B9 53 9C</td>
</tr>

<tr id="addr-9CD2">
<td class="addr"><a href="#addr-9CD2">9CD2</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9CD3">
<td class="addr"><a href="#addr-9CD3">9CD3</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-9CD4">
<td class="addr"><a href="#addr-9CD4">9CD4</a></td>
<td>    <span class="directive">EQUB</span> &amp;E7, &amp;EB, &amp;0A, &amp;0A, &amp;0A, &amp;44, &amp;44, &amp;E3, &amp;9C, &amp;9C, &amp;9D, &amp;9D, &amp;9D, &amp;9D, &amp;9D, &amp;9C, &amp;A9, &amp;03, &amp;D0, &amp;25, &amp;A9, &amp;03, &amp;D0, &amp;02, &amp;A9, &amp;02, &amp;8D, &amp;5C, &amp;0D, &amp;18, &amp;08, &amp;A0, &amp;0C, &amp;B9, &amp;1E, &amp;0D, &amp;28, &amp;71, &amp;A0, &amp;99, &amp;1E, &amp;0D, &amp;C8, &amp;08, &amp;C0, &amp;10, &amp;90, &amp;F1</td>
<td class="hex">E7 EB 0A 0A 0A 44 44 E3 9C 9C 9D 9D 9D 9D 9D 9C A9 03 D0 25 A9 03 D0 02 A9 02 8D 5C 0D 18 08 A0 0C B9 1E 0D 28 71 A0 99 1E 0D C8 08 C0 10 90 F1</td>
</tr>

<tr id="addr-9D04">
<td class="addr"><a href="#addr-9D04">9D04</a></td>
<td>    <span class="directive">EQUS</span> <span class="string">&quot;( [&quot;</span></td>
<td class="hex">28 20 5B</td>
</tr>

<tr id="addr-9D07">
<td class="addr"><a href="#addr-9D07">9D07</a></td>
<td>    <span class="directive">EQUB</span> &amp;9F, &amp;4C, &amp;45, &amp;9D, &amp;A9, &amp;02, &amp;8D, &amp;5C, &amp;0D, &amp;20, &amp;5B, &amp;9F, &amp;4C, &amp;45, &amp;9D</td>
<td class="hex">9F 4C 45 9D A9 02 8D 5C 0D 20 5B 9F 4C 45 9D</td>
</tr>

<tr id="addr-9D16">
<td class="addr"><a href="#addr-9D16">9D16</a></td>
<td><span class="label">.c9d16</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D20">tx_dst_stn</a></span></td>
<td class="hex">AD 20 0D</td>
</tr>

<tr id="addr-9D19">
<td class="addr"><a href="#addr-9D19">9D19</a></td>
<td>    <span class="opcode">AND</span> <span class="operand"><a href="#addr-0D21">tx_dst_net</a></span></td>
<td class="hex">2D 21 0D</td>
</tr>

<tr id="addr-9D1C">
<td class="addr"><a href="#addr-9D1C">9D1C</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">C9 FF</td>
</tr>

<tr id="addr-9D1E">
<td class="addr"><a href="#addr-9D1E">9D1E</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9D38">c9d38</a></span></td>
<td class="hex">D0 18</td>
</tr>

<tr id="addr-9D20">
<td class="addr"><a href="#addr-9D20">9D20</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;0e</span></td>
<td class="hex">A9 0E</td>
</tr>

<tr id="addr-9D22">
<td class="addr"><a href="#addr-9D22">9D22</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D50">tx_length</a></span></td>
<td class="hex">8D 50 0D</td>
</tr>

<tr id="addr-9D25">
<td class="addr"><a href="#addr-9D25">9D25</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;40</span></td>
<td class="hex">A9 40</td>
</tr>

<tr id="addr-9D27">
<td class="addr"><a href="#addr-9D27">9D27</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr id="addr-9D2A">
<td class="addr"><a href="#addr-9D2A">9D2A</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-9D2C">
<td class="addr"><a href="#addr-9D2C">9D2C</a></td>
<td><span class="label">.loop_c9d2c</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9D2E">
<td class="addr"><a href="#addr-9D2E">9D2E</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D22">tx_src_stn</a>,y</span></td>
<td class="hex">99 22 0D</td>
</tr>

<tr id="addr-9D31">
<td class="addr"><a href="#addr-9D31">9D31</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9D32">
<td class="addr"><a href="#addr-9D32">9D32</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#&amp;0c</span></td>
<td class="hex">C0 0C</td>
</tr>

<tr id="addr-9D34">
<td class="addr"><a href="#addr-9D34">9D34</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9D2C">loop_c9d2c</a></span></td>
<td class="hex">90 F6</td>
</tr>

<tr id="addr-9D36">
<td class="addr"><a href="#addr-9D36">9D36</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9D45">c9d45</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">B0 0D</td>
</tr>

<tr id="addr-9D38">
<td class="addr"><a href="#addr-9D38">9D38</a></td>
<td><span class="label">.c9d38</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9D3A">
<td class="addr"><a href="#addr-9D3A">9D3A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr id="addr-9D3D">
<td class="addr"><a href="#addr-9D3D">9D3D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-9D3F">
<td class="addr"><a href="#addr-9D3F">9D3F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D5C">scout_status</a></span></td>
<td class="hex">8D 5C 0D</td>
</tr>

<tr id="addr-9D42">
<td class="addr"><a href="#addr-9D42">9D42</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-9F5B">tx_calc_transfer</a></span></td>
<td class="hex">20 5B 9F</td>
</tr>

<tr id="addr-9D45">
<td class="addr"><a href="#addr-9D45">9D45</a></td>
<td><span class="label">.c9d45</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9D46">
<td class="addr"><a href="#addr-9D46">9D46</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9D47">
<td class="addr"><a href="#addr-9D47">9D47</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9D48">
<td class="addr"><a href="#addr-9D48">9D48</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9D49">
<td class="addr"><a href="#addr-9D49">9D49</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9D4A">
<td class="addr"><a href="#addr-9D4A">9D4A</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9D4B">
<td class="addr"><a href="#addr-9D4B">9D4B</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; NMI TX data handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Writes 2 bytes per NMI invocation to the TX FIFO at $FEA2. Uses the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; BIT instruction on SR1 to test TDRA (V flag = bit6) and IRQ (N flag = bit7).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; After writing 2 bytes, checks if the frame is complete. If more data,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; tests SR1 bit7 (IRQ) via BMI -- if IRQ still asserted, writes 2 more bytes</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; without returning from NMI (tight loop). Otherwise returns via RTI.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9D4C">
<td class="addr"><a href="#addr-9D4C">9D4C</a></td>
<td><span class="label">.nmi_tx_data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D4F">tx_index</a></span>  <span class="comment">; Load TX buffer index</span></td>
<td class="hex">AC 4F 0D</td>
</tr>

<tr id="addr-9D4F">
<td class="addr"><a href="#addr-9D4F">9D4F</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: V=bit6(TDRA), N=bit7(IRQ)</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9D52">
<td class="addr"><a href="#addr-9D52">9D52</a></td>
<td><span class="label">.loop_c9d52</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9D76">c9d76</a></span>  <span class="comment">; TDRA not set -- TX error</span></td>
<td class="hex">50 22</td>
</tr>

<tr id="addr-9D54">
<td class="addr"><a href="#addr-9D54">9D54</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D20">tx_dst_stn</a>,y</span>  <span class="comment">; Load byte from TX buffer</span></td>
<td class="hex">B9 20 0D</td>
</tr>

<tr id="addr-9D57">
<td class="addr"><a href="#addr-9D57">9D57</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Write to TX_DATA (continue frame)</span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9D5A">
<td class="addr"><a href="#addr-9D5A">9D5A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9D5B">
<td class="addr"><a href="#addr-9D5B">9D5B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D20">tx_dst_stn</a>,y</span></td>
<td class="hex">B9 20 0D</td>
</tr>

<tr id="addr-9D5E">
<td class="addr"><a href="#addr-9D5E">9D5E</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9D5F">
<td class="addr"><a href="#addr-9D5F">9D5F</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0D4F">tx_index</a></span></td>
<td class="hex">8C 4F 0D</td>
</tr>

<tr id="addr-9D62">
<td class="addr"><a href="#addr-9D62">9D62</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Write second byte to TX_DATA</span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9D65">
<td class="addr"><a href="#addr-9D65">9D65</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand"><a href="#addr-0D50">tx_length</a></span>  <span class="comment">; Compare index to TX length</span></td>
<td class="hex">CC 50 0D</td>
</tr>

<tr id="addr-9D68">
<td class="addr"><a href="#addr-9D68">9D68</a></td>
<td>    <span class="opcode">BCS</span> <span class="operand"><a href="#addr-9D88">tx_last_data</a></span>  <span class="comment">; Frame complete -- go to TX_LAST_DATA</span></td>
<td class="hex">B0 1E</td>
</tr>

<tr id="addr-9D6A">
<td class="addr"><a href="#addr-9D6A">9D6A</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; Check if we can send another pair</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9D6D">
<td class="addr"><a href="#addr-9D6D">9D6D</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-9D52">loop_c9d52</a></span>  <span class="comment">; IRQ set -- send 2 more bytes (tight loop)</span></td>
<td class="hex">30 E3</td>
</tr>

<tr id="addr-9D6F">
<td class="addr"><a href="#addr-9D6F">9D6F</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D14">nmi_rti</a></span>  <span class="comment">; RTI -- wait for next NMI</span></td>
<td class="hex">4C 14 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX error path</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9D72">
<td class="addr"><a href="#addr-9D72">9D72</a></td>
<td><span class="label">.tx_error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;42</span>  <span class="comment">; Error $42</span></td>
<td class="hex">A9 42</td>
</tr>

<tr id="addr-9D74">
<td class="addr"><a href="#addr-9D74">9D74</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9D7D">c9d7d</a></span>  <span class="comment">; ALWAYS branch</span></td>
<td class="hex">D0 07</td>
</tr>

<tr id="addr-9D76">
<td class="addr"><a href="#addr-9D76">9D76</a></td>
<td><span class="label">.c9d76</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;67</span>  <span class="comment">; CR2=$67: clear status, return to listen</span></td>
<td class="hex">A9 67</td>
</tr>

<tr id="addr-9D78">
<td class="addr"><a href="#addr-9D78">9D78</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9D7B">
<td class="addr"><a href="#addr-9D7B">9D7B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;41</span>  <span class="comment">; Error $41 (TDRA not ready)</span></td>
<td class="hex">A9 41</td>
</tr>

<tr id="addr-9D7D">
<td class="addr"><a href="#addr-9D7D">9D7D</a></td>
<td><span class="label">.c9d7d</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; INTOFF (also loads station ID)</span></td>
<td class="hex">AC 18 FE</td>
</tr>

<tr id="addr-9D80">
<td class="addr"><a href="#addr-9D80">9D80</a></td>
<td><span class="label">.loop_c9d80</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PHA</span>  <span class="comment">; PHA/PLA delay loop (256 iterations for NMI disable)</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9D81">
<td class="addr"><a href="#addr-9D81">9D81</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9D82">
<td class="addr"><a href="#addr-9D82">9D82</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9D83">
<td class="addr"><a href="#addr-9D83">9D83</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9D80">loop_c9d80</a></span></td>
<td class="hex">D0 FB</td>
</tr>

<tr id="addr-9D85">
<td class="addr"><a href="#addr-9D85">9D85</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9F3F">tx_store_result</a></span>  <span class="comment">; Jump to error handler</span></td>
<td class="hex">4C 3F 9F</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX_LAST_DATA and frame completion</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Signals end of TX frame by writing CR2=$3F (TX_LAST_DATA). Then installs</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the TX completion NMI handler at $9D94 which switches to RX mode.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; CR2=$3F = 0011_1111:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit5: CLR_RX_ST -- clears fv_stored_ (prepares for RX of reply)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit4: TX_LAST_DATA -- tells ADLC this is the final data byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit3: FLAG_IDLE -- send flags/idle after frame</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit2: FC_TDRA -- force clear TDRA</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit1: 2_1_BYTE -- two-byte transfer mode</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   bit0: PSE -- prioritised status enable</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Note: NO CLR_TX_ST (bit6=0), NO RTS (bit7=0 -- drops RTS after frame)</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9D88">
<td class="addr"><a href="#addr-9D88">9D88</a></td>
<td><span class="label">.tx_last_data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;3f</span>  <span class="comment">; CR2=$3F: TX_LAST_DATA | CLR_RX_ST | FLAG_IDLE | FC_TDRA | 2_1_BYTE | PSE</span></td>
<td class="hex">A9 3F</td>
</tr>

<tr id="addr-9D8A">
<td class="addr"><a href="#addr-9D8A">9D8A</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9D8D">
<td class="addr"><a href="#addr-9D8D">9D8D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;94</span>  <span class="comment">; Install NMI handler at $9D94 (TX completion)</span></td>
<td class="hex">A9 94</td>
</tr>

<tr id="addr-9D8F">
<td class="addr"><a href="#addr-9D8F">9D8F</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9d</span></td>
<td class="hex">A0 9D</td>
</tr>

<tr id="addr-9D91">
<td class="addr"><a href="#addr-9D91">9D91</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX completion: switch to RX mode</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Called via NMI after the frame (including CRC and closing flag) has been</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; fully transmitted. Switches from TX mode to RX mode by writing CR1=$82.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; CR1=$82 = 1000_0010: TX_RESET | RIE (listen for reply).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks workspace flags to decide next action:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - bit6 set at $0D4A -&gt; completion at $9F39</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - bit0 set at $0D4A -&gt; four-way handshake data phase at $9EDD</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   - Otherwise -&gt; install RX reply handler at $9DB2</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9D94">
<td class="addr"><a href="#addr-9D94">9D94</a></td>
<td><span class="label">.nmi_tx_complete</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;82</span>  <span class="comment">; CR1=$82: TX_RESET | RIE (now in RX mode)</span></td>
<td class="hex">A9 82</td>
</tr>

<tr id="addr-9D96">
<td class="addr"><a href="#addr-9D96">9D96</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9D99">
<td class="addr"><a href="#addr-9D99">9D99</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span>  <span class="comment">; Test workspace flags</span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-9D9C">
<td class="addr"><a href="#addr-9D9C">9D9C</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9DA1">c9da1</a></span>  <span class="comment">; bit6 not set -- check bit0</span></td>
<td class="hex">50 03</td>
</tr>

<tr id="addr-9D9E">
<td class="addr"><a href="#addr-9D9E">9D9E</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9F39">tx_result_ok</a></span>  <span class="comment">; bit6 set -- TX completion</span></td>
<td class="hex">4C 39 9F</td>
</tr>

<tr id="addr-9DA1">
<td class="addr"><a href="#addr-9DA1">9DA1</a></td>
<td><span class="label">.c9da1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-9DA3">
<td class="addr"><a href="#addr-9DA3">9DA3</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-9DA6">
<td class="addr"><a href="#addr-9DA6">9DA6</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9DAB">c9dab</a></span></td>
<td class="hex">F0 03</td>
</tr>

<tr id="addr-9DA8">
<td class="addr"><a href="#addr-9DA8">9DA8</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9EDD">handshake_await_ack</a></span>  <span class="comment">; bit0 set -- four-way handshake data phase</span></td>
<td class="hex">4C DD 9E</td>
</tr>

<tr id="addr-9DAB">
<td class="addr"><a href="#addr-9DAB">9DAB</a></td>
<td><span class="label">.c9dab</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;b2</span>  <span class="comment">; Install RX reply handler at $9DB2</span></td>
<td class="hex">A9 B2</td>
</tr>

<tr id="addr-9DAD">
<td class="addr"><a href="#addr-9DAD">9DAD</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9d</span></td>
<td class="hex">A0 9D</td>
</tr>

<tr id="addr-9DAF">
<td class="addr"><a href="#addr-9DAF">9DAF</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; RX reply scout handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Handles reception of the reply scout frame after transmission.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Checks SR2 bit0 (AP) for incoming data, reads the first byte</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (destination station) and compares to our station ID via $FE18</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; (which also disables NMIs as a side effect).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9DB2">
<td class="addr"><a href="#addr-9DB2">9DB2</a></td>
<td><span class="label">.nmi_reply_scout</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span>  <span class="comment">; A=$01: AP mask for SR2</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-9DB4">
<td class="addr"><a href="#addr-9DB4">9DB4</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test AP (Address Present)</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9DB7">
<td class="addr"><a href="#addr-9DB7">9DB7</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9D72">tx_error</a></span>  <span class="comment">; No AP -- error</span></td>
<td class="hex">F0 B9</td>
</tr>

<tr id="addr-9DB9">
<td class="addr"><a href="#addr-9DB9">9DB9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read RX byte (destination station)</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9DBC">
<td class="addr"><a href="#addr-9DBC">9DBC</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; Compare to our station ID (INTOFF side effect)</span></td>
<td class="hex">CD 18 FE</td>
</tr>

<tr id="addr-9DBF">
<td class="addr"><a href="#addr-9DBF">9DBF</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9DDE">reply_error</a></span>  <span class="comment">; Not our station -- error/reject</span></td>
<td class="hex">D0 1D</td>
</tr>

<tr id="addr-9DC1">
<td class="addr"><a href="#addr-9DC1">9DC1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;c8</span>  <span class="comment">; Install next handler at $9DC8 (reply continuation)</span></td>
<td class="hex">A9 C8</td>
</tr>

<tr id="addr-9DC3">
<td class="addr"><a href="#addr-9DC3">9DC3</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9d</span></td>
<td class="hex">A0 9D</td>
</tr>

<tr id="addr-9DC5">
<td class="addr"><a href="#addr-9DC5">9DC5</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; RX reply continuation handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the second byte of the reply scout (destination network) and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; validates it is zero (local network). Installs $9DE3 for the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; remaining two bytes (source station and network).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Optimisation: checks SR1 bit7 (IRQ still asserted) via BMI at $9DD9.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If IRQ is still set, falls through directly to $9DE3 without an RTI,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; avoiding NMI re-entry overhead for short frames where all bytes arrive</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; in quick succession.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9DC8">
<td class="addr"><a href="#addr-9DC8">9DC8</a></td>
<td><span class="label">.nmi_reply_cont</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test for RDA (bit7 = data available)</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9DCB">
<td class="addr"><a href="#addr-9DCB">9DCB</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9DDE">reply_error</a></span>  <span class="comment">; No RDA -- error</span></td>
<td class="hex">10 11</td>
</tr>

<tr id="addr-9DCD">
<td class="addr"><a href="#addr-9DCD">9DCD</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read destination network byte</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9DD0">
<td class="addr"><a href="#addr-9DD0">9DD0</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9DDE">reply_error</a></span>  <span class="comment">; Non-zero -- network mismatch, error</span></td>
<td class="hex">D0 0C</td>
</tr>

<tr id="addr-9DD2">
<td class="addr"><a href="#addr-9DD2">9DD2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e3</span>  <span class="comment">; Install next handler at $9DE3 (reply validation)</span></td>
<td class="hex">A9 E3</td>
</tr>

<tr id="addr-9DD4">
<td class="addr"><a href="#addr-9DD4">9DD4</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9d</span></td>
<td class="hex">A0 9D</td>
</tr>

<tr id="addr-9DD6">
<td class="addr"><a href="#addr-9DD6">9DD6</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: test IRQ (N=bit7) -- more data ready?</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9DD9">
<td class="addr"><a href="#addr-9DD9">9DD9</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-9DE3">nmi_reply_validate</a></span>  <span class="comment">; IRQ set -- fall through to $9DE3 without RTI</span></td>
<td class="hex">30 08</td>
</tr>

<tr id="addr-9DDB">
<td class="addr"><a href="#addr-9DDB">9DDB</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span>  <span class="comment">; IRQ not set -- install handler and RTI</span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9DDE">
<td class="addr"><a href="#addr-9DDE">9DDE</a></td>
<td><span class="label">.reply_error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;41</span></td>
<td class="hex">A9 41</td>
</tr>

<tr id="addr-9DE0">
<td class="addr"><a href="#addr-9DE0">9DE0</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9F3F">tx_store_result</a></span></td>
<td class="hex">4C 3F 9F</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; RX reply validation (Path 2 for FV/PSE interaction)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads the source station and source network from the reply scout and</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; validates them against the original TX destination ($0D20/$0D21).</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sequence:</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   1. Check SR2 bit7 (RDA) at $9DE3 -- must see data available</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   2. Read source station at $9DE8, compare to $0D20 (tx_dst_stn)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   3. Read source network at $9DF0, compare to $0D21 (tx_dst_net)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   4. Check SR2 bit1 (FV) at $9DFA -- must see frame complete</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; If all checks pass, the reply scout is valid and the ROM proceeds</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; to send the scout ACK (CR2=$A7 for RTS, CR1=$44 for TX mode).</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9DE3">
<td class="addr"><a href="#addr-9DE3">9DE3</a></td>
<td><span class="label">.nmi_reply_validate</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test RDA (bit7). Must be set for valid reply.</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9DE6">
<td class="addr"><a href="#addr-9DE6">9DE6</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9DDE">reply_error</a></span>  <span class="comment">; No RDA -- error (FV masking RDA via PSE would cause this)</span></td>
<td class="hex">10 F6</td>
</tr>

<tr id="addr-9DE8">
<td class="addr"><a href="#addr-9DE8">9DE8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read source station</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9DEB">
<td class="addr"><a href="#addr-9DEB">9DEB</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0D20">tx_dst_stn</a></span>  <span class="comment">; Compare to original TX destination station ($0D20)</span></td>
<td class="hex">CD 20 0D</td>
</tr>

<tr id="addr-9DEE">
<td class="addr"><a href="#addr-9DEE">9DEE</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9DDE">reply_error</a></span>  <span class="comment">; Mismatch -- not the expected reply, error</span></td>
<td class="hex">D0 EE</td>
</tr>

<tr id="addr-9DF0">
<td class="addr"><a href="#addr-9DF0">9DF0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read source network</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9DF3">
<td class="addr"><a href="#addr-9DF3">9DF3</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0D21">tx_dst_net</a></span>  <span class="comment">; Compare to original TX destination network ($0D21)</span></td>
<td class="hex">CD 21 0D</td>
</tr>

<tr id="addr-9DF6">
<td class="addr"><a href="#addr-9DF6">9DF6</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9DDE">reply_error</a></span>  <span class="comment">; Mismatch -- error</span></td>
<td class="hex">D0 E6</td>
</tr>

<tr id="addr-9DF8">
<td class="addr"><a href="#addr-9DF8">9DF8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span>  <span class="comment">; A=$02: FV mask for SR2 bit1</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-9DFA">
<td class="addr"><a href="#addr-9DFA">9DFA</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test FV -- frame must be complete</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9DFD">
<td class="addr"><a href="#addr-9DFD">9DFD</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9DDE">reply_error</a></span>  <span class="comment">; No FV -- incomplete frame, error</span></td>
<td class="hex">F0 DF</td>
</tr>

<tr id="addr-9DFF">
<td class="addr"><a href="#addr-9DFF">9DFF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;a7</span>  <span class="comment">; CR2=$A7: RTS|CLR_TX_ST|FC_TDRA|2_1_BYTE|PSE (TX in handshake)</span></td>
<td class="hex">A9 A7</td>
</tr>

<tr id="addr-9E01">
<td class="addr"><a href="#addr-9E01">9E01</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9E04">
<td class="addr"><a href="#addr-9E04">9E04</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;44</span>  <span class="comment">; CR1=$44: RX_RESET | TIE (TX active for scout ACK)</span></td>
<td class="hex">A9 44</td>
</tr>

<tr id="addr-9E06">
<td class="addr"><a href="#addr-9E06">9E06</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9E09">
<td class="addr"><a href="#addr-9E09">9E09</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;dd</span>  <span class="comment">; Install next handler at $9EDD (four-way data phase) into $0D4B/$0D4C</span></td>
<td class="hex">A9 DD</td>
</tr>

<tr id="addr-9E0B">
<td class="addr"><a href="#addr-9E0B">9E0B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9e</span></td>
<td class="hex">A0 9E</td>
</tr>

<tr id="addr-9E0D">
<td class="addr"><a href="#addr-9E0D">9E0D</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4B">nmi_next_lo</a></span></td>
<td class="hex">8D 4B 0D</td>
</tr>

<tr id="addr-9E10">
<td class="addr"><a href="#addr-9E10">9E10</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0D4C">nmi_next_hi</a></span></td>
<td class="hex">8C 4C 0D</td>
</tr>

<tr id="addr-9E13">
<td class="addr"><a href="#addr-9E13">9E13</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D20">tx_dst_stn</a></span>  <span class="comment">; Load dest station for scout ACK TX</span></td>
<td class="hex">AD 20 0D</td>
</tr>

<tr id="addr-9E16">
<td class="addr"><a href="#addr-9E16">9E16</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: test TDRA (V=bit6)</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9E19">
<td class="addr"><a href="#addr-9E19">9E19</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9E8E">data_tx_error</a></span>  <span class="comment">; TDRA not ready -- error</span></td>
<td class="hex">50 73</td>
</tr>

<tr id="addr-9E1B">
<td class="addr"><a href="#addr-9E1B">9E1B</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Write dest station to TX FIFO</span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9E1E">
<td class="addr"><a href="#addr-9E1E">9E1E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D21">tx_dst_net</a></span>  <span class="comment">; Write dest network to TX FIFO</span></td>
<td class="hex">AD 21 0D</td>
</tr>

<tr id="addr-9E21">
<td class="addr"><a href="#addr-9E21">9E21</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9E24">
<td class="addr"><a href="#addr-9E24">9E24</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;2b</span>  <span class="comment">; Install handler at $9E2B (write src addr for scout ACK)</span></td>
<td class="hex">A9 2B</td>
</tr>

<tr id="addr-9E26">
<td class="addr"><a href="#addr-9E26">9E26</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9e</span></td>
<td class="hex">A0 9E</td>
</tr>

<tr id="addr-9E28">
<td class="addr"><a href="#addr-9E28">9E28</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX scout ACK: write source address</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Writes our station ID and network=0 to TX FIFO, completing the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; 4-byte scout ACK frame. Then proceeds to send the data frame.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9E2B">
<td class="addr"><a href="#addr-9E2B">9E2B</a></td>
<td><span class="label">.nmi_scout_ack_src</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; Load our station ID (also INTOFF)</span></td>
<td class="hex">AD 18 FE</td>
</tr>

<tr id="addr-9E2E">
<td class="addr"><a href="#addr-9E2E">9E2E</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: test TDRA</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9E31">
<td class="addr"><a href="#addr-9E31">9E31</a></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9E8E">data_tx_error</a></span>  <span class="comment">; TDRA not ready -- error</span></td>
<td class="hex">50 5B</td>
</tr>

<tr id="addr-9E33">
<td class="addr"><a href="#addr-9E33">9E33</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Write our station to TX FIFO</span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9E36">
<td class="addr"><a href="#addr-9E36">9E36</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span>  <span class="comment">; Write network=0 to TX FIFO</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9E38">
<td class="addr"><a href="#addr-9E38">9E38</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9E3B">
<td class="addr"><a href="#addr-9E3B">9E3B</a></td>
<td><span class="label">.data_tx_begin</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-9E3D">
<td class="addr"><a href="#addr-9E3D">9E3D</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">2C 4A 0D</td>
</tr>

<tr id="addr-9E40">
<td class="addr"><a href="#addr-9E40">9E40</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9E49">c9e49</a></span></td>
<td class="hex">D0 07</td>
</tr>

<tr id="addr-9E42">
<td class="addr"><a href="#addr-9E42">9E42</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;50</span></td>
<td class="hex">A9 50</td>
</tr>

<tr id="addr-9E44">
<td class="addr"><a href="#addr-9E44">9E44</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9e</span></td>
<td class="hex">A0 9E</td>
</tr>

<tr id="addr-9E46">
<td class="addr"><a href="#addr-9E46">9E46</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9E49">
<td class="addr"><a href="#addr-9E49">9E49</a></td>
<td><span class="label">.c9e49</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;a4</span></td>
<td class="hex">A9 A4</td>
</tr>

<tr id="addr-9E4B">
<td class="addr"><a href="#addr-9E4B">9E4B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9e</span></td>
<td class="hex">A0 9E</td>
</tr>

<tr id="addr-9E4D">
<td class="addr"><a href="#addr-9E4D">9E4D</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX data phase: send payload</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Sends the data frame payload from (open_port_buf),Y in pairs per NMI.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Same pattern as the NMI TX handler at $9D4C but reads from the port</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; buffer instead of the TX workspace. Writes two bytes per iteration,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; checking SR1 IRQ between pairs for tight looping.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9E50">
<td class="addr"><a href="#addr-9E50">9E50</a></td>
<td><span class="label">.nmi_data_tx</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span>  <span class="comment">; Y = buffer offset, resume from last position</span></td>
<td class="hex">A4 A2</td>
</tr>

<tr id="addr-9E52">
<td class="addr"><a href="#addr-9E52">9E52</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: test TDRA (V=bit6)</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9E55">
<td class="addr"><a href="#addr-9E55">9E55</a></td>
<td><span class="label">.c9e55</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9E8E">data_tx_error</a></span>  <span class="comment">; TDRA not ready -- error</span></td>
<td class="hex">50 37</td>
</tr>

<tr id="addr-9E57">
<td class="addr"><a href="#addr-9E57">9E57</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A4">open_port_buf</a>),y</span>  <span class="comment">; Write data byte to TX FIFO</span></td>
<td class="hex">B1 A4</td>
</tr>

<tr id="addr-9E59">
<td class="addr"><a href="#addr-9E59">9E59</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9E5C">
<td class="addr"><a href="#addr-9E5C">9E5C</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9E5D">
<td class="addr"><a href="#addr-9E5D">9E5D</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9E65">c9e65</a></span></td>
<td class="hex">D0 06</td>
</tr>

<tr id="addr-9E5F">
<td class="addr"><a href="#addr-9E5F">9E5F</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">C6 A3</td>
</tr>

<tr id="addr-9E61">
<td class="addr"><a href="#addr-9E61">9E61</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9E7D">data_tx_last</a></span></td>
<td class="hex">F0 1A</td>
</tr>

<tr id="addr-9E63">
<td class="addr"><a href="#addr-9E63">9E63</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-9E65">
<td class="addr"><a href="#addr-9E65">9E65</a></td>
<td><span class="label">.c9e65</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A4">open_port_buf</a>),y</span></td>
<td class="hex">B1 A4</td>
</tr>

<tr id="addr-9E67">
<td class="addr"><a href="#addr-9E67">9E67</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9E6A">
<td class="addr"><a href="#addr-9E6A">9E6A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9E6B">
<td class="addr"><a href="#addr-9E6B">9E6B</a></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">84 A2</td>
</tr>

<tr id="addr-9E6D">
<td class="addr"><a href="#addr-9E6D">9E6D</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9E75">c9e75</a></span></td>
<td class="hex">D0 06</td>
</tr>

<tr id="addr-9E6F">
<td class="addr"><a href="#addr-9E6F">9E6F</a></td>
<td>    <span class="opcode">DEC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">C6 A3</td>
</tr>

<tr id="addr-9E71">
<td class="addr"><a href="#addr-9E71">9E71</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9E7D">data_tx_last</a></span></td>
<td class="hex">F0 0A</td>
</tr>

<tr id="addr-9E73">
<td class="addr"><a href="#addr-9E73">9E73</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-9E75">
<td class="addr"><a href="#addr-9E75">9E75</a></td>
<td><span class="label">.c9e75</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9E78">
<td class="addr"><a href="#addr-9E78">9E78</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-9E55">c9e55</a></span></td>
<td class="hex">30 DB</td>
</tr>

<tr id="addr-9E7A">
<td class="addr"><a href="#addr-9E7A">9E7A</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D14">nmi_rti</a></span></td>
<td class="hex">4C 14 0D</td>
</tr>

<tr id="addr-9E7D">
<td class="addr"><a href="#addr-9E7D">9E7D</a></td>
<td><span class="label">.data_tx_last</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;3f</span>  <span class="comment">; CR2=$3F: TX_LAST_DATA (close data frame)</span></td>
<td class="hex">A9 3F</td>
</tr>

<tr id="addr-9E7F">
<td class="addr"><a href="#addr-9E7F">9E7F</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span></td>
<td class="hex">8D A1 FE</td>
</tr>

<tr id="addr-9E82">
<td class="addr"><a href="#addr-9E82">9E82</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-9E85">
<td class="addr"><a href="#addr-9E85">9E85</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9E9B">install_saved_handler</a></span></td>
<td class="hex">10 14</td>
</tr>

<tr id="addr-9E87">
<td class="addr"><a href="#addr-9E87">9E87</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;34</span></td>
<td class="hex">A9 34</td>
</tr>

<tr id="addr-9E89">
<td class="addr"><a href="#addr-9E89">9E89</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9a</span></td>
<td class="hex">A0 9A</td>
</tr>

<tr id="addr-9E8B">
<td class="addr"><a href="#addr-9E8B">9E8B</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9E8E">
<td class="addr"><a href="#addr-9E8E">9E8E</a></td>
<td><span class="label">.data_tx_error</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-9E91">
<td class="addr"><a href="#addr-9E91">9E91</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9E96">c9e96</a></span></td>
<td class="hex">10 03</td>
</tr>

<tr id="addr-9E93">
<td class="addr"><a href="#addr-9E93">9E93</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A34">discard_reset_listen</a></span></td>
<td class="hex">4C 34 9A</td>
</tr>

<tr id="addr-9E96">
<td class="addr"><a href="#addr-9E96">9E96</a></td>
<td><span class="label">.c9e96</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;41</span></td>
<td class="hex">A9 41</td>
</tr>

<tr id="addr-9E98">
<td class="addr"><a href="#addr-9E98">9E98</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9F3F">tx_store_result</a></span></td>
<td class="hex">4C 3F 9F</td>
</tr>

<tr id="addr-9E9B">
<td class="addr"><a href="#addr-9E9B">9E9B</a></td>
<td><span class="label">.install_saved_handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4B">nmi_next_lo</a></span></td>
<td class="hex">AD 4B 0D</td>
</tr>

<tr id="addr-9E9E">
<td class="addr"><a href="#addr-9E9E">9E9E</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-0D4C">nmi_next_hi</a></span></td>
<td class="hex">AC 4C 0D</td>
</tr>

<tr id="addr-9EA1">
<td class="addr"><a href="#addr-9EA1">9EA1</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9EA4">
<td class="addr"><a href="#addr-9EA4">9EA4</a></td>
<td><span class="label">.nmi_data_tx_tube</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9EA7">
<td class="addr"><a href="#addr-9EA7">9EA7</a></td>
<td><span class="label">.c9ea7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BVC</span> <span class="operand"><a href="#addr-9E8E">data_tx_error</a></span></td>
<td class="hex">50 E5</td>
</tr>

<tr id="addr-9EA9">
<td class="addr"><a href="#addr-9EA9">9EA9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">AD E5 FE</td>
</tr>

<tr id="addr-9EAC">
<td class="addr"><a href="#addr-9EAC">9EAC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9EAF">
<td class="addr"><a href="#addr-9EAF">9EAF</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">E6 A2</td>
</tr>

<tr id="addr-9EB1">
<td class="addr"><a href="#addr-9EB1">9EB1</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9EBF">c9ebf</a></span></td>
<td class="hex">D0 0C</td>
</tr>

<tr id="addr-9EB3">
<td class="addr"><a href="#addr-9EB3">9EB3</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">E6 A3</td>
</tr>

<tr id="addr-9EB5">
<td class="addr"><a href="#addr-9EB5">9EB5</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9EBF">c9ebf</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-9EB7">
<td class="addr"><a href="#addr-9EB7">9EB7</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A4">open_port_buf</a></span></td>
<td class="hex">E6 A4</td>
</tr>

<tr id="addr-9EB9">
<td class="addr"><a href="#addr-9EB9">9EB9</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9EBF">c9ebf</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-9EBB">
<td class="addr"><a href="#addr-9EBB">9EBB</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-9EBD">
<td class="addr"><a href="#addr-9EBD">9EBD</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9E7D">data_tx_last</a></span></td>
<td class="hex">F0 BE</td>
</tr>

<tr id="addr-9EBF">
<td class="addr"><a href="#addr-9EBF">9EBF</a></td>
<td><span class="label">.c9ebf</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEE5">tube_data_register_3</a></span></td>
<td class="hex">AD E5 FE</td>
</tr>

<tr id="addr-9EC2">
<td class="addr"><a href="#addr-9EC2">9EC2</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span></td>
<td class="hex">8D A2 FE</td>
</tr>

<tr id="addr-9EC5">
<td class="addr"><a href="#addr-9EC5">9EC5</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">E6 A2</td>
</tr>

<tr id="addr-9EC7">
<td class="addr"><a href="#addr-9EC7">9EC7</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9ED5">c9ed5</a></span></td>
<td class="hex">D0 0C</td>
</tr>

<tr id="addr-9EC9">
<td class="addr"><a href="#addr-9EC9">9EC9</a></td>
<td><span class="label">.sub_c9ec9</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">E6 A3</td>
</tr>

<tr id="addr-9ECB">
<td class="addr"><a href="#addr-9ECB">9ECB</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9ED5">c9ed5</a></span></td>
<td class="hex">D0 08</td>
</tr>

<tr id="addr-9ECD">
<td class="addr"><a href="#addr-9ECD">9ECD</a></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A4">open_port_buf</a></span></td>
<td class="hex">E6 A4</td>
</tr>

<tr id="addr-9ECF">
<td class="addr"><a href="#addr-9ECF">9ECF</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9ED5">c9ed5</a></span></td>
<td class="hex">D0 04</td>
</tr>

<tr id="addr-9ED1">
<td class="addr"><a href="#addr-9ED1">9ED1</a></td>
<td><span class="label">.sub_c9ed1</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">INC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E6 A5</td>
</tr>

<tr id="addr-9ED3">
<td class="addr"><a href="#addr-9ED3">9ED3</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9E7D">data_tx_last</a></span></td>
<td class="hex">F0 A8</td>
</tr>

<tr id="addr-9ED5">
<td class="addr"><a href="#addr-9ED5">9ED5</a></td>
<td><span class="label">.c9ed5</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9ED8">
<td class="addr"><a href="#addr-9ED8">9ED8</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-9EA7">c9ea7</a></span></td>
<td class="hex">30 CD</td>
</tr>

<tr id="addr-9EDA">
<td class="addr"><a href="#addr-9EDA">9EDA</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D14">nmi_rti</a></span></td>
<td class="hex">4C 14 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Four-way handshake: switch to RX for final ACK</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; After the data frame TX completes, switches to RX mode (CR1=$82)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and installs $9EE9 to receive the final ACK from the remote station.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9EDD">
<td class="addr"><a href="#addr-9EDD">9EDD</a></td>
<td><span class="label">.handshake_await_ack</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;82</span>  <span class="comment">; CR1=$82: TX_RESET | RIE (switch to RX for final ACK)</span></td>
<td class="hex">A9 82</td>
</tr>

<tr id="addr-9EDF">
<td class="addr"><a href="#addr-9EDF">9EDF</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span></td>
<td class="hex">8D A0 FE</td>
</tr>

<tr id="addr-9EE2">
<td class="addr"><a href="#addr-9EE2">9EE2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;e9</span>  <span class="comment">; Install handler at $9EE9 (RX final ACK)</span></td>
<td class="hex">A9 E9</td>
</tr>

<tr id="addr-9EE4">
<td class="addr"><a href="#addr-9EE4">9EE4</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9e</span></td>
<td class="hex">A0 9E</td>
</tr>

<tr id="addr-9EE6">
<td class="addr"><a href="#addr-9EE6">9EE6</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; RX final ACK handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Receives the final ACK in a four-way handshake. Same validation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; pattern as the reply scout handler ($9DB2-$9DE3):</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9EE9: Check AP, read dest_stn, compare to our station</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9EFF: Check RDA, read dest_net, validate = 0</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9F15: Check RDA, read src_stn/net, compare to TX dest</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">;   $9F32: Check FV for frame completion</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; On success, stores result=0 at $9F39. On any failure, error $41.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9EE9">
<td class="addr"><a href="#addr-9EE9">9EE9</a></td>
<td><span class="label">.nmi_final_ack</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#1</span>  <span class="comment">; A=$01: AP mask</span></td>
<td class="hex">A9 01</td>
</tr>

<tr id="addr-9EEB">
<td class="addr"><a href="#addr-9EEB">9EEB</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test AP</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9EEE">
<td class="addr"><a href="#addr-9EEE">9EEE</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; No AP -- error</span></td>
<td class="hex">F0 4D</td>
</tr>

<tr id="addr-9EF0">
<td class="addr"><a href="#addr-9EF0">9EF0</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read dest station</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9EF3">
<td class="addr"><a href="#addr-9EF3">9EF3</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span>  <span class="comment">; Compare to our station (INTOFF side effect)</span></td>
<td class="hex">CD 18 FE</td>
</tr>

<tr id="addr-9EF6">
<td class="addr"><a href="#addr-9EF6">9EF6</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; Not our station -- error</span></td>
<td class="hex">D0 45</td>
</tr>

<tr id="addr-9EF8">
<td class="addr"><a href="#addr-9EF8">9EF8</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;ff</span>  <span class="comment">; Install handler at $9EFF (final ACK continuation)</span></td>
<td class="hex">A9 FF</td>
</tr>

<tr id="addr-9EFA">
<td class="addr"><a href="#addr-9EFA">9EFA</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9e</span></td>
<td class="hex">A0 9E</td>
</tr>

<tr id="addr-9EFC">
<td class="addr"><a href="#addr-9EFC">9EFC</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr id="addr-9EFF">
<td class="addr"><a href="#addr-9EFF">9EFF</a></td>
<td><span class="label">.nmi_final_ack_net</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test RDA</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9F02">
<td class="addr"><a href="#addr-9F02">9F02</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; No RDA -- error</span></td>
<td class="hex">10 39</td>
</tr>

<tr id="addr-9F04">
<td class="addr"><a href="#addr-9F04">9F04</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read dest network</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9F07">
<td class="addr"><a href="#addr-9F07">9F07</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; Non-zero -- network mismatch, error</span></td>
<td class="hex">D0 34</td>
</tr>

<tr id="addr-9F09">
<td class="addr"><a href="#addr-9F09">9F09</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;15</span>  <span class="comment">; Install handler at $9F15 (final ACK validation)</span></td>
<td class="hex">A9 15</td>
</tr>

<tr id="addr-9F0B">
<td class="addr"><a href="#addr-9F0B">9F0B</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#&amp;9f</span></td>
<td class="hex">A0 9F</td>
</tr>

<tr id="addr-9F0D">
<td class="addr"><a href="#addr-9F0D">9F0D</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA0">econet_control1_or_status1</a></span>  <span class="comment">; BIT SR1: test IRQ -- more data ready?</span></td>
<td class="hex">2C A0 FE</td>
</tr>

<tr id="addr-9F10">
<td class="addr"><a href="#addr-9F10">9F10</a></td>
<td>    <span class="opcode">BMI</span> <span class="operand"><a href="#addr-9F15">nmi_final_ack_validate</a></span>  <span class="comment">; IRQ set -- fall through to $9F15 without RTI</span></td>
<td class="hex">30 03</td>
</tr>

<tr id="addr-9F12">
<td class="addr"><a href="#addr-9F12">9F12</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-0D0E">set_nmi_vector</a></span></td>
<td class="hex">4C 0E 0D</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Final ACK validation</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Reads and validates src_stn and src_net against original TX dest.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Then checks FV for frame completion.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9F15">
<td class="addr"><a href="#addr-9F15">9F15</a></td>
<td><span class="label">.nmi_final_ack_validate</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test RDA</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9F18">
<td class="addr"><a href="#addr-9F18">9F18</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; No RDA -- error</span></td>
<td class="hex">10 23</td>
</tr>

<tr id="addr-9F1A">
<td class="addr"><a href="#addr-9F1A">9F1A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read source station</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9F1D">
<td class="addr"><a href="#addr-9F1D">9F1D</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0D20">tx_dst_stn</a></span>  <span class="comment">; Compare to TX dest station ($0D20)</span></td>
<td class="hex">CD 20 0D</td>
</tr>

<tr id="addr-9F20">
<td class="addr"><a href="#addr-9F20">9F20</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; Mismatch -- error</span></td>
<td class="hex">D0 1B</td>
</tr>

<tr id="addr-9F22">
<td class="addr"><a href="#addr-9F22">9F22</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-FEA2">econet_data_continue_frame</a></span>  <span class="comment">; Read source network</span></td>
<td class="hex">AD A2 FE</td>
</tr>

<tr id="addr-9F25">
<td class="addr"><a href="#addr-9F25">9F25</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand"><a href="#addr-0D21">tx_dst_net</a></span>  <span class="comment">; Compare to TX dest network ($0D21)</span></td>
<td class="hex">CD 21 0D</td>
</tr>

<tr id="addr-9F28">
<td class="addr"><a href="#addr-9F28">9F28</a></td>
<td>    <span class="opcode">BNE</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; Mismatch -- error</span></td>
<td class="hex">D0 13</td>
</tr>

<tr id="addr-9F2A">
<td class="addr"><a href="#addr-9F2A">9F2A</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-9F2D">
<td class="addr"><a href="#addr-9F2D">9F2D</a></td>
<td>    <span class="opcode">BPL</span> <span class="operand"><a href="#addr-9F32">c9f32</a></span></td>
<td class="hex">10 03</td>
</tr>

<tr id="addr-9F2F">
<td class="addr"><a href="#addr-9F2F">9F2F</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9870">c9870</a></span></td>
<td class="hex">4C 70 98</td>
</tr>

<tr id="addr-9F32">
<td class="addr"><a href="#addr-9F32">9F32</a></td>
<td><span class="label">.c9f32</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#2</span>  <span class="comment">; A=$02: FV mask for SR2 bit1</span></td>
<td class="hex">A9 02</td>
</tr>

<tr id="addr-9F34">
<td class="addr"><a href="#addr-9F34">9F34</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FEA1">econet_control23_or_status2</a></span>  <span class="comment">; BIT SR2: test FV -- frame must be complete</span></td>
<td class="hex">2C A1 FE</td>
</tr>

<tr id="addr-9F37">
<td class="addr"><a href="#addr-9F37">9F37</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9F3D">tx_result_fail</a></span>  <span class="comment">; No FV -- error</span></td>
<td class="hex">F0 04</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX completion handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores result code 0 (success) into the first byte of the TX control</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; block (nmi_tx_block),Y=0. Then sets $0D3A bit7 to signal completion</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and calls full ADLC reset + idle listen via $9A34.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9F39">
<td class="addr"><a href="#addr-9F39">9F39</a></td>
<td><span class="label">.tx_result_ok</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span>  <span class="comment">; A=0: success result code</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9F3B">
<td class="addr"><a href="#addr-9F3B">9F3B</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9F3F">tx_store_result</a></span>  <span class="comment">; BEQ: always taken (A=0) ALWAYS branch</span></td>
<td class="hex">F0 02</td>
</tr>

<tr id="addr-9F3D">
<td class="addr"><a href="#addr-9F3D">9F3D</a></td>
<td><span class="label">.tx_result_fail</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;41</span></td>
<td class="hex">A9 41</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; TX error handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Stores error code (A) into the TX control block, sets $0D3A bit7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; for completion, and returns to idle via $9A34.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Error codes: $00=success, $40=line jammed, $41=not listening,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; $42=net error.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9F3F">
<td class="addr"><a href="#addr-9F3F">9F3F</a></td>
<td><span class="label">.tx_store_result</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#0</span>  <span class="comment">; Y=0: index into TX control block</span></td>
<td class="hex">A0 00</td>
</tr>

<tr id="addr-9F41">
<td class="addr"><a href="#addr-9F41">9F41</a></td>
<td>    <span class="opcode">STA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span>  <span class="comment">; Store result/error code at (nmi_tx_block),0</span></td>
<td class="hex">91 A0</td>
</tr>

<tr id="addr-9F43">
<td class="addr"><a href="#addr-9F43">9F43</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;80</span>  <span class="comment">; $80: completion flag for $0D3A</span></td>
<td class="hex">A9 80</td>
</tr>

<tr id="addr-9F45">
<td class="addr"><a href="#addr-9F45">9F45</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D3A">tx_ctrl_status</a></span>  <span class="comment">; Signal TX complete</span></td>
<td class="hex">8D 3A 0D</td>
</tr>

<tr id="addr-9F48">
<td class="addr"><a href="#addr-9F48">9F48</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-9A34">discard_reset_listen</a></span>  <span class="comment">; Full ADLC reset and return to idle listen</span></td>
<td class="hex">4C 34 9A</td>
</tr>

<tr id="addr-9F4B">
<td class="addr"><a href="#addr-9F4B">9F4B</a></td>
<td>    <span class="directive">EQUB</span> &amp;0E, &amp;0E, &amp;0A, &amp;0A, &amp;0A, &amp;06, &amp;06, &amp;0A, &amp;81, &amp;00, &amp;00, &amp;00, &amp;00, &amp;01, &amp;01, &amp;81</td>
<td class="hex">0E 0E 0A 0A 0A 06 06 0A 81 00 00 00 00 01 01 81</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Calculate transfer size</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Computes the number of bytes actually transferred during a data</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; frame reception. Subtracts the low pointer (LPTR, offset 4 in</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the RXCB) from the current buffer position to get the byte count,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; and stores it back into the RXCB&#39;s high pointer field (HPTR,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; offset 8). This tells the caller how much data was received.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9F5B">
<td class="addr"><a href="#addr-9F5B">9F5B</a></td>
<td><span class="label">.tx_calc_transfer</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#6</span></td>
<td class="hex">A0 06</td>
</tr>

<tr id="addr-9F5D">
<td class="addr"><a href="#addr-9F5D">9F5D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9F5F">
<td class="addr"><a href="#addr-9F5F">9F5F</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;07</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9F60">
<td class="addr"><a href="#addr-9F60">9F60</a></td>
<td>    <span class="opcode">AND</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">31 A0</td>
</tr>

<tr id="addr-9F62">
<td class="addr"><a href="#addr-9F62">9F62</a></td>
<td>    <span class="opcode">CMP</span> <span class="operand">#&amp;ff</span></td>
<td class="hex">C9 FF</td>
</tr>

<tr id="addr-9F64">
<td class="addr"><a href="#addr-9F64">9F64</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9FA7">c9fa7</a></span></td>
<td class="hex">F0 41</td>
</tr>

<tr id="addr-9F66">
<td class="addr"><a href="#addr-9F66">9F66</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D52">tx_in_progress</a></span></td>
<td class="hex">AD 52 0D</td>
</tr>

<tr id="addr-9F69">
<td class="addr"><a href="#addr-9F69">9F69</a></td>
<td>    <span class="opcode">BEQ</span> <span class="operand"><a href="#addr-9FA7">c9fa7</a></span></td>
<td class="hex">F0 3C</td>
</tr>

<tr id="addr-9F6B">
<td class="addr"><a href="#addr-9F6B">9F6B</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-9F6E">
<td class="addr"><a href="#addr-9F6E">9F6E</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#2</span></td>
<td class="hex">09 02</td>
</tr>

<tr id="addr-9F70">
<td class="addr"><a href="#addr-9F70">9F70</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr id="addr-9F73">
<td class="addr"><a href="#addr-9F73">9F73</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9F74">
<td class="addr"><a href="#addr-9F74">9F74</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9F75">
<td class="addr"><a href="#addr-9F75">9F75</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-9F77">
<td class="addr"><a href="#addr-9F77">9F77</a></td>
<td><span class="label">.loop_c9f77</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9F79">
<td class="addr"><a href="#addr-9F79">9F79</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9F7A">
<td class="addr"><a href="#addr-9F7A">9F7A</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9F7B">
<td class="addr"><a href="#addr-9F7B">9F7B</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9F7C">
<td class="addr"><a href="#addr-9F7C">9F7C</a></td>
<td>    <span class="opcode">INY</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9F7D">
<td class="addr"><a href="#addr-9F7D">9F7D</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9F7E">
<td class="addr"><a href="#addr-9F7E">9F7E</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">F1 A0</td>
</tr>

<tr id="addr-9F80">
<td class="addr"><a href="#addr-9F80">9F80</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-009A">net_tx_ptr</a>,y</span></td>
<td class="hex">99 9A 00</td>
</tr>

<tr id="addr-9F83">
<td class="addr"><a href="#addr-9F83">9F83</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9F84">
<td class="addr"><a href="#addr-9F84">9F84</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9F85">
<td class="addr"><a href="#addr-9F85">9F85</a></td>
<td>    <span class="opcode">DEY</span></td>
<td class="hex">88</td>
</tr>

<tr id="addr-9F86">
<td class="addr"><a href="#addr-9F86">9F86</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9F87">
<td class="addr"><a href="#addr-9F87">9F87</a></td>
<td>    <span class="opcode">CPY</span> <span class="operand">#8</span></td>
<td class="hex">C0 08</td>
</tr>

<tr id="addr-9F89">
<td class="addr"><a href="#addr-9F89">9F89</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9F77">loop_c9f77</a></span></td>
<td class="hex">90 EC</td>
</tr>

<tr id="addr-9F8B">
<td class="addr"><a href="#addr-9F8B">9F8B</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9F8C">
<td class="addr"><a href="#addr-9F8C">9F8C</a></td>
<td>    <span class="opcode">TXA</span></td>
<td class="hex">8A</td>
</tr>

<tr id="addr-9F8D">
<td class="addr"><a href="#addr-9F8D">9F8D</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9F8E">
<td class="addr"><a href="#addr-9F8E">9F8E</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#4</span></td>
<td class="hex">A9 04</td>
</tr>

<tr id="addr-9F90">
<td class="addr"><a href="#addr-9F90">9F90</a></td>
<td>    <span class="opcode">CLC</span></td>
<td class="hex">18</td>
</tr>

<tr id="addr-9F91">
<td class="addr"><a href="#addr-9F91">9F91</a></td>
<td>    <span class="opcode">ADC</span> <span class="operand"><a href="#addr-00A0">nmi_tx_block</a></span></td>
<td class="hex">65 A0</td>
</tr>

<tr id="addr-9F93">
<td class="addr"><a href="#addr-9F93">9F93</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9F94">
<td class="addr"><a href="#addr-9F94">9F94</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand"><a href="#addr-00A1">nmi_tx_block_hi</a></span></td>
<td class="hex">A4 A1</td>
</tr>

<tr id="addr-9F96">
<td class="addr"><a href="#addr-9F96">9F96</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#&amp;c2</span></td>
<td class="hex">A9 C2</td>
</tr>

<tr id="addr-9F98">
<td class="addr"><a href="#addr-9F98">9F98</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr id="addr-9F9B">
<td class="addr"><a href="#addr-9F9B">9F9B</a></td>
<td>    <span class="opcode">BCC</span> <span class="operand"><a href="#addr-9FA4">c9fa4</a></span></td>
<td class="hex">90 07</td>
</tr>

<tr id="addr-9F9D">
<td class="addr"><a href="#addr-9F9D">9F9D</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D5C">scout_status</a></span></td>
<td class="hex">AD 5C 0D</td>
</tr>

<tr id="addr-9FA0">
<td class="addr"><a href="#addr-9FA0">9FA0</a></td>
<td>    <span class="opcode">JSR</span> <span class="operand"><a href="#addr-0406">tube_addr_claim</a></span></td>
<td class="hex">20 06 04</td>
</tr>

<tr id="addr-9FA3">
<td class="addr"><a href="#addr-9FA3">9FA3</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9FA4">
<td class="addr"><a href="#addr-9FA4">9FA4</a></td>
<td><span class="label">.c9fa4</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9FA5">
<td class="addr"><a href="#addr-9FA5">9FA5</a></td>
<td>    <span class="opcode">TAX</span></td>
<td class="hex">AA</td>
</tr>

<tr id="addr-9FA6">
<td class="addr"><a href="#addr-9FA6">9FA6</a></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr id="addr-9FA7">
<td class="addr"><a href="#addr-9FA7">9FA7</a></td>
<td><span class="label">.c9fa7</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-9FA9">
<td class="addr"><a href="#addr-9FA9">9FA9</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9FAB">
<td class="addr"><a href="#addr-9FAB">9FAB</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-9FAD">
<td class="addr"><a href="#addr-9FAD">9FAD</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9FAE">
<td class="addr"><a href="#addr-9FAE">9FAE</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">F1 A0</td>
</tr>

<tr id="addr-9FB0">
<td class="addr"><a href="#addr-9FB0">9FB0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A2">port_buf_len</a></span></td>
<td class="hex">85 A2</td>
</tr>

<tr id="addr-9FB2">
<td class="addr"><a href="#addr-9FB2">9FB2</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#5</span></td>
<td class="hex">A0 05</td>
</tr>

<tr id="addr-9FB4">
<td class="addr"><a href="#addr-9FB4">9FB4</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9FB6">
<td class="addr"><a href="#addr-9FB6">9FB6</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">#0</span></td>
<td class="hex">E9 00</td>
</tr>

<tr id="addr-9FB8">
<td class="addr"><a href="#addr-9FB8">9FB8</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">85 A5</td>
</tr>

<tr id="addr-9FBA">
<td class="addr"><a href="#addr-9FBA">9FBA</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#8</span></td>
<td class="hex">A0 08</td>
</tr>

<tr id="addr-9FBC">
<td class="addr"><a href="#addr-9FBC">9FBC</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9FBE">
<td class="addr"><a href="#addr-9FBE">9FBE</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A4">open_port_buf</a></span></td>
<td class="hex">85 A4</td>
</tr>

<tr id="addr-9FC0">
<td class="addr"><a href="#addr-9FC0">9FC0</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#9</span></td>
<td class="hex">A0 09</td>
</tr>

<tr id="addr-9FC2">
<td class="addr"><a href="#addr-9FC2">9FC2</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9FC4">
<td class="addr"><a href="#addr-9FC4">9FC4</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9FC5">
<td class="addr"><a href="#addr-9FC5">9FC5</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand"><a href="#addr-00A5">open_port_buf_hi</a></span></td>
<td class="hex">E5 A5</td>
</tr>

<tr id="addr-9FC7">
<td class="addr"><a href="#addr-9FC7">9FC7</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-00A3">port_buf_len_hi</a></span></td>
<td class="hex">85 A3</td>
</tr>

<tr id="addr-9FC9">
<td class="addr"><a href="#addr-9FC9">9FC9</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9FCA">
<td class="addr"><a href="#addr-9FCA">9FCA</a></td>
<td><span class="label">.nmi_shim_rom_src</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">RTS</span></td>
<td class="hex">60</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Bootstrap NMI entry point (in ROM)</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; An alternate NMI handler that lives in the ROM itself rather than</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; in the RAM workspace at $0D00. Unlike the RAM shim (which uses a</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; self-modifying JMP to dispatch to different handlers), this one</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; hardcodes JMP nmi_rx_scout ($96F6). Used as the initial NMI handler</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; before the workspace has been properly set up during initialisation.</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; Same sequence as the RAM shim: BIT $FE18 (INTOFF), PHA, TYA, PHA,</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; LDA romsel, STA $FE30, JMP $96F6.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9FCB">
<td class="addr"><a href="#addr-9FCB">9FCB</a></td>
<td><span class="label">.nmi_bootstrap_entry</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE18">station_id_disable_net_nmis</a></span></td>
<td class="hex">2C 18 FE</td>
</tr>

<tr id="addr-9FCE">
<td class="addr"><a href="#addr-9FCE">9FCE</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9FCF">
<td class="addr"><a href="#addr-9FCF">9FCF</a></td>
<td>    <span class="opcode">TYA</span></td>
<td class="hex">98</td>
</tr>

<tr id="addr-9FD0">
<td class="addr"><a href="#addr-9FD0">9FD0</a></td>
<td>    <span class="opcode">PHA</span></td>
<td class="hex">48</td>
</tr>

<tr id="addr-9FD1">
<td class="addr"><a href="#addr-9FD1">9FD1</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">#0</span></td>
<td class="hex">A9 00</td>
</tr>

<tr id="addr-9FD3">
<td class="addr"><a href="#addr-9FD3">9FD3</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FE30">romsel</a></span></td>
<td class="hex">8D 30 FE</td>
</tr>

<tr id="addr-9FD6">
<td class="addr"><a href="#addr-9FD6">9FD6</a></td>
<td>    <span class="opcode">JMP</span> <span class="operand"><a href="#addr-96F6">nmi_rx_scout</a></span></td>
<td class="hex">4C F6 96</td>
</tr>

<tr>
<td class="addr"></td>
<td></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; ROM copy of set_nmi_vector + nmi_rti</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; A version of the NMI vector-setting subroutine and RTI sequence</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; that lives in ROM. The RAM workspace copy at $0D0E/$0D14 is the</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; one normally used at runtime; this ROM copy is used during early</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; initialisation before the RAM workspace has been set up, and as</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td><span class="comment">; the source for the initial copy to RAM.</span></td>
<td class="hex"></td>
</tr>

<tr id="addr-9FD9">
<td class="addr"><a href="#addr-9FD9">9FD9</a></td>
<td><span class="label">.rom_set_nmi_vector</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">STY</span> <span class="operand"><a href="#addr-0D0D">nmi_jmp_hi</a></span></td>
<td class="hex">8C 0D 0D</td>
</tr>

<tr id="addr-9FDC">
<td class="addr"><a href="#addr-9FDC">9FDC</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D0C">nmi_jmp_lo</a></span></td>
<td class="hex">8D 0C 0D</td>
</tr>

<tr id="addr-9FDF">
<td class="addr"><a href="#addr-9FDF">9FDF</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-00F4">romsel_copy</a></span></td>
<td class="hex">A5 F4</td>
</tr>

<tr id="addr-9FE1">
<td class="addr"><a href="#addr-9FE1">9FE1</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-FE30">romsel</a></span></td>
<td class="hex">8D 30 FE</td>
</tr>

<tr id="addr-9FE4">
<td class="addr"><a href="#addr-9FE4">9FE4</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9FE5">
<td class="addr"><a href="#addr-9FE5">9FE5</a></td>
<td>    <span class="opcode">TAY</span></td>
<td class="hex">A8</td>
</tr>

<tr id="addr-9FE6">
<td class="addr"><a href="#addr-9FE6">9FE6</a></td>
<td>    <span class="opcode">PLA</span></td>
<td class="hex">68</td>
</tr>

<tr id="addr-9FE7">
<td class="addr"><a href="#addr-9FE7">9FE7</a></td>
<td>    <span class="opcode">BIT</span> <span class="operand"><a href="#addr-FE20">video_ula_control</a></span></td>
<td class="hex">2C 20 FE</td>
</tr>

<tr id="addr-9FEA">
<td class="addr"><a href="#addr-9FEA">9FEA</a></td>
<td>    <span class="opcode">RTI</span></td>
<td class="hex">40</td>
</tr>

<tr id="addr-9FEB">
<td class="addr"><a href="#addr-9FEB">9FEB</a></td>
<td><span class="label">.rom_nmi_tail</span></td>
<td class="hex"></td>
</tr>

<tr>
<td class="addr"></td>
<td>    <span class="opcode">LDA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">AD 4A 0D</td>
</tr>

<tr id="addr-9FEE">
<td class="addr"><a href="#addr-9FEE">9FEE</a></td>
<td>    <span class="opcode">ORA</span> <span class="operand">#2</span></td>
<td class="hex">09 02</td>
</tr>

<tr id="addr-9FF0">
<td class="addr"><a href="#addr-9FF0">9FF0</a></td>
<td>    <span class="opcode">STA</span> <span class="operand"><a href="#addr-0D4A">tx_flags</a></span></td>
<td class="hex">8D 4A 0D</td>
</tr>

<tr id="addr-9FF3">
<td class="addr"><a href="#addr-9FF3">9FF3</a></td>
<td>    <span class="opcode">SEC</span></td>
<td class="hex">38</td>
</tr>

<tr id="addr-9FF4">
<td class="addr"><a href="#addr-9FF4">9FF4</a></td>
<td>    <span class="opcode">PHP</span></td>
<td class="hex">08</td>
</tr>

<tr id="addr-9FF5">
<td class="addr"><a href="#addr-9FF5">9FF5</a></td>
<td>    <span class="opcode">LDY</span> <span class="operand">#4</span></td>
<td class="hex">A0 04</td>
</tr>

<tr id="addr-9FF7">
<td class="addr"><a href="#addr-9FF7">9FF7</a></td>
<td>    <span class="opcode">LDA</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">B1 A0</td>
</tr>

<tr id="addr-9FF9">
<td class="addr"><a href="#addr-9FF9">9FF9</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;05</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9FFA">
<td class="addr"><a href="#addr-9FFA">9FFA</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;06</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9FFB">
<td class="addr"><a href="#addr-9FFB">9FFB</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;07</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9FFC">
<td class="addr"><a href="#addr-9FFC">9FFC</a></td>
<td>    <span class="opcode">INY</span>  <span class="comment">; Y=&amp;08</span></td>
<td class="hex">C8</td>
</tr>

<tr id="addr-9FFD">
<td class="addr"><a href="#addr-9FFD">9FFD</a></td>
<td>    <span class="opcode">PLP</span></td>
<td class="hex">28</td>
</tr>

<tr id="addr-9FFE">
<td class="addr"><a href="#addr-9FFE">9FFE</a></td>
<td>    <span class="opcode">SBC</span> <span class="operand">(<a href="#addr-00A0">nmi_tx_block</a>),y</span></td>
<td class="hex">F1 A0</td>
</tr>

</table>
</div>
</div>

    </main>

    <footer class="site-footer">
        <div class="container">
            acornaeology.uk
        </div>
    </footer>
</body>
</html>